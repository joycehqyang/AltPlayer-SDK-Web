function hex_sha1(e){return binb2hex(core_sha1(str2binb(e),e.length*chrsz))}function b64_sha1(e){return binb2b64(core_sha1(str2binb(e),e.length*chrsz))}function str_sha1(e){return binb2str(core_sha1(str2binb(e),e.length*chrsz))}function hex_hmac_sha1(e,t){return binb2hex(core_hmac_sha1(e,t))}function b64_hmac_sha1(e,t){return binb2b64(core_hmac_sha1(e,t))}function str_hmac_sha1(e,t){return binb2str(core_hmac_sha1(e,t))}function sha1_vm_test(){return"a9993e364706816aba3e25717850c26c9cd0d89d"==hex_sha1("abc")}function core_sha1(e,t){e[t>>5]|=128<<24-t%32,e[(t+64>>9<<4)+15]=t;for(var n=Array(80),i=1732584193,r=-271733879,a=-1732584194,o=271733878,s=-1009589776,u=0;u<e.length;u+=16){for(var l=i,c=r,h=a,d=o,f=s,p=0;p<80;p++){p<16?n[p]=e[u+p]:n[p]=rol(n[p-3]^n[p-8]^n[p-14]^n[p-16],1);var m=safe_add(safe_add(rol(i,5),sha1_ft(p,r,a,o)),safe_add(safe_add(s,n[p]),sha1_kt(p)));s=o,o=a,a=rol(r,30),r=i,i=m}i=safe_add(i,l),r=safe_add(r,c),a=safe_add(a,h),o=safe_add(o,d),s=safe_add(s,f)}return Array(i,r,a,o,s)}function sha1_ft(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function sha1_kt(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function core_hmac_sha1(e,t){var n=str2binb(e);n.length>16&&(n=core_sha1(n,e.length*chrsz));for(var i=Array(16),r=Array(16),a=0;a<16;a++)i[a]=909522486^n[a],r[a]=1549556828^n[a];var o=core_sha1(i.concat(str2binb(t)),512+t.length*chrsz);return core_sha1(r.concat(o),672)}function safe_add(e,t){var n=(65535&e)+(65535&t),i=(e>>16)+(t>>16)+(n>>16);return i<<16|65535&n}function rol(e,t){return e<<t|e>>>32-t}function str2binb(e){for(var t=Array(),n=(1<<chrsz)-1,i=0;i<e.length*chrsz;i+=chrsz)t[i>>5]|=(e.charCodeAt(i/chrsz)&n)<<24-i%32;return t}function binb2str(e){for(var t="",n=(1<<chrsz)-1,i=0;i<32*e.length;i+=chrsz)t+=String.fromCharCode(e[i>>5]>>>24-i%32&n);return t}function binb2hex(e){for(var t=hexcase?"0123456789ABCDEF":"0123456789abcdef",n="",i=0;i<4*e.length;i++)n+=t.charAt(e[i>>2]>>8*(3-i%4)+4&15)+t.charAt(e[i>>2]>>8*(3-i%4)&15);return n}function binb2b64(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n="",i=0;i<4*e.length;i+=3)for(var r=(e[i>>2]>>8*(3-i%4)&255)<<16|(e[i+1>>2]>>8*(3-(i+1)%4)&255)<<8|e[i+2>>2]>>8*(3-(i+2)%4)&255,a=0;a<4;a++)n+=8*i+6*a>32*e.length?b64pad:t.charAt(r>>6*(3-a)&63);return n}function VRVIUPlayer2D(e){function t(){var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen&&e.webkitRequestFullScreen()}function n(e){var t;return e.traverse(function(e){e instanceof THREE.Mesh&&(t=e)}),t}function i(t){var n={Format:"JSON",Version:"2016-11-01",AppId:e.AppId,AccessKeyId:e.AccessKeyId,BizId:e.BizId,Timestamp:(new Date).format("yyyy-MM-ddThh:mm:ssZ"),SignatureMethod:"HMAC-SHA1",SignatureVersion:"1.0",SignatureNonce:r()},s=["Format","Version","AppId","AccessKeyId","BizId","Timestamp","SignatureMethod","SignatureVersion","SignatureNonce"];n.Signature=a(n,s),$.ajax({url:"https://auth-api.vrviu.com/auth?",type:"GET",data:n,timeout:5e3}).done(function(e){if(e.AuthInfo){var n=e.AuthInfo,r=["AppId","Cycle","Nonce","Permission","Timestamp"];n.Signature=a(n,r),n.Signature==e.AuthInfo.Signature&&n.Nonce==e.AuthInfo.Nonce?(1==e.AuthInfo.Permission?(sessionStorage.setItem("isRender","true"),sessionStorage.setItem("timestamp",1e3*e.AuthInfo.Timestamp)):sessionStorage.setItem("isRender","false"),requestId2=setTimeout(function(){i(t)},1e3*e.AuthInfo.Cycle)):sessionStorage.setItem("isRender","false")}}).fail(function(e){o(t)}).always(function(e){})}function r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function a(t,n){var i=n,r="",a=[];i=i.sort();for(var o=0;o<i.length;o++)a.push(escape(i[o])+"="+escape(t[i[o]]));return r="GET&%2F&"+escape(a.join("&")),b64_hmac_sha1(e.AccessKeySecret+"&",r)+"="}function o(e){e<2?setTimeout(function(){i(e+1)},5e3):sessionStorage.setItem("isRender","false")}var s=['\t<video id="myvideo"  crossorigin="anonymous" preload="auto" style="display: none;"></video>','\t<span id="playBtn" class="playBtn init"></span>','\t<span id="pauseBtn" class="pauseBtn"></span>','\t<div id="container"></div>'].join("");$("body").append(s);var u=document.getElementById("playBtn"),l=document.getElementById("pauseBtn"),c=document.getElementById("myvideo"),h=document.getElementById("container"),d=!1;if(Date.prototype.format=function(e){var t={"M+":this.getUTCMonth()+1,"d+":this.getUTCDate(),"h+":this.getUTCHours(),"m+":this.getUTCMinutes(),"s+":this.getUTCSeconds(),"q+":Math.floor((this.getUTCMonth()+3)/3),S:this.getUTCMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getUTCFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e},flvjs.isSupported()){var f=flvjs.createPlayer({type:"flv",url:e.url,isLive:e.isLive,isFilter:!0,isMapping:!0,filterVision:1.3});f.attachMediaElement(c),f.load();var p=0;i(p)}u.addEventListener("click",function(){if(d)c.play(),u.style.display="none";else{d=!0,c.play(),t(),u.style.display="none";var i=new THREE.Scene,r=new THREE.PerspectiveCamera(90,1,.1,1e3),a=new THREE.WebGLRenderer;window.innerWidth<window.innerHeight?a.setSize(window.innerWidth,16*window.innerWidth/9):a.setSize(9*window.innerHeight/16,window.innerHeight),h.appendChild(a.domElement);var o,s=new THREE.OBJLoader((void 0));s.load("https://img.vrviu.com/static/mesh/2d_q3.obj",function(t){var a=new THREE.VideoTexture(c);a.minFilter=THREE.LinearFilter,a.magFilter=THREE.LinearFilter,a.format=THREE.RGBAFormat,e.isMapping?(a.flipY=!1,o=n(t)):(a.flipY=!0,o=new THREE.Mesh,o.geometry=new THREE.PlaneGeometry(4,2)),o.material=new THREE.MeshBasicMaterial({color:16777215,map:a,side:THREE.DoubleSide}),i.add(o),r.position.z=1});var l=function(){requestAnimationFrame(l),a.render(i,r)};l()}},!1),l.addEventListener("click",function(){u.style.display="block",c.pause(),l.style.display="none"}),document.body.addEventListener("click",function(){if("block"!=u.style.display){l.style.display="block";setTimeout(function(){l.style.display="none"},5e3)}})}!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.flvjs=e()}}(function(){var e;return function t(e,n,i){function r(o,s){if(!n[o]){if(!e[o]){var u="function"==typeof require&&require;if(!s&&u)return u(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[o]={exports:{}};e[o][0].call(c.exports,function(t){var n=e[o][1][t];return r(n?n:t)},c,c.exports,t,e,n,i)}return n[o].exports}for(var a="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(t,module,exports){(function(n,i){!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof e&&e.amd?e(n):t.ES6Promise=n()}(this,function(){"use strict";function e(e){return"function"==typeof e||"object"==typeof e&&null!==e}function r(e){return"function"==typeof e}function a(e){K=e}function o(e){Z=e}function s(){return function(){return n.nextTick(d)}}function u(){return"undefined"!=typeof Y?function(){Y(d)}:h()}function l(){var e=0,t=new ee(d),n=document.createTextNode("");return t.observe(n,{characterData:!0}),function(){n.data=e=++e%2}}function c(){var e=new MessageChannel;return e.port1.onmessage=d,function(){return e.port2.postMessage(0)}}function h(){var e=setTimeout;return function(){return e(d,1)}}function d(){for(var e=0;e<X;e+=2){var t=ie[e],n=ie[e+1];t(n),ie[e]=void 0,ie[e+1]=void 0}X=0}function f(){try{var e=t,n=e("vertx");return Y=n.runOnLoop||n.runOnContext,u()}catch(i){return h()}}function p(e,t){var n=arguments,i=this,r=new this.constructor(g);void 0===r[ae]&&D(r);var a=i._state;return a?!function(){var e=n[a-1];Z(function(){return I(a,r,e,i._result)})}():L(i,r,e,t),r}function m(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var n=new t(g);return S(n,e),n}function g(){}function v(){return new TypeError("You cannot resolve a promise with itself")}function y(){return new TypeError("A promises callback cannot return that same promise.")}function _(e){try{return e.then}catch(t){return le.error=t,le}}function x(e,t,n,i){try{e.call(t,n,i)}catch(r){return r}}function b(e,t,n){Z(function(e){var i=!1,r=x(n,t,function(n){i||(i=!0,t!==n?S(e,n):T(e,n))},function(t){i||(i=!0,A(e,t))},"Settle: "+(e._label||" unknown promise"));!i&&r&&(i=!0,A(e,r))},e)}function w(e,t){t._state===se?T(e,t._result):t._state===ue?A(e,t._result):L(t,void 0,function(t){return S(e,t)},function(t){return A(e,t)})}function E(e,t,n){t.constructor===e.constructor&&n===p&&t.constructor.resolve===m?w(e,t):n===le?(A(e,le.error),le.error=null):void 0===n?T(e,t):r(n)?b(e,t,n):T(e,t)}function S(t,n){t===n?A(t,v()):e(n)?E(t,n,_(n)):T(t,n)}function M(e){e._onerror&&e._onerror(e._result),R(e)}function T(e,t){e._state===oe&&(e._result=t,e._state=se,0!==e._subscribers.length&&Z(R,e))}function A(e,t){e._state===oe&&(e._state=ue,e._result=t,Z(M,e))}function L(e,t,n,i){var r=e._subscribers,a=r.length;e._onerror=null,r[a]=t,r[a+se]=n,r[a+ue]=i,0===a&&e._state&&Z(R,e)}function R(e){var t=e._subscribers,n=e._state;if(0!==t.length){for(var i=void 0,r=void 0,a=e._result,o=0;o<t.length;o+=3)i=t[o],r=t[o+n],i?I(n,i,r,a):r(a);e._subscribers.length=0}}function C(){this.error=null}function P(e,t){try{return e(t)}catch(n){return ce.error=n,ce}}function I(e,t,n,i){var a=r(n),o=void 0,s=void 0,u=void 0,l=void 0;if(a){if(o=P(n,i),o===ce?(l=!0,s=o.error,o.error=null):u=!0,t===o)return void A(t,y())}else o=i,u=!0;t._state!==oe||(a&&u?S(t,o):l?A(t,s):e===se?T(t,o):e===ue&&A(t,o))}function O(e,t){try{t(function(t){S(e,t)},function(t){A(e,t)})}catch(n){A(e,n)}}function k(){return he++}function D(e){e[ae]=he++,e._state=void 0,e._result=void 0,e._subscribers=[]}function N(e,t){this._instanceConstructor=e,this.promise=new e(g),this.promise[ae]||D(this.promise),q(t)?(this._input=t,this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?T(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&T(this.promise,this._result))):A(this.promise,U())}function U(){return new Error("Array Methods must be provided an Array")}function B(e){return new N(this,e).promise}function F(e){var t=this;return new t(q(e)?function(n,i){for(var r=e.length,a=0;a<r;a++)t.resolve(e[a]).then(n,i)}:function(e,t){return t(new TypeError("You must pass an array to race."))})}function j(e){var t=this,n=new t(g);return A(n,e),n}function z(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(e){this[ae]=k(),this._result=this._state=void 0,this._subscribers=[],g!==e&&("function"!=typeof e&&z(),this instanceof H?O(this,e):G())}function V(){var e=void 0;if("undefined"!=typeof i)e=i;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(t){throw new Error("polyfill failed because global object is unavailable in this environment")}var n=e.Promise;if(n){var r=null;try{r=Object.prototype.toString.call(n.resolve())}catch(t){}if("[object Promise]"===r&&!n.cast)return}e.Promise=H}var W=void 0;W=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)};var q=W,X=0,Y=void 0,K=void 0,Z=function(e,t){ie[X]=e,ie[X+1]=t,X+=2,2===X&&(K?K(d):re())},J="undefined"!=typeof window?window:void 0,Q=J||{},ee=Q.MutationObserver||Q.WebKitMutationObserver,te="undefined"==typeof self&&"undefined"!=typeof n&&"[object process]"==={}.toString.call(n),ne="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,ie=new Array(1e3),re=void 0;re=te?s():ee?l():ne?c():void 0===J&&"function"==typeof t?f():h();var ae=Math.random().toString(36).substring(16),oe=void 0,se=1,ue=2,le=new C,ce=new C,he=0;return N.prototype._enumerate=function(){for(var e=this.length,t=this._input,n=0;this._state===oe&&n<e;n++)this._eachEntry(t[n],n)},N.prototype._eachEntry=function(e,t){var n=this._instanceConstructor,i=n.resolve;if(i===m){var r=_(e);if(r===p&&e._state!==oe)this._settledAt(e._state,t,e._result);else if("function"!=typeof r)this._remaining--,this._result[t]=e;else if(n===H){var a=new n(g);E(a,e,r),this._willSettleAt(a,t)}else this._willSettleAt(new n(function(t){return t(e)}),t)}else this._willSettleAt(i(e),t)},N.prototype._settledAt=function(e,t,n){var i=this.promise;i._state===oe&&(this._remaining--,e===ue?A(i,n):this._result[t]=n),0===this._remaining&&T(i,this._result)},N.prototype._willSettleAt=function(e,t){var n=this;L(e,void 0,function(e){return n._settledAt(se,t,e)},function(e){return n._settledAt(ue,t,e)})},H.all=B,H.race=F,H.resolve=m,H.reject=j,H._setScheduler=a,H._setAsap=o,H._asap=Z,H.prototype={constructor:H,then:p,"catch":function(e){return this.then(null,e)}},H.polyfill=V,H.Promise=H,H})}).call(this,t("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:3}],2:[function(e,module,exports){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function i(e){return"number"==typeof e}function r(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}module.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!i(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},t.prototype.emit=function(e){var t,i,o,s,u,l;if(this._events||(this._events={}),"error"===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length)){if(t=arguments[1],t instanceof Error)throw t;var c=new Error('Uncaught, unspecified "error" event. ('+t+")");throw c.context=t,c}if(i=this._events[e],a(i))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:s=Array.prototype.slice.call(arguments,1),i.apply(this,s)}else if(r(i))for(s=Array.prototype.slice.call(arguments,1),l=i.slice(),o=l.length,u=0;u<o;u++)l[u].apply(this,s);return!0},t.prototype.addListener=function(e,i){var o;if(!n(i))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(i.listener)?i.listener:i),this._events[e]?r(this._events[e])?this._events[e].push(i):this._events[e]=[this._events[e],i]:this._events[e]=i,r(this._events[e])&&!this._events[e].warned&&(o=a(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,o&&o>0&&this._events[e].length>o&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function i(){this.removeListener(e,i),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError("listener must be a function");var r=!1;return i.listener=t,this.on(e,i),this},t.prototype.removeListener=function(e,t){var i,a,o,s;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=this._events[e],o=i.length,a=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(r(i)){for(s=o;s-- >0;)if(i[s]===t||i[s].listener&&i[s].listener===t){a=s;break}if(a<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},t.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(i=this._events[e],n(i))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},{}],3:[function(e,module,exports){function t(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function i(e){if(l===setTimeout)return setTimeout(e,0);if((l===t||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(n){try{return l.call(null,e,0)}catch(n){return l.call(this,e,0)}}}function r(e){if(c===clearTimeout)return clearTimeout(e);if((c===n||!c)&&clearTimeout)return c=clearTimeout,clearTimeout(e);try{return c(e)}catch(t){try{return c.call(null,e)}catch(t){return c.call(this,e)}}}function a(){p&&d&&(p=!1,d.length?f=d.concat(f):m=-1,f.length&&o())}function o(){if(!p){var e=i(a);p=!0;for(var t=f.length;t;){for(d=f,f=[];++m<t;)d&&d[m].run();m=-1,t=f.length}d=null,p=!1,r(e)}}function s(e,t){this.fun=e,this.array=t}function u(){}var l,c,h=module.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:t}catch(e){l=t}try{c="function"==typeof clearTimeout?clearTimeout:n}catch(e){c=n}}();var d,f=[],p=!1,m=-1;h.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];f.push(new s(e,t)),1!==f.length||p||i(o)},s.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=u,h.addListener=u,h.once=u,h.off=u,h.removeListener=u,h.removeAllListeners=u,h.emit=u,h.prependListener=u,h.prependOnceListener=u,h.listeners=function(e){return[]},h.binding=function(e){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(e){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},{}],4:[function(e,module,exports){var t=arguments[3],n=arguments[4],i=arguments[5],r=JSON.stringify;module.exports=function(e,a){function o(e){g[e]=!0;for(var t in n[e][1]){var i=n[e][1][t];g[i]||o(i)}}for(var s,u=Object.keys(i),l=0,c=u.length;l<c;l++){var h=u[l],d=i[h].exports;if(d===e||d&&d["default"]===e){s=h;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},l=0,c=u.length;l<c;l++){var h=u[l];f[h]=h}n[s]=[Function(["require","module","exports"],"("+e+")(self)"),f]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[s]=s,n[p]=[Function(["require"],"var f = require("+r(s)+");(f.default ? f.default : f)(self);"),m];var g={};o(p);var v="("+t+")({"+Object.keys(g).map(function(e){return r(e)+":["+n[e][0]+","+r(n[e][1])+"]"}).join(",")+"},{},["+r(p)+"])",y=window.URL||window.webkitURL||window.mozURL||window.msURL,_=new Blob([v],{type:"text/javascript"});if(a&&a.bare)return _;var x=y.createObjectURL(_),b=new Worker(x);return b.objectURL=x,b}},{}],5:[function(e,module,exports){"use strict";function t(){return Object.assign({},n)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.createDefaultConfig=t;var n=exports.defaultConfig={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1}},{}],6:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("../io/io-controller.js"),a=t(r),o=e("../config.js"),s=function(){function e(){n(this,e)}return i(e,null,[{key:"supportMSEH264Playback",value:function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')}},{key:"supportNetworkStreamIO",value:function(){var e=new a["default"]({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t}},{key:"getNetworkLoaderTypeName",value:function(){var e=new a["default"]({},(0,o.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t}},{key:"supportNativeMediaPlayback",value:function(t){void 0==e.videoElement&&(e.videoElement=window.document.createElement("video"));var n=e.videoElement.canPlayType(t);return"probably"===n||"maybe"==n}},{key:"getFeatureList",value:function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t}}]),e}();exports["default"]=s},{"../config.js":5,"../io/io-controller.js":23}],7:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(){t(this,e),this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return n(e,[{key:"isComplete",value:function(){var e=this.hasAudio===!1||this.hasAudio===!0&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=this.hasVideo===!1||this.hasVideo===!0&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t}},{key:"isSeekable",value:function(){return this.hasKeyframesIndex===!0}},{key:"getNearestKeyframe",value:function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,n=this._search(t.times,e);return{index:n,milliseconds:t.times[n],fileposition:t.filepositions[n]}}},{key:"_search",value:function(e,t){var n=0,i=e.length-1,r=0,a=0,o=i;for(t<e[0]&&(n=0,a=o+1);a<=o;){if(r=a+Math.floor((o-a)/2),r===i||t>=e[r]&&t<e[r+1]){n=r;break}e[r]<t?a=r+1:o=r-1}return n}}]),e}();exports["default"]=i},{}],8:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();exports.SampleInfo=function i(e,n,r,a,o){t(this,i),this.dts=e,this.pts=n,this.duration=r,this.originalDts=a,this.isSyncPoint=o,this.fileposition=null},exports.MediaSegmentInfo=function(){function e(){t(this,e),this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return n(e,[{key:"appendSyncPoint",value:function(e){e.isSyncPoint=!0,this.syncPoints.push(e)}}]),e}(),exports.IDRSampleList=function(){function e(){t(this,e),this._list=[]}return n(e,[{key:"clear",value:function(){this._list=[]}},{key:"appendArray",value:function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))}},{key:"getLastSyncPointBeforeDts",value:function(e){if(0==this._list.length)return null;var t=this._list,n=0,i=t.length-1,r=0,a=0,o=i;for(e<t[0].dts&&(n=0,a=o+1);a<=o;){if(r=a+Math.floor((o-a)/2),r===i||e>=t[r].dts&&e<t[r+1].dts){n=r;break}t[r].dts<e?a=r+1:o=r-1}return this._list[n]}}]),e}(),exports.MediaSegmentInfoList=function(){function e(n){t(this,e),this._type=n,this._list=[],this._lastAppendLocation=-1}return n(e,[{key:"isEmpty",value:function(){return 0===this._list.length}},{key:"clear",value:function(){this._list=[],this._lastAppendLocation=-1}},{key:"_searchNearestSegmentBefore",value:function(e){var t=this._list;if(0===t.length)return-2;var n=t.length-1,i=0,r=0,a=n,o=0;if(e<t[0].originalBeginDts)return o=-1;for(;r<=a;){if(i=r+Math.floor((a-r)/2),i===n||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){o=i;break}t[i].originalBeginDts<e?r=i+1:a=i-1}return o}},{key:"_searchNearestSegmentAfter",value:function(e){return this._searchNearestSegmentBefore(e)+1}},{key:"append",value:function(e){var t=this._list,n=e,i=this._lastAppendLocation,r=0;i!==-1&&i<t.length&&n.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&n.originalBeginDts<t[i+1].originalBeginDts)?r=i+1:t.length>0&&(r=this._searchNearestSegmentBefore(n.originalBeginDts)+1),this._lastAppendLocation=r,this._list.splice(r,0,n)}},{key:"getLastSegmentBefore",value:function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null}},{key:"getLastSampleBefore",value:function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null}},{key:"getLastSyncPointBefore",value:function(e){for(var t=this._searchNearestSegmentBefore(e),n=this._list[t].syncPoints;0===n.length&&t>0;)t--,n=this._list[t].syncPoints;return n.length>0?n[n.length-1]:null}},{key:"type",get:function(){return this._type}},{key:"length",get:function(){return this._list.length}}]),e}()},{}],9:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("events"),a=t(r),o=e("../utils/logger.js"),s=t(o),u=e("../utils/browser.js"),l=t(u),c=e("./mse-events.js"),h=t(c),d=e("./media-segment-info.js"),f=e("../utils/exception.js"),p=function(){function e(t){n(this,e),this.TAG="MSEController",this._config=t,this._emitter=new a["default"],this._config.isLive&&void 0==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new d.IDRSampleList}return i(e,[{key:"destroy",value:function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaSource)throw new f.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL}},{key:"detachMediaElement",value:function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var n=this._pendingSegments[t];n.splice(0,n.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];i&&("closed"!==e.readyState&&(e.removeSourceBuffer(i),i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)),this._mimeTypes[t]=null,this._sourceBuffers[t]=null)}if("open"===e.readyState)try{e.endOfStream()}catch(r){s["default"].e(this.TAG,r.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)}},{key:"appendInitSegment",value:function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var n=e,i=""+n.container;n.codec&&n.codec.length>0&&(i+=";codecs="+n.codec);var r=!1;if(s["default"].v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[n.type]=n,i!==this._mimeTypes[n.type]){if(this._mimeTypes[n.type])s["default"].v(this.TAG,"Notice: "+n.type+" mimeType changed, origin: "+this._mimeTypes[n.type]+", target: "+i);else{r=!0;try{var a=this._sourceBuffers[n.type]=this._mediaSource.addSourceBuffer(i);a.addEventListener("error",this.e.onSourceBufferError),a.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(o){return s["default"].e(this.TAG,o.message),void this._emitter.emit(h["default"].ERROR,{
code:o.code,msg:o.message})}}this._mimeTypes[n.type]=i}t||this._pendingSegments[n.type].push(n),r||this._sourceBuffers[n.type]&&!this._sourceBuffers[n.type].updating&&this._doAppendSegments(),l["default"].safari&&"audio/mpeg"===n.container&&n.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=n.mediaDuration/1e3,this._updateMediaSourceDuration())}},{key:"appendMediaSegment",value:function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var n=this._sourceBuffers[t.type];!n||n.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()}},{key:"seek",value:function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var n=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{n.abort()}catch(i){s["default"].e(this.TAG,i.message)}this._idrList.clear();var r=this._pendingSegments[t];if(r.splice(0,r.length),"closed"!==this._mediaSource.readyState){for(var a=0;a<n.buffered.length;a++){var o=n.buffered.start(a),u=n.buffered.end(a);this._pendingRemoveRanges[t].push({start:o,end:u})}if(n.updating||this._doRemoveRanges(),l["default"].safari){var c=this._lastInitSegments[t];c&&(this._pendingSegments[t].push(c),n.updating||this._doAppendSegments())}}}}},{key:"endOfStream",value:function(){var e=this._mediaSource,t=this._sourceBuffers;return e&&"open"===e.readyState?void(t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream())):void(e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0))}},{key:"getNearestKeyframe",value:function(e){return this._idrList.getLastSyncPointBeforeDts(e)}},{key:"_needCleanupSourceBuffer",value:function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){var i=n.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1}},{key:"_doCleanupSourceBuffer",value:function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var n=this._sourceBuffers[t];if(n){for(var i=n.buffered,r=!1,a=0;a<i.length;a++){var o=i.start(a),s=i.end(a);if(o<=e&&e<s+3){if(e-o>=this._config.autoCleanupMaxBackwardDuration){r=!0;var u=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:o,end:u})}}else s<e&&(r=!0,this._pendingRemoveRanges[t].push({start:o,end:s}))}r&&!n.updating&&this._doRemoveRanges()}}}},{key:"_updateMediaSourceDuration",value:function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,n=this._pendingMediaDuration;n>0&&(isNaN(t)||n>t)&&(s["default"].v(this.TAG,"Update MediaSource duration from "+t+" to "+n),this._mediaSource.duration=n),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}}},{key:"_doRemoveRanges",value:function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],n=this._pendingRemoveRanges[e];n.length&&!t.updating;){var i=n.shift();t.remove(i.start,i.end)}}},{key:"_doAppendSegments",value:function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var n=e[t].shift();if(n.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,r=n.timestampOffset/1e3,a=Math.abs(i-r);a>.1&&(s["default"].v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+r),this._sourceBuffers[t].timestampOffset=r),delete n.timestampOffset}if(!n.data||0===n.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(n.data),this._isBufferFull=!1,"video"===t&&n.hasOwnProperty("info")&&this._idrList.appendArray(n.info.syncPoints)}catch(o){this._pendingSegments[t].unshift(n),22===o.code?(this._isBufferFull||this._emitter.emit(h["default"].BUFFER_FULL),this._isBufferFull=!0):(s["default"].e(this.TAG,o.message),this._emitter.emit(h["default"].ERROR,{code:o.code,msg:o.message}))}}}},{key:"_onSourceOpen",value:function(){if(s["default"].v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(h["default"].SOURCE_OPEN)}},{key:"_onSourceEnded",value:function(){s["default"].v(this.TAG,"MediaSource onSourceEnded")}},{key:"_onSourceClose",value:function(){s["default"].v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))}},{key:"_hasPendingSegments",value:function(){var e=this._pendingSegments;return e.video.length>0||e.audio.length>0}},{key:"_hasPendingRemoveRanges",value:function(){var e=this._pendingRemoveRanges;return e.video.length>0||e.audio.length>0}},{key:"_onSourceBufferUpdateEnd",value:function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(h["default"].UPDATE_END)}},{key:"_onSourceBufferError",value:function(e){s["default"].e(this.TAG,"SourceBuffer Error: "+e)}}]),e}();exports["default"]=p},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./media-segment-info.js":8,"./mse-events.js":10,events:2}],10:[function(e,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"};exports["default"]=t},{}],11:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("events"),a=t(r),o=e("../utils/logger.js"),s=t(o),u=e("../utils/logging-control.js"),l=t(u),c=e("./transmuxing-controller.js"),h=t(c),d=e("./transmuxing-events.js"),f=t(d),p=e("./transmuxing-worker.js"),m=t(p),g=e("./media-info.js"),v=t(g),y=function(){function t(i,r){if(n(this,t),this.TAG="Transmuxer",this._emitter=new a["default"],r.enableWorker&&"undefined"!=typeof Worker)try{var o=e("webworkify");this._worker=o(m["default"]),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[i,r]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l["default"].registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l["default"].getConfig()})}catch(u){s["default"].e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new h["default"](i,r)}else this._controller=new h["default"](i,r);if(this._controller){var c=this._controller;c.on(f["default"].IO_ERROR,this._onIOError.bind(this)),c.on(f["default"].DEMUX_ERROR,this._onDemuxError.bind(this)),c.on(f["default"].INIT_SEGMENT,this._onInitSegment.bind(this)),c.on(f["default"].MEDIA_SEGMENT,this._onMediaSegment.bind(this)),c.on(f["default"].LOADING_COMPLETE,this._onLoadingComplete.bind(this)),c.on(f["default"].RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),c.on(f["default"].MEDIA_INFO,this._onMediaInfo.bind(this)),c.on(f["default"].STATISTICS_INFO,this._onStatisticsInfo.bind(this)),c.on(f["default"].RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return i(t,[{key:"destroy",value:function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l["default"].removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"hasWorker",value:function(){return null!=this._worker}},{key:"open",value:function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()}},{key:"close",value:function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()}},{key:"seek",value:function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)}},{key:"pause",value:function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()}},{key:"resume",value:function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()}},{key:"_onInitSegment",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(f["default"].INIT_SEGMENT,e,t)})}},{key:"_onMediaSegment",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(f["default"].MEDIA_SEGMENT,e,t)})}},{key:"_onLoadingComplete",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(f["default"].LOADING_COMPLETE)})}},{key:"_onRecoveredEarlyEof",value:function(){var e=this;Promise.resolve().then(function(){e._emitter.emit(f["default"].RECOVERED_EARLY_EOF)})}},{key:"_onMediaInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(f["default"].MEDIA_INFO,e)})}},{key:"_onStatisticsInfo",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(f["default"].STATISTICS_INFO,e)})}},{key:"_onIOError",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(f["default"].IO_ERROR,e,t)})}},{key:"_onDemuxError",value:function(e,t){var n=this;Promise.resolve().then(function(){n._emitter.emit(f["default"].DEMUX_ERROR,e,t)})}},{key:"_onRecommendSeekpoint",value:function(e){var t=this;Promise.resolve().then(function(){t._emitter.emit(f["default"].RECOMMEND_SEEKPOINT,e)})}},{key:"_onLoggingConfigChanged",value:function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})}},{key:"_onWorkerMessage",value:function(e){var t=e.data,n=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case f["default"].INIT_SEGMENT:case f["default"].MEDIA_SEGMENT:this._emitter.emit(t.msg,n.type,n.data);break;case f["default"].LOADING_COMPLETE:case f["default"].RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case f["default"].MEDIA_INFO:Object.setPrototypeOf(n,v["default"].prototype),this._emitter.emit(t.msg,n);break;case f["default"].STATISTICS_INFO:this._emitter.emit(t.msg,n);break;case f["default"].IO_ERROR:case f["default"].DEMUX_ERROR:this._emitter.emit(t.msg,n.type,n.info);break;case f["default"].RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,n);break;case"logcat_callback":s["default"].emitter.emit("log",n.type,n.logcat)}}}]),t}();exports["default"]=y},{"../utils/logger.js":41,"../utils/logging-control.js":42,"./media-info.js":7,"./transmuxing-controller.js":12,"./transmuxing-events.js":13,"./transmuxing-worker.js":14,events:2,webworkify:4}],12:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("events"),a=t(r),o=e("../utils/logger.js"),s=t(o),u=e("../utils/browser.js"),l=t(u),c=e("./media-info.js"),h=t(c),d=e("../demux/flv-demuxer.js"),f=t(d),p=e("../remux/mp4-remuxer.js"),m=t(p),g=e("../demux/demux-errors.js"),v=t(g),y=e("../io/io-controller.js"),_=t(y),x=e("./transmuxing-events.js"),b=t(x),w=(e("../io/loader.js"),function(){function e(t,i){n(this,e),this.TAG="TransmuxingController",this._emitter=new a["default"],this._config=i,t.segments||(t.segments=[{duration:t.duration,filesize:t.filesize,url:t.url}]),"boolean"!=typeof t.cors&&(t.cors=!0),"boolean"!=typeof t.withCredentials&&(t.withCredentials=!1),this._mediaDataSource=t,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach(function(e){e.timestampBase=r,r+=e.duration,e.cors=t.cors,e.withCredentials=t.withCredentials,i.referrerPolicy&&(e.referrerPolicy=i.referrerPolicy)}),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return i(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"start",value:function(){this._loadSegment(0),this._enableStatisticsReporter()}},{key:"_loadSegment",value:function(e,t){this._currentSegmentIndex=e;var n=this._mediaDataSource.segments[e],i=this._ioctl=new _["default"](n,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)}},{key:"stop",value:function(){this._internalAbort(),this._disableStatisticsReporter()}},{key:"_internalAbort",value:function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)}},{key:"pause",value:function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())}},{key:"resume",value:function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())}},{key:"seek",value:function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var n=this._mediaInfo.segments[t];if(void 0==n)this._pendingSeekTime=e;else{var i=n.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var r=this._mediaInfo.segments[t];if(void 0==r)this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t);else{var a=r.getNearestKeyframe(e);this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,a.fileposition),this._pendingResolveSeekPoint=a.milliseconds,this._reportSegmentMediaInfo(t)}}this._enableStatisticsReporter()}}},{key:"_searchSegmentIndexContains",value:function(e){for(var t=this._mediaDataSource.segments,n=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){n=i-1;break}return n}},{key:"_onInitChunkArrival",value:function(e,t){var n=this,i=null,r=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,r=this._demuxer.parseChunks(e,t);else if((i=f["default"].probe(e)).match){this._demuxer=new f["default"](i,this._config),this._remuxer||(this._remuxer=new m["default"](this._config));var a=this._mediaDataSource;void 0==a.duration||isNaN(a.duration)||(this._demuxer.overridedDuration=a.duration),"boolean"==typeof a.hasAudio&&(this._demuxer.overridedHasAudio=a.hasAudio),"boolean"==typeof a.hasVideo&&(this._demuxer.overridedHasVideo=a.hasVideo),this._demuxer.timestampBase=a.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),r=this._demuxer.parseChunks(e,t)}else i=null,s["default"].e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then(function(){n._internalAbort()}),this._emitter.emit(b["default"].DEMUX_ERROR,v["default"].FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),r=0;return r}},{key:"_onMediaInfo",value:function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,h["default"].prototype));var n=Object.assign({},e);Object.setPrototypeOf(n,h["default"].prototype),this._mediaInfo.segments[this._currentSegmentIndex]=n,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then(function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)})}},{key:"_onIOSeeked",value:function(){this._remuxer.insertDiscontinuity()}},{key:"_onIOComplete",value:function(e){var t=e,n=t+1;n<this._mediaDataSource.segments.length?(this._internalAbort(),this._loadSegment(n)):(this._remuxer.flushStashedSamples(),this._emitter.emit(b["default"].LOADING_COMPLETE),this._disableStatisticsReporter())}},{key:"_onIORedirect",value:function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e}},{key:"_onIORecoveredEarlyEof",value:function(){this._emitter.emit(b["default"].RECOVERED_EARLY_EOF)}},{key:"_onIOException",value:function(e,t){s["default"].e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(b["default"].IO_ERROR,e,t),this._disableStatisticsReporter()}},{key:"_onDemuxException",value:function(e,t){s["default"].e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(b["default"].DEMUX_ERROR,e,t)}},{key:"_onRemuxerInitSegmentArrival",value:function(e,t){this._emitter.emit(b["default"].INIT_SEGMENT,e,t)}},{key:"_onRemuxerMediaSegmentArrival",value:function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(b["default"].MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var n=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,l["default"].safari&&n.length>0&&n[0].originalDts===i&&(i=n[0].pts),this._emitter.emit(b["default"].RECOMMEND_SEEKPOINT,i)}}},{key:"_enableStatisticsReporter",value:function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))}},{key:"_disableStatisticsReporter",value:function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"_reportSegmentMediaInfo",value:function(e){var t=this._mediaInfo.segments[e],n=Object.assign({},t);n.duration=this._mediaInfo.duration,n.segmentCount=this._mediaInfo.segmentCount,delete n.segments,delete n.keyframesIndex,this._emitter.emit(b["default"].MEDIA_INFO,n)}},{key:"_reportStatisticsInfo",value:function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(b["default"].STATISTICS_INFO,e)}}]),e}());exports["default"]=w},{"../demux/demux-errors.js":16,"../demux/flv-demuxer.js":18,"../io/io-controller.js":23,"../io/loader.js":24,"../remux/mp4-remuxer.js":38,"../utils/browser.js":39,"../utils/logger.js":41,"./media-info.js":7,"./transmuxing-events.js":13,events:2}],13:[function(e,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"};exports["default"]=t},{}],14:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0});var n=e("../utils/logger.js"),i=(t(n),e("../utils/logging-control.js")),r=t(i),a=e("../utils/polyfill.js"),o=t(a),s=e("./transmuxing-controller.js"),u=t(s),l=e("./transmuxing-events.js"),c=t(l),h=function(e){function t(t,n){var i={msg:c["default"].INIT_SEGMENT,data:{type:t,data:n}};e.postMessage(i,[n.data])}function n(t,n){var i={msg:c["default"].MEDIA_SEGMENT,data:{type:t,data:n}};e.postMessage(i,[n.data])}function i(){var t={msg:c["default"].LOADING_COMPLETE};e.postMessage(t)}function a(){var t={msg:c["default"].RECOVERED_EARLY_EOF};e.postMessage(t)}function s(t){var n={msg:c["default"].MEDIA_INFO,data:t};e.postMessage(n)}function l(t){var n={msg:c["default"].STATISTICS_INFO,data:t};e.postMessage(n)}function h(t,n){e.postMessage({msg:c["default"].IO_ERROR,data:{type:t,info:n}})}function d(t,n){e.postMessage({msg:c["default"].DEMUX_ERROR,data:{type:t,info:n}})}function f(t){e.postMessage({msg:c["default"].RECOMMEND_SEEKPOINT,data:t})}function p(t,n){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:n}})}var m=null,g=p.bind(this);o["default"].install(),e.addEventListener("message",function(o){switch(o.data.cmd){case"init":m=new u["default"](o.data.param[0],o.data.param[1]),m.on(c["default"].IO_ERROR,h.bind(this)),m.on(c["default"].DEMUX_ERROR,d.bind(this)),m.on(c["default"].INIT_SEGMENT,t.bind(this)),m.on(c["default"].MEDIA_SEGMENT,n.bind(this)),m.on(c["default"].LOADING_COMPLETE,i.bind(this)),m.on(c["default"].RECOVERED_EARLY_EOF,a.bind(this)),m.on(c["default"].MEDIA_INFO,s.bind(this)),m.on(c["default"].STATISTICS_INFO,l.bind(this)),m.on(c["default"].RECOMMEND_SEEKPOINT,f.bind(this));break;case"destroy":m&&(m.destroy(),m=null),e.postMessage({msg:"destroyed"});break;case"start":m.start();break;case"stop":m.stop();break;case"seek":m.seek(o.data.param);break;case"pause":m.pause();break;case"resume":m.resume();break;case"logging_config":var p=o.data.param;r["default"].applyConfig(p),p.enableCallback===!0?r["default"].addLogListener(g):r["default"].removeLogListener(g)}})};exports["default"]=h},{"../utils/logger.js":41,"../utils/logging-control.js":42,"../utils/polyfill.js":43,"./transmuxing-controller.js":12,"./transmuxing-events.js":13}],15:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("../utils/logger.js"),a=t(r),o=e("../utils/utf8-conv.js"),s=t(o),u=e("../utils/exception.js"),l=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),256===new Int16Array(e)[0]}(),c=function(){function e(){n(this,e)}return i(e,null,[{key:"parseScriptData",value:function(t,n,i){var r={};try{var o=e.parseValue(t,n,i),s=e.parseValue(t,n+o.size,i-o.size);r[o.data]=s.data}catch(u){a["default"].e("AMF",u.toString())}return r}},{key:"parseObject",value:function(t,n,i){if(i<3)throw new u.IllegalStateException("Data not enough when parse ScriptDataObject");var r=e.parseString(t,n,i),a=e.parseValue(t,n+r.size,i-r.size),o=a.objectEnd;return{data:{name:r.data,value:a.data},size:r.size+a.size,objectEnd:o}}},{key:"parseVariable",value:function(t,n,i){return e.parseObject(t,n,i)}},{key:"parseString",value:function(e,t,n){if(n<2)throw new u.IllegalStateException("Data not enough when parse String");var i=new DataView(e,t,n),r=i.getUint16(0,!l),a=void 0;return a=r>0?(0,s["default"])(new Uint8Array(e,t+2,r)):"",{data:a,size:2+r}}},{key:"parseLongString",value:function(e,t,n){if(n<4)throw new u.IllegalStateException("Data not enough when parse LongString");var i=new DataView(e,t,n),r=i.getUint32(0,!l),a=void 0;return a=r>0?(0,s["default"])(new Uint8Array(e,t+4,r)):"",{data:a,size:4+r}}},{key:"parseDate",value:function(e,t,n){if(n<10)throw new u.IllegalStateException("Data size invalid when parse Date");var i=new DataView(e,t,n),r=i.getFloat64(0,!l),a=i.getInt16(8,!l);return r+=60*a*1e3,{data:new Date(r),size:10}}},{key:"parseValue",value:function(t,n,i){if(i<1)throw new u.IllegalStateException("Data not enough when parse Value");var r=new DataView(t,n,i),o=1,s=r.getUint8(0),c=void 0,h=!1;try{switch(s){case 0:c=r.getFloat64(1,!l),o+=8;break;case 1:var d=r.getUint8(1);c=!!d,o+=1;break;case 2:var f=e.parseString(t,n+1,i-1);c=f.data,o+=f.size;break;case 3:c={};var p=0;for(9===(16777215&r.getUint32(i-4,!l))&&(p=3);o<i-4;){var m=e.parseObject(t,n+o,i-o-p);if(m.objectEnd)break;c[m.data.name]=m.data.value,o+=m.size}if(o<=i-3){var g=16777215&r.getUint32(o-1,!l);9===g&&(o+=3)}break;case 8:c={},o+=4;var v=0;for(9===(16777215&r.getUint32(i-4,!l))&&(v=3);o<i-8;){var y=e.parseVariable(t,n+o,i-o-v);if(y.objectEnd)break;c[y.data.name]=y.data.value,o+=y.size}if(o<=i-3){var _=16777215&r.getUint32(o-1,!l);9===_&&(o+=3)}break;case 9:c=void 0,o=1,h=!0;break;case 10:c=[];var x=r.getUint32(1,!l);o+=4;for(var b=0;b<x;b++){var w=e.parseValue(t,n+o,i-o);c.push(w.data),o+=w.size}break;case 11:var E=e.parseDate(t,n+1,i-1);c=E.data,o+=E.size;break;case 12:var S=e.parseString(t,n+1,i-1);c=S.data,o+=S.size;break;default:o=i,a["default"].w("AMF","Unsupported AMF value type "+s)}}catch(M){a["default"].e("AMF",M.toString())}return{data:c,size:o,objectEnd:h}}}]),e}();exports["default"]=c},{"../utils/exception.js":40,"../utils/logger.js":41,"../utils/utf8-conv.js":44}],16:[function(e,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"};exports["default"]=t},{}],17:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=e("../utils/exception.js"),r=function(){function e(n){t(this,e),this.TAG="ExpGolomb",this._buffer=n,this._buffer_index=0,this._total_bytes=n.byteLength,this._total_bits=8*n.byteLength,this._current_word=0,this._current_word_bits_left=0}return n(e,[{key:"destroy",value:function(){this._buffer=null}},{key:"_fillCurrentWord",value:function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new i.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),n=new Uint8Array(4);n.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(n.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t}},{key:"readBits",value:function(e){if(e>32)throw new i.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var n=this._current_word_bits_left?this._current_word:0;n>>>=32-this._current_word_bits_left;var r=e-this._current_word_bits_left;this._fillCurrentWord();var a=Math.min(r,this._current_word_bits_left),o=this._current_word>>>32-a;return this._current_word<<=a,this._current_word_bits_left-=a,n=n<<a|o}},{key:"readBool",value:function(){return 1===this.readBits(1)}},{key:"readByte",value:function(){return this.readBits(8)}},{key:"_skipLeadingZero",value:function(){var e=void 0;for(e=0;e<this._current_word_bits_left;e++)if(0!==(this._current_word&2147483648>>>e))return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()}},{key:"readUEG",value:function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1}},{key:"readSEG",value:function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)}}]),e}();exports["default"]=r},{"../utils/exception.js":40}],18:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}Object.defineProperty(exports,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=e("../utils/logger.js"),s=t(o),u=e("./amf-parser.js"),l=t(u),c=e("./sps-parser.js"),h=t(c),d=e("./demux-errors.js"),f=t(d),p=e("../core/media-info.js"),m=t(p),g=e("../utils/exception.js"),v=function(){function e(t,i){n(this,e),this.TAG="FLVDemuxer",this._config=i,this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=t.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=t.hasAudioTrack,this._hasVideo=t.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new m["default"],this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=function(){var e=new ArrayBuffer(2);return new DataView(e).setInt16(0,256,!0),
256===new Int16Array(e)[0]}()}return a(e,[{key:"destroy",value:function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onTrackMetadata=null,this._onDataAvailable=null}},{key:"bindDataSource",value:function(e){return e.onDataArrival=this.parseChunks.bind(this),this}},{key:"resetMediaInfo",value:function(){this._mediaInfo=new m["default"]}},{key:"_isInitialMetadataDispatched",value:function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched}},{key:"parseChunks",value:function(t,n){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new g.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var i=0,r=this._littleEndian;if(0===n){if(!(t.byteLength>13))return 0;var a=e.probe(t);i=a.dataOffset}if(this._firstParse){this._firstParse=!1,n+i!==this._dataOffset&&s["default"].w(this.TAG,"First time parsing but chunk byteStart invalid!");var o=new DataView(t,i),u=o.getUint32(0,!r);0!==u&&s["default"].w(this.TAG,"PrevTagSize0 !== 0 !!!"),i+=4}for(;i<t.byteLength;){this._dispatch=!0;var l=new DataView(t,i);if(i+11+4>t.byteLength)break;var c=l.getUint8(0),h=16777215&l.getUint32(0,!r);if(i+11+h+4>t.byteLength)break;if(8===c||9===c||18===c){var d=l.getUint8(4),f=l.getUint8(5),p=l.getUint8(6),m=l.getUint8(7),v=p|f<<8|d<<16|m<<24,y=16777215&l.getUint32(7,!r);0!==y&&s["default"].w(this.TAG,"Meet tag which has StreamID != 0!");var _=i+11;switch(c){case 8:this._parseAudioData(t,_,h,v);break;case 9:this._parseVideoData(t,_,h,v,n+i);break;case 18:this._parseScriptData(t,_,h)}var x=l.getUint32(11+h,!r);x!==11+h&&s["default"].w(this.TAG,"Invalid PrevTagSize "+x),i+=11+h+4}else s["default"].w(this.TAG,"Unsupported tag type "+c+", skipped"),i+=11+h+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),i}},{key:"_parseScriptData",value:function(e,t,n){var i=l["default"].parseScriptData(e,t,n);if(i.hasOwnProperty("onMetaData")){if(null==i.onMetaData||"object"!==r(i.onMetaData))return void s["default"].w(this.TAG,"Invalid onMetaData structure!");this._metadata&&s["default"].w(this.TAG,"Found another onMetaData tag!"),this._metadata=i;var a=this._metadata.onMetaData;if("boolean"==typeof a.hasAudio&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=a.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof a.hasVideo&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=a.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof a.audiodatarate&&(this._mediaInfo.audioDataRate=a.audiodatarate),"number"==typeof a.videodatarate&&(this._mediaInfo.videoDataRate=a.videodatarate),"number"==typeof a.width&&(this._mediaInfo.width=a.width),"number"==typeof a.height&&(this._mediaInfo.height=a.height),"number"==typeof a.duration){if(!this._durationOverrided){var o=Math.floor(a.duration*this._timescale);this._duration=o,this._mediaInfo.duration=o}}else this._mediaInfo.duration=0;if("number"==typeof a.framerate){var u=Math.floor(1e3*a.framerate);if(u>0){var c=u/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=c,this._referenceFrameRate.fps_num=u,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=c}}if("object"===r(a.keyframes)){this._mediaInfo.hasKeyframesIndex=!0;var h=a.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(h),a.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=a,s["default"].v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}}},{key:"_parseKeyframesIndex",value:function(e){for(var t=[],n=[],i=1;i<e.times.length;i++){var r=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(r),n.push(e.filepositions[i])}return{times:t,filepositions:n}}},{key:"_parseAudioData",value:function(e,t,n,i){if(n<=1)return void s["default"].w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");if(this._hasAudioFlagOverrided!==!0||this._hasAudio!==!1){var r=(this._littleEndian,new DataView(e,t,n)),a=r.getUint8(0),o=a>>>4;if(2!==o&&10!==o)return void this._onError(f["default"].CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+o);var u=0,l=(12&a)>>>2;if(!(l>=0&&l<=4))return void this._onError(f["default"].FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+l);u=this._flvSoundRateTable[l];var c=1&a,h=this._audioMetadata,d=this._audioTrack;if(h||(this._hasAudio===!1&&this._hasAudioFlagOverrided===!1&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),h=this._audioMetadata={},h.type="audio",h.id=d.id,h.timescale=this._timescale,h.duration=this._duration,h.audioSampleRate=u,h.channelCount=0===c?1:2),10===o){var p=this._parseAACAudioData(e,t+1,n-1);if(void 0==p)return;if(0===p.packetType){h.config&&s["default"].w(this.TAG,"Found another AudioSpecificConfig!");var m=p.data;h.audioSampleRate=m.samplingRate,h.channelCount=m.channelCount,h.codec=m.codec,h.originalCodec=m.originalCodec,h.config=m.config,h.refSampleDuration=1024/h.audioSampleRate*h.timescale,s["default"].v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",h);var g=this._mediaInfo;g.audioCodec=h.originalCodec,g.audioSampleRate=h.audioSampleRate,g.audioChannelCount=h.channelCount,g.hasVideo?null!=g.videoCodec&&(g.mimeType='video/x-flv; codecs="'+g.videoCodec+","+g.audioCodec+'"'):g.mimeType='video/x-flv; codecs="'+g.audioCodec+'"',g.isComplete()&&this._onMediaInfo(g)}else if(1===p.packetType){var v=this._timestampBase+i,y={unit:p.data,length:p.data.byteLength,dts:v,pts:v};d.samples.push(y),d.length+=p.data.length}else s["default"].e(this.TAG,"Flv: Unsupported AAC data type "+p.packetType)}else if(2===o){if(!h.codec){var _=this._parseMP3AudioData(e,t+1,n-1,!0);if(void 0==_)return;h.audioSampleRate=_.samplingRate,h.channelCount=_.channelCount,h.codec=_.codec,h.originalCodec=_.originalCodec,h.refSampleDuration=1152/h.audioSampleRate*h.timescale,s["default"].v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",h);var x=this._mediaInfo;x.audioCodec=h.codec,x.audioSampleRate=h.audioSampleRate,x.audioChannelCount=h.channelCount,x.audioDataRate=_.bitRate,x.hasVideo?null!=x.videoCodec&&(x.mimeType='video/x-flv; codecs="'+x.videoCodec+","+x.audioCodec+'"'):x.mimeType='video/x-flv; codecs="'+x.audioCodec+'"',x.isComplete()&&this._onMediaInfo(x)}var b=this._parseMP3AudioData(e,t+1,n-1,!1);if(void 0==b)return;var w=this._timestampBase+i,E={unit:b,length:b.byteLength,dts:w,pts:w};d.samples.push(E),d.length+=b.length}}}},{key:"_parseAACAudioData",value:function(e,t,n){if(n<=1)return void s["default"].w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!");var i={},r=new Uint8Array(e,t,n);return i.packetType=r[0],0===r[0]?i.data=this._parseAACAudioSpecificConfig(e,t+1,n-1):i.data=r.subarray(1),i}},{key:"_parseAACAudioSpecificConfig",value:function(e,t,n){var i=new Uint8Array(e,t,n),r=null,a=0,o=0,s=null,u=0,l=null;if(a=o=i[0]>>>3,u=(7&i[0])<<1|i[1]>>>7,u<0||u>=this._mpegSamplingRates.length)return void this._onError(f["default"].FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");var c=this._mpegSamplingRates[u],h=(120&i[1])>>>3;if(h<0||h>=8)return void this._onError(f["default"].FORMAT_ERROR,"Flv: AAC invalid channel configuration");5===a&&(l=(7&i[1])<<1|i[2]>>>7,s=(124&i[2])>>>2);var d=self.navigator.userAgent.toLowerCase();return d.indexOf("firefox")!==-1?u>=6?(a=5,r=new Array(4),l=u-3):(a=2,r=new Array(2),l=u):d.indexOf("android")!==-1?(a=2,r=new Array(2),l=u):(a=5,l=u,r=new Array(4),u>=6?l=u-3:1===h&&(a=2,r=new Array(2),l=u)),r[0]=a<<3,r[0]|=(15&u)>>>1,r[1]=(15&u)<<7,r[1]|=(15&h)<<3,5===a&&(r[1]|=(15&l)>>>1,r[2]=(1&l)<<7,r[2]|=8,r[3]=0),{config:r,samplingRate:c,channelCount:h,codec:"mp4a.40."+a,originalCodec:"mp4a.40."+o}}},{key:"_parseMP3AudioData",value:function(e,t,n,i){if(n<4)return void s["default"].w(this.TAG,"Flv: Invalid MP3 packet, header missing!");var r=(this._littleEndian,new Uint8Array(e,t,n)),a=null;if(i){if(255!==r[0])return;var o=r[1]>>>3&3,u=(6&r[1])>>1,l=(240&r[2])>>>4,c=(12&r[2])>>>2,h=r[3]>>>6&3,d=3!==h?2:1,f=0,p=0,m=34,g="mp3";switch(o){case 0:f=this._mpegAudioV25SampleRateTable[c];break;case 2:f=this._mpegAudioV20SampleRateTable[c];break;case 3:f=this._mpegAudioV10SampleRateTable[c]}switch(u){case 1:m=34,l<this._mpegAudioL3BitRateTable.length&&(p=this._mpegAudioL3BitRateTable[l]);break;case 2:m=33,l<this._mpegAudioL2BitRateTable.length&&(p=this._mpegAudioL2BitRateTable[l]);break;case 3:m=32,l<this._mpegAudioL1BitRateTable.length&&(p=this._mpegAudioL1BitRateTable[l])}a={bitRate:p,samplingRate:f,channelCount:d,codec:g,originalCodec:g}}else a=r;return a}},{key:"_parseVideoData",value:function(e,t,n,i,r){if(n<=1)return void s["default"].w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");if(this._hasVideoFlagOverrided!==!0||this._hasVideo!==!1){var a=new Uint8Array(e,t,n)[0],o=(240&a)>>>4,u=15&a;return 7!==u?void this._onError(f["default"].CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+u):void this._parseAVCVideoPacket(e,t+1,n-1,i,r,o)}}},{key:"_parseAVCVideoPacket",value:function(e,t,n,i,r,a){if(n<4)return void s["default"].w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");var o=this._littleEndian,u=new DataView(e,t,n),l=u.getUint8(0),c=16777215&u.getUint32(0,!o),h=c<<8>>8;if(0===l)this._parseAVCDecoderConfigurationRecord(e,t+4,n-4);else if(1===l)this._parseAVCVideoData(e,t+4,n-4,i,r,a,h);else if(2!==l)return void this._onError(f["default"].FORMAT_ERROR,"Flv: Invalid video packet type "+l)}},{key:"_encrypt_buffer",value:function(e,t,n){var i,r=1024,a=new DataView(e,t,e.length),o=n<r?n:r,s=a.getUint8(1),u=2;for(i=u;i<o;i++){var l=i>>3&255;s^=l;var c=a.getUint8(i);c^=s,a.setUint8(i,c)}}},{key:"_parseAVCDecoderConfigurationRecord",value:function(e,t,n){if(n<7)return void s["default"].w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");var i=this._videoMetadata,r=this._videoTrack,a=this._littleEndian,o=new DataView(e,t,n);i?"undefined"!=typeof i.avcc&&s["default"].w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(this._hasVideo===!1&&this._hasVideoFlagOverrided===!1&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),i=this._videoMetadata={},i.type="video",i.id=r.id,i.timescale=this._timescale,i.duration=this._duration);var u=o.getUint8(0),l=o.getUint8(1);o.getUint8(2),o.getUint8(3);if(1!==u||0===l)return void this._onError(f["default"].FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord");if(this._naluLengthSize=(3&o.getUint8(4))+1,3!==this._naluLengthSize&&4!==this._naluLengthSize)return void this._onError(f["default"].FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));var c=31&o.getUint8(5);if(0===c)return void this._onError(f["default"].FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS");c>1&&s["default"].w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+c);for(var d=6,p=0;p<c;p++){var m=o.getUint16(d,!a);if(d+=2,0!==m){var g=new Uint8Array(e,t+d,m);if(0==p){for(var v=0,y=0;y<m-1;y++)if(255==g[y]&&103==g[y+1]){v=y;break}this._encrypt_buffer(e,t+d+v+1,m-v-1);for(var _=0;_<m-v-1;_++)g[_]=g[v+1+_];g=g.subarray(0,m-v-1)}d+=m;var x=h["default"].parseSPS(g);if(0===p){i.codecWidth=x.codec_size.width,i.codecHeight=x.codec_size.height,i.presentWidth=x.present_size.width,i.presentHeight=x.present_size.height,i.profile=x.profile_string,i.level=x.level_string,i.bitDepth=x.bit_depth,i.chromaFormat=x.chroma_format,i.sarRatio=x.sar_ratio,i.frameRate=x.frame_rate,x.frame_rate.fixed!==!1&&0!==x.frame_rate.fps_num&&0!==x.frame_rate.fps_den||(i.frameRate=this._referenceFrameRate);var b=i.frameRate.fps_den,w=i.frameRate.fps_num;i.refSampleDuration=i.timescale*(b/w);for(var E=g.subarray(1,4),S="avc1.",_=0;_<3;_++){var M=E[_].toString(16);M.length<2&&(M="0"+M),S+=M}i.codec=S;var T=this._mediaInfo;T.width=i.codecWidth,T.height=i.codecHeight,T.fps=i.frameRate.fps,T.profile=i.profile,T.level=i.level,T.refFrames=x.ref_frames,T.chromaFormat=x.chroma_format_string,T.sarNum=i.sarRatio.width,T.sarDen=i.sarRatio.height,T.videoCodec=S,T.hasAudio?null!=T.audioCodec&&(T.mimeType='video/x-flv; codecs="'+T.videoCodec+","+T.audioCodec+'"'):T.mimeType='video/x-flv; codecs="'+T.videoCodec+'"',T.isComplete()&&this._onMediaInfo(T)}}}var A=o.getUint8(d);if(0===A)return void this._onError(f["default"].FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS");A>1&&s["default"].w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+A),d++;for(var L=0;L<A;L++){var R=o.getUint16(d,!a);d+=2,this._config.isFilter&&1.3!=this._config.filterVision&&0==L&&this._encrypt_buffer(e,t+d,R),0!==R&&(d+=R)}i.avcc=new Uint8Array(n),i.avcc.set(new Uint8Array(e,t,n),0),s["default"].v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",i)}},{key:"_parseAVCVideoData",value:function(e,t,n,i,r,a,o){for(var u=this._littleEndian,l=new DataView(e,t,n),c=[],h=0,d=0,f=this._naluLengthSize,p=this._timestampBase+i,m=1===a;d<n;){if(d+4>=n){s["default"].w(this.TAG,"Malformed Nalu near timestamp "+p+", offset = "+d+", dataSize = "+n);break}var g=l.getUint32(d,!u);if(3===f&&(g>>>=8),g>n-f)return void s["default"].w(this.TAG,"Malformed Nalus near timestamp "+p+", NaluSize > DataSize!");var v=31&l.getUint8(d+f);5===v?(m=!0,this._config.isFilter&&this._encrypt_buffer(e,t+d+f,g)):1===v&&96&l.getUint8(d+f)&&this._config.isFilter&&this._encrypt_buffer(e,t+d+f,g);var y=new Uint8Array(e,t+d,f+g),_={type:v,data:y};c.push(_),h+=y.byteLength,d+=f+g}if(c.length){var x=this._videoTrack,b={units:c,length:h,isKeyframe:m,dts:p,cts:o,pts:p+o};m&&(b.fileposition=r),x.samples.push(b),x.length+=h}}},{key:"onTrackMetadata",get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e}},{key:"onMediaInfo",get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onDataAvailable",get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e}},{key:"timestampBase",get:function(){return this._timestampBase},set:function(e){this._timestampBase=e}},{key:"overridedDuration",get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e}},{key:"overridedHasAudio",set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e}},{key:"overridedHasVideo",set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e}}],[{key:"probe",value:function(e){var t=new Uint8Array(e),n={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return n;var r=(4&t[4])>>>2!==0,a=0!==(1&t[4]),o=i(t,5);return o<9?n:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:r,hasVideoTrack:a}}}]),e}();exports["default"]=v},{"../core/media-info.js":7,"../utils/exception.js":40,"../utils/logger.js":41,"./amf-parser.js":15,"./demux-errors.js":16,"./sps-parser.js":19}],19:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("./exp-golomb.js"),a=t(r),o=function(){function e(){n(this,e)}return i(e,null,[{key:"_ebsp2rbsp",value:function(e){for(var t=e,n=t.byteLength,i=new Uint8Array(n),r=0,a=0;a<n;a++)a>=2&&3===t[a]&&0===t[a-1]&&0===t[a-2]||(i[r]=t[a],r++);return new Uint8Array(i.buffer,0,r)}},{key:"parseSPS",value:function(t){var n=e._ebsp2rbsp(t),i=new a["default"](n);i.readByte();var r=i.readByte();i.readByte();var o=i.readByte();i.readUEG();var s=e.getProfileString(r),u=e.getLevelString(o),l=1,c=420,h=[0,420,422,444],d=8;if((100===r||110===r||122===r||244===r||44===r||83===r||86===r||118===r||128===r||138===r||144===r)&&(l=i.readUEG(),3===l&&i.readBits(1),l<=3&&(c=h[l]),d=i.readUEG()+8,i.readUEG(),i.readBits(1),i.readBool()))for(var f=3!==l?8:12,p=0;p<f;p++)i.readBool()&&(p<6?e._skipScalingList(i,16):e._skipScalingList(i,64));i.readUEG();var m=i.readUEG();if(0===m)i.readUEG();else if(1===m){i.readBits(1),i.readSEG(),i.readSEG();for(var g=i.readUEG(),v=0;v<g;v++)i.readSEG()}var y=i.readUEG();i.readBits(1);var _=i.readUEG(),x=i.readUEG(),b=i.readBits(1);0===b&&i.readBits(1),i.readBits(1);var w=0,E=0,S=0,M=0,T=i.readBool();T&&(w=i.readUEG(),E=i.readUEG(),S=i.readUEG(),M=i.readUEG());var A=1,L=1,R=0,C=!0,P=0,I=0,O=i.readBool();if(O){if(i.readBool()){var k=i.readByte(),D=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],N=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];k>0&&k<16?(A=D[k-1],L=N[k-1]):255===k&&(A=i.readByte()<<8|i.readByte(),L=i.readByte()<<8|i.readByte())}if(i.readBool()&&i.readBool(),i.readBool()&&(i.readBits(4),i.readBool()&&i.readBits(24)),i.readBool()&&(i.readUEG(),i.readUEG()),i.readBool()){var U=i.readBits(32),B=i.readBits(32);C=i.readBool(),P=B,I=2*U,R=P/I}}var F=1;1===A&&1===L||(F=A/L);var j=0,z=0;if(0===l)j=1,z=2-b;else{var G=3===l?1:2,H=1===l?2:1;j=G,z=H*(2-b)}var V=16*(_+1),W=(2-b)*(16*(x+1));V-=(w+E)*j,W-=(S+M)*z;var q=Math.ceil(V*F);return i.destroy(),i=null,{profile_string:s,level_string:u,bit_depth:d,ref_frames:y,chroma_format:c,chroma_format_string:e.getChromaFormatString(c),frame_rate:{fixed:C,fps:R,fps_den:I,fps_num:P},sar_ratio:{width:A,height:L},codec_size:{width:V,height:W},present_size:{width:q,height:W}}}},{key:"_skipScalingList",value:function(e,t){for(var n=8,i=8,r=0,a=0;a<t;a++)0!==i&&(r=e.readSEG(),i=(n+r+256)%256),n=0===i?n:i}},{key:"getProfileString",value:function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}}},{key:"getLevelString",value:function(e){return(e/10).toFixed(1)}},{key:"getChromaFormatString",value:function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}}}]),e}();exports["default"]=o},{"./exp-golomb.js":17}],20:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){var n=e;if(null==n||"object"!==("undefined"==typeof n?"undefined":a(n)))throw new _.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!n.hasOwnProperty("type"))throw new _.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");switch(n.type){case"flv":return new h["default"](n,t);default:return new f["default"](n,t)}}function i(){return l["default"].supportMSEH264Playback()}function r(){return l["default"].getFeatureList()}Object.defineProperty(exports,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=e("./utils/polyfill.js"),s=t(o),u=e("./core/features.js"),l=t(u),c=e("./player/flv-player.js"),h=t(c),d=e("./player/native-player.js"),f=t(d),p=e("./player/player-events.js"),m=t(p),g=e("./player/player-errors.js"),v=e("./utils/logging-control.js"),y=t(v),_=e("./utils/exception.js");s["default"].install();var x={};x.createPlayer=n,x.isSupported=i,x.getFeatureList=r,x.Events=m["default"],x.ErrorTypes=g.ErrorTypes,x.ErrorDetails=g.ErrorDetails,x.FlvPlayer=h["default"],x.NativePlayer=f["default"],x.LoggingControl=y["default"],Object.defineProperty(x,"version",{enumerable:!0,get:function(){return"1.4.0"}}),exports["default"]=x},{"./core/features.js":6,"./player/flv-player.js":32,"./player/native-player.js":33,"./player/player-errors.js":34,"./player/player-events.js":35,"./utils/exception.js":40,"./utils/logging-control.js":42,"./utils/polyfill.js":43}],21:[function(e,module,exports){"use strict";module.exports=e("./flv.js")["default"]},{"./flv.js":20}],22:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function p(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:p(r,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../utils/logger.js"),l=(t(u),e("../utils/browser.js")),c=t(l),h=e("./loader.js"),d=e("../utils/exception.js"),f=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"fetch-stream-loader"));return a.TAG="FetchStreamLoader",a._seekHandler=e,a._config=r,a._needStash=!0,a._requestAbort=!1,a._contentLength=null,a._receivedLength=0,a}return r(t,e),s(t,null,[{key:"isSupported",value:function(){try{var e=c["default"].msedge&&c["default"].version.minor>=15048,t=!c["default"].msedge||e;return self.fetch&&self.ReadableStream&&t}catch(n){return!1}}}]),s(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){var n=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(i=e.redirectedURL);var r=this._seekHandler.getConfig(i,t),o=new self.Headers;if("object"===a(r.headers)){var s=r.headers;for(var u in s)s.hasOwnProperty(u)&&o.append(u,s[u])}var l={method:"GET",headers:o,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};e.cors===!1&&(l.mode="same-origin"),e.withCredentials&&(l.credentials="include"),e.referrerPolicy&&(l.referrerPolicy=e.referrerPolicy),this._status=h.LoaderStatus.kConnecting,self.fetch(r.url,l).then(function(e){if(n._requestAbort)return n._requestAbort=!1,void(n._status=h.LoaderStatus.kIdle);if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==r.url&&n._onURLRedirect){var t=n._seekHandler.removeURLParameters(e.url);n._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(n._contentLength=parseInt(i),0!==n._contentLength&&n._onContentLengthKnown&&n._onContentLengthKnown(n._contentLength)),n._pump.call(n,e.body.getReader())}if(n._status=h.LoaderStatus.kError,!n._onError)throw new d.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);n._onError(h.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})["catch"](function(e){if(n._status=h.LoaderStatus.kError,!n._onError)throw e;n._onError(h.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})})}},{key:"abort",value:function(){this._requestAbort=!0}},{key:"_pump",value:function(e){var t=this;return e.read().then(function(n){if(n.done)t._status=h.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._requestAbort===!0)return t._requestAbort=!1,t._status=h.LoaderStatus.kComplete,e.cancel();t._status=h.LoaderStatus.kBuffering;var i=n.value.buffer,r=t._range.from+t._receivedLength;t._receivedLength+=i.byteLength,t._onDataArrival&&t._onDataArrival(i,r,t._receivedLength),t._pump(e)}})["catch"](function(e){if(11!==e.code||!c["default"].msedge){t._status=h.LoaderStatus.kError;var n=0,i=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(n=h.LoaderErrors.EXCEPTION,i={code:e.code,msg:e.message}):(n=h.LoaderErrors.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new d.RuntimeException(i.msg);t._onError(n,i)}})}}]),t}(h.BaseLoader);exports["default"]=f},{"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],23:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("../utils/logger.js"),a=t(r),o=e("./speed-sampler.js"),s=t(o),u=e("./loader.js"),l=e("./fetch-stream-loader.js"),c=t(l),h=e("./xhr-moz-chunked-loader.js"),d=t(h),f=e("./xhr-msstream-loader.js"),p=(t(f),e("./xhr-range-loader.js")),m=t(p),g=e("./websocket-loader.js"),v=t(g),y=e("./range-seek-handler.js"),_=t(y),x=e("./param-seek-handler.js"),b=t(x),w=e("../utils/exception.js"),E=function(){function e(t,i,r){n(this,e),this.TAG="IOController",this._config=i,this._extraData=r,this._stashInitialSize=393216,void 0!=i.stashInitialSize&&i.stashInitialSize>0&&(this._stashInitialSize=i.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,i.enableStashBuffer===!1&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=t,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(t.url),this._refTotalLength=t.filesize?t.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new s["default"],this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return i(e,[{key:"destroy",value:function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null}},{key:"isWorking",value:function(){return this._loader&&this._loader.isWorking()&&!this._paused}},{key:"isPaused",value:function(){return this._paused}},{key:"_selectSeekHandler",value:function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new _["default"](this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",n=e.seekParamEnd||"bend";this._seekHandler=new b["default"](t,n)}else{if("custom"!==e.seekType)throw new w.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new w.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}}},{key:"_selectLoader",value:function(){if(this._isWebSocketURL)this._loaderClass=v["default"];else if(c["default"].isSupported())this._loaderClass=c["default"];else if(d["default"].isSupported())this._loaderClass=d["default"];else{if(!m["default"].isSupported())throw new w.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=m["default"]}}},{key:"_createLoader",value:function(){this._loader=new this._loaderClass(this._seekHandler,this._config),this._loader.needStashBuffer===!1&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)}},{key:"open",value:function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))}},{key:"abort",value:function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)}},{key:"pause",value:function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)}},{key:"resume",value:function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}}},{key:"seek",value:function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)}},{key:"_internalSeek",value:function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var n={from:e,to:-1};this._currentRange={from:n.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,n),this._onSeeked&&this._onSeeked()}},{key:"updateUrl",value:function(e){if(!e||"string"!=typeof e||0===e.length)throw new w.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e}},{key:"_expandBuffer",value:function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if(t+=1048576,t!==this._bufferSize){var n=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed),r=new Uint8Array(n,0,t);r.set(i,0)}this._stashBuffer=n,this._bufferSize=t}}},{key:"_normalizeSpeed",value:function(e){var t=this._speedNormalizeList,n=t.length-1,i=0,r=0,a=n;if(e<t[0])return t[0];for(;r<=a;){if(i=r+Math.floor((a-r)/2),i===n||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?r=i+1:a=i-1}}},{key:"_adjustStashSize",value:function(e){var t=0;t=this._config.isLive?e:e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e,t>8192&&(t=8192);var n=1024*t+1048576;this._bufferSize<n&&this._expandBuffer(n),
this._stashSize=1024*t}},{key:"_dispatchChunks",value:function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)}},{key:"_onURLRedirect",value:function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)}},{key:"_onContentLengthKnown",value:function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)}},{key:"_onLoaderChunkArrival",value:function(e,t,n){if(!this._onDataArrival)throw new w.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var r=this._normalizeSpeed(i);this._speedNormalized!==r&&(this._speedNormalized=r,this._adjustStashSize(r))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize){var a=new Uint8Array(this._stashBuffer,0,this._stashSize);a.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var o=new Uint8Array(this._stashBuffer,0,this._bufferSize);if(this._stashUsed>0){var s=this._stashBuffer.slice(0,this._stashUsed),u=this._dispatchChunks(s,this._stashByteStart);if(u<s.byteLength){if(u>0){var l=new Uint8Array(s,u);o.set(l,0),this._stashUsed=l.byteLength,this._stashByteStart+=u}}else this._stashUsed=0,this._stashByteStart+=u;this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else{var c=this._dispatchChunks(e,t);if(c<e.byteLength){var h=e.byteLength-c;h>this._bufferSize&&(this._expandBuffer(h),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,c),0),this._stashUsed+=h,this._stashByteStart=t+c}}}else if(0===this._stashUsed){var d=this._dispatchChunks(e,t);if(d<e.byteLength){var f=e.byteLength-d;f>this._bufferSize&&this._expandBuffer(f);var p=new Uint8Array(this._stashBuffer,0,this._bufferSize);p.set(new Uint8Array(e,d),0),this._stashUsed+=f,this._stashByteStart=t+d}}else{this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength);var m=new Uint8Array(this._stashBuffer,0,this._bufferSize);m.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;var g=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart);if(g<this._stashUsed&&g>0){var v=new Uint8Array(this._stashBuffer,g);m.set(v,0)}this._stashUsed-=g,this._stashByteStart+=g}}}},{key:"_flushStashBuffer",value:function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),n=this._dispatchChunks(t,this._stashByteStart),i=t.byteLength-n;if(n<t.byteLength){if(!e){if(n>0){var r=new Uint8Array(this._stashBuffer,0,this._bufferSize),o=new Uint8Array(t,n);r.set(o,0),this._stashUsed=o.byteLength,this._stashByteStart+=n}return 0}a["default"].w(this.TAG,i+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,i}return 0}},{key:"_onLoaderComplete",value:function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)}},{key:"_onLoaderError",value:function(e,t){switch(a["default"].e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case u.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var n=this._currentRange.to+1;return void(n<this._totalLength&&(a["default"].w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(n,!1)))}e=u.LoaderErrors.UNRECOVERABLE_EARLY_EOF;break;case u.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case u.LoaderErrors.CONNECTING_TIMEOUT:case u.LoaderErrors.HTTP_STATUS_CODE_INVALID:case u.LoaderErrors.EXCEPTION:}if(!this._onError)throw new w.RuntimeException("IOException: "+t.msg);this._onError(e,t)}},{key:"status",get:function(){return this._loader.status}},{key:"extraData",get:function(){return this._extraData},set:function(e){this._extraData=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onSeeked",get:function(){return this._onSeeked},set:function(e){this._onSeeked=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}},{key:"onRedirect",get:function(){return this._onRedirect},set:function(e){this._onRedirect=e}},{key:"onRecoveredEarlyEof",get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e}},{key:"currentURL",get:function(){return this._dataSource.url}},{key:"hasRedirect",get:function(){return null!=this._redirectedURL||void 0!=this._dataSource.redirectedURL}},{key:"currentRedirectedURL",get:function(){return this._redirectedURL||this._dataSource.redirectedURL}},{key:"currentSpeed",get:function(){return this._loaderClass===m["default"]?this._loader.currentSpeed:this._speedSampler.lastSecondKBps}},{key:"loaderType",get:function(){return this._loader.type}}]),e}();exports["default"]=E},{"../utils/exception.js":40,"../utils/logger.js":41,"./fetch-stream-loader.js":22,"./loader.js":24,"./param-seek-handler.js":25,"./range-seek-handler.js":26,"./speed-sampler.js":27,"./websocket-loader.js":28,"./xhr-moz-chunked-loader.js":29,"./xhr-msstream-loader.js":30,"./xhr-range-loader.js":31}],24:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.BaseLoader=exports.LoaderErrors=exports.LoaderStatus=void 0;var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=e("../utils/exception.js"),r=exports.LoaderStatus={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4};exports.LoaderErrors={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},exports.BaseLoader=function(){function e(n){t(this,e),this._type=n||"undefined",this._status=r.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return n(e,[{key:"destroy",value:function(){this._status=r.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}},{key:"isWorking",value:function(){return this._status===r.kConnecting||this._status===r.kBuffering}},{key:"open",value:function(e,t){throw new i.NotImplementedException("Unimplemented abstract function!")}},{key:"abort",value:function(){throw new i.NotImplementedException("Unimplemented abstract function!")}},{key:"type",get:function(){return this._type}},{key:"status",get:function(){return this._status}},{key:"needStashBuffer",get:function(){return this._needStash}},{key:"onContentLengthKnown",get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e}},{key:"onURLRedirect",get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e}},{key:"onDataArrival",get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e}},{key:"onError",get:function(){return this._onError},set:function(e){this._onError=e}},{key:"onComplete",get:function(){return this._onComplete},set:function(e){this._onComplete=e}}]),e}()},{"../utils/exception.js":40}],25:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(n,i){t(this,e),this._startName=n,this._endName=i}return n(e,[{key:"getConfig",value:function(e,t){var n=e;if(0!==t.from||t.to!==-1){var i=!0;n.indexOf("?")===-1&&(n+="?",i=!1),i&&(n+="&"),n+=this._startName+"="+t.from.toString(),t.to!==-1&&(n+="&"+this._endName+"="+t.to.toString())}return{url:n,headers:{}}}},{key:"removeURLParameters",value:function(e){var t=e.split("?")[0],n=void 0,i=e.indexOf("?");i!==-1&&(n=e.substring(i+1));var r="";if(void 0!=n&&n.length>0)for(var a=n.split("&"),o=0;o<a.length;o++){var s=a[o].split("="),u=o>0;s[0]!==this._startName&&s[0]!==this._endName&&(u&&(r+="&"),r+=a[o])}return 0===r.length?t:t+"?"+r}}]),e}();exports["default"]=i},{}],26:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(n){t(this,e),this._zeroStart=n||!1}return n(e,[{key:"getConfig",value:function(e,t){var n={};if(0!==t.from||t.to!==-1){var i=void 0;i=t.to!==-1?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",n.Range=i}else this._zeroStart&&(n.Range="bytes=0-");return{url:e,headers:n}}},{key:"removeURLParameters",value:function(e){return e}}]),e}();exports["default"]=i},{}],27:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(){t(this,e),this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return n(e,[{key:"reset",value:function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0}},{key:"addBytes",value:function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())}},{key:"currentKBps",get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024}},{key:"lastSecondKBps",get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0}},{key:"averageKBps",get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024}}]),e}();exports["default"]=i},{}],28:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var a=function h(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:h(r,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=e("../utils/logger.js"),u=(t(s),e("./loader.js")),l=e("../utils/exception.js"),c=function(e){function t(){n(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"websocket-loader"));return e.TAG="WebSocketLoader",e._needStash=!0,e._ws=null,e._requestAbort=!1,e._receivedLength=0,e}return r(t,e),o(t,null,[{key:"isSupported",value:function(){try{return"undefined"!=typeof self.WebSocket}catch(e){return!1}}}]),o(t,[{key:"destroy",value:function(){this._ws&&this.abort(),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=u.LoaderStatus.kConnecting}catch(n){this._status=u.LoaderStatus.kError;var i={code:n.code,msg:n.message};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(u.LoaderErrors.EXCEPTION,i)}}},{key:"abort",value:function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=u.LoaderStatus.kComplete}},{key:"_onWebSocketOpen",value:function(e){this._status=u.LoaderStatus.kBuffering}},{key:"_onWebSocketClose",value:function(e){return this._requestAbort===!0?void(this._requestAbort=!1):(this._status=u.LoaderStatus.kComplete,void(this._onComplete&&this._onComplete(0,this._receivedLength-1)))}},{key:"_onWebSocketMessage",value:function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var n=new FileReader;n.onload=function(){t._dispatchArrayBuffer(n.result)},n.readAsArrayBuffer(e.data)}else{this._status=u.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new l.RuntimeException(i.msg);this._onError(u.LoaderErrors.EXCEPTION,i)}}},{key:"_dispatchArrayBuffer",value:function(e){var t=e,n=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}},{key:"_onWebSocketError",value:function(e){this._status=u.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new l.RuntimeException(t.msg);this._onError(u.LoaderErrors.EXCEPTION,t)}}]),t}(u.BaseLoader);exports["default"]=c},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],29:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function f(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:f(r,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../utils/logger.js"),l=t(u),c=e("./loader.js"),h=e("../utils/exception.js"),d=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-moz-chunked-loader"));return a.TAG="MozChunkedLoader",a._seekHandler=e,a._config=r,a._needStash=!0,a._xhr=null,a._requestAbort=!1,a._contentLength=null,a._receivedLength=0,a}return r(t,e),s(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(t){return l["default"].w("MozChunkedLoader",t.message),!1}}}]),s(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t;var n=e.url;this._config.reuseRedirectedURL&&void 0!=e.redirectedURL&&(n=e.redirectedURL);var i=this._seekHandler.getConfig(n,t);this._requestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="moz-chunked-arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onloadend=this._onLoadEnd.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===a(i.headers)){var o=i.headers;for(var s in o)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s])}this._status=c.LoaderStatus.kConnecting,r.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=c.LoaderStatus.kComplete}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var n=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(n)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=c.LoaderStatus.kError,!this._onError)throw new h.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=c.LoaderStatus.kBuffering}}},{key:"_onProgress",value:function(e){if(this._status!==c.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,n=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,n,this._receivedLength)}}},{key:"_onLoadEnd",value:function(e){return this._requestAbort===!0?void(this._requestAbort=!1):void(this._status!==c.LoaderStatus.kError&&(this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)))}},{key:"_onXhrError",value:function(e){this._status=c.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&e.loaded<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,n={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=c.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new h.RuntimeException(n.msg);this._onError(t,n)}}]),t}(c.BaseLoader);exports["default"]=d},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],30:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function f(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:f(r,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../utils/logger.js"),l=t(u),c=e("./loader.js"),h=e("../utils/exception.js"),d=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-msstream-loader"));return a.TAG="MSStreamLoader",a._seekHandler=e,a._config=r,a._needStash=!0,a._xhr=null,a._reader=null,a._totalRange=null,a._currentRange=null,a._currentRequestURL=null,a._currentRedirectedURL=null,a._contentLength=null,a._receivedLength=0,a._bufferLimit=16777216,a._lastTimeBufferSize=0,a._isReconnecting=!1,a}return r(t,e),s(t,null,[{key:"isSupported",value:function(){try{if("undefined"==typeof self.MSStream||"undefined"==typeof self.MSStreamReader)return!1;var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="ms-stream","ms-stream"===e.responseType}catch(t){return l["default"].w("MSStreamLoader",t.message),!1}}}]),s(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._reader&&(this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._internalOpen(e,t,!1)}},{key:"_internalOpen",value:function(e,t,n){this._dataSource=e,n?this._currentRange=t:this._totalRange=t;var i=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?i=this._currentRedirectedURL:void 0!=e.redirectedURL&&(i=e.redirectedURL));var r=this._seekHandler.getConfig(i,t);this._currentRequestURL=r.url;var o=this._reader=new self.MSStreamReader;o.onprogress=this._msrOnProgress.bind(this),o.onload=this._msrOnLoad.bind(this),o.onerror=this._msrOnError.bind(this);var s=this._xhr=new XMLHttpRequest;if(s.open("GET",r.url,!0),s.responseType="ms-stream",s.onreadystatechange=this._xhrOnReadyStateChange.bind(this),s.onerror=this._xhrOnError.bind(this),e.withCredentials&&(s.withCredentials=!0),"object"===a(r.headers)){var u=r.headers;for(var l in u)u.hasOwnProperty(l)&&s.setRequestHeader(l,u[l])}this._isReconnecting?this._isReconnecting=!1:this._status=c.LoaderStatus.kConnecting,s.send()}},{key:"abort",value:function(){this._internalAbort(),this._status=c.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._reader&&(1===this._reader.readyState&&this._reader.abort(),this._reader.onprogress=null,this._reader.onload=null,this._reader.onerror=null,this._reader=null),this._xhr&&(this._xhr.abort(),this._xhr.onreadystatechange=null,this._xhr=null)}},{key:"_xhrOnReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState)if(t.status>=200&&t.status<=299){if(this._status=c.LoaderStatus.kBuffering,void 0!=t.responseURL){var n=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}var i=t.getResponseHeader("Content-Length");if(null!=i&&null==this._contentLength){var r=parseInt(i);r>0&&(this._contentLength=r,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength))}}else{if(this._status=c.LoaderStatus.kError,!this._onError)throw new h.RuntimeException("MSStreamLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(c.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else if(3===t.readyState&&t.status>=200&&t.status<=299){this._status=c.LoaderStatus.kBuffering;var a=t.response;this._reader.readAsArrayBuffer(a)}}},{key:"_xhrOnError",value:function(e){this._status=c.LoaderStatus.kError;var t=c.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type};if(!this._onError)throw new h.RuntimeException(n.msg);this._onError(t,n)}},{key:"_msrOnProgress",value:function(e){var t=e.target,n=t.result;if(null==n)return void this._doReconnectIfNeeded();var i=n.slice(this._lastTimeBufferSize);this._lastTimeBufferSize=n.byteLength;var r=this._totalRange.from+this._receivedLength;this._receivedLength+=i.byteLength,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),n.byteLength>=this._bufferLimit&&(l["default"].v(this.TAG,"MSStream buffer exceeded max size near "+(r+i.byteLength)+", reconnecting..."),this._doReconnectIfNeeded())}},{key:"_doReconnectIfNeeded",value:function(){if(null==this._contentLength||this._receivedLength<this._contentLength){this._isReconnecting=!0,this._lastTimeBufferSize=0,this._internalAbort();var e={from:this._totalRange.from+this._receivedLength,to:-1};this._internalOpen(this._dataSource,e,!0)}}},{key:"_msrOnLoad",value:function(e){this._status=c.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._totalRange.from,this._totalRange.from+this._receivedLength-1)}},{key:"_msrOnError",value:function(e){this._status=c.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&this._receivedLength<this._contentLength?(t=c.LoaderErrors.EARLY_EOF,n={code:-1,msg:"MSStream meet Early-Eof"}):(t=c.LoaderErrors.EARLY_EOF,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new h.RuntimeException(n.msg);this._onError(t,n)}}]),t}(c.BaseLoader);exports["default"]=d},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24}],31:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(exports,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function m(e,t,n){null===e&&(e=Function.prototype);var i=Object.getOwnPropertyDescriptor(e,t);if(void 0===i){var r=Object.getPrototypeOf(e);return null===r?void 0:m(r,t,n)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(n)},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),u=e("../utils/logger.js"),l=t(u),c=e("./speed-sampler.js"),h=t(c),d=e("./loader.js"),f=e("../utils/exception.js"),p=function(e){function t(e,r){n(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"xhr-range-loader"));return a.TAG="RangeLoader",a._seekHandler=e,a._config=r,a._needStash=!1,a._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],a._currentChunkSizeKB=384,a._currentSpeedNormalized=0,a._zeroSpeedChunkCount=0,a._xhr=null,a._speedSampler=new h["default"],a._requestAbort=!1,a._waitForTotalLength=!1,a._totalLengthReceived=!1,a._currentRequestURL=null,a._currentRedirectedURL=null,a._currentRequestRange=null,a._totalLength=null,a._contentLength=null,a._receivedLength=0,a._lastTimeLoaded=0,a}return r(t,e),s(t,null,[{key:"isSupported",value:function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(t){return l["default"].w("RangeLoader",t.message),!1}}}]),s(t,[{key:"destroy",value:function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"open",value:function(e,t){this._dataSource=e,this._range=t,this._status=d.LoaderStatus.kConnecting;var n=!1;void 0!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(n=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||n?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))}},{key:"_openSubRange",value:function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,n=t+e;null!=this._contentLength&&n-this._range.from>=this._contentLength&&(n=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:n},this._internalOpen(this._dataSource,this._currentRequestRange)}},{key:"_internalOpen",value:function(e,t){this._lastTimeLoaded=0;var n=e.url;this._config.reuseRedirectedURL&&(void 0!=this._currentRedirectedURL?n=this._currentRedirectedURL:void 0!=e.redirectedURL&&(n=e.redirectedURL));var i=this._seekHandler.getConfig(n,t);this._currentRequestURL=i.url;var r=this._xhr=new XMLHttpRequest;if(r.open("GET",i.url,!0),r.responseType="arraybuffer",r.onreadystatechange=this._onReadyStateChange.bind(this),r.onprogress=this._onProgress.bind(this),r.onload=this._onLoad.bind(this),r.onerror=this._onXhrError.bind(this),e.withCredentials&&(r.withCredentials=!0),"object"===a(i.headers)){var o=i.headers;for(var s in o)o.hasOwnProperty(s)&&r.setRequestHeader(s,o[s])}r.send()}},{key:"abort",value:function(){this._requestAbort=!0,this._internalAbort(),this._status=d.LoaderStatus.kComplete}},{key:"_internalAbort",value:function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)}},{key:"_onReadyStateChange",value:function(e){var t=e.target;if(2===t.readyState){if(void 0!=t.responseURL){var n=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&n!==this._currentRedirectedURL&&(this._currentRedirectedURL=n,this._onURLRedirect&&this._onURLRedirect(n))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=d.LoaderStatus.kBuffering}else{if(this._status=d.LoaderStatus.kError,!this._onError)throw new f.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);
this._onError(d.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}}},{key:"_onProgress",value:function(e){if(this._status!==d.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var n=e.total;this._internalAbort(),null!=n&0!==n&&(this._totalLength=n)}if(this._range.to===-1?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}}},{key:"_normalizeSpeed",value:function(e){var t=this._chunkSizeKBList,n=t.length-1,i=0,r=0,a=n;if(e<t[0])return t[0];for(;r<=a;){if(i=r+Math.floor((a-r)/2),i===n||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?r=i+1:a=i-1}}},{key:"_onLoad",value:function(e){if(this._status!==d.LoaderStatus.kError){if(this._waitForTotalLength)return void(this._waitForTotalLength=!1);this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var n=this._normalizeSpeed(t);this._currentSpeedNormalized!==n&&(this._currentSpeedNormalized=n,this._currentChunkSizeKB=n)}var i=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var a=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():a=!0,this._onDataArrival&&this._onDataArrival(i,r,this._receivedLength),a&&(this._status=d.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}}},{key:"_onXhrError",value:function(e){this._status=d.LoaderStatus.kError;var t=0,n=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=d.LoaderErrors.EARLY_EOF,n={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=d.LoaderErrors.EXCEPTION,n={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new f.RuntimeException(n.msg);this._onError(t,n)}},{key:"currentSpeed",get:function(){return this._speedSampler.lastSecondKBps}}]),t}(d.BaseLoader);exports["default"]=p},{"../utils/exception.js":40,"../utils/logger.js":41,"./loader.js":24,"./speed-sampler.js":27}],32:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("events"),o=t(a),s=e("../utils/logger.js"),u=t(s),l=e("../utils/browser.js"),c=t(l),h=e("./player-events.js"),d=t(h),f=e("../core/transmuxer.js"),p=t(f),m=e("../core/transmuxing-events.js"),g=t(m),v=e("../core/mse-controller.js"),y=t(v),_=e("../core/mse-events.js"),x=t(_),b=e("./player-errors.js"),w=e("../config.js"),E=e("../utils/exception.js"),S=function(){function e(t,r){if(n(this,e),this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new o["default"],this._config=(0,w.createDefaultConfig)(),"object"===("undefined"==typeof r?"undefined":i(r))&&Object.assign(this._config,r),"flv"!==t.type.toLowerCase())throw new E.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");t.isLive===!0&&(this._config.isLive=!0),this._config.isFilter=t.isFilter,this._config.isMapping=t.isMapping,this._config.filterVision=t.filterVision,this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=t,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var a=c["default"].chrome&&(c["default"].version.major<50||50===c["default"].version.major&&c["default"].version.build<2661);this._alwaysSeekKeyframe=!!(a||c["default"].msedge||c["default"].msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return r(e,[{key:"destroy",value:function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var n=this;e===d["default"].MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then(function(){n._emitter.emit(d["default"].MEDIA_INFO,n.mediaInfo)}):e===d["default"].STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then(function(){n._emitter.emit(d["default"].STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new y["default"](this._config),this._msectl.on(x["default"].UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(x["default"].BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(x["default"].SOURCE_OPEN,function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())}),this._msectl.on(x["default"].ERROR,function(e){t._emitter.emit(d["default"].ERROR,b.ErrorTypes.MEDIA_ERROR,b.ErrorDetails.MEDIA_MSE_ERROR,e)}),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(n){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)}},{key:"load",value:function(){var e=this;if(!this._mediaElement)throw new E.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new E.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");if(!this._hasPendingLoad){if(this._config.deferLoadAfterSourceOpen&&this._mseSourceOpened===!1)return void(this._hasPendingLoad=!0);this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new p["default"](this._mediaDataSource,this._config),this._transmuxer.on(g["default"].INIT_SEGMENT,function(t,n){e._msectl.appendInitSegment(n)}),this._transmuxer.on(g["default"].MEDIA_SEGMENT,function(t,n){if(e._msectl.appendMediaSegment(n),e._config.lazyLoad&&!e._config.isLive){var i=e._mediaElement.currentTime;n.info.endDts>=1e3*(i+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(u["default"].v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}}),this._transmuxer.on(g["default"].LOADING_COMPLETE,function(){e._msectl.endOfStream(),e._emitter.emit(d["default"].LOADING_COMPLETE)}),this._transmuxer.on(g["default"].RECOVERED_EARLY_EOF,function(){e._emitter.emit(d["default"].RECOVERED_EARLY_EOF)}),this._transmuxer.on(g["default"].IO_ERROR,function(t,n){e._emitter.emit(d["default"].ERROR,b.ErrorTypes.NETWORK_ERROR,t,n)}),this._transmuxer.on(g["default"].DEMUX_ERROR,function(t,n){e._emitter.emit(d["default"].ERROR,b.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:n})}),this._transmuxer.on(g["default"].MEDIA_INFO,function(t){e._mediaInfo=t,e._emitter.emit(d["default"].MEDIA_INFO,Object.assign({},t))}),this._transmuxer.on(g["default"].STATISTICS_INFO,function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(d["default"].STATISTICS_INFO,Object.assign({},e._statisticsInfo))}),this._transmuxer.on(g["default"].RECOMMEND_SEEKPOINT,function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)}),this._transmuxer.open()}}},{key:"unload",value:function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_fillStatisticsInfo",value:function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();n=r.totalVideoFrames,i=r.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=i),e}},{key:"_onmseUpdateEnd",value:function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,n=0,i=0,r=0;r<e.length;r++){var a=e.start(r),o=e.end(r);if(a<=t&&t<o){n=a,i=o;break}}i>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(u["default"].v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}}},{key:"_onmseBufferFull",value:function(){u["default"].v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()}},{key:"_suspendTransmuxer",value:function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))}},{key:"_checkProgressAndResume",value:function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,n=!1,i=0;i<t.length;i++){var r=t.start(i),a=t.end(i);if(e>=r&&e<a){e>=a-this._config.lazyLoadRecoverDuration&&(n=!0);break}}n&&(window.clearInterval(this._progressChecker),this._progressChecker=null,n&&(u["default"].v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))}},{key:"_isTimepointBuffered",value:function(e){for(var t=this._mediaElement.buffered,n=0;n<t.length;n++){var i=t.start(n),r=t.end(n);if(e>=i&&e<r)return!0}return!1}},{key:"_internalSeek",value:function(e){var t=this._isTimepointBuffered(e),n=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var r=this._mediaElement.buffered.start(0);(r<1&&e<r||c["default"].safari)&&(n=!0,i=c["default"].safari?.1:r)}if(n)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,null!=a?this._mediaElement.currentTime=a.dts/1e3:this._mediaElement.currentTime=e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)}},{key:"_checkAndApplyUnbufferedSeekpoint",value:function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_checkAndResumeStuckPlayback",value:function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var n=t.buffered;n.length>0&&t.currentTime<n.start(0)&&(u["default"].w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+n.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=n.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)}},{key:"_onvSeeking",value:function(e){var t=this._mediaElement.currentTime,n=this._mediaElement.buffered;if(this._requestSetTime)return void(this._requestSetTime=!1);if(t<1&&n.length>0){var i=n.start(0);if(i<1&&t<i||c["default"].safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=c["default"].safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var r=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=r&&(this._requestSetTime=!0,this._mediaElement.currentTime=r.dts/1e3)}return void(null!=this._progressChecker&&this._checkProgressAndResume())}this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},{key:"_onvCanPlay",value:function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)}},{key:"_onvStalled",value:function(e){this._checkAndResumeStuckPlayback(!0)}},{key:"_onvProgress",value:function(e){this._checkAndResumeStuckPlayback()}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){return Object.assign({},this._mediaInfo)}},{key:"statisticsInfo",get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)}}]),e}();exports["default"]=S},{"../config.js":5,"../core/mse-controller.js":9,"../core/mse-events.js":10,"../core/transmuxer.js":11,"../core/transmuxing-events.js":13,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./player-errors.js":34,"./player-events.js":35,events:2}],33:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=e("events"),o=t(a),s=e("./player-events.js"),u=t(s),l=e("../config.js"),c=e("../utils/exception.js"),h=function(){function e(t,r){if(n(this,e),this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new o["default"],this._config=(0,l.createDefaultConfig)(),"object"===("undefined"==typeof r?"undefined":i(r))&&Object.assign(this._config,r),"flv"===t.type.toLowerCase())throw new c.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(t.hasOwnProperty("segments"))throw new c.InvalidArgumentException("NativePlayer("+t.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=t,this._mediaElement=null}return r(e,[{key:"destroy",value:function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null}},{key:"on",value:function(e,t){var n=this;e===u["default"].MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){n._emitter.emit(u["default"].MEDIA_INFO,n.mediaInfo)}):e===u["default"].STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then(function(){n._emitter.emit(u["default"].STATISTICS_INFO,n.statisticsInfo)}),this._emitter.addListener(e,t)}},{key:"off",value:function(e,t){this._emitter.removeListener(e,t)}},{key:"attachMediaElement",value:function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(t){}}},{key:"detachMediaElement",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"load",value:function(){if(!this._mediaElement)throw new c.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)}},{key:"unload",value:function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)}},{key:"play",value:function(){return this._mediaElement.play()}},{key:"pause",value:function(){this._mediaElement.pause()}},{key:"_onvLoadedMetadata",value:function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(u["default"].MEDIA_INFO,this.mediaInfo)}},{key:"_reportStatisticsInfo",value:function(){this._emitter.emit(u["default"].STATISTICS_INFO,this.statisticsInfo)}},{key:"type",get:function(){return this._type}},{key:"buffered",get:function(){return this._mediaElement.buffered}},{key:"duration",get:function(){return this._mediaElement.duration}},{key:"volume",get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e}},{key:"muted",get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e}},{key:"currentTime",get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e}},{key:"mediaInfo",get:function(){var e=this._mediaElement instanceof HTMLAudioElement?"audio/":"video/",t={mimeType:e+this._mediaDataSource.type};return this._mediaElement&&(t.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(t.width=this._mediaElement.videoWidth,t.height=this._mediaElement.videoHeight)),t}},{key:"statisticsInfo",get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,n=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var r=this._mediaElement.getVideoPlaybackQuality();n=r.totalVideoFrames,i=r.droppedVideoFrames}else void 0!=this._mediaElement.webkitDecodedFrameCount?(n=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=n,e.droppedFrames=i),e}}]),e}();exports["default"]=h},{"../config.js":5,"../utils/exception.js":40,"./player-events.js":35,events:2}],34:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(exports,"__esModule",{value:!0}),exports.ErrorDetails=exports.ErrorTypes=void 0;var n=e("../io/loader.js"),i=e("../demux/demux-errors.js"),r=t(i);exports.ErrorTypes={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},exports.ErrorDetails={NETWORK_EXCEPTION:n.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:n.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:n.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:n.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:r["default"].FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:r["default"].FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:r["default"].CODEC_UNSUPPORTED}},{"../demux/demux-errors.js":16,"../io/loader.js":24}],35:[function(e,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",STATISTICS_INFO:"statistics_info"};exports["default"]=t},{}],36:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return n(e,null,[{key:"getSilentFrame",value:function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();exports["default"]=i},{}],37:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function e(){t(this,e)}return n(e,null,[{key:"init",value:function(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],".mp3":[]};for(var t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var n=e.constants={};n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}},{key:"box",value:function(e){for(var t=8,n=null,i=Array.prototype.slice.call(arguments,1),r=i.length,a=0;a<r;a++)t+=i[a].byteLength;n=new Uint8Array(t),n[0]=t>>>24&255,n[1]=t>>>16&255,n[2]=t>>>8&255,n[3]=255&t,n.set(e,4);for(var o=8,s=0;s<r;s++)n.set(i[s],o),o+=i[s].byteLength;return n}},{key:"generateInitSegment",value:function(t){var n=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),r=new Uint8Array(n.byteLength+i.byteLength);return r.set(n,0),r.set(i,n.byteLength),r}},{key:"moov",value:function(t){var n=e.mvhd(t.timescale,t.duration),i=e.trak(t),r=e.mvex(t);return e.box(e.types.moov,n,i,r)}},{key:"mvhd",value:function(t,n){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))}},{key:"trak",value:function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))}},{key:"tkhd",value:function(t){var n=t.id,i=t.duration,r=t.presentWidth,a=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,a>>>8&255,255&a,0,0]))}},{key:"mdia",value:function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))}},{key:"mdhd",value:function(t){var n=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}},{key:"hdlr",value:function(t){var n=null;return n="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,n)}},{key:"minf",value:function(t){var n=null;return n="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,n,e.dinf(),e.stbl(t))}},{key:"dinf",value:function(){var t=e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF));return t}},{key:"stbl",value:function(t){var n=e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO));return n}},{key:"stsd",value:function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))}},{key:"mp3",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],r)}},{key:"mp4a",value:function(t){var n=t.channelCount,i=t.audioSampleRate,r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,n,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,r,e.esds(t))}},{key:"esds",value:function(t){var n=t.config||[],i=n.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(n).concat([6,1,2]));return e.box(e.types.esds,r)}},{key:"avc1",value:function(t){var n=t.avcc,i=t.codecWidth,r=t.codecHeight,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,r>>>8&255,255&r,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return e.box(e.types.avc1,a,e.box(e.types.avcC,n))}},{key:"mvex",value:function(t){return e.box(e.types.mvex,e.trex(t))}},{key:"trex",value:function(t){var n=t.id,i=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)}},{key:"moof",value:function(t,n){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,n))}},{key:"mfhd",value:function(t){var n=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,n)}},{key:"traf",value:function(t,n){var i=t.id,r=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),a=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n])),o=e.sdtp(t),s=e.trun(t,o.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,r,a,s,o)}},{key:"sdtp",value:function(t){for(var n=t.samples||[],i=n.length,r=new Uint8Array(4+i),a=0;a<i;a++){var o=n[a].flags;r[a+4]=o.isLeading<<6|o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy}return e.box(e.types.sdtp,r)}},{key:"trun",value:function(t,n){var i=t.samples||[],r=i.length,a=12+16*r,o=new Uint8Array(a);n+=8+a,o.set([0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,255&r,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0);for(var s=0;s<r;s++){var u=i[s].duration,l=i[s].size,c=i[s].flags,h=i[s].cts;o.set([u>>>24&255,u>>>16&255,u>>>8&255,255&u,l>>>24&255,l>>>16&255,l>>>8&255,255&l,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.isNonSync,0,0,h>>>24&255,h>>>16&255,h>>>8&255,255&h],12+16*s)}return e.box(e.types.trun,o)}},{key:"mdat",value:function(t){return e.box(e.types.mdat,t)}}]),e}();i.init(),exports["default"]=i},{}],38:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("../utils/logger.js"),a=t(r),o=e("./mp4-generator.js"),s=t(o),u=e("./aac-silent.js"),l=t(u),c=e("../utils/browser.js"),h=t(c),d=e("../core/media-segment-info.js"),f=e("../utils/exception.js"),p=function(){function e(t){n(this,e),this.TAG="MP4Remuxer",this._config=t,this._isLive=t.isLive===!0,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new d.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new d.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!h["default"].chrome||!(h["default"].version.major<50||50===h["default"].version.major&&h["default"].version.build<2661)),
this._fillSilentAfterSeek=h["default"].msedge||h["default"].msie,this._mp3UseMpegAudio=!h["default"].firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return i(e,[{key:"destroy",value:function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null}},{key:"bindDataSource",value:function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this}},{key:"insertDiscontinuity",value:function(){this._audioNextDts=this._videoNextDts=void 0}},{key:"seek",value:function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()}},{key:"remux",value:function(e,t){if(!this._onMediaSegment)throw new f.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)}},{key:"_onTrackMetadataReceived",value:function(e,t){var n=null,i="mp4",r=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",r="",n=new Uint8Array):n=s["default"].generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,n=s["default"].generateInitSegment(t)}if(!this._onInitSegment)throw new f.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:n.buffer,codec:r,container:e+"/"+i,mediaDuration:t.duration})}},{key:"_calculateDtsBase",value:function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)}},{key:"flushStashedSamples",value:function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,n={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(n.samples.push(e),n.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(n,!0),this._remuxAudio(i,!0)}},{key:"_remuxAudio",value:function(e,t){if(null!=this._audioMeta){var n=e,i=n.samples,r=void 0,o=-1,u=-1,c=this._audioMeta.refSampleDuration,f="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,p=this._dtsBaseInited&&void 0===this._audioNextDts,m=!1;if(i&&0!==i.length&&(1!==i.length||t)){var g=0,v=null,y=0;f?(g=0,y=n.length):(g=8,y=8+n.length);var _=null;if(i.length>1&&(_=i.pop(),y-=_.length),null!=this._audioStashedLastSample){var x=this._audioStashedLastSample;this._audioStashedLastSample=null,i.unshift(x),y+=x.length}null!=_&&(this._audioStashedLastSample=_);var b=i[0].dts-this._dtsBase;if(this._audioNextDts)r=b-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())r=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(m=!0);else{var w=this._audioSegmentInfoList.getLastSampleBefore(b);if(null!=w){var E=b-(w.originalDts+w.duration);E<=3&&(E=0);var S=w.dts+w.duration+E;r=b-S}else r=0}if(m){var M=b-r,T=this._videoSegmentInfoList.getLastSegmentBefore(b);if(null!=T&&T.beginDts<M){var A=l["default"].getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);if(A){var L=T.beginDts,R=M-T.beginDts;a["default"].v(this.TAG,"InsertPrefixSilentAudio: dts: "+L+", duration: "+R),i.unshift({unit:A,dts:L,pts:L}),y+=A.byteLength}}else m=!1}for(var C=[],P=0;P<i.length;P++){var I=i[P],O=I.unit,k=I.dts-this._dtsBase,D=k-r;o===-1&&(o=D);var N=0;if(P!==i.length-1){var U=i[P+1].dts-this._dtsBase-r;N=U-D}else if(null!=_){var B=_.dts-this._dtsBase-r;N=B-D}else N=C.length>=1?C[C.length-1].duration:Math.floor(c);var F=!1,j=null;if(N>1.5*c&&"mp3"!==this._audioMeta.codec&&this._fillAudioTimestampGap&&!h["default"].safari){F=!0;var z=Math.abs(N-c),G=Math.ceil(z/c),H=D+c;a["default"].w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\n"+("dts: "+(D+N)+" ms, expected: "+(D+Math.round(c))+" ms, ")+("delta: "+Math.round(z)+" ms, generate: "+G+" frames"));var V=l["default"].getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount);null==V&&(a["default"].w(this.TAG,"Unable to generate silent frame for "+(this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame")),V=O),j=[];for(var W=0;W<G;W++){var q=Math.round(H);if(j.length>0){var X=j[j.length-1];X.duration=q-X.dts}var Y={dts:q,pts:q,cts:0,unit:V,size:V.byteLength,duration:0,originalDts:k,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};j.push(Y),y+=O.byteLength,H+=c}var K=j[j.length-1];K.duration=D+N-K.dts,N=Math.round(c)}C.push({dts:D,pts:D,cts:0,unit:I.unit,size:I.unit.byteLength,duration:N,originalDts:k,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),F&&C.push.apply(C,j)}f?v=new Uint8Array(y):(v=new Uint8Array(y),v[0]=y>>>24&255,v[1]=y>>>16&255,v[2]=y>>>8&255,v[3]=255&y,v.set(s["default"].types.mdat,4));for(var Z=0;Z<C.length;Z++){var J=C[Z].unit;v.set(J,g),g+=J.byteLength}var Q=C[C.length-1];u=Q.dts+Q.duration,this._audioNextDts=u;var ee=new d.MediaSegmentInfo;ee.beginDts=o,ee.endDts=u,ee.beginPts=o,ee.endPts=u,ee.originalBeginDts=C[0].originalDts,ee.originalEndDts=Q.originalDts+Q.duration,ee.firstSample=new d.SampleInfo(C[0].dts,C[0].pts,C[0].duration,C[0].originalDts,(!1)),ee.lastSample=new d.SampleInfo(Q.dts,Q.pts,Q.duration,Q.originalDts,(!1)),this._isLive||this._audioSegmentInfoList.append(ee),n.samples=C,n.sequenceNumber++;var te=null;te=f?new Uint8Array:s["default"].moof(n,o),n.samples=[],n.length=0;var ne={type:"audio",data:this._mergeBoxes(te,v).buffer,sampleCount:C.length,info:ee};f&&p&&(ne.timestampOffset=o),this._onMediaSegment("audio",ne)}}}},{key:"_remuxVideo",value:function(e,t){if(null!=this._videoMeta){var n=e,i=n.samples,r=void 0,a=-1,o=-1,u=-1,l=-1;if(i&&0!==i.length&&(1!==i.length||t)){var c=8,h=null,f=8+e.length,p=null;if(i.length>1&&(p=i.pop(),f-=p.length),null!=this._videoStashedLastSample){var m=this._videoStashedLastSample;this._videoStashedLastSample=null,i.unshift(m),f+=m.length}null!=p&&(this._videoStashedLastSample=p);var g=i[0].dts-this._dtsBase;if(this._videoNextDts)r=g-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())r=0;else{var v=this._videoSegmentInfoList.getLastSampleBefore(g);if(null!=v){var y=g-(v.originalDts+v.duration);y<=3&&(y=0);var _=v.dts+v.duration+y;r=g-_}else r=0}for(var x=new d.MediaSegmentInfo,b=[],w=0;w<i.length;w++){var E=i[w],S=E.dts-this._dtsBase,M=E.isKeyframe,T=S-r,A=E.cts,L=T+A;a===-1&&(a=T,u=L);var R=0;if(w!==i.length-1){var C=i[w+1].dts-this._dtsBase-r;R=C-T}else if(null!=p){var P=p.dts-this._dtsBase-r;R=P-T}else R=b.length>=1?b[b.length-1].duration:Math.floor(this._videoMeta.refSampleDuration);if(M){var I=new d.SampleInfo(T,L,R,E.dts,(!0));I.fileposition=E.fileposition,x.appendSyncPoint(I)}b.push({dts:T,pts:L,cts:A,units:E.units,size:E.length,isKeyframe:M,duration:R,originalDts:S,flags:{isLeading:0,dependsOn:M?2:1,isDependedOn:M?1:0,hasRedundancy:0,isNonSync:M?0:1}})}h=new Uint8Array(f),h[0]=f>>>24&255,h[1]=f>>>16&255,h[2]=f>>>8&255,h[3]=255&f,h.set(s["default"].types.mdat,4);for(var O=0;O<b.length;O++)for(var k=b[O].units;k.length;){var D=k.shift(),N=D.data;h.set(N,c),c+=N.byteLength}var U=b[b.length-1];if(o=U.dts+U.duration,l=U.pts+U.duration,this._videoNextDts=o,x.beginDts=a,x.endDts=o,x.beginPts=u,x.endPts=l,x.originalBeginDts=b[0].originalDts,x.originalEndDts=U.originalDts+U.duration,x.firstSample=new d.SampleInfo(b[0].dts,b[0].pts,b[0].duration,b[0].originalDts,b[0].isKeyframe),x.lastSample=new d.SampleInfo(U.dts,U.pts,U.duration,U.originalDts,U.isKeyframe),this._isLive||this._videoSegmentInfoList.append(x),n.samples=b,n.sequenceNumber++,this._forceFirstIDR){var B=b[0].flags;B.dependsOn=2,B.isNonSync=0}var F=s["default"].moof(n,a);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(F,h).buffer,sampleCount:b.length,info:x})}}}},{key:"_mergeBoxes",value:function(e,t){var n=new Uint8Array(e.byteLength+t.byteLength);return n.set(e,0),n.set(t,e.byteLength),n}},{key:"onInitSegment",get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e}},{key:"onMediaSegment",get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e}}]),e}();exports["default"]=p},{"../core/media-segment-info.js":8,"../utils/browser.js":39,"../utils/exception.js":40,"../utils/logger.js":41,"./aac-silent.js":36,"./mp4-generator.js":37}],39:[function(e,module,exports){"use strict";function t(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],i=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],r={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:i[0]||""},a={};if(r.browser){a[r.browser]=!0;var o=r.majorVersion.split(".");a.version={major:parseInt(r.majorVersion,10),string:r.version},o.length>1&&(a.version.minor=parseInt(o[1],10)),o.length>2&&(a.version.build=parseInt(o[2],10))}if(r.platform&&(a[r.platform]=!0),(a.chrome||a.opr||a.safari)&&(a.webkit=!0),a.rv||a.iemobile){a.rv&&delete a.rv;var s="msie";r.browser=s,a[s]=!0}if(a.edge){delete a.edge;var u="msedge";r.browser=u,a[u]=!0}if(a.opr){var l="opera";r.browser=l,a[l]=!0}if(a.safari&&a.android){var c="android";r.browser=c,a[c]=!0}a.name=r.browser,a.platform=r.platform;for(var h in n)n.hasOwnProperty(h)&&delete n[h];Object.assign(n,a)}Object.defineProperty(exports,"__esModule",{value:!0});var n={};t(),exports["default"]=n},{}],40:[function(e,module,exports){"use strict";function t(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=exports.RuntimeException=function(){function e(t){i(this,e),this._message=t}return r(e,[{key:"toString",value:function(){return this.name+": "+this.message}},{key:"name",get:function(){return"RuntimeException"}},{key:"message",get:function(){return this._message}}]),e}();exports.IllegalStateException=function(e){function a(e){return i(this,a),t(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e))}return n(a,e),r(a,[{key:"name",get:function(){return"IllegalStateException"}}]),a}(a),exports.InvalidArgumentException=function(e){function a(e){return i(this,a),t(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e))}return n(a,e),r(a,[{key:"name",get:function(){return"InvalidArgumentException"}}]),a}(a),exports.NotImplementedException=function(e){function a(e){return i(this,a),t(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e))}return n(a,e),r(a,[{key:"name",get:function(){return"NotImplementedException"}}]),a}(a)},{}],41:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("events"),a=t(r),o=function(){function e(){n(this,e)}return i(e,null,[{key:"e",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",i),e.ENABLE_ERROR&&(console.error?console.error(i):console.warn?console.warn(i):console.log(i))}},{key:"i",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",i),e.ENABLE_INFO&&(console.info?console.info(i):console.log(i))}},{key:"w",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",i),e.ENABLE_WARN&&(console.warn?console.warn(i):console.log(i))}},{key:"d",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",i),e.ENABLE_DEBUG&&(console.debug?console.debug(i):console.log(i))}},{key:"v",value:function(t,n){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+n;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",i),e.ENABLE_VERBOSE&&console.log(i)}}]),e}();o.GLOBAL_TAG="flv.js",o.FORCE_GLOBAL_TAG=!1,o.ENABLE_ERROR=!0,o.ENABLE_INFO=!0,o.ENABLE_WARN=!0,o.ENABLE_DEBUG=!0,o.ENABLE_VERBOSE=!0,o.ENABLE_CALLBACK=!1,o.emitter=new a["default"],exports["default"]=o},{events:2}],42:[function(e,module,exports){"use strict";function t(e){return e&&e.__esModule?e:{"default":e}}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=e("events"),a=t(r),o=e("./logger.js"),s=t(o),u=function(){function e(){n(this,e)}return i(e,null,[{key:"getConfig",value:function(){return{globalTag:s["default"].GLOBAL_TAG,forceGlobalTag:s["default"].FORCE_GLOBAL_TAG,enableVerbose:s["default"].ENABLE_VERBOSE,enableDebug:s["default"].ENABLE_DEBUG,enableInfo:s["default"].ENABLE_INFO,enableWarn:s["default"].ENABLE_WARN,enableError:s["default"].ENABLE_ERROR,enableCallback:s["default"].ENABLE_CALLBACK}}},{key:"applyConfig",value:function(e){s["default"].GLOBAL_TAG=e.globalTag,s["default"].FORCE_GLOBAL_TAG=e.forceGlobalTag,s["default"].ENABLE_VERBOSE=e.enableVerbose,s["default"].ENABLE_DEBUG=e.enableDebug,s["default"].ENABLE_INFO=e.enableInfo,s["default"].ENABLE_WARN=e.enableWarn,s["default"].ENABLE_ERROR=e.enableError,s["default"].ENABLE_CALLBACK=e.enableCallback}},{key:"_notifyChange",value:function(){var t=e.emitter;if(t.listenerCount("change")>0){var n=e.getConfig();t.emit("change",n)}}},{key:"registerListener",value:function(t){e.emitter.addListener("change",t)}},{key:"removeListener",value:function(t){e.emitter.removeListener("change",t)}},{key:"addLogListener",value:function(t){s["default"].emitter.addListener("log",t),s["default"].emitter.listenerCount("log")>0&&(s["default"].ENABLE_CALLBACK=!0,e._notifyChange())}},{key:"removeLogListener",value:function(t){s["default"].emitter.removeListener("log",t),0===s["default"].emitter.listenerCount("log")&&(s["default"].ENABLE_CALLBACK=!1,e._notifyChange())}},{key:"forceGlobalTag",get:function(){return s["default"].FORCE_GLOBAL_TAG},set:function(t){s["default"].FORCE_GLOBAL_TAG=t,e._notifyChange()}},{key:"globalTag",get:function(){return s["default"].GLOBAL_TAG},set:function(t){s["default"].GLOBAL_TAG=t,e._notifyChange()}},{key:"enableAll",get:function(){return s["default"].ENABLE_VERBOSE&&s["default"].ENABLE_DEBUG&&s["default"].ENABLE_INFO&&s["default"].ENABLE_WARN&&s["default"].ENABLE_ERROR},set:function(t){s["default"].ENABLE_VERBOSE=t,s["default"].ENABLE_DEBUG=t,s["default"].ENABLE_INFO=t,s["default"].ENABLE_WARN=t,s["default"].ENABLE_ERROR=t,e._notifyChange()}},{key:"enableDebug",get:function(){return s["default"].ENABLE_DEBUG},set:function(t){s["default"].ENABLE_DEBUG=t,e._notifyChange()}},{key:"enableVerbose",get:function(){return s["default"].ENABLE_VERBOSE},set:function(t){s["default"].ENABLE_VERBOSE=t,e._notifyChange()}},{key:"enableInfo",get:function(){return s["default"].ENABLE_INFO},set:function(t){s["default"].ENABLE_INFO=t,e._notifyChange()}},{key:"enableWarn",get:function(){return s["default"].ENABLE_WARN},set:function(t){s["default"].ENABLE_WARN=t,e._notifyChange()}},{key:"enableError",get:function(){return s["default"].ENABLE_ERROR},set:function(t){s["default"].ENABLE_ERROR=t,e._notifyChange()}}]),e}();u.emitter=new a["default"],exports["default"]=u},{"./logger.js":41,events:2}],43:[function(e,module,exports){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var n=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),i=function(){function i(){t(this,i)}return n(i,null,[{key:"install",value:function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var r in i)i.hasOwnProperty(r)&&(t[r]=i[r])}return t},"function"!=typeof self.Promise&&e("es6-promise").polyfill()}}]),i}();i.install(),exports["default"]=i},{"es6-promise":1}],44:[function(e,module,exports){"use strict";function t(e,t,n){var i=e;if(t+n<i.length){for(;n--;)if(128!==(192&i[++t]))return!1;return!0}return!1}function n(e){for(var n=[],i=e,r=0,a=e.length;r<a;)if(i[r]<128)n.push(String.fromCharCode(i[r])),++r;else{if(i[r]<192);else if(i[r]<224){if(t(i,r,1)){var o=(31&i[r])<<6|63&i[r+1];if(o>=128){n.push(String.fromCharCode(65535&o)),r+=2;continue}}}else if(i[r]<240){if(t(i,r,2)){var s=(15&i[r])<<12|(63&i[r+1])<<6|63&i[r+2];if(s>=2048&&55296!==(63488&s)){n.push(String.fromCharCode(65535&s)),r+=3;continue}}}else if(i[r]<248&&t(i,r,3)){var u=(7&i[r])<<18|(63&i[r+1])<<12|(63&i[r+2])<<6|63&i[r+3];if(u>65536&&u<1114112){u-=65536,n.push(String.fromCharCode(u>>>10|55296)),n.push(String.fromCharCode(1023&u|56320)),r+=4;continue}}n.push(String.fromCharCode(65533)),++r}return n.join("")}Object.defineProperty(exports,"__esModule",{value:!0}),exports["default"]=n},{}]},{},[21])(21)}),function(e,t){function n(e){var t=e.length,n=oe.type(e);return!oe.isWindow(e)&&(!(1!==e.nodeType||!t)||("array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)))}function i(e){var t=me[e]={};return oe.each(e.match(ue)||[],function(e,n){t[n]=!0}),t}function r(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=oe.expando+Math.random()}function a(e,n,i){var r;if(i===t&&1===e.nodeType)if(r="data-"+n.replace(_e,"-$1").toLowerCase(),i=e.getAttribute(r),"string"==typeof i){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:ye.test(i)?JSON.parse(i):i)}catch(a){}ge.set(e,n,i)}else i=t;return i}function o(){return!0}function s(){return!1}function u(){try{return W.activeElement}catch(e){}}function l(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function c(e,t,n){if(oe.isFunction(t))return oe.grep(e,function(e,i){return!!t.call(e,i,e)!==n});if(t.nodeType)return oe.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(Re.test(t))return oe.filter(t,e,n);t=oe.filter(t,e)}return oe.grep(e,function(e){return ne.call(t,e)>=0!==n})}function h(e,t){return oe.nodeName(e,"table")&&oe.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function d(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function f(e){var t=Fe.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function p(e,t){for(var n=e.length,i=0;i<n;i++)ve.set(e[i],"globalEval",!t||ve.get(t[i],"globalEval"))}function m(e,t){var n,i,r,a,o,s,u,l;if(1===t.nodeType){if(ve.hasData(e)&&(a=ve.access(e),o=oe.extend({},a),l=a.events,ve.set(t,o),l)){delete o.handle,o.events={};for(r in l)for(n=0,i=l[r].length;n<i;n++)oe.event.add(t,r,l[r][n])}ge.hasData(e)&&(s=ge.access(e),u=oe.extend({},s),ge.set(t,u))}}function g(e,n){var i=e.getElementsByTagName?e.getElementsByTagName(n||"*"):e.querySelectorAll?e.querySelectorAll(n||"*"):[];return n===t||n&&oe.nodeName(e,n)?oe.merge([e],i):i}function v(e,t){var n=t.nodeName.toLowerCase();"input"===n&&Ne.test(e.type)?t.checked=e.checked:"input"!==n&&"textarea"!==n||(t.defaultValue=e.defaultValue)}function y(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,r=$e.length;r--;)if(t=$e[r]+n,t in e)return t;return i}function _(e,t){return e=t||e,"none"===oe.css(e,"display")||!oe.contains(e.ownerDocument,e)}function x(t){return e.getComputedStyle(t,null)}function b(e,t){for(var n,i,r,a=[],o=0,s=e.length;o<s;o++)i=e[o],i.style&&(a[o]=ve.get(i,"olddisplay"),n=i.style.display,t?(a[o]||"none"!==n||(i.style.display=""),""===i.style.display&&_(i)&&(a[o]=ve.access(i,"olddisplay",M(i.nodeName)))):a[o]||(r=_(i),(n&&"none"!==n||!r)&&ve.set(i,"olddisplay",r?n:oe.css(i,"display"))));for(o=0;o<s;o++)i=e[o],i.style&&(t&&"none"!==i.style.display&&""!==i.style.display||(i.style.display=t?a[o]||"":"none"));return e}function w(e,t,n){var i=qe.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function E(e,t,n,i,r){for(var a=n===(i?"border":"content")?4:"width"===t?1:0,o=0;a<4;a+=2)"margin"===n&&(o+=oe.css(e,n+Qe[a],!0,r)),i?("content"===n&&(o-=oe.css(e,"padding"+Qe[a],!0,r)),"margin"!==n&&(o-=oe.css(e,"border"+Qe[a]+"Width",!0,r))):(o+=oe.css(e,"padding"+Qe[a],!0,r),"padding"!==n&&(o+=oe.css(e,"border"+Qe[a]+"Width",!0,r)));return o}function S(e,t,n){var i=!0,r="width"===t?e.offsetWidth:e.offsetHeight,a=x(e),o=oe.support.boxSizing&&"border-box"===oe.css(e,"boxSizing",!1,a);if(r<=0||null==r){if(r=Ge(e,t,a),(r<0||null==r)&&(r=e.style[t]),Xe.test(r))return r;i=o&&(oe.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+E(e,t,n||(o?"border":"content"),i,a)+"px"}function M(e){var t=W,n=Ke[e];return n||(n=T(e,t),"none"!==n&&n||(He=(He||oe("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(He[0].contentWindow||He[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=T(e,t),He.detach()),Ke[e]=n),n}function T(e,t){var n=oe(t.createElement(e)).appendTo(t.body),i=oe.css(n[0],"display");return n.remove(),i}function A(e,t,n,i){var r;if(oe.isArray(t))oe.each(t,function(t,r){n||tt.test(e)?i(e,r):A(e+"["+("object"==typeof r?t:"")+"]",r,n,i)});else if(n||"object"!==oe.type(t))i(e,t);else for(r in t)A(e+"["+r+"]",t[r],n,i)}function L(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r=0,a=t.toLowerCase().match(ue)||[];if(oe.isFunction(n))for(;i=a[r++];)"+"===i[0]?(i=i.slice(1)||"*",(e[i]=e[i]||[]).unshift(n)):(e[i]=e[i]||[]).push(n)}}function R(e,t,n,i){function r(s){var u;return a[s]=!0,oe.each(e[s]||[],function(e,s){var l=s(t,n,i);return"string"!=typeof l||o||a[l]?o?!(u=l):void 0:(t.dataTypes.unshift(l),r(l),!1)}),u}var a={},o=e===yt;return r(t.dataTypes[0])||!a["*"]&&r("*")}function C(e,n){var i,r,a=oe.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((a[i]?e:r||(r={}))[i]=n[i]);return r&&oe.extend(!0,e,r),e}function P(e,n,i){for(var r,a,o,s,u=e.contents,l=e.dataTypes;"*"===l[0];)l.shift(),r===t&&(r=e.mimeType||n.getResponseHeader("Content-Type"));if(r)for(a in u)if(u[a]&&u[a].test(r)){l.unshift(a);break}if(l[0]in i)o=l[0];else{for(a in i){if(!l[0]||e.converters[a+" "+l[0]]){o=a;break}s||(s=a)}o=o||s}if(o)return o!==l[0]&&l.unshift(o),i[o]}function I(e,t,n,i){var r,a,o,s,u,l={},c=e.dataTypes.slice();if(c[1])for(o in e.converters)l[o.toLowerCase()]=e.converters[o];for(a=c.shift();a;)if(e.responseFields[a]&&(n[e.responseFields[a]]=t),!u&&i&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=a,a=c.shift())if("*"===a)a=u;else if("*"!==u&&u!==a){if(o=l[u+" "+a]||l["* "+a],!o)for(r in l)if(s=r.split(" "),s[1]===a&&(o=l[u+" "+s[0]]||l["* "+s[0]])){o===!0?o=l[r]:l[r]!==!0&&(a=s[0],c.unshift(s[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(h){return{state:"parsererror",error:o?h:"No conversion from "+u+" to "+a}}}return{state:"success",data:t}}function O(){return setTimeout(function(){At=t}),At=oe.now()}function k(e,t){oe.each(t,function(t,n){for(var i=(Ot[t]||[]).concat(Ot["*"]),r=0,a=i.length;r<a;r++)if(i[r].call(e,t,n))return})}function D(e,t,n){var i,r,a=0,o=It.length,s=oe.Deferred().always(function(){delete u.elem}),u=function(){if(r)return!1;for(var t=At||O(),n=Math.max(0,l.startTime+l.duration-t),i=n/l.duration||0,a=1-i,o=0,u=l.tweens.length;o<u;o++)l.tweens[o].run(a);return s.notifyWith(e,[l,a,n]),a<1&&u?n:(s.resolveWith(e,[l]),!1)},l=s.promise({elem:e,props:oe.extend({},t),opts:oe.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:At||O(),duration:n.duration,tweens:[],createTween:function(t,n){var i=oe.Tween(e,l.opts,t,n,l.opts.specialEasing[t]||l.opts.easing);return l.tweens.push(i),i},stop:function(t){var n=0,i=t?l.tweens.length:0;if(r)return this;for(r=!0;n<i;n++)l.tweens[n].run(1);return t?s.resolveWith(e,[l,t]):s.rejectWith(e,[l,t]),this}}),c=l.props;for(N(c,l.opts.specialEasing);a<o;a++)if(i=It[a].call(l,e,c,l.opts))return i;return k(l,c),oe.isFunction(l.opts.start)&&l.opts.start.call(e,l),oe.fx.timer(oe.extend(u,{elem:e,anim:l,queue:l.opts.queue})),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always)}function N(e,t){var n,i,r,a,o;for(n in e)if(i=oe.camelCase(n),r=t[i],a=e[n],oe.isArray(a)&&(r=a[1],a=e[n]=a[0]),n!==i&&(e[i]=a,delete e[n]),o=oe.cssHooks[i],o&&"expand"in o){a=o.expand(a),delete e[i];for(n in a)n in e||(e[n]=a[n],t[n]=r)}else t[i]=r}function U(e,n,i){var r,a,o,s,u,l,c,h,d,f=this,p=e.style,m={},g=[],v=e.nodeType&&_(e);i.queue||(h=oe._queueHooks(e,"fx"),null==h.unqueued&&(h.unqueued=0,d=h.empty.fire,h.empty.fire=function(){h.unqueued||d()}),h.unqueued++,f.always(function(){f.always(function(){h.unqueued--,oe.queue(e,"fx").length||h.empty.fire()})})),1===e.nodeType&&("height"in n||"width"in n)&&(i.overflow=[p.overflow,p.overflowX,p.overflowY],"inline"===oe.css(e,"display")&&"none"===oe.css(e,"float")&&(p.display="inline-block")),i.overflow&&(p.overflow="hidden",f.always(function(){p.overflow=i.overflow[0],p.overflowX=i.overflow[1],p.overflowY=i.overflow[2]})),u=ve.get(e,"fxshow");for(r in n)if(o=n[r],Rt.exec(o)){if(delete n[r],l=l||"toggle"===o,o===(v?"hide":"show")){if("show"!==o||u===t||u[r]===t)continue;v=!0}g.push(r)}if(s=g.length){u=ve.get(e,"fxshow")||ve.access(e,"fxshow",{}),"hidden"in u&&(v=u.hidden),l&&(u.hidden=!v),v?oe(e).show():f.done(function(){oe(e).hide()}),f.done(function(){var t;ve.remove(e,"fxshow");for(t in m)oe.style(e,t,m[t])});for(r=0;r<s;r++)a=g[r],c=f.createTween(a,v?u[a]:0),m[a]=u[a]||oe.style(e,a),a in u||(u[a]=c.start,v&&(c.end=c.start,c.start="width"===a||"height"===a?1:0))}}function B(e,t,n,i,r){return new B.prototype.init(e,t,n,i,r)}function F(e,t){var n,i={height:e},r=0;for(t=t?1:0;r<4;r+=2-t)n=Qe[r],i["margin"+n]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function j(e){return oe.isWindow(e)?e:9===e.nodeType&&e.defaultView}var z,G,H=typeof t,V=e.location,W=e.document,q=W.documentElement,X=e.jQuery,Y=e.$,K={},Z=[],J="2.0.0",Q=Z.concat,ee=Z.push,te=Z.slice,ne=Z.indexOf,ie=K.toString,re=K.hasOwnProperty,ae=J.trim,oe=function(e,t){return new oe.fn.init(e,t,z)},se=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ue=/\S+/g,le=/^(?:(<[\w\W]+>)[^>]*|#([\w-]*))$/,ce=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,he=/^-ms-/,de=/-([\da-z])/gi,fe=function(e,t){return t.toUpperCase()},pe=function(){W.removeEventListener("DOMContentLoaded",pe,!1),e.removeEventListener("load",pe,!1),oe.ready()};oe.fn=oe.prototype={jquery:J,constructor:oe,init:function(e,n,i){var r,a;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:le.exec(e),!r||!r[1]&&n)return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e);if(r[1]){if(n=n instanceof oe?n[0]:n,oe.merge(this,oe.parseHTML(r[1],n&&n.nodeType?n.ownerDocument||n:W,!0)),ce.test(r[1])&&oe.isPlainObject(n))for(r in n)oe.isFunction(this[r])?this[r](n[r]):this.attr(r,n[r]);return this}return a=W.getElementById(r[2]),a&&a.parentNode&&(this.length=1,this[0]=a),this.context=W,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):oe.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),oe.makeArray(e,this))},selector:"",length:0,toArray:function(){return te.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e){var t=oe.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return oe.each(this,e,t)},ready:function(e){return oe.ready.promise().done(e),this},slice:function(){return this.pushStack(te.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(n>=0&&n<t?[this[n]]:[])},map:function(e){return this.pushStack(oe.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ee,sort:[].sort,splice:[].splice},oe.fn.init.prototype=oe.fn,oe.extend=oe.fn.extend=function(){var e,n,i,r,a,o,s=arguments[0]||{},u=1,l=arguments.length,c=!1;for("boolean"==typeof s&&(c=s,s=arguments[1]||{},u=2),"object"==typeof s||oe.isFunction(s)||(s={}),l===u&&(s=this,--u);u<l;u++)if(null!=(e=arguments[u]))for(n in e)i=s[n],r=e[n],s!==r&&(c&&r&&(oe.isPlainObject(r)||(a=oe.isArray(r)))?(a?(a=!1,o=i&&oe.isArray(i)?i:[]):o=i&&oe.isPlainObject(i)?i:{},s[n]=oe.extend(c,o,r)):r!==t&&(s[n]=r));return s},oe.extend({expando:"jQuery"+(J+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===oe&&(e.$=Y),t&&e.jQuery===oe&&(e.jQuery=X),oe},isReady:!1,readyWait:1,holdReady:function(e){e?oe.readyWait++:oe.ready(!0)},ready:function(e){(e===!0?--oe.readyWait:oe.isReady)||(oe.isReady=!0,e!==!0&&--oe.readyWait>0||(G.resolveWith(W,[oe]),oe.fn.trigger&&oe(W).trigger("ready").off("ready")))},isFunction:function(e){return"function"===oe.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?K[ie.call(e)]||"object":typeof e},isPlainObject:function(e){if("object"!==oe.type(e)||e.nodeType||oe.isWindow(e))return!1;try{if(e.constructor&&!re.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,
t=!1),t=t||W;var i=ce.exec(e),r=!n&&[];return i?[t.createElement(i[1])]:(i=oe.buildFragment([e],t,r),r&&oe(r).remove(),oe.merge([],i.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var n,i;if(!e||"string"!=typeof e)return null;try{i=new DOMParser,n=i.parseFromString(e,"text/xml")}catch(r){n=t}return n&&!n.getElementsByTagName("parsererror").length||oe.error("Invalid XML: "+e),n},noop:function(){},globalEval:function(e){var t,n=eval;e=oe.trim(e),e&&(1===e.indexOf("use strict")?(t=W.createElement("script"),t.text=e,W.head.appendChild(t).parentNode.removeChild(t)):n(e))},camelCase:function(e){return e.replace(he,"ms-").replace(de,fe)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,i){var r,a=0,o=e.length,s=n(e);if(i){if(s)for(;a<o&&(r=t.apply(e[a],i),r!==!1);a++);else for(a in e)if(r=t.apply(e[a],i),r===!1)break}else if(s)for(;a<o&&(r=t.call(e[a],a,e[a]),r!==!1);a++);else for(a in e)if(r=t.call(e[a],a,e[a]),r===!1)break;return e},trim:function(e){return null==e?"":ae.call(e)},makeArray:function(e,t){var i=t||[];return null!=e&&(n(Object(e))?oe.merge(i,"string"==typeof e?[e]:e):ee.call(i,e)),i},inArray:function(e,t,n){return null==t?-1:ne.call(t,e,n)},merge:function(e,n){var i=n.length,r=e.length,a=0;if("number"==typeof i)for(;a<i;a++)e[r++]=n[a];else for(;n[a]!==t;)e[r++]=n[a++];return e.length=r,e},grep:function(e,t,n){var i,r=[],a=0,o=e.length;for(n=!!n;a<o;a++)i=!!t(e[a],a),n!==i&&r.push(e[a]);return r},map:function(e,t,i){var r,a=0,o=e.length,s=n(e),u=[];if(s)for(;a<o;a++)r=t(e[a],a,i),null!=r&&(u[u.length]=r);else for(a in e)r=t(e[a],a,i),null!=r&&(u[u.length]=r);return Q.apply([],u)},guid:1,proxy:function(e,n){var i,r,a;return"string"==typeof n&&(i=e[n],n=e,e=i),oe.isFunction(e)?(r=te.call(arguments,2),a=function(){return e.apply(n||this,r.concat(te.call(arguments)))},a.guid=e.guid=e.guid||oe.guid++,a):t},access:function(e,n,i,r,a,o,s){var u=0,l=e.length,c=null==i;if("object"===oe.type(i)){a=!0;for(u in i)oe.access(e,n,u,i[u],!0,o,s)}else if(r!==t&&(a=!0,oe.isFunction(r)||(s=!0),c&&(s?(n.call(e,r),n=null):(c=n,n=function(e,t,n){return c.call(oe(e),n)})),n))for(;u<l;u++)n(e[u],i,s?r:r.call(e[u],u,n(e[u],i)));return a?e:c?n.call(e):l?n(e[0],i):o},now:Date.now,swap:function(e,t,n,i){var r,a,o={};for(a in t)o[a]=e.style[a],e.style[a]=t[a];r=n.apply(e,i||[]);for(a in t)e.style[a]=o[a];return r}}),oe.ready.promise=function(t){return G||(G=oe.Deferred(),"complete"===W.readyState?setTimeout(oe.ready):(W.addEventListener("DOMContentLoaded",pe,!1),e.addEventListener("load",pe,!1))),G.promise(t)},oe.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){K["[object "+t+"]"]=t.toLowerCase()}),z=oe(W),function(e,t){function n(e){return xe.test(e+"")}function i(){var e,t=[];return e=function(n,i){return t.push(n+=" ")>T.cacheLength&&delete e[t.shift()],e[n]=i}}function r(e){return e[j]=!0,e}function a(e){var t=O.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function o(e,t,n,i){var r,a,o,s,u,l,c,h,d,m;if((t?t.ownerDocument||t:z)!==O&&I(t),t=t||O,n=n||[],!e||"string"!=typeof e)return n;if(1!==(s=t.nodeType)&&9!==s)return[];if(D&&!i){if(r=be.exec(e))if(o=r[1]){if(9===s){if(a=t.getElementById(o),!a||!a.parentNode)return n;if(a.id===o)return n.push(a),n}else if(t.ownerDocument&&(a=t.ownerDocument.getElementById(o))&&F(t,a)&&a.id===o)return n.push(a),n}else{if(r[2])return ne.apply(n,t.getElementsByTagName(e)),n;if((o=r[3])&&G.getElementsByClassName&&t.getElementsByClassName)return ne.apply(n,t.getElementsByClassName(o)),n}if(G.qsa&&(!N||!N.test(e))){if(h=c=j,d=t,m=9===s&&e,1===s&&"object"!==t.nodeName.toLowerCase()){for(l=f(e),(c=t.getAttribute("id"))?h=c.replace(Se,"\\$&"):t.setAttribute("id",h),h="[id='"+h+"'] ",u=l.length;u--;)l[u]=h+p(l[u]);d=me.test(e)&&t.parentNode||t,m=l.join(",")}if(m)try{return ne.apply(n,d.querySelectorAll(m)),n}catch(g){}finally{c||t.removeAttribute("id")}}}return w(e.replace(de,"$1"),t,n,i)}function s(e,t){var n=t&&e,i=n&&(~t.sourceIndex||J)-(~e.sourceIndex||J);if(i)return i;if(n)for(;n=n.nextSibling;)if(n===t)return-1;return e?1:-1}function u(e,n,i){var r;return i?t:(r=e.getAttributeNode(n))&&r.specified?r.value:e[n]===!0?n.toLowerCase():null}function l(e,n,i){var r;return i?t:r=e.getAttribute(n,"type"===n.toLowerCase()?1:2)}function c(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function h(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function d(e){return r(function(t){return t=+t,r(function(n,i){for(var r,a=e([],n.length,t),o=a.length;o--;)n[r=a[o]]&&(n[r]=!(i[r]=n[r]))})})}function f(e,t){var n,i,r,a,s,u,l,c=q[e+" "];if(c)return t?0:c.slice(0);for(s=e,u=[],l=T.preFilter;s;){n&&!(i=fe.exec(s))||(i&&(s=s.slice(i[0].length)||s),u.push(r=[])),n=!1,(i=pe.exec(s))&&(n=i.shift(),r.push({value:n,type:i[0].replace(de," ")}),s=s.slice(n.length));for(a in T.filter)!(i=_e[a].exec(s))||l[a]&&!(i=l[a](i))||(n=i.shift(),r.push({value:n,type:a,matches:i}),s=s.slice(n.length));if(!n)break}return t?s.length:s?o.error(e):q(e,u).slice(0)}function p(e){for(var t=0,n=e.length,i="";t<n;t++)i+=e[t].value;return i}function m(e,t,n){var i=t.dir,r=n&&"parentNode"===i,a=V++;return t.first?function(t,n,a){for(;t=t[i];)if(1===t.nodeType||r)return e(t,n,a)}:function(t,n,o){var s,u,l,c=H+" "+a;if(o){for(;t=t[i];)if((1===t.nodeType||r)&&e(t,n,o))return!0}else for(;t=t[i];)if(1===t.nodeType||r)if(l=t[j]||(t[j]={}),(u=l[i])&&u[0]===c){if((s=u[1])===!0||s===M)return s===!0}else if(u=l[i]=[c],u[1]=e(t,n,o)||M,u[1]===!0)return!0}}function g(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function v(e,t,n,i,r){for(var a,o=[],s=0,u=e.length,l=null!=t;s<u;s++)(a=e[s])&&(n&&!n(a,i,r)||(o.push(a),l&&t.push(s)));return o}function y(e,t,n,i,a,o){return i&&!i[j]&&(i=y(i)),a&&!a[j]&&(a=y(a,o)),r(function(r,o,s,u){var l,c,h,d=[],f=[],p=o.length,m=r||b(t||"*",s.nodeType?[s]:s,[]),g=!e||!r&&t?m:v(m,d,e,s,u),y=n?a||(r?e:p||i)?[]:o:g;if(n&&n(g,y,s,u),i)for(l=v(y,f),i(l,[],s,u),c=l.length;c--;)(h=l[c])&&(y[f[c]]=!(g[f[c]]=h));if(r){if(a||e){if(a){for(l=[],c=y.length;c--;)(h=y[c])&&l.push(g[c]=h);a(null,y=[],l,u)}for(c=y.length;c--;)(h=y[c])&&(l=a?re.call(r,h):d[c])>-1&&(r[l]=!(o[l]=h))}}else y=v(y===o?y.splice(p,y.length):y),a?a(null,o,y,u):ne.apply(o,y)})}function _(e){for(var t,n,i,r=e.length,a=T.relative[e[0].type],o=a||T.relative[" "],s=a?1:0,u=m(function(e){return e===t},o,!0),l=m(function(e){return re.call(t,e)>-1},o,!0),c=[function(e,n,i){return!a&&(i||n!==C)||((t=n).nodeType?u(e,n,i):l(e,n,i))}];s<r;s++)if(n=T.relative[e[s].type])c=[m(g(c),n)];else{if(n=T.filter[e[s].type].apply(null,e[s].matches),n[j]){for(i=++s;i<r&&!T.relative[e[i].type];i++);return y(s>1&&g(c),s>1&&p(e.slice(0,s-1)).replace(de,"$1"),n,s<i&&_(e.slice(s,i)),i<r&&_(e=e.slice(i)),i<r&&p(e))}c.push(n)}return g(c)}function x(e,t){var n=0,i=t.length>0,a=e.length>0,s=function(r,s,u,l,c){var h,d,f,p=[],m=0,g="0",y=r&&[],_=null!=c,x=C,b=r||a&&T.find.TAG("*",c&&s.parentNode||s),w=H+=null==x?1:Math.random()||.1;for(_&&(C=s!==O&&s,M=n);null!=(h=b[g]);g++){if(a&&h){for(d=0;f=e[d++];)if(f(h,s,u)){l.push(h);break}_&&(H=w,M=++n)}i&&((h=!f&&h)&&m--,r&&y.push(h))}if(m+=g,i&&g!==m){for(d=0;f=t[d++];)f(y,p,s,u);if(r){if(m>0)for(;g--;)y[g]||p[g]||(p[g]=ee.call(l));p=v(p)}ne.apply(l,p),_&&!r&&p.length>0&&m+t.length>1&&o.uniqueSort(l)}return _&&(H=w,C=x),y};return i?r(s):s}function b(e,t,n){for(var i=0,r=t.length;i<r;i++)o(e,t[i],n);return n}function w(e,t,n,i){var r,a,o,s,u,l=f(e);if(!i&&1===l.length){if(a=l[0]=l[0].slice(0),a.length>2&&"ID"===(o=a[0]).type&&9===t.nodeType&&D&&T.relative[a[1].type]){if(t=(T.find.ID(o.matches[0].replace(Me,Te),t)||[])[0],!t)return n;e=e.slice(a.shift().value.length)}for(r=_e.needsContext.test(e)?0:a.length;r--&&(o=a[r],!T.relative[s=o.type]);)if((u=T.find[s])&&(i=u(o.matches[0].replace(Me,Te),me.test(a[0].type)&&t.parentNode||t))){if(a.splice(r,1),e=i.length&&p(a),!e)return ne.apply(n,i),n;break}}return R(e,l)(i,t,!D,n,me.test(e)),n}function E(){}var S,M,T,A,L,R,C,P,I,O,k,D,N,U,B,F,j="sizzle"+-new Date,z=e.document,G={},H=0,V=0,W=i(),q=i(),X=i(),Y=!1,K=function(){return 0},Z=typeof t,J=1<<31,Q=[],ee=Q.pop,te=Q.push,ne=Q.push,ie=Q.slice,re=Q.indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},ae="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",se="[\\x20\\t\\r\\n\\f]",ue="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",le=ue.replace("w","w#"),ce="\\["+se+"*("+ue+")"+se+"*(?:([*^$|!~]?=)"+se+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+le+")|)|)"+se+"*\\]",he=":("+ue+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+ce.replace(3,8)+")*)|.*)\\)|)",de=new RegExp("^"+se+"+|((?:^|[^\\\\])(?:\\\\.)*)"+se+"+$","g"),fe=new RegExp("^"+se+"*,"+se+"*"),pe=new RegExp("^"+se+"*([>+~]|"+se+")"+se+"*"),me=new RegExp(se+"*[+~]"),ge=new RegExp("="+se+"*([^\\]'\"]*)"+se+"*\\]","g"),ve=new RegExp(he),ye=new RegExp("^"+le+"$"),_e={ID:new RegExp("^#("+ue+")"),CLASS:new RegExp("^\\.("+ue+")"),TAG:new RegExp("^("+ue.replace("w","w*")+")"),ATTR:new RegExp("^"+ce),PSEUDO:new RegExp("^"+he),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+se+"*(even|odd|(([+-]|)(\\d*)n|)"+se+"*(?:([+-]|)"+se+"*(\\d+)|))"+se+"*\\)|)","i"),"boolean":new RegExp("^(?:"+ae+")$","i"),needsContext:new RegExp("^"+se+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+se+"*((?:-\\d)?\\d*)"+se+"*\\)|)(?=[^-]|$)","i")},xe=/^[^{]+\{\s*\[native \w/,be=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,we=/^(?:input|select|textarea|button)$/i,Ee=/^h\d$/i,Se=/'|\\/g,Me=/\\([\da-fA-F]{1,6}[\x20\t\r\n\f]?|.)/g,Te=function(e,t){var n="0x"+t-65536;return n!==n?t:n<0?String.fromCharCode(n+65536):String.fromCharCode(n>>10|55296,1023&n|56320)};try{ne.apply(Q=ie.call(z.childNodes),z.childNodes),Q[z.childNodes.length].nodeType}catch(Ae){ne={apply:Q.length?function(e,t){te.apply(e,ie.call(t))}:function(e,t){for(var n=e.length,i=0;e[n++]=t[i++];);e.length=n-1}}}L=o.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},I=o.setDocument=function(e){var i=e?e.ownerDocument||e:z;return i!==O&&9===i.nodeType&&i.documentElement?(O=i,k=i.documentElement,D=!L(i),G.getElementsByTagName=a(function(e){return e.appendChild(i.createComment("")),!e.getElementsByTagName("*").length}),G.attributes=a(function(e){return e.className="i",!e.getAttribute("className")}),G.getElementsByClassName=a(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),G.sortDetached=a(function(e){return 1&e.compareDocumentPosition(O.createElement("div"))}),G.getById=a(function(e){return k.appendChild(e).id=j,!i.getElementsByName||!i.getElementsByName(j).length}),G.getById?(T.find.ID=function(e,t){if(typeof t.getElementById!==Z&&D){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},T.filter.ID=function(e){var t=e.replace(Me,Te);return function(e){return e.getAttribute("id")===t}}):(T.find.ID=function(e,n){if(typeof n.getElementById!==Z&&D){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==Z&&i.getAttributeNode("id").value===e?[i]:t:[]}},T.filter.ID=function(e){var t=e.replace(Me,Te);return function(e){var n=typeof e.getAttributeNode!==Z&&e.getAttributeNode("id");return n&&n.value===t}}),T.find.TAG=G.getElementsByTagName?function(e,t){if(typeof t.getElementsByTagName!==Z)return t.getElementsByTagName(e)}:function(e,t){var n,i=[],r=0,a=t.getElementsByTagName(e);if("*"===e){for(;n=a[r++];)1===n.nodeType&&i.push(n);return i}return a},T.find.CLASS=G.getElementsByClassName&&function(e,t){if(typeof t.getElementsByClassName!==Z&&D)return t.getElementsByClassName(e)},U=[],N=[],(G.qsa=n(i.querySelectorAll))&&(a(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||N.push("\\["+se+"*(?:value|"+ae+")"),e.querySelectorAll(":checked").length||N.push(":checked")}),a(function(e){var t=O.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&N.push("[*^$]="+se+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),N.push(",.*:")})),(G.matchesSelector=n(B=k.webkitMatchesSelector||k.mozMatchesSelector||k.oMatchesSelector||k.msMatchesSelector))&&a(function(e){G.disconnectedMatch=B.call(e,"div"),B.call(e,"[s!='']:x"),U.push("!=",he)}),N=N.length&&new RegExp(N.join("|")),U=U.length&&new RegExp(U.join("|")),F=n(k.contains)||k.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!(!i||1!==i.nodeType||!(n.contains?n.contains(i):e.compareDocumentPosition&&16&e.compareDocumentPosition(i)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},K=k.compareDocumentPosition?function(e,t){if(e===t)return Y=!0,0;var n=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return n?1&n||!G.sortDetached&&t.compareDocumentPosition(e)===n?e===i||F(z,e)?-1:t===i||F(z,t)?1:P?re.call(P,e)-re.call(P,t):0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var n,r=0,a=e.parentNode,o=t.parentNode,u=[e],l=[t];if(e===t)return Y=!0,0;if(!a||!o)return e===i?-1:t===i?1:a?-1:o?1:P?re.call(P,e)-re.call(P,t):0;if(a===o)return s(e,t);for(n=e;n=n.parentNode;)u.unshift(n);for(n=t;n=n.parentNode;)l.unshift(n);for(;u[r]===l[r];)r++;return r?s(u[r],l[r]):u[r]===z?-1:l[r]===z?1:0},O):O},o.matches=function(e,t){return o(e,null,null,t)},o.matchesSelector=function(e,t){if((e.ownerDocument||e)!==O&&I(e),t=t.replace(ge,"='$1']"),G.matchesSelector&&D&&(!U||!U.test(t))&&(!N||!N.test(t)))try{var n=B.call(e,t);if(n||G.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return o(t,O,null,[e]).length>0},o.contains=function(e,t){return(e.ownerDocument||e)!==O&&I(e),F(e,t)},o.attr=function(e,n){(e.ownerDocument||e)!==O&&I(e);var i=T.attrHandle[n.toLowerCase()],r=i&&i(e,n,!D);return r===t?G.attributes||!D?e.getAttribute(n):(r=e.getAttributeNode(n))&&r.specified?r.value:null:r},o.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},o.uniqueSort=function(e){var t,n=[],i=0,r=0;if(Y=!G.detectDuplicates,P=!G.sortStable&&e.slice(0),e.sort(K),Y){for(;t=e[r++];)t===e[r]&&(i=n.push(r));for(;i--;)e.splice(n[i],1)}return e},A=o.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=A(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i];i++)n+=A(t);return n},T=o.selectors={cacheLength:50,createPseudo:r,match:_e,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Me,Te),e[3]=(e[4]||e[5]||"").replace(Me,Te),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||o.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&o.error(e[0]),e},PSEUDO:function(e){var t,n=!e[5]&&e[2];return _e.CHILD.test(e[0])?null:(e[4]?e[2]=e[4]:n&&ve.test(n)&&(t=f(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Me,Te).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=W[e+" "];return t||(t=new RegExp("(^|"+se+")"+e+"("+se+"|$)"))&&W(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==Z&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i){var r=o.attr(i,e);return null==r?"!="===t:!t||(r+="","="===t?r===n:"!="===t?r!==n:"^="===t?n&&0===r.indexOf(n):"*="===t?n&&r.indexOf(n)>-1:"$="===t?n&&r.slice(-n.length)===n:"~="===t?(" "+r+" ").indexOf(n)>-1:"|="===t&&(r===n||r.slice(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i,r){var a="nth"!==e.slice(0,3),o="last"!==e.slice(-4),s="of-type"===t;return 1===i&&0===r?function(e){return!!e.parentNode}:function(t,n,u){var l,c,h,d,f,p,m=a!==o?"nextSibling":"previousSibling",g=t.parentNode,v=s&&t.nodeName.toLowerCase(),y=!u&&!s;if(g){if(a){for(;m;){for(h=t;h=h[m];)if(s?h.nodeName.toLowerCase()===v:1===h.nodeType)return!1;p=m="only"===e&&!p&&"nextSibling"}return!0}if(p=[o?g.firstChild:g.lastChild],o&&y){for(c=g[j]||(g[j]={}),l=c[e]||[],f=l[0]===H&&l[1],d=l[0]===H&&l[2],h=f&&g.childNodes[f];h=++f&&h&&h[m]||(d=f=0)||p.pop();)if(1===h.nodeType&&++d&&h===t){c[e]=[H,f,d];break}}else if(y&&(l=(t[j]||(t[j]={}))[e])&&l[0]===H)d=l[1];else for(;(h=++f&&h&&h[m]||(d=f=0)||p.pop())&&((s?h.nodeName.toLowerCase()!==v:1!==h.nodeType)||!++d||(y&&((h[j]||(h[j]={}))[e]=[H,d]),h!==t)););return d-=r,d===i||d%i===0&&d/i>=0}}},PSEUDO:function(e,t){var n,i=T.pseudos[e]||T.setFilters[e.toLowerCase()]||o.error("unsupported pseudo: "+e);return i[j]?i(t):i.length>1?(n=[e,e,"",t],T.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,n){for(var r,a=i(e,t),o=a.length;o--;)r=re.call(e,a[o]),e[r]=!(n[r]=a[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:r(function(e){var t=[],n=[],i=R(e.replace(de,"$1"));return i[j]?r(function(e,t,n,r){for(var a,o=i(e,null,r,[]),s=e.length;s--;)(a=o[s])&&(e[s]=!(t[s]=a))}):function(e,r,a){return t[0]=e,i(t,null,a,n),!n.pop()}}),has:r(function(e){return function(t){return o(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||A(t)).indexOf(e)>-1}}),lang:r(function(e){return ye.test(e||"")||o.error("unsupported lang: "+e),e=e.replace(Me,Te).toLowerCase(),function(t){var n;do if(n=D?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===k},focus:function(e){return e===O.activeElement&&(!O.hasFocus||O.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!T.pseudos.empty(e)},header:function(e){return Ee.test(e.nodeName)},input:function(e){return we.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:d(function(){return[0]}),last:d(function(e,t){return[t-1]}),eq:d(function(e,t,n){return[n<0?n+t:n]}),even:d(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:d(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:d(function(e,t,n){for(var i=n<0?n+t:n;--i>=0;)e.push(i);return e}),gt:d(function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e})}};for(S in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})T.pseudos[S]=c(S);for(S in{submit:!0,reset:!0})T.pseudos[S]=h(S);R=o.compile=function(e,t){var n,i=[],r=[],a=X[e+" "];if(!a){for(t||(t=f(e)),n=t.length;n--;)a=_(t[n]),a[j]?i.push(a):r.push(a);a=X(e,x(r,i))}return a},T.pseudos.nth=T.pseudos.eq,E.prototype=T.filters=T.pseudos,T.setFilters=new E,G.sortStable=j.split("").sort(K).join("")===j,I(),[0,0].sort(K),G.detectDuplicates=Y,a(function(e){if(e.innerHTML="<a href='#'></a>","#"!==e.firstChild.getAttribute("href"))for(var t="type|href|height|width".split("|"),n=t.length;n--;)T.attrHandle[t[n]]=l}),a(function(e){if(null!=e.getAttribute("disabled"))for(var t=ae.split("|"),n=t.length;n--;)T.attrHandle[t[n]]=u}),oe.find=o,oe.expr=o.selectors,oe.expr[":"]=oe.expr.pseudos,oe.unique=o.uniqueSort,oe.text=o.getText,oe.isXMLDoc=o.isXML,oe.contains=o.contains}(e);var me={};oe.Callbacks=function(e){e="string"==typeof e?me[e]||i(e):oe.extend({},e);var n,r,a,o,s,u,l=[],c=!e.once&&[],h=function(t){for(n=e.memory&&t,r=!0,u=o||0,o=0,s=l.length,a=!0;l&&u<s;u++)if(l[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}a=!1,l&&(c?c.length&&h(c.shift()):n?l=[]:d.disable())},d={add:function(){if(l){var t=l.length;!function i(t){oe.each(t,function(t,n){var r=oe.type(n);"function"===r?e.unique&&d.has(n)||l.push(n):n&&n.length&&"string"!==r&&i(n)})}(arguments),a?s=l.length:n&&(o=t,h(n))}return this},remove:function(){return l&&oe.each(arguments,function(e,t){for(var n;(n=oe.inArray(t,l,n))>-1;)l.splice(n,1),a&&(n<=s&&s--,n<=u&&u--)}),this},has:function(e){return e?oe.inArray(e,l)>-1:!(!l||!l.length)},empty:function(){return l=[],s=0,this},disable:function(){return l=c=n=t,this},disabled:function(){return!l},lock:function(){return c=t,n||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],!l||r&&!c||(a?c.push(t):h(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d},oe.extend({Deferred:function(e){var t=[["resolve","done",oe.Callbacks("once memory"),"resolved"],["reject","fail",oe.Callbacks("once memory"),"rejected"],["notify","progress",oe.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return oe.Deferred(function(n){oe.each(t,function(t,a){var o=a[0],s=oe.isFunction(e[t])&&e[t];r[a[1]](function(){var e=s&&s.apply(this,arguments);e&&oe.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===i?n.promise():this,s?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?oe.extend(e,i):i}},r={};return i.pipe=i.then,oe.each(t,function(e,a){var o=a[2],s=a[3];i[a[1]]=o.add,s&&o.add(function(){n=s},t[1^e][2].disable,t[2][2].lock),r[a[0]]=function(){return r[a[0]+"With"](this===r?i:this,arguments),this},r[a[0]+"With"]=o.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,a=te.call(arguments),o=a.length,s=1!==o||e&&oe.isFunction(e.promise)?o:0,u=1===s?e:oe.Deferred(),l=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?te.call(arguments):r,i===t?u.notifyWith(n,i):--s||u.resolveWith(n,i)}};if(o>1)for(t=new Array(o),n=new Array(o),i=new Array(o);r<o;r++)a[r]&&oe.isFunction(a[r].promise)?a[r].promise().done(l(r,i,a)).fail(u.reject).progress(l(r,n,t)):--s;return s||u.resolveWith(i,a),u.promise()}}),oe.support=function(t){var n=W.createElement("input"),i=W.createDocumentFragment(),r=W.createElement("div"),a=W.createElement("select"),o=a.appendChild(W.createElement("option"));return n.type?(n.type="checkbox",t.checkOn=""!==n.value,t.optSelected=o.selected,t.reliableMarginRight=!0,t.boxSizingReliable=!0,t.pixelPosition=!1,n.checked=!0,t.noCloneChecked=n.cloneNode(!0).checked,a.disabled=!0,t.optDisabled=!o.disabled,n=W.createElement("input"),n.value="t",n.type="radio",t.radioValue="t"===n.value,n.setAttribute("checked","t"),n.setAttribute("name","t"),i.appendChild(n),t.checkClone=i.cloneNode(!0).cloneNode(!0).lastChild.checked,t.focusinBubbles="onfocusin"in e,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===r.style.backgroundClip,oe(function(){var n,i,a="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",o=W.getElementsByTagName("body")[0];o&&(n=W.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",o.appendChild(n).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",oe.swap(o,null!=o.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===r.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(r,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(r,null)||{width:"4px"}).width,i=r.appendChild(W.createElement("div")),i.style.cssText=r.style.cssText=a,i.style.marginRight=i.style.width="0",r.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(i,null)||{}).marginRight)),o.removeChild(n))}),t):t}({});var ge,ve,ye=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,_e=/([A-Z])/g;r.uid=1,r.accepts=function(e){return!e.nodeType||(1===e.nodeType||9===e.nodeType)},r.prototype={key:function(e){if(!r.accepts(e))return 0;var t={},n=e[this.expando];if(!n){n=r.uid++;try{t[this.expando]={value:n},Object.defineProperties(e,t)}catch(i){t[this.expando]=n,oe.extend(e,t)}}return this.cache[n]||(this.cache[n]={}),n},set:function(e,t,n){var i,r=this.key(e),a=this.cache[r];if("string"==typeof t)a[t]=n;else if(oe.isEmptyObject(a))this.cache[r]=t;else for(i in t)a[i]=t[i]},get:function(e,n){var i=this.cache[this.key(e)];return n===t?i:i[n]},access:function(e,n,i){return n===t||n&&"string"==typeof n&&i===t?this.get(e,n):(this.set(e,n,i),i!==t?i:n)},remove:function(e,n){var i,r,a=this.key(e),o=this.cache[a];if(n===t)this.cache[a]={};else{oe.isArray(n)?r=n.concat(n.map(oe.camelCase)):n in o?r=[n]:(r=oe.camelCase(n),r=r in o?[r]:r.match(ue)||[]),i=r.length;for(;i--;)delete o[r[i]]}},hasData:function(e){return!oe.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){delete this.cache[this.key(e)]}},ge=new r,ve=new r,oe.extend({acceptData:r.accepts,hasData:function(e){return ge.hasData(e)||ve.hasData(e)},data:function(e,t,n){return ge.access(e,t,n)},removeData:function(e,t){ge.remove(e,t)},_data:function(e,t,n){return ve.access(e,t,n)},_removeData:function(e,t){ve.remove(e,t)}}),oe.fn.extend({data:function(e,n){var i,r,o=this[0],s=0,u=null;if(e===t){if(this.length&&(u=ge.get(o),1===o.nodeType&&!ve.get(o,"hasDataAttrs"))){for(i=o.attributes;s<i.length;s++)r=i[s].name,0===r.indexOf("data-")&&(r=oe.camelCase(r.substring(5)),a(o,r,u[r]));ve.set(o,"hasDataAttrs",!0)}return u}return"object"==typeof e?this.each(function(){ge.set(this,e)}):oe.access(this,function(n){var i,r=oe.camelCase(e);if(o&&n===t){if(i=ge.get(o,e),i!==t)return i;if(i=ge.get(o,r),i!==t)return i;if(i=a(o,r,t),i!==t)return i}else this.each(function(){var i=ge.get(this,r);ge.set(this,r,n),e.indexOf("-")!==-1&&i!==t&&ge.set(this,e,n)})},null,n,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){ge.remove(this,e)})}}),oe.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=ve.get(e,t),n&&(!i||oe.isArray(n)?i=ve.access(e,t,oe.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=oe.queue(e,t),i=n.length,r=n.shift(),a=oe._queueHooks(e,t),o=function(){oe.dequeue(e,t)};"inprogress"===r&&(r=n.shift(),i--),a.cur=r,r&&("fx"===t&&n.unshift("inprogress"),delete a.stop,r.call(e,o,a)),!i&&a&&a.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return ve.get(e,n)||ve.access(e,n,{empty:oe.Callbacks("once memory").add(function(){ve.remove(e,[t+"queue",n])})})}}),oe.fn.extend({queue:function(e,n){var i=2;return"string"!=typeof e&&(n=e,e="fx",i--),arguments.length<i?oe.queue(this[0],e):n===t?this:this.each(function(){var t=oe.queue(this,e,n);oe._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&oe.dequeue(this,e)})},dequeue:function(e){return this.each(function(){oe.dequeue(this,e)})},delay:function(e,t){return e=oe.fx?oe.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var i,r=1,a=oe.Deferred(),o=this,s=this.length,u=function(){--r||a.resolveWith(o,[o])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";s--;)i=ve.get(o[s],e+"queueHooks"),i&&i.empty&&(r++,i.empty.add(u));return u(),a.promise(n)}});var xe,be,we=/[\t\r\n]/g,Ee=/\r/g,Se=/^(?:input|select|textarea|button)$/i;oe.fn.extend({attr:function(e,t){return oe.access(this,oe.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){oe.removeAttr(this,e)})},prop:function(e,t){return oe.access(this,oe.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[oe.propFix[e]||e]})},addClass:function(e){var t,n,i,r,a,o=0,s=this.length,u="string"==typeof e&&e;if(oe.isFunction(e))return this.each(function(t){oe(this).addClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(ue)||[];o<s;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(we," "):" ")){for(a=0;r=t[a++];)i.indexOf(" "+r+" ")<0&&(i+=r+" ");n.className=oe.trim(i)}return this},removeClass:function(e){var t,n,i,r,a,o=0,s=this.length,u=0===arguments.length||"string"==typeof e&&e;if(oe.isFunction(e))return this.each(function(t){oe(this).removeClass(e.call(this,t,this.className))});if(u)for(t=(e||"").match(ue)||[];o<s;o++)if(n=this[o],i=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(we," "):"")){for(a=0;r=t[a++];)for(;i.indexOf(" "+r+" ")>=0;)i=i.replace(" "+r+" "," ");n.className=e?oe.trim(i):""}return this},toggleClass:function(e,t){var n=typeof e,i="boolean"==typeof t;return oe.isFunction(e)?this.each(function(n){oe(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var r,a=0,o=oe(this),s=t,u=e.match(ue)||[];r=u[a++];)s=i?s:!o.hasClass(r),o[s?"addClass":"removeClass"](r);else n!==H&&"boolean"!==n||(this.className&&ve.set(this,"__className__",this.className),this.className=this.className||e===!1?"":ve.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;n<i;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(we," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,i,r,a=this[0];{if(arguments.length)return r=oe.isFunction(e),this.each(function(i){var a,o=oe(this);1===this.nodeType&&(a=r?e.call(this,i,o.val()):e,null==a?a="":"number"==typeof a?a+="":oe.isArray(a)&&(a=oe.map(a,function(e){return null==e?"":e+""})),n=oe.valHooks[this.type]||oe.valHooks[this.nodeName.toLowerCase()],n&&"set"in n&&n.set(this,a,"value")!==t||(this.value=a))});if(a)return n=oe.valHooks[a.type]||oe.valHooks[a.nodeName.toLowerCase()],n&&"get"in n&&(i=n.get(a,"value"))!==t?i:(i=a.value,"string"==typeof i?i.replace(Ee,""):null==i?"":i)}}}),oe.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,a="select-one"===e.type||r<0,o=a?null:[],s=a?r+1:i.length,u=r<0?s:a?r:0;u<s;u++)if(n=i[u],(n.selected||u===r)&&(oe.support.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!oe.nodeName(n.parentNode,"optgroup"))){if(t=oe(n).val(),a)return t;o.push(t)}return o},set:function(e,t){for(var n,i,r=e.options,a=oe.makeArray(t),o=r.length;o--;)i=r[o],(i.selected=oe.inArray(oe(i).val(),a)>=0)&&(n=!0);return n||(e.selectedIndex=-1),a}}},attr:function(e,n,i){var r,a,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return typeof e.getAttribute===H?oe.prop(e,n,i):(1===o&&oe.isXMLDoc(e)||(n=n.toLowerCase(),r=oe.attrHooks[n]||(oe.expr.match["boolean"].test(n)?be:xe)),i===t?r&&"get"in r&&null!==(a=r.get(e,n))?a:(a=oe.find.attr(e,n),null==a?t:a):null!==i?r&&"set"in r&&(a=r.set(e,i,n))!==t?a:(e.setAttribute(n,i+""),i):void oe.removeAttr(e,n))},removeAttr:function(e,t){var n,i,r=0,a=t&&t.match(ue);if(a&&1===e.nodeType)for(;n=a[r++];)i=oe.propFix[n]||n,oe.expr.match["boolean"].test(n)&&(e[i]=!1),e.removeAttribute(n)},
attrHooks:{type:{set:function(e,t){if(!oe.support.radioValue&&"radio"===t&&oe.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,i){var r,a,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return o=1!==s||!oe.isXMLDoc(e),o&&(n=oe.propFix[n]||n,a=oe.propHooks[n]),i!==t?a&&"set"in a&&(r=a.set(e,i,n))!==t?r:e[n]=i:a&&"get"in a&&null!==(r=a.get(e,n))?r:e[n]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||Se.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),be={set:function(e,t,n){return t===!1?oe.removeAttr(e,n):e.setAttribute(n,n),n}},oe.each(oe.expr.match["boolean"].source.match(/\w+/g),function(e,n){var i=oe.expr.attrHandle[n]||oe.find.attr;oe.expr.attrHandle[n]=function(e,n,r){var a=oe.expr.attrHandle[n],o=r?t:(oe.expr.attrHandle[n]=t)!=i(e,n,r)?n.toLowerCase():null;return oe.expr.attrHandle[n]=a,o}}),oe.support.optSelected||(oe.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),oe.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){oe.propFix[this.toLowerCase()]=this}),oe.each(["radio","checkbox"],function(){oe.valHooks[this]={set:function(e,t){if(oe.isArray(t))return e.checked=oe.inArray(oe(e).val(),t)>=0}},oe.support.checkOn||(oe.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Me=/^key/,Te=/^(?:mouse|contextmenu)|click/,Ae=/^(?:focusinfocus|focusoutblur)$/,Le=/^([^.]*)(?:\.(.+)|)$/;oe.event={global:{},add:function(e,n,i,r,a){var o,s,u,l,c,h,d,f,p,m,g,v=ve.get(e);if(v){for(i.handler&&(o=i,i=o.handler,a=o.selector),i.guid||(i.guid=oe.guid++),(l=v.events)||(l=v.events={}),(s=v.handle)||(s=v.handle=function(e){return typeof oe===H||e&&oe.event.triggered===e.type?t:oe.event.dispatch.apply(s.elem,arguments)},s.elem=e),n=(n||"").match(ue)||[""],c=n.length;c--;)u=Le.exec(n[c])||[],p=g=u[1],m=(u[2]||"").split(".").sort(),p&&(d=oe.event.special[p]||{},p=(a?d.delegateType:d.bindType)||p,d=oe.event.special[p]||{},h=oe.extend({type:p,origType:g,data:r,handler:i,guid:i.guid,selector:a,needsContext:a&&oe.expr.match.needsContext.test(a),namespace:m.join(".")},o),(f=l[p])||(f=l[p]=[],f.delegateCount=0,d.setup&&d.setup.call(e,r,m,s)!==!1||e.addEventListener&&e.addEventListener(p,s,!1)),d.add&&(d.add.call(e,h),h.handler.guid||(h.handler.guid=i.guid)),a?f.splice(f.delegateCount++,0,h):f.push(h),oe.event.global[p]=!0);e=null}},remove:function(e,t,n,i,r){var a,o,s,u,l,c,h,d,f,p,m,g=ve.hasData(e)&&ve.get(e);if(g&&(u=g.events)){for(t=(t||"").match(ue)||[""],l=t.length;l--;)if(s=Le.exec(t[l])||[],f=m=s[1],p=(s[2]||"").split(".").sort(),f){for(h=oe.event.special[f]||{},f=(i?h.delegateType:h.bindType)||f,d=u[f]||[],s=s[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=a=d.length;a--;)c=d[a],!r&&m!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||i&&i!==c.selector&&("**"!==i||!c.selector)||(d.splice(a,1),c.selector&&d.delegateCount--,h.remove&&h.remove.call(e,c));o&&!d.length&&(h.teardown&&h.teardown.call(e,p,g.handle)!==!1||oe.removeEvent(e,f,g.handle),delete u[f])}else for(f in u)oe.event.remove(e,f+t[l],n,i,!0);oe.isEmptyObject(u)&&(delete g.handle,ve.remove(e,"events"))}},trigger:function(n,i,r,a){var o,s,u,l,c,h,d,f=[r||W],p=re.call(n,"type")?n.type:n,m=re.call(n,"namespace")?n.namespace.split("."):[];if(s=u=r=r||W,3!==r.nodeType&&8!==r.nodeType&&!Ae.test(p+oe.event.triggered)&&(p.indexOf(".")>=0&&(m=p.split("."),p=m.shift(),m.sort()),c=p.indexOf(":")<0&&"on"+p,n=n[oe.expando]?n:new oe.Event(p,"object"==typeof n&&n),n.isTrigger=a?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=r),i=null==i?[n]:oe.makeArray(i,[n]),d=oe.event.special[p]||{},a||!d.trigger||d.trigger.apply(r,i)!==!1)){if(!a&&!d.noBubble&&!oe.isWindow(r)){for(l=d.delegateType||p,Ae.test(l+p)||(s=s.parentNode);s;s=s.parentNode)f.push(s),u=s;u===(r.ownerDocument||W)&&f.push(u.defaultView||u.parentWindow||e)}for(o=0;(s=f[o++])&&!n.isPropagationStopped();)n.type=o>1?l:d.bindType||p,h=(ve.get(s,"events")||{})[n.type]&&ve.get(s,"handle"),h&&h.apply(s,i),h=c&&s[c],h&&oe.acceptData(s)&&h.apply&&h.apply(s,i)===!1&&n.preventDefault();return n.type=p,a||n.isDefaultPrevented()||d._default&&d._default.apply(f.pop(),i)!==!1||!oe.acceptData(r)||c&&oe.isFunction(r[p])&&!oe.isWindow(r)&&(u=r[c],u&&(r[c]=null),oe.event.triggered=p,r[p](),oe.event.triggered=t,u&&(r[c]=u)),n.result}},dispatch:function(e){e=oe.event.fix(e);var n,i,r,a,o,s=[],u=te.call(arguments),l=(ve.get(this,"events")||{})[e.type]||[],c=oe.event.special[e.type]||{};if(u[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(s=oe.event.handlers.call(this,e,l),n=0;(a=s[n++])&&!e.isPropagationStopped();)for(e.currentTarget=a.elem,i=0;(o=a.handlers[i++])&&!e.isImmediatePropagationStopped();)e.namespace_re&&!e.namespace_re.test(o.namespace)||(e.handleObj=o,e.data=o.data,r=((oe.event.special[o.origType]||{}).handle||o.handler).apply(a.elem,u),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,n){var i,r,a,o,s=[],u=n.delegateCount,l=e.target;if(u&&l.nodeType&&(!e.button||"click"!==e.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==e.type){for(r=[],i=0;i<u;i++)o=n[i],a=o.selector+" ",r[a]===t&&(r[a]=o.needsContext?oe(a,this).index(l)>=0:oe.find(a,this,null,[l]).length),r[a]&&r.push(o);r.length&&s.push({elem:l,handlers:r})}return u<n.length&&s.push({elem:this,handlers:n.slice(u)}),s},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var i,r,a,o=n.button;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||W,r=i.documentElement,a=i.body,e.pageX=n.clientX+(r&&r.scrollLeft||a&&a.scrollLeft||0)-(r&&r.clientLeft||a&&a.clientLeft||0),e.pageY=n.clientY+(r&&r.scrollTop||a&&a.scrollTop||0)-(r&&r.clientTop||a&&a.clientTop||0)),e.which||o===t||(e.which=1&o?1:2&o?3:4&o?2:0),e}},fix:function(e){if(e[oe.expando])return e;var t,n,i,r=e.type,a=e,o=this.fixHooks[r];for(o||(this.fixHooks[r]=o=Te.test(r)?this.mouseHooks:Me.test(r)?this.keyHooks:{}),i=o.props?this.props.concat(o.props):this.props,e=new oe.Event(a),t=i.length;t--;)n=i[t],e[n]=a[n];return 3===e.target.nodeType&&(e.target=e.target.parentNode),o.filter?o.filter(e,a):e},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==u()&&this.focus)return this.focus(),!1},delegateType:"focusin"},blur:{trigger:function(){if(this===u()&&this.blur)return this.blur(),!1},delegateType:"focusout"},click:{trigger:function(){if("checkbox"===this.type&&this.click&&oe.nodeName(this,"input"))return this.click(),!1},_default:function(e){return oe.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,i){var r=oe.extend(new oe.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?oe.event.trigger(r,null,t):oe.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},oe.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)},oe.Event=function(e,t){return this instanceof oe.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?o:s):this.type=e,t&&oe.extend(this,t),this.timeStamp=e&&e.timeStamp||oe.now(),void(this[oe.expando]=!0)):new oe.Event(e,t)},oe.Event.prototype={isDefaultPrevented:s,isPropagationStopped:s,isImmediatePropagationStopped:s,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=o,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=o,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=o,this.stopPropagation()}},oe.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){oe.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=this,r=e.relatedTarget,a=e.handleObj;return r&&(r===i||oe.contains(i,r))||(e.type=a.origType,n=a.handler.apply(this,arguments),e.type=t),n}}}),oe.support.focusinBubbles||oe.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,i=function(e){oe.event.simulate(t,e.target,oe.event.fix(e),!0)};oe.event.special[t]={setup:function(){0===n++&&W.addEventListener(e,i,!0)},teardown:function(){0===--n&&W.removeEventListener(e,i,!0)}}}),oe.fn.extend({on:function(e,n,i,r,a){var o,u;if("object"==typeof e){"string"!=typeof n&&(i=i||n,n=t);for(u in e)this.on(u,n,i,e[u],a);return this}if(null==i&&null==r?(r=n,i=n=t):null==r&&("string"==typeof n?(r=i,i=t):(r=i,i=n,n=t)),r===!1)r=s;else if(!r)return this;return 1===a&&(o=r,r=function(e){return oe().off(e),o.apply(this,arguments)},r.guid=o.guid||(o.guid=oe.guid++)),this.each(function(){oe.event.add(this,e,r,i,n)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,n,i){var r,a;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,oe(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(a in e)this.off(a,n,e[a]);return this}return n!==!1&&"function"!=typeof n||(i=n,n=t),i===!1&&(i=s),this.each(function(){oe.event.remove(this,e,i,n)})},trigger:function(e,t){return this.each(function(){oe.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return oe.event.trigger(e,t,n,!0)}});var Re=/^.[^:#\[\.,]*$/,Ce=oe.expr.match.needsContext,Pe={children:!0,contents:!0,next:!0,prev:!0};oe.fn.extend({find:function(e){var t,n,i,r=this.length;if("string"!=typeof e)return t=this,this.pushStack(oe(e).filter(function(){for(i=0;i<r;i++)if(oe.contains(t[i],this))return!0}));for(n=[],i=0;i<r;i++)oe.find(e,this[i],n);return n=this.pushStack(r>1?oe.unique(n):n),n.selector=(this.selector?this.selector+" ":"")+e,n},has:function(e){var t=oe(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(oe.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(c(this,e||[],!0))},filter:function(e){return this.pushStack(c(this,e||[],!1))},is:function(e){return!!e&&("string"==typeof e?Ce.test(e)?oe(e,this.context).index(this[0])>=0:oe.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,i=0,r=this.length,a=[],o=Ce.test(e)||"string"!=typeof e?oe(e,t||this.context):0;i<r;i++)for(n=this[i];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(o?o.index(n)>-1:1===n.nodeType&&oe.find.matchesSelector(n,e))){n=a.push(n);break}return this.pushStack(a.length>1?oe.unique(a):a)},index:function(e){return e?"string"==typeof e?ne.call(oe(e),this[0]):ne.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?oe(e,t):oe.makeArray(e&&e.nodeType?[e]:e),i=oe.merge(this.get(),n);return this.pushStack(oe.unique(i))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),oe.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return oe.dir(e,"parentNode")},parentsUntil:function(e,t,n){return oe.dir(e,"parentNode",n)},next:function(e){return l(e,"nextSibling")},prev:function(e){return l(e,"previousSibling")},nextAll:function(e){return oe.dir(e,"nextSibling")},prevAll:function(e){return oe.dir(e,"previousSibling")},nextUntil:function(e,t,n){return oe.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return oe.dir(e,"previousSibling",n)},siblings:function(e){return oe.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return oe.sibling(e.firstChild)},contents:function(e){return oe.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:oe.merge([],e.childNodes)}},function(e,t){oe.fn[e]=function(n,i){var r=oe.map(this,t,n);return"Until"!==e.slice(-5)&&(i=n),i&&"string"==typeof i&&(r=oe.filter(i,r)),this.length>1&&(Pe[e]||oe.unique(r),"p"===e[0]&&r.reverse()),this.pushStack(r)}}),oe.extend({filter:function(e,t,n){var i=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===i.nodeType?oe.find.matchesSelector(i,e)?[i]:[]:oe.find.matches(e,oe.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,i){for(var r=[],a=i!==t;(e=e[n])&&9!==e.nodeType;)if(1===e.nodeType){if(a&&oe(e).is(i))break;r.push(e)}return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var Ie=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Oe=/<([\w:]+)/,ke=/<|&#?\w+;/,De=/<(?:script|style|link)/i,Ne=/^(?:checkbox|radio)$/i,Ue=/checked\s*(?:[^=]|=\s*.checked.)/i,Be=/^$|\/(?:java|ecma)script/i,Fe=/^true\/(.*)/,je=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,ze={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};ze.optgroup=ze.option,ze.tbody=ze.tfoot=ze.colgroup=ze.caption=ze.col=ze.thead,ze.th=ze.td,oe.fn.extend({text:function(e){return oe.access(this,function(e){return e===t?oe.text(this):this.empty().append((this[0]&&this[0].ownerDocument||W).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=h(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var n,i=e?oe.filter(e,this):this,r=0;null!=(n=i[r]);r++)t||1!==n.nodeType||oe.cleanData(g(n)),n.parentNode&&(t&&oe.contains(n.ownerDocument,n)&&p(g(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(oe.cleanData(g(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return oe.clone(this,e,t)})},html:function(e){return oe.access(this,function(e){var n=this[0]||{},i=0,r=this.length;if(e===t&&1===n.nodeType)return n.innerHTML;if("string"==typeof e&&!De.test(e)&&!ze[(Oe.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Ie,"<$1></$2>");try{for(;i<r;i++)n=this[i]||{},1===n.nodeType&&(oe.cleanData(g(n,!1)),n.innerHTML=e);n=0}catch(a){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=oe.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var i=e[t++],r=e[t++];r&&(oe(this).remove(),r.insertBefore(n,i))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=Q.apply([],e);var i,r,a,o,s,u,l=0,c=this.length,h=this,p=c-1,m=e[0],v=oe.isFunction(m);if(v||!(c<=1||"string"!=typeof m||oe.support.checkClone)&&Ue.test(m))return this.each(function(i){var r=h.eq(i);v&&(e[0]=m.call(this,i,r.html())),r.domManip(e,t,n)});if(c&&(i=oe.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=i.firstChild,1===i.childNodes.length&&(i=r),r)){for(a=oe.map(g(i,"script"),d),o=a.length;l<c;l++)s=i,l!==p&&(s=oe.clone(s,!0,!0),o&&oe.merge(a,g(s,"script"))),t.call(this[l],s,l);if(o)for(u=a[a.length-1].ownerDocument,oe.map(a,f),l=0;l<o;l++)s=a[l],Be.test(s.type||"")&&!ve.access(s,"globalEval")&&oe.contains(u,s)&&(s.src?oe._evalUrl(s.src):oe.globalEval(s.textContent.replace(je,"")))}return this}}),oe.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){oe.fn[e]=function(e){for(var n,i=[],r=oe(e),a=r.length-1,o=0;o<=a;o++)n=o===a?this:this.clone(!0),oe(r[o])[t](n),ee.apply(i,n.get());return this.pushStack(i)}}),oe.extend({clone:function(e,t,n){var i,r,a,o,s=e.cloneNode(!0),u=oe.contains(e.ownerDocument,e);if(!(oe.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||oe.isXMLDoc(e)))for(o=g(s),a=g(e),i=0,r=a.length;i<r;i++)v(a[i],o[i]);if(t)if(n)for(a=a||g(e),o=o||g(s),i=0,r=a.length;i<r;i++)m(a[i],o[i]);else m(e,s);return o=g(s,"script"),o.length>0&&p(o,!u&&g(e,"script")),s},buildFragment:function(e,t,n,i){for(var r,a,o,s,u,l,c=0,h=e.length,d=t.createDocumentFragment(),f=[];c<h;c++)if(r=e[c],r||0===r)if("object"===oe.type(r))oe.merge(f,r.nodeType?[r]:r);else if(ke.test(r)){for(a=a||d.appendChild(t.createElement("div")),o=(Oe.exec(r)||["",""])[1].toLowerCase(),s=ze[o]||ze._default,a.innerHTML=s[1]+r.replace(Ie,"<$1></$2>")+s[2],l=s[0];l--;)a=a.firstChild;oe.merge(f,a.childNodes),a=d.firstChild,a.textContent=""}else f.push(t.createTextNode(r));for(d.textContent="",c=0;r=f[c++];)if((!i||oe.inArray(r,i)===-1)&&(u=oe.contains(r.ownerDocument,r),a=g(d.appendChild(r),"script"),u&&p(a),n))for(l=0;r=a[l++];)Be.test(r.type||"")&&n.push(r);return d},cleanData:function(e){for(var t,n,i,r=e.length,a=0,o=oe.event.special;a<r;a++){if(n=e[a],oe.acceptData(n)&&(t=ve.access(n)))for(i in t.events)o[i]?oe.event.remove(n,i):oe.removeEvent(n,i,t.handle);ge.discard(n),ve.discard(n)}},_evalUrl:function(e){return oe.ajax({url:e,type:"GET",dataType:"text",async:!1,global:!1,success:oe.globalEval})}}),oe.fn.extend({wrapAll:function(e){var t;return oe.isFunction(e)?this.each(function(t){oe(this).wrapAll(e.call(this,t))}):(this[0]&&(t=oe(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return oe.isFunction(e)?this.each(function(t){oe(this).wrapInner(e.call(this,t))}):this.each(function(){var t=oe(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=oe.isFunction(e);return this.each(function(n){oe(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){oe.nodeName(this,"body")||oe(this).replaceWith(this.childNodes)}).end()}});var Ge,He,Ve=/^(none|table(?!-c[ea]).+)/,We=/^margin/,qe=new RegExp("^("+se+")(.*)$","i"),Xe=new RegExp("^("+se+")(?!px)[a-z%]+$","i"),Ye=new RegExp("^([+-])=("+se+")","i"),Ke={BODY:"block"},Ze={position:"absolute",visibility:"hidden",display:"block"},Je={letterSpacing:0,fontWeight:400},Qe=["Top","Right","Bottom","Left"],$e=["Webkit","O","Moz","ms"];oe.fn.extend({css:function(e,n){return oe.access(this,function(e,n,i){var r,a,o={},s=0;if(oe.isArray(n)){for(r=x(e),a=n.length;s<a;s++)o[n[s]]=oe.css(e,n[s],!1,r);return o}return i!==t?oe.style(e,n,i):oe.css(e,n)},e,n,arguments.length>1)},show:function(){return b(this,!0)},hide:function(){return b(this)},toggle:function(e){var t="boolean"==typeof e;return this.each(function(){(t?e:_(this))?oe(this).show():oe(this).hide()})}}),oe.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Ge(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,n,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var a,o,s,u=oe.camelCase(n),l=e.style;return n=oe.cssProps[u]||(oe.cssProps[u]=y(l,u)),s=oe.cssHooks[n]||oe.cssHooks[u],i===t?s&&"get"in s&&(a=s.get(e,!1,r))!==t?a:l[n]:(o=typeof i,"string"===o&&(a=Ye.exec(i))&&(i=(a[1]+1)*a[2]+parseFloat(oe.css(e,n)),o="number"),null==i||"number"===o&&isNaN(i)||("number"!==o||oe.cssNumber[u]||(i+="px"),oe.support.clearCloneStyle||""!==i||0!==n.indexOf("background")||(l[n]="inherit"),s&&"set"in s&&(i=s.set(e,i,r))===t||(l[n]=i)),void 0)}},css:function(e,n,i,r){var a,o,s,u=oe.camelCase(n);return n=oe.cssProps[u]||(oe.cssProps[u]=y(e.style,u)),s=oe.cssHooks[n]||oe.cssHooks[u],s&&"get"in s&&(a=s.get(e,!0,i)),a===t&&(a=Ge(e,n,r)),"normal"===a&&n in Je&&(a=Je[n]),""===i||i?(o=parseFloat(a),i===!0||oe.isNumeric(o)?o||0:a):a}}),Ge=function(e,n,i){var r,a,o,s=i||x(e),u=s?s.getPropertyValue(n)||s[n]:t,l=e.style;return s&&(""!==u||oe.contains(e.ownerDocument,e)||(u=oe.style(e,n)),Xe.test(u)&&We.test(n)&&(r=l.width,a=l.minWidth,o=l.maxWidth,l.minWidth=l.maxWidth=l.width=u,u=s.width,l.width=r,l.minWidth=a,l.maxWidth=o)),u},oe.each(["height","width"],function(e,t){oe.cssHooks[t]={get:function(e,n,i){if(n)return 0===e.offsetWidth&&Ve.test(oe.css(e,"display"))?oe.swap(e,Ze,function(){return S(e,t,i)}):S(e,t,i)},set:function(e,n,i){var r=i&&x(e);return w(e,n,i?E(e,t,i,oe.support.boxSizing&&"border-box"===oe.css(e,"boxSizing",!1,r),r):0)}}}),oe(function(){oe.support.reliableMarginRight||(oe.cssHooks.marginRight={get:function(e,t){if(t)return oe.swap(e,{display:"inline-block"},Ge,[e,"marginRight"])}}),!oe.support.pixelPosition&&oe.fn.position&&oe.each(["top","left"],function(e,t){oe.cssHooks[t]={get:function(e,n){if(n)return n=Ge(e,t),Xe.test(n)?oe(e).position()[t]+"px":n}}})}),oe.expr&&oe.expr.filters&&(oe.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},oe.expr.filters.visible=function(e){return!oe.expr.filters.hidden(e)}),oe.each({margin:"",padding:"",border:"Width"},function(e,t){oe.cssHooks[e+t]={expand:function(n){for(var i=0,r={},a="string"==typeof n?n.split(" "):[n];i<4;i++)r[e+Qe[i]+t]=a[i]||a[i-2]||a[0];return r}},We.test(e)||(oe.cssHooks[e+t].set=w)});var et=/%20/g,tt=/\[\]$/,nt=/\r?\n/g,it=/^(?:submit|button|image|reset|file)$/i,rt=/^(?:input|select|textarea|keygen)/i;oe.fn.extend({serialize:function(){return oe.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=oe.prop(this,"elements");return e?oe.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!oe(this).is(":disabled")&&rt.test(this.nodeName)&&!it.test(e)&&(this.checked||!Ne.test(e))}).map(function(e,t){var n=oe(this).val();return null==n?null:oe.isArray(n)?oe.map(n,function(e){return{name:t.name,value:e.replace(nt,"\r\n")}}):{name:t.name,value:n.replace(nt,"\r\n")}}).get()}}),oe.param=function(e,n){var i,r=[],a=function(e,t){t=oe.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=oe.ajaxSettings&&oe.ajaxSettings.traditional),oe.isArray(e)||e.jquery&&!oe.isPlainObject(e))oe.each(e,function(){a(this.name,this.value)});else for(i in e)A(i,e[i],n,a);return r.join("&").replace(et,"+")},oe.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){oe.fn[t]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),oe.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var at,ot,st=oe.now(),ut=/\?/,lt=/#.*$/,ct=/([?&])_=[^&]*/,ht=/^(.*?):[ \t]*([^\r\n]*)$/gm,dt=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,ft=/^(?:GET|HEAD)$/,pt=/^\/\//,mt=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,gt=oe.fn.load,vt={},yt={},_t="*/".concat("*");try{ot=V.href}catch(xt){ot=W.createElement("a"),ot.href="",ot=ot.href}at=mt.exec(ot.toLowerCase())||[],oe.fn.load=function(e,n,i){if("string"!=typeof e&&gt)return gt.apply(this,arguments);var r,a,o,s=this,u=e.indexOf(" ");return u>=0&&(r=e.slice(u),e=e.slice(0,u)),oe.isFunction(n)?(i=n,n=t):n&&"object"==typeof n&&(a="POST"),s.length>0&&oe.ajax({url:e,type:a,dataType:"html",data:n}).done(function(e){o=arguments,s.html(r?oe("<div>").append(oe.parseHTML(e)).find(r):e)}).complete(i&&function(e,t){s.each(i,o||[e.responseText,t,e])}),this},oe.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){oe.fn[t]=function(e){return this.on(t,e)}}),oe.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ot,type:"GET",isLocal:dt.test(at[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":oe.parseJSON,"text xml":oe.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?C(C(e,oe.ajaxSettings),t):C(oe.ajaxSettings,e)},ajaxPrefilter:L(vt),ajaxTransport:L(yt),ajax:function(e,n){function i(e,n,i,s){var l,h,y,_,b,E=n;2!==x&&(x=2,u&&clearTimeout(u),r=t,o=s||"",w.readyState=e>0?4:0,l=e>=200&&e<300||304===e,i&&(_=P(d,w,i)),_=I(d,_,w,l),l?(d.ifModified&&(b=w.getResponseHeader("Last-Modified"),b&&(oe.lastModified[a]=b),b=w.getResponseHeader("etag"),b&&(oe.etag[a]=b)),204===e?E="nocontent":304===e?E="notmodified":(E=_.state,h=_.data,y=_.error,l=!y)):(y=E,!e&&E||(E="error",e<0&&(e=0))),w.status=e,w.statusText=(n||E)+"",l?m.resolveWith(f,[h,E,w]):m.rejectWith(f,[w,E,y]),w.statusCode(v),v=t,c&&p.trigger(l?"ajaxSuccess":"ajaxError",[w,d,l?h:y]),g.fireWith(f,[w,E]),c&&(p.trigger("ajaxComplete",[w,d]),--oe.active||oe.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,a,o,s,u,l,c,h,d=oe.ajaxSetup({},n),f=d.context||d,p=d.context&&(f.nodeType||f.jquery)?oe(f):oe.event,m=oe.Deferred(),g=oe.Callbacks("once memory"),v=d.statusCode||{},y={},_={},x=0,b="canceled",w={readyState:0,getResponseHeader:function(e){var t;if(2===x){if(!s)for(s={};t=ht.exec(o);)s[t[1].toLowerCase()]=t[2];t=s[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===x?o:null},setRequestHeader:function(e,t){var n=e.toLowerCase();return x||(e=_[n]=_[n]||e,y[e]=t),this},overrideMimeType:function(e){return x||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(x<2)for(t in e)v[t]=[v[t],e[t]];else w.always(e[w.status]);return this},abort:function(e){var t=e||b;return r&&r.abort(t),i(0,t),this}};if(m.promise(w).complete=g.add,w.success=w.done,w.error=w.fail,d.url=((e||d.url||ot)+"").replace(lt,"").replace(pt,at[1]+"//"),d.type=n.method||n.type||d.method||d.type,d.dataTypes=oe.trim(d.dataType||"*").toLowerCase().match(ue)||[""],null==d.crossDomain&&(l=mt.exec(d.url.toLowerCase()),d.crossDomain=!(!l||l[1]===at[1]&&l[2]===at[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(at[3]||("http:"===at[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=oe.param(d.data,d.traditional)),R(vt,d,n,w),2===x)return w;c=d.global,c&&0===oe.active++&&oe.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!ft.test(d.type),a=d.url,d.hasContent||(d.data&&(a=d.url+=(ut.test(a)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=ct.test(a)?a.replace(ct,"$1_="+st++):a+(ut.test(a)?"&":"?")+"_="+st++)),d.ifModified&&(oe.lastModified[a]&&w.setRequestHeader("If-Modified-Since",oe.lastModified[a]),oe.etag[a]&&w.setRequestHeader("If-None-Match",oe.etag[a])),(d.data&&d.hasContent&&d.contentType!==!1||n.contentType)&&w.setRequestHeader("Content-Type",d.contentType),w.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+_t+"; q=0.01":""):d.accepts["*"]);for(h in d.headers)w.setRequestHeader(h,d.headers[h]);if(d.beforeSend&&(d.beforeSend.call(f,w,d)===!1||2===x))return w.abort();b="abort";for(h in{success:1,error:1,complete:1})w[h](d[h]);if(r=R(yt,d,n,w)){w.readyState=1,c&&p.trigger("ajaxSend",[w,d]),d.async&&d.timeout>0&&(u=setTimeout(function(){w.abort("timeout")},d.timeout));try{x=1,r.send(y,i)}catch(E){if(!(x<2))throw E;i(-1,E)}}else i(-1,"No Transport");return w},getJSON:function(e,t,n){return oe.get(e,t,n,"json")},getScript:function(e,n){return oe.get(e,t,n,"script")}}),oe.each(["get","post"],function(e,n){oe[n]=function(e,i,r,a){return oe.isFunction(i)&&(a=a||r,r=i,i=t),oe.ajax({url:e,type:n,dataType:a,data:i,success:r})}}),oe.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return oe.globalEval(e),e}}}),oe.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),oe.ajaxTransport("script",function(e){if(e.crossDomain){var t,n;return{send:function(i,r){t=oe("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",n=function(e){t.remove(),n=null,e&&r("error"===e.type?404:200,e.type)}),W.head.appendChild(t[0])},abort:function(){n&&n()}}}});var bt=[],wt=/(=)\?(?=&|$)|\?\?/;oe.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=bt.pop()||oe.expando+"_"+st++;return this[e]=!0,e}}),oe.ajaxPrefilter("json jsonp",function(n,i,r){var a,o,s,u=n.jsonp!==!1&&(wt.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&wt.test(n.data)&&"data");if(u||"jsonp"===n.dataTypes[0])return a=n.jsonpCallback=oe.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,u?n[u]=n[u].replace(wt,"$1"+a):n.jsonp!==!1&&(n.url+=(ut.test(n.url)?"&":"?")+n.jsonp+"="+a),n.converters["script json"]=function(){return s||oe.error(a+" was not called"),s[0]},n.dataTypes[0]="json",o=e[a],e[a]=function(){s=arguments},r.always(function(){e[a]=o,n[a]&&(n.jsonpCallback=i.jsonpCallback,bt.push(a)),s&&oe.isFunction(o)&&o(s[0]),s=o=t}),"script"}),oe.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Et=oe.ajaxSettings.xhr(),St={0:200,1223:204},Mt=0,Tt={};e.ActiveXObject&&oe(e).on("unload",function(){for(var e in Tt)Tt[e]();Tt=t}),oe.support.cors=!!Et&&"withCredentials"in Et,oe.support.ajax=Et=!!Et,oe.ajaxTransport(function(e){var n;if(oe.support.cors||Et&&!e.crossDomain)return{send:function(i,r){var a,o,s=e.xhr();if(s.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(a in e.xhrFields)s[a]=e.xhrFields[a];e.mimeType&&s.overrideMimeType&&s.overrideMimeType(e.mimeType),e.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(a in i)s.setRequestHeader(a,i[a]);n=function(e){return function(){n&&(delete Tt[o],n=s.onload=s.onerror=null,"abort"===e?s.abort():"error"===e?r(s.status||404,s.statusText):r(St[s.status]||s.status,s.statusText,"string"==typeof s.responseText?{text:s.responseText}:t,s.getAllResponseHeaders()))}},s.onload=n(),s.onerror=n("error"),n=Tt[o=Mt++]=n("abort"),s.send(e.hasContent&&e.data||null)},abort:function(){n&&n()}}});var At,Lt,Rt=/^(?:toggle|show|hide)$/,Ct=new RegExp("^(?:([+-])=|)("+se+")([a-z%]*)$","i"),Pt=/queueHooks$/,It=[U],Ot={"*":[function(e,t){var n,i,r=this.createTween(e,t),a=Ct.exec(t),o=r.cur(),s=+o||0,u=1,l=20;if(a){if(n=+a[2],i=a[3]||(oe.cssNumber[e]?"":"px"),"px"!==i&&s){s=oe.css(r.elem,e,!0)||n||1;do u=u||".5",s/=u,oe.style(r.elem,e,s+i);while(u!==(u=r.cur()/o)&&1!==u&&--l)}r.unit=i,r.start=s,r.end=a[1]?s+(a[1]+1)*n:n}return r}]};oe.Animation=oe.extend(D,{tweener:function(e,t){oe.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;i<r;i++)n=e[i],Ot[n]=Ot[n]||[],Ot[n].unshift(t)},prefilter:function(e,t){t?It.unshift(e):It.push(e)}}),oe.Tween=B,B.prototype={constructor:B,init:function(e,t,n,i,r,a){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=a||(oe.cssNumber[n]?"":"px")},cur:function(){var e=B.propHooks[this.prop];
return e&&e.get?e.get(this):B.propHooks._default.get(this)},run:function(e){var t,n=B.propHooks[this.prop];return this.options.duration?this.pos=t=oe.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):B.propHooks._default.set(this),this}},B.prototype.init.prototype=B.prototype,B.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=oe.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){oe.fx.step[e.prop]?oe.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[oe.cssProps[e.prop]]||oe.cssHooks[e.prop])?oe.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},B.propHooks.scrollTop=B.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},oe.each(["toggle","show","hide"],function(e,t){var n=oe.fn[t];oe.fn[t]=function(e,i,r){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(F(t,!0),e,i,r)}}),oe.fn.extend({fadeTo:function(e,t,n,i){return this.filter(_).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=oe.isEmptyObject(e),a=oe.speed(t,n,i),o=function(){var t=D(this,oe.extend({},e),a);o.finish=function(){t.stop(!0)},(r||ve.get(this,"finish"))&&t.stop(!0)};return o.finish=o,r||a.queue===!1?this.each(o):this.queue(a.queue,o)},stop:function(e,n,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",a=oe.timers,o=ve.get(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&Pt.test(n)&&r(o[n]);for(n=a.length;n--;)a[n].elem!==this||null!=e&&a[n].queue!==e||(a[n].anim.stop(i),t=!1,a.splice(n,1));!t&&i||oe.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=ve.get(this),i=n[e+"queue"],r=n[e+"queueHooks"],a=oe.timers,o=i?i.length:0;for(n.finish=!0,oe.queue(this,e,[]),r&&r.cur&&r.cur.finish&&r.cur.finish.call(this),t=a.length;t--;)a[t].elem===this&&a[t].queue===e&&(a[t].anim.stop(!0),a.splice(t,1));for(t=0;t<o;t++)i[t]&&i[t].finish&&i[t].finish.call(this);delete n.finish})}}),oe.each({slideDown:F("show"),slideUp:F("hide"),slideToggle:F("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){oe.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),oe.speed=function(e,t,n){var i=e&&"object"==typeof e?oe.extend({},e):{complete:n||!n&&t||oe.isFunction(e)&&e,duration:e,easing:n&&t||t&&!oe.isFunction(t)&&t};return i.duration=oe.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in oe.fx.speeds?oe.fx.speeds[i.duration]:oe.fx.speeds._default,null!=i.queue&&i.queue!==!0||(i.queue="fx"),i.old=i.complete,i.complete=function(){oe.isFunction(i.old)&&i.old.call(this),i.queue&&oe.dequeue(this,i.queue)},i},oe.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},oe.timers=[],oe.fx=B.prototype.init,oe.fx.tick=function(){var e,n=oe.timers,i=0;for(At=oe.now();i<n.length;i++)e=n[i],e()||n[i]!==e||n.splice(i--,1);n.length||oe.fx.stop(),At=t},oe.fx.timer=function(e){e()&&oe.timers.push(e)&&oe.fx.start()},oe.fx.interval=13,oe.fx.start=function(){Lt||(Lt=setInterval(oe.fx.tick,oe.fx.interval))},oe.fx.stop=function(){clearInterval(Lt),Lt=null},oe.fx.speeds={slow:600,fast:200,_default:400},oe.fx.step={},oe.expr&&oe.expr.filters&&(oe.expr.filters.animated=function(e){return oe.grep(oe.timers,function(t){return e===t.elem}).length}),oe.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){oe.offset.setOffset(this,e,t)});var n,i,r=this[0],a={top:0,left:0},o=r&&r.ownerDocument;if(o)return n=o.documentElement,oe.contains(n,r)?(typeof r.getBoundingClientRect!==H&&(a=r.getBoundingClientRect()),i=j(o),{top:a.top+i.pageYOffset-n.clientTop,left:a.left+i.pageXOffset-n.clientLeft}):a},oe.offset={setOffset:function(e,t,n){var i,r,a,o,s,u,l,c=oe.css(e,"position"),h=oe(e),d={};"static"===c&&(e.style.position="relative"),s=h.offset(),a=oe.css(e,"top"),u=oe.css(e,"left"),l=("absolute"===c||"fixed"===c)&&(a+u).indexOf("auto")>-1,l?(i=h.position(),o=i.top,r=i.left):(o=parseFloat(a)||0,r=parseFloat(u)||0),oe.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(d.top=t.top-s.top+o),null!=t.left&&(d.left=t.left-s.left+r),"using"in t?t.using.call(e,d):h.css(d)}},oe.fn.extend({position:function(){if(this[0]){var e,t,n=this[0],i={top:0,left:0};return"fixed"===oe.css(n,"position")?t=n.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),oe.nodeName(e[0],"html")||(i=e.offset()),i.top+=oe.css(e[0],"borderTopWidth",!0),i.left+=oe.css(e[0],"borderLeftWidth",!0)),{top:t.top-i.top-oe.css(n,"marginTop",!0),left:t.left-i.left-oe.css(n,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||q;e&&!oe.nodeName(e,"html")&&"static"===oe.css(e,"position");)e=e.offsetParent;return e||q})}}),oe.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,i){var r="pageYOffset"===i;oe.fn[n]=function(a){return oe.access(this,function(n,a,o){var s=j(n);return o===t?s?s[i]:n[a]:void(s?s.scrollTo(r?e.pageXOffset:o,r?o:e.pageYOffset):n[a]=o)},n,a,arguments.length,null)}}),oe.each({Height:"height",Width:"width"},function(e,n){oe.each({padding:"inner"+e,content:n,"":"outer"+e},function(i,r){oe.fn[r]=function(r,a){var o=arguments.length&&(i||"boolean"!=typeof r),s=i||(r===!0||a===!0?"margin":"border");return oe.access(this,function(n,i,r){var a;return oe.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(a=n.documentElement,Math.max(n.body["scroll"+e],a["scroll"+e],n.body["offset"+e],a["offset"+e],a["client"+e])):r===t?oe.css(n,i,s):oe.style(n,i,r,s)},n,o?r:t,o,null)}})}),oe.fn.size=function(){return this.length},oe.fn.andSelf=oe.fn.addBack,"object"==typeof module&&"object"==typeof module.exports?module.exports=oe:"function"==typeof define&&define.amd&&define("jquery",[],function(){return oe}),"object"==typeof e&&"object"==typeof e.document&&(e.jQuery=e.$=oe)}(window);var hexcase=0,b64pad="",chrsz=8;!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.THREE=e.THREE||{})}(this,function(exports){"use strict";function e(){}function t(e,t){this.x=e||0,this.y=t||0}function n(e,i,r,a,o,s,u,l,c,h){Object.defineProperty(this,"id",{value:Ms++}),this.uuid=Ss.generateUUID(),this.name="",this.image=void 0!==e?e:n.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=void 0!==i?i:n.DEFAULT_MAPPING,this.wrapS=void 0!==r?r:_o,this.wrapT=void 0!==a?a:_o,this.magFilter=void 0!==o?o:So,this.minFilter=void 0!==s?s:To,this.anisotropy=void 0!==c?c:1,this.format=void 0!==u?u:zo,this.type=void 0!==l?l:Ao,this.offset=new t(0,0),this.repeat=new t(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=void 0!==h?h:ps,this.version=0,this.onUpdate=null}function i(e,t,n,i){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==i?i:1}function r(e,t,r){this.uuid=Ss.generateUUID(),this.width=e,this.height=t,this.scissor=new i(0,0,e,t),this.scissorTest=!1,this.viewport=new i(0,0,e,t),r=r||{},void 0===r.minFilter&&(r.minFilter=So),this.texture=new n((void 0),(void 0),r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.depthBuffer=void 0===r.depthBuffer||r.depthBuffer,this.stencilBuffer=void 0===r.stencilBuffer||r.stencilBuffer,this.depthTexture=void 0!==r.depthTexture?r.depthTexture:null}function a(e,t,n){r.call(this,e,t,n),this.activeCubeFace=0,this.activeMipMapLevel=0}function o(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==i?i:1}function s(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0}function u(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}function l(e,t,i,r,a,o,s,u,l,c,h,d){n.call(this,null,o,s,u,l,c,r,a,h,d),this.image={data:e,width:t,height:i},this.magFilter=void 0!==l?l:bo,this.minFilter=void 0!==c?c:bo,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}function c(e,t,i,r,a,o,s,u,l,c){e=void 0!==e?e:[],t=void 0!==t?t:co,n.call(this,e,t,i,r,a,o,s,u,l,c),this.flipY=!1}function h(){this.seq=[],this.map={}}function d(e,t,n){var i=e[0];if(i<=0||i>0)return e;var r=t*n,a=Ls[r];if(void 0===a&&(a=new Float32Array(r),Ls[r]=a),0!==t){i.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function f(e,t){var n=Rs[t];void 0===n&&(n=new Int32Array(t),Rs[t]=n);for(var i=0;i!==t;++i)n[i]=e.allocTextureUnit();return n}function p(e,t){e.uniform1f(this.addr,t)}function m(e,t){e.uniform1i(this.addr,t)}function g(e,t){void 0===t.x?e.uniform2fv(this.addr,t):e.uniform2f(this.addr,t.x,t.y)}function v(e,t){void 0!==t.x?e.uniform3f(this.addr,t.x,t.y,t.z):void 0!==t.r?e.uniform3f(this.addr,t.r,t.g,t.b):e.uniform3fv(this.addr,t)}function y(e,t){void 0===t.x?e.uniform4fv(this.addr,t):e.uniform4f(this.addr,t.x,t.y,t.z,t.w)}function _(e,t){e.uniformMatrix2fv(this.addr,!1,t.elements||t)}function x(e,t){void 0===t.elements?e.uniformMatrix3fv(this.addr,!1,t):(Ps.set(t.elements),e.uniformMatrix3fv(this.addr,!1,Ps))}function b(e,t){void 0===t.elements?e.uniformMatrix4fv(this.addr,!1,t):(Cs.set(t.elements),e.uniformMatrix4fv(this.addr,!1,Cs))}function w(e,t,n){var i=n.allocTextureUnit();e.uniform1i(this.addr,i),n.setTexture2D(t||Ts,i)}function E(e,t,n){var i=n.allocTextureUnit();e.uniform1i(this.addr,i),n.setTextureCube(t||As,i)}function S(e,t){e.uniform2iv(this.addr,t)}function M(e,t){e.uniform3iv(this.addr,t)}function T(e,t){e.uniform4iv(this.addr,t)}function A(e){switch(e){case 5126:return p;case 35664:return g;case 35665:return v;case 35666:return y;case 35674:return _;case 35675:return x;case 35676:return b;case 35678:case 36198:return w;case 35680:return E;case 5124:case 35670:return m;case 35667:case 35671:return S;case 35668:case 35672:return M;case 35669:case 35673:return T}}function L(e,t){e.uniform1fv(this.addr,t)}function R(e,t){e.uniform1iv(this.addr,t)}function C(e,t){e.uniform2fv(this.addr,d(t,this.size,2))}function P(e,t){e.uniform3fv(this.addr,d(t,this.size,3))}function I(e,t){e.uniform4fv(this.addr,d(t,this.size,4))}function O(e,t){e.uniformMatrix2fv(this.addr,!1,d(t,this.size,4))}function k(e,t){e.uniformMatrix3fv(this.addr,!1,d(t,this.size,9))}function D(e,t){e.uniformMatrix4fv(this.addr,!1,d(t,this.size,16))}function N(e,t,n){var i=t.length,r=f(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTexture2D(t[a]||Ts,r[a])}function U(e,t,n){var i=t.length,r=f(n,i);e.uniform1iv(this.addr,r);for(var a=0;a!==i;++a)n.setTextureCube(t[a]||As,r[a])}function B(e){switch(e){case 5126:return L;case 35664:return C;case 35665:return P;case 35666:return I;case 35674:return O;case 35675:return k;case 35676:return D;case 35678:return N;case 35680:return U;case 5124:case 35670:return R;case 35667:case 35671:return S;case 35668:case 35672:return M;case 35669:case 35673:return T}}function F(e,t,n){this.id=e,this.addr=n,this.setValue=A(t.type)}function j(e,t,n){this.id=e,this.addr=n,this.size=t.size,this.setValue=B(t.type)}function z(e){this.id=e,h.call(this)}function G(e,t){e.seq.push(t),e.map[t.id]=t}function H(e,t,n){var i=e.name,r=i.length;for(Is.lastIndex=0;;){var a=Is.exec(i),o=Is.lastIndex,s=a[1],u="]"===a[2],l=a[3];if(u&&(s=0|s),void 0===l||"["===l&&o+2===r){G(n,void 0===l?new F(s,e,t):new j(s,e,t));break}var c=n.map,h=c[s];void 0===h&&(h=new z(s),G(n,h)),n=h}}function V(e,t,n){h.call(this),this.renderer=n;for(var i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS),r=0;r<i;++r){var a=e.getActiveUniform(t,r),o=a.name,s=e.getUniformLocation(t,o);H(a,s,this)}}function W(e,t,n){return void 0===t&&void 0===n?this.set(e):this.setRGB(e,t,n)}function q(e,n){this.min=void 0!==e?e:new t((+(1/0)),(+(1/0))),this.max=void 0!==n?n:new t((-(1/0)),(-(1/0)))}function X(e,n){function i(){var e=new Float32Array([-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1]),t=new Uint16Array([0,1,2,0,2,3]);a=p.createBuffer(),o=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,a),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),p.bufferData(p.ELEMENT_ARRAY_BUFFER,t,p.STATIC_DRAW),d=p.createTexture(),f=p.createTexture(),m.bindTexture(p.TEXTURE_2D,d),p.texImage2D(p.TEXTURE_2D,0,p.RGB,16,16,0,p.RGB,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),m.bindTexture(p.TEXTURE_2D,f),p.texImage2D(p.TEXTURE_2D,0,p.RGBA,16,16,0,p.RGBA,p.UNSIGNED_BYTE,null),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,p.CLAMP_TO_EDGE),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,p.NEAREST),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,p.NEAREST),u={vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if ( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if ( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if ( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},l=r(u),c={vertex:p.getAttribLocation(l,"position"),uv:p.getAttribLocation(l,"uv")},h={renderType:p.getUniformLocation(l,"renderType"),map:p.getUniformLocation(l,"map"),occlusionMap:p.getUniformLocation(l,"occlusionMap"),opacity:p.getUniformLocation(l,"opacity"),color:p.getUniformLocation(l,"color"),scale:p.getUniformLocation(l,"scale"),rotation:p.getUniformLocation(l,"rotation"),screenPosition:p.getUniformLocation(l,"screenPosition")}}function r(t){var n=p.createProgram(),i=p.createShader(p.FRAGMENT_SHADER),r=p.createShader(p.VERTEX_SHADER),a="precision "+e.getPrecision()+" float;\n";return p.shaderSource(i,a+t.fragmentShader),p.shaderSource(r,a+t.vertexShader),p.compileShader(i),p.compileShader(r),p.attachShader(n,i),p.attachShader(n,r),p.linkProgram(n),n}var a,o,u,l,c,h,d,f,p=e.context,m=e.state;this.render=function(r,u,g){if(0!==n.length){var v=new s,y=g.w/g.z,_=.5*g.z,x=.5*g.w,b=16/g.w,w=new t(b*y,b),E=new s(1,1,0),S=new t(1,1),M=new q;M.min.set(g.x,g.y),M.max.set(g.x+(g.z-16),g.y+(g.w-16)),void 0===l&&i(),p.useProgram(l),m.initAttributes(),m.enableAttribute(c.vertex),m.enableAttribute(c.uv),m.disableUnusedAttributes(),p.uniform1i(h.occlusionMap,0),p.uniform1i(h.map,1),p.bindBuffer(p.ARRAY_BUFFER,a),p.vertexAttribPointer(c.vertex,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(c.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,o),m.disable(p.CULL_FACE),m.buffers.depth.setMask(!1);for(var T=0,A=n.length;T<A;T++){b=16/g.w,w.set(b*y,b);var L=n[T];if(v.set(L.matrixWorld.elements[12],L.matrixWorld.elements[13],L.matrixWorld.elements[14]),v.applyMatrix4(u.matrixWorldInverse),v.applyMatrix4(u.projectionMatrix),E.copy(v),S.x=g.x+E.x*_+_-8,S.y=g.y+E.y*x+x-8,M.containsPoint(S)===!0){m.activeTexture(p.TEXTURE0),m.bindTexture(p.TEXTURE_2D,null),m.activeTexture(p.TEXTURE1),m.bindTexture(p.TEXTURE_2D,d),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGB,S.x,S.y,16,16,0),p.uniform1i(h.renderType,0),p.uniform2f(h.scale,w.x,w.y),p.uniform3f(h.screenPosition,E.x,E.y,E.z),m.disable(p.BLEND),m.enable(p.DEPTH_TEST),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),m.activeTexture(p.TEXTURE0),m.bindTexture(p.TEXTURE_2D,f),p.copyTexImage2D(p.TEXTURE_2D,0,p.RGBA,S.x,S.y,16,16,0),p.uniform1i(h.renderType,1),m.disable(p.DEPTH_TEST),m.activeTexture(p.TEXTURE1),m.bindTexture(p.TEXTURE_2D,d),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),L.positionScreen.copy(E),L.customUpdateCallback?L.customUpdateCallback(L):L.updateLensFlares(),p.uniform1i(h.renderType,2),m.enable(p.BLEND);for(var R=0,C=L.lensFlares.length;R<C;R++){var P=L.lensFlares[R];P.opacity>.001&&P.scale>.001&&(E.x=P.x,E.y=P.y,E.z=P.z,b=P.size*P.scale/g.w,w.x=b*y,w.y=b,p.uniform3f(h.screenPosition,E.x,E.y,E.z),p.uniform2f(h.scale,w.x,w.y),p.uniform1f(h.rotation,P.rotation),p.uniform1f(h.opacity,P.opacity),p.uniform3f(h.color,P.color.r,P.color.g,P.color.b),m.setBlending(P.blending,P.blendEquation,P.blendSrc,P.blendDst),e.setTexture2D(P.texture,1),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0))}}}m.enable(p.CULL_FACE),m.enable(p.DEPTH_TEST),m.buffers.depth.setMask(!0),e.resetGLState()}}}function Y(e,t){function i(){var e=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),t=new Uint16Array([0,1,2,0,2,3]);u=p.createBuffer(),l=p.createBuffer(),p.bindBuffer(p.ARRAY_BUFFER,u),p.bufferData(p.ARRAY_BUFFER,e,p.STATIC_DRAW),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l),p.bufferData(p.ELEMENT_ARRAY_BUFFER,t,p.STATIC_DRAW),c=r(),h={position:p.getAttribLocation(c,"position"),uv:p.getAttribLocation(c,"uv")},d={uvOffset:p.getUniformLocation(c,"uvOffset"),uvScale:p.getUniformLocation(c,"uvScale"),rotation:p.getUniformLocation(c,"rotation"),scale:p.getUniformLocation(c,"scale"),color:p.getUniformLocation(c,"color"),map:p.getUniformLocation(c,"map"),opacity:p.getUniformLocation(c,"opacity"),modelViewMatrix:p.getUniformLocation(c,"modelViewMatrix"),projectionMatrix:p.getUniformLocation(c,"projectionMatrix"),fogType:p.getUniformLocation(c,"fogType"),fogDensity:p.getUniformLocation(c,"fogDensity"),fogNear:p.getUniformLocation(c,"fogNear"),fogFar:p.getUniformLocation(c,"fogFar"),fogColor:p.getUniformLocation(c,"fogColor"),alphaTest:p.getUniformLocation(c,"alphaTest")};var i=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");i.width=8,i.height=8;var a=i.getContext("2d");a.fillStyle="white",a.fillRect(0,0,8,8),f=new n(i),f.needsUpdate=!0}function r(){var t=p.createProgram(),n=p.createShader(p.VERTEX_SHADER),i=p.createShader(p.FRAGMENT_SHADER);return p.shaderSource(n,["precision "+e.getPrecision()+" float;","#define SHADER_NAME SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),p.shaderSource(i,["precision "+e.getPrecision()+" float;","#define SHADER_NAME SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),p.compileShader(n),p.compileShader(i),p.attachShader(t,n),p.attachShader(t,i),p.linkProgram(t),t}function a(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:t.id-e.id}var u,l,c,h,d,f,p=e.context,m=e.state,g=new s,v=new o,y=new s;this.render=function(n,r){if(0!==t.length){void 0===c&&i(),p.useProgram(c),m.initAttributes(),m.enableAttribute(h.position),m.enableAttribute(h.uv),m.disableUnusedAttributes(),m.disable(p.CULL_FACE),m.enable(p.BLEND),p.bindBuffer(p.ARRAY_BUFFER,u),p.vertexAttribPointer(h.position,2,p.FLOAT,!1,16,0),p.vertexAttribPointer(h.uv,2,p.FLOAT,!1,16,8),p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,l),p.uniformMatrix4fv(d.projectionMatrix,!1,r.projectionMatrix.elements),m.activeTexture(p.TEXTURE0),p.uniform1i(d.map,0);var o=0,s=0,_=n.fog;_?(p.uniform3f(d.fogColor,_.color.r,_.color.g,_.color.b),_.isFog?(p.uniform1f(d.fogNear,_.near),p.uniform1f(d.fogFar,_.far),p.uniform1i(d.fogType,1),o=1,s=1):_.isFogExp2&&(p.uniform1f(d.fogDensity,_.density),p.uniform1i(d.fogType,2),o=2,s=2)):(p.uniform1i(d.fogType,0),o=0,s=0);for(var x=0,b=t.length;x<b;x++){var w=t[x];w.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,w.matrixWorld),w.z=-w.modelViewMatrix.elements[14]}t.sort(a);for(var E=[],x=0,b=t.length;x<b;x++){var w=t[x],S=w.material;if(S.visible!==!1){w.onBeforeRender(e,n,r,void 0,S,void 0),p.uniform1f(d.alphaTest,S.alphaTest),p.uniformMatrix4fv(d.modelViewMatrix,!1,w.modelViewMatrix.elements),w.matrixWorld.decompose(g,v,y),E[0]=y.x,E[1]=y.y;var M=0;n.fog&&S.fog&&(M=s),o!==M&&(p.uniform1i(d.fogType,M),o=M),null!==S.map?(p.uniform2f(d.uvOffset,S.map.offset.x,S.map.offset.y),p.uniform2f(d.uvScale,S.map.repeat.x,S.map.repeat.y)):(p.uniform2f(d.uvOffset,0,0),p.uniform2f(d.uvScale,1,1)),p.uniform1f(d.opacity,S.opacity),p.uniform3f(d.color,S.color.r,S.color.g,S.color.b),p.uniform1f(d.rotation,S.rotation),p.uniform2fv(d.scale,E),m.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst,S.blendEquationAlpha,S.blendSrcAlpha,S.blendDstAlpha,S.premultipliedAlpha),m.buffers.depth.setTest(S.depthTest),m.buffers.depth.setMask(S.depthWrite),S.map?e.setTexture2D(S.map,0):e.setTexture2D(f,0),p.drawElements(p.TRIANGLES,6,p.UNSIGNED_SHORT,0),w.onAfterRender(e,n,r,void 0,S,void 0)}}m.enable(p.CULL_FACE),e.resetGLState()}}}function K(){Object.defineProperty(this,"id",{value:jl++}),this.uuid=Ss.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.lights=!0,this.blending=Ta,this.side=va,this.shading=ba,this.vertexColors=wa,this.opacity=1,this.transparent=!1,this.blendSrc=ja,this.blendDst=za,this.blendEquation=Pa,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=Za,this.depthTest=!0,this.depthWrite=!0,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.overdraw=0,this.visible=!0,this.needsUpdate=!0}function Z(e){K.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function J(e){K.call(this),this.type="MeshDepthMaterial",this.depthPacking=ws,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.setValues(e)}function Q(e,t){this.min=void 0!==e?e:new s((+(1/0)),(+(1/0)),(+(1/0))),this.max=void 0!==t?t:new s((-(1/0)),(-(1/0)),(-(1/0)))}function ee(e,t){this.center=void 0!==e?e:new s,this.radius=void 0!==t?t:0}function te(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}function ne(e,t){this.normal=void 0!==e?e:new s(1,0,0),this.constant=void 0!==t?t:0}function ie(e,t,n,i,r,a){this.planes=[void 0!==e?e:new ne,void 0!==t?t:new ne,void 0!==n?n:new ne,void 0!==i?i:new ne,void 0!==r?r:new ne,void 0!==a?a:new ne]}function re(e,n,a,o){function l(t,n,i,r){var a=t.geometry,o=null,s=E,u=t.customDepthMaterial;if(i&&(s=S,u=t.customDistanceMaterial),u)o=u;else{var l=!1;n.morphTargets&&(a&&a.isBufferGeometry?l=a.morphAttributes&&a.morphAttributes.position&&a.morphAttributes.position.length>0:a&&a.isGeometry&&(l=a.morphTargets&&a.morphTargets.length>0)),t.isSkinnedMesh&&n.skinning===!1&&console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t);var c=t.isSkinnedMesh&&n.skinning,h=0;l&&(h|=x),c&&(h|=b),o=s[h]}if(e.localClippingEnabled&&n.clipShadows===!0&&0!==n.clippingPlanes.length){var d=o.uuid,f=n.uuid,p=M[d];void 0===p&&(p={},M[d]=p);var m=p[f];void 0===m&&(m=o.clone(),p[f]=m),o=m}o.visible=n.visible,o.wireframe=n.wireframe;var g=n.side;return U.renderSingleSided&&g==_a&&(g=va),U.renderReverseSided&&(g===va?g=ya:g===ya&&(g=va)),o.side=g,o.clipShadows=n.clipShadows,o.clippingPlanes=n.clippingPlanes,o.wireframeLinewidth=n.wireframeLinewidth,o.linewidth=n.linewidth,i&&void 0!==o.uniforms.lightPos&&o.uniforms.lightPos.value.copy(r),o}function c(t,n,i,r){if(t.visible!==!1){var o=t.layers.test(n.layers);if(o&&(t.isMesh||t.isLine||t.isPoints)&&t.castShadow&&(!t.frustumCulled||f.intersectsObject(t))){t.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,t.matrixWorld);var s=a.update(t),u=t.material;if(Array.isArray(u))for(var h=s.groups,d=0,p=h.length;d<p;d++){var m=h[d],g=u[m.materialIndex];if(g&&g.visible){var v=l(t,g,r,_);e.renderBufferDirect(i,null,s,v,t,m)}}else if(u.visible){var v=l(t,u,r,_);e.renderBufferDirect(i,null,s,v,t,null)}}for(var y=t.children,x=0,b=y.length;x<b;x++)c(y[x],n,i,r)}}var h=e.context,d=e.state,f=new ie,p=new u,m=n.shadows,g=new t,v=new t(o.maxTextureSize,o.maxTextureSize),y=new s,_=new s,x=1,b=2,w=(x|b)+1,E=new Array(w),S=new Array(w),M={},T=[new s(1,0,0),new s((-1),0,0),new s(0,0,1),new s(0,0,(-1)),new s(0,1,0),new s(0,(-1),0)],A=[new s(0,1,0),new s(0,1,0),new s(0,1,0),new s(0,1,0),new s(0,0,1),new s(0,0,(-1))],L=[new i,new i,new i,new i,new i,new i],R=new J;R.depthPacking=Es,R.clipping=!0;for(var C=Fl.distanceRGBA,P=Ds.clone(C.uniforms),I=0;I!==w;++I){var O=0!==(I&x),k=0!==(I&b),D=R.clone();D.morphTargets=O,D.skinning=k,E[I]=D;var N=new Z({defines:{USE_SHADOWMAP:""},uniforms:P,vertexShader:C.vertexShader,fragmentShader:C.fragmentShader,morphTargets:O,skinning:k,clipping:!0});S[I]=N}var U=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=ma,this.renderReverseSided=!0,this.renderSingleSided=!0,this.render=function(t,n){if(U.enabled!==!1&&(U.autoUpdate!==!1||U.needsUpdate!==!1)&&0!==m.length){d.disable(h.BLEND),d.buffers.color.setClear(1,1,1,1),d.buffers.depth.setTest(!0),d.setScissorTest(!1);for(var i,a=0,o=m.length;a<o;a++){var s=m[a],u=s.shadow,l=s&&s.isPointLight;if(void 0!==u){var x=u.camera;if(g.copy(u.mapSize),g.min(v),l){var b=g.x,w=g.y;L[0].set(2*b,w,b,w),L[1].set(0,w,b,w),L[2].set(3*b,w,b,w),L[3].set(b,w,b,w),L[4].set(3*b,0,b,w),L[5].set(b,0,b,w),g.x*=4,g.y*=2}if(null===u.map){var E={minFilter:bo,magFilter:bo,format:zo};u.map=new r(g.x,g.y,E),u.map.texture.name=s.name+".shadowMap",x.updateProjectionMatrix()}u.isSpotLightShadow&&u.update(s);var S=u.map,M=u.matrix;_.setFromMatrixPosition(s.matrixWorld),x.position.copy(_),l?(i=6,M.makeTranslation(-_.x,-_.y,-_.z)):(i=1,y.setFromMatrixPosition(s.target.matrixWorld),x.lookAt(y),x.updateMatrixWorld(),M.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),M.multiply(x.projectionMatrix),M.multiply(x.matrixWorldInverse)),e.setRenderTarget(S),e.clear();for(var R=0;R<i;R++){if(l){y.copy(x.position),y.add(T[R]),x.up.copy(A[R]),x.lookAt(y),x.updateMatrixWorld();var C=L[R];d.viewport(C)}p.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),f.setFromMatrix(p),c(t,n,x,l)}}else console.warn("THREE.WebGLShadowMap:",s,"has no shadow.")}var P=e.getClearColor(),I=e.getClearAlpha();e.setClearColor(P,I),U.needsUpdate=!1}}}function ae(e){function t(t,n){var i=t.array,r=t.dynamic?e.DYNAMIC_DRAW:e.STATIC_DRAW,a=e.createBuffer();e.bindBuffer(n,a),e.bufferData(n,i,r),t.onUploadCallback();var o=e.FLOAT;return i instanceof Float32Array?o=e.FLOAT:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?o=e.UNSIGNED_SHORT:i instanceof Int16Array?o=e.SHORT:i instanceof Uint32Array?o=e.UNSIGNED_INT:i instanceof Int32Array?o=e.INT:i instanceof Int8Array?o=e.BYTE:i instanceof Uint8Array&&(o=e.UNSIGNED_BYTE),{buffer:a,type:o,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}function n(t,n,i){var r=n.array,a=n.updateRange;e.bindBuffer(i,t),n.dynamic===!1?e.bufferData(i,r,e.STATIC_DRAW):a.count===-1?e.bufferSubData(i,0,r):0===a.count?console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually."):(e.bufferSubData(i,a.offset*r.BYTES_PER_ELEMENT,r.subarray(a.offset,a.offset+a.count)),a.count=-1)}function i(e){return e.isInterleavedBufferAttribute&&(e=e.data),o[e.uuid]}function r(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=o[t.uuid];n&&(e.deleteBuffer(n.buffer),delete o[t.uuid])}function a(e,i){e.isInterleavedBufferAttribute&&(e=e.data);var r=o[e.uuid];void 0===r?o[e.uuid]=t(e,i):r.version<e.version&&(n(r.buffer,e,i),r.version=e.version)}var o={};return{get:i,remove:r,update:a}}function oe(e,t,n,i){this._x=e||0,this._y=t||0,this._z=n||0,this._order=i||oe.DefaultOrder}function se(){this.mask=1}function ue(){function e(){r.setFromEuler(i,!1)}function t(){i.setFromQuaternion(r,void 0,!1)}Object.defineProperty(this,"id",{value:zl++}),this.uuid=Ss.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ue.DefaultUp.clone();var n=new s,i=new oe,r=new o,a=new s(1,1,1);i.onChange(e),r.onChange(t),Object.defineProperties(this,{position:{enumerable:!0,value:n},rotation:{enumerable:!0,value:i},quaternion:{enumerable:!0,value:r},scale:{enumerable:!0,value:a},modelViewMatrix:{value:new u},normalMatrix:{value:new te}}),this.matrix=new u,this.matrixWorld=new u,
this.matrixAutoUpdate=ue.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new se,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function le(){ue.call(this),this.type="Camera",this.matrixWorldInverse=new u,this.projectionMatrix=new u}function ce(e,t,n,i,r,a){le.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=void 0!==r?r:.1,this.far=void 0!==a?a:2e3,this.updateProjectionMatrix()}function he(e,t,n,i){le.call(this),this.type="PerspectiveCamera",this.fov=void 0!==e?e:50,this.zoom=1,this.near=void 0!==n?n:.1,this.far=void 0!==i?i:2e3,this.focus=10,this.aspect=void 0!==t?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function de(e,t,n,i,r,a){this.a=e,this.b=t,this.c=n,this.normal=i&&i.isVector3?i:new s,this.vertexNormals=Array.isArray(i)?i:[],this.color=r&&r.isColor?r:new W,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=void 0!==a?a:0}function fe(){return Gl++}function pe(){Object.defineProperty(this,"id",{value:fe()}),this.uuid=Ss.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}function me(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.uuid=Ss.generateUUID(),this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=n===!0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function ge(e,t){me.call(this,new Int8Array(e),t)}function ve(e,t){me.call(this,new Uint8Array(e),t)}function ye(e,t){me.call(this,new Uint8ClampedArray(e),t)}function _e(e,t){me.call(this,new Int16Array(e),t)}function xe(e,t){me.call(this,new Uint16Array(e),t)}function be(e,t){me.call(this,new Int32Array(e),t)}function we(e,t){me.call(this,new Uint32Array(e),t)}function Ee(e,t){me.call(this,new Float32Array(e),t)}function Se(e,t){me.call(this,new Float64Array(e),t)}function Me(){this.indices=[],this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Te(e){if(0===e.length)return-(1/0);for(var t=e[0],n=1,i=e.length;n<i;++n)e[n]>t&&(t=e[n]);return t}function Ae(){Object.defineProperty(this,"id",{value:fe()}),this.uuid=Ss.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0}}function Le(e,t,n,i,r,a){pe.call(this),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a},this.fromBufferGeometry(new Re(e,t,n,i,r,a)),this.mergeVertices()}function Re(e,t,n,i,r,a){function o(e,t,n,i,r,a,o,m,g,v,y){var _,x,b=a/g,w=o/v,E=a/2,S=o/2,M=m/2,T=g+1,A=v+1,L=0,R=0,C=new s;for(x=0;x<A;x++){var P=x*w-S;for(_=0;_<T;_++){var I=_*b-E;C[e]=I*i,C[t]=P*r,C[n]=M,c.push(C.x,C.y,C.z),C[e]=0,C[t]=0,C[n]=m>0?1:-1,h.push(C.x,C.y,C.z),d.push(_/g),d.push(1-x/v),L+=1}}for(x=0;x<v;x++)for(_=0;_<g;_++){var O=f+_+T*x,k=f+_+T*(x+1),D=f+(_+1)+T*(x+1),N=f+(_+1)+T*x;l.push(O,k,N),l.push(k,D,N),R+=6}u.addGroup(p,R,y),p+=R,f+=L}Ae.call(this),this.type="BoxBufferGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:r,depthSegments:a};var u=this;i=Math.floor(i)||1,r=Math.floor(r)||1,a=Math.floor(a)||1;var l=[],c=[],h=[],d=[],f=0,p=0;o("z","y","x",-1,-1,n,t,e,a,r,0),o("z","y","x",1,-1,n,t,-e,a,r,1),o("x","z","y",1,1,e,n,t,i,a,2),o("x","z","y",1,-1,e,n,-t,i,a,3),o("x","y","z",1,-1,e,t,n,i,r,4),o("x","y","z",-1,-1,e,t,-n,i,r,5),this.setIndex(l),this.addAttribute("position",new Ee(c,3)),this.addAttribute("normal",new Ee(h,3)),this.addAttribute("uv",new Ee(d,2))}function Ce(e,t,n,i){pe.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i},this.fromBufferGeometry(new Pe(e,t,n,i)),this.mergeVertices()}function Pe(e,t,n,i){Ae.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};var r,a,o=e/2,s=t/2,u=Math.floor(n)||1,l=Math.floor(i)||1,c=u+1,h=l+1,d=e/u,f=t/l,p=[],m=[],g=[],v=[];for(a=0;a<h;a++){var y=a*f-s;for(r=0;r<c;r++){var _=r*d-o;m.push(_,-y,0),g.push(0,0,1),v.push(r/u),v.push(1-a/l)}}for(a=0;a<l;a++)for(r=0;r<u;r++){var x=r+c*a,b=r+c*(a+1),w=r+1+c*(a+1),E=r+1+c*a;p.push(x,b,E),p.push(b,w,E)}this.setIndex(p),this.addAttribute("position",new Ee(m,3)),this.addAttribute("normal",new Ee(g,3)),this.addAttribute("uv",new Ee(v,2))}function Ie(e){K.call(this),this.type="MeshBasicMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=to,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.lights=!1,this.setValues(e)}function Oe(e,t){this.origin=void 0!==e?e:new s,this.direction=void 0!==t?t:new s}function ke(e,t){this.start=void 0!==e?e:new s,this.end=void 0!==t?t:new s}function De(e,t,n){this.a=void 0!==e?e:new s,this.b=void 0!==t?t:new s,this.c=void 0!==n?n:new s}function Ne(e,t){ue.call(this),this.type="Mesh",this.geometry=void 0!==e?e:new Ae,this.material=void 0!==t?t:new Ie({color:16777215*Math.random()}),this.drawMode=hs,this.updateMorphTargets()}function Ue(e,t,n,i){function r(t,i,r){var d=t.background;null===d?a(c,h):d&&d.isColor&&(a(d,1),r=!0),(e.autoClear||r)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),d&&d.isCubeTexture?(void 0===u&&(u=new he,l=new Ne(new Re(5,5,5),new Z({uniforms:Fl.cube.uniforms,vertexShader:Fl.cube.vertexShader,fragmentShader:Fl.cube.fragmentShader,side:ya,depthTest:!1,depthWrite:!1,fog:!1}))),u.projectionMatrix.copy(i.projectionMatrix),u.matrixWorld.extractRotation(i.matrixWorld),u.matrixWorldInverse.getInverse(u.matrixWorld),l.material.uniforms.tCube.value=d,l.modelViewMatrix.multiplyMatrices(u.matrixWorldInverse,l.matrixWorld),n.update(l),e.renderBufferDirect(u,null,l.geometry,l.material,l,null)):d&&d.isTexture&&(void 0===o&&(o=new ce((-1),1,1,(-1),0,1),s=new Ne(new Pe(2,2),new Ie({depthTest:!1,depthWrite:!1,fog:!1}))),s.material.map=d,n.update(s),e.renderBufferDirect(o,null,s.geometry,s.material,s,null))}function a(e,n){t.buffers.color.setClear(e.r,e.g,e.b,n,i)}var o,s,u,l,c=new W(0),h=0;return{getClearColor:function(){return c},setClearColor:function(e,t){c.set(e),h=void 0!==t?t:1,a(c,h)},getClearAlpha:function(){return h},setClearAlpha:function(e){h=e,a(c,h)},render:r}}function Be(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program&&t.program&&e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Fe(e,t){return e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function je(){function e(){a=-1,s=-1}function t(e,t,n,i,u){var l,c;n.transparent?(l=o,c=++s):(l=r,c=++a);var h=l[c];h?(h.id=e.id,h.object=e,h.geometry=t,h.material=n,h.program=n.program,h.renderOrder=e.renderOrder,h.z=i,h.group=u):(h={id:e.id,object:e,geometry:t,material:n,program:n.program,renderOrder:e.renderOrder,z:i,group:u},l.push(h))}function n(){r.length=a+1,o.length=s+1}function i(){r.sort(Be),o.sort(Fe)}var r=[],a=-1,o=[],s=-1;return{opaque:r,transparent:o,init:e,push:t,finish:n,sort:i}}function ze(){function e(e,t){var i=e.id+","+t.id,r=n[i];return void 0===r&&(r=new je,n[i]=r),r}function t(){n={}}var n={};return{get:e,dispose:t}}function Ge(e,t,n){function i(e){s=e}function r(e){u=e.type,l=e.bytesPerElement}function a(t,i){e.drawElements(s,i,u,t*l),n.calls++,n.vertices+=i,s===e.TRIANGLES&&(n.faces+=i/3)}function o(i,r,a){var o=t.get("ANGLE_instanced_arrays");return null===o?void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays."):(o.drawElementsInstancedANGLE(s,a,u,r*l,i.maxInstancedCount),n.calls++,n.vertices+=a*i.maxInstancedCount,void(s===e.TRIANGLES&&(n.faces+=i.maxInstancedCount*a/3)))}var s,u,l;this.setMode=i,this.setIndex=r,this.render=a,this.renderInstances=o}function He(e,t,n){function i(e){o=e}function r(t,i){e.drawArrays(o,t,i),n.calls++,n.vertices+=i,o===e.TRIANGLES&&(n.faces+=i/3)}function a(i,r,a){var s=t.get("ANGLE_instanced_arrays");if(null===s)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");var u=i.attributes.position;u.isInterleavedBufferAttribute?(a=u.data.count,s.drawArraysInstancedANGLE(o,0,a,i.maxInstancedCount)):s.drawArraysInstancedANGLE(o,r,a,i.maxInstancedCount),n.calls++,n.vertices+=a*i.maxInstancedCount,o===e.TRIANGLES&&(n.faces+=i.maxInstancedCount*a/3)}var o;this.setMode=i,this.render=r,this.renderInstances=a}function Ve(e,t,n){function i(e){var r=e.target,a=s[r.id];null!==a.index&&t.remove(a.index);for(var o in a.attributes)t.remove(a.attributes[o]);r.removeEventListener("dispose",i),delete s[r.id];var l=u[r.id];l&&(t.remove(l),delete u[r.id]),l=u[a.id],l&&(t.remove(l),delete u[a.id]),n.geometries--}function r(e,t){var r=s[t.id];return r?r:(t.addEventListener("dispose",i),t.isBufferGeometry?r=t:t.isGeometry&&(void 0===t._bufferGeometry&&(t._bufferGeometry=(new Ae).setFromObject(e)),r=t._bufferGeometry),s[t.id]=r,n.geometries++,r)}function a(n){var i=n.index,r=n.attributes;null!==i&&t.update(i,e.ELEMENT_ARRAY_BUFFER);for(var a in r)t.update(r[a],e.ARRAY_BUFFER);var o=n.morphAttributes;for(var a in o)for(var s=o[a],u=0,l=s.length;u<l;u++)t.update(s[u],e.ARRAY_BUFFER)}function o(n){var i=u[n.id];if(i)return i;var r=[],a=n.index,o=n.attributes;if(null!==a)for(var s=a.array,l=0,c=s.length;l<c;l+=3){var h=s[l+0],d=s[l+1],f=s[l+2];r.push(h,d,d,f,f,h)}else for(var s=o.position.array,l=0,c=s.length/3-1;l<c;l+=3){var h=l+0,d=l+1,f=l+2;r.push(h,d,d,f,f,h)}return i=new(Te(r)>65535?we:xe)(r,1),t.update(i,e.ELEMENT_ARRAY_BUFFER),u[n.id]=i,i}var s={},u={};return{get:r,update:a,getWireframeAttribute:o}}function We(){var e={};return{get:function(n){if(void 0!==e[n.id])return e[n.id];var i;switch(n.type){case"DirectionalLight":i={direction:new s,color:new W,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new t};break;case"SpotLight":i={position:new s,direction:new s,color:new W,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new t};break;case"PointLight":i={position:new s,color:new W,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new t};break;case"HemisphereLight":i={direction:new s,skyColor:new W,groundColor:new W};break;case"RectAreaLight":i={color:new W,position:new s,halfWidth:new s,halfHeight:new s}}return e[n.id]=i,i}}}function qe(e,t,n){function i(e){var i=n.frame,r=e.geometry,o=t.get(e,r);return a[o.id]!==i&&(r.isGeometry&&o.updateFromObject(e),t.update(o),a[o.id]=i),o}function r(){a={}}var a={};return{update:i,clear:r}}function Xe(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}function Ye(e,t,n){var i=e.createShader(t);return e.shaderSource(i,n),e.compileShader(i),e.getShaderParameter(i,e.COMPILE_STATUS)===!1&&console.error("THREE.WebGLShader: Shader couldn't compile."),""!==e.getShaderInfoLog(i)&&console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",t===e.VERTEX_SHADER?"vertex":"fragment",e.getShaderInfoLog(i),Xe(n)),i}function Ke(e){switch(e){case ps:return["Linear","( value )"];case ms:return["sRGB","( value )"];case vs:return["RGBE","( value )"];case _s:return["RGBM","( value, 7.0 )"];case xs:return["RGBM","( value, 16.0 )"];case bs:return["RGBD","( value, 256.0 )"];case gs:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+e)}}function Ze(e,t){var n=Ke(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Je(e,t){var n=Ke(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Qe(e,t){var n;switch(t){case ao:n="Linear";break;case oo:n="Reinhard";break;case so:n="Uncharted2";break;case uo:n="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+t)}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function $e(e,t,n){e=e||{};var i=[e.derivatives||t.envMapCubeUV||t.bumpMap||t.normalMap||t.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(e.fragDepth||t.logarithmicDepthBuffer)&&n.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",e.drawBuffers&&n.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(e.shaderTextureLOD||t.envMap)&&n.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return i.filter(nt).join("\n")}function et(e){var t=[];for(var n in e){var i=e[n];i!==!1&&t.push("#define "+n+" "+i)}return t.join("\n")}function tt(e,t,n){for(var i={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES),a=0;a<r;a++){var o=e.getActiveAttrib(t,a),s=o.name;i[s]=e.getAttribLocation(t,s)}return i}function nt(e){return""!==e}function it(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights)}function rt(e){function t(e,t){var n=Bl[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return rt(n)}var n=/^[ \t]*#include +<([\w\d.]+)>/gm;return e.replace(n,t)}function at(e){function t(e,t,n,i){for(var r="",a=parseInt(t);a<parseInt(n);a++)r+=i.replace(/\[ i \]/g,"[ "+a+" ]");return r}var n=/for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return e.replace(n,t)}function ot(e,t,n,i,r){var a=e.context,o=n.extensions,s=n.defines,u=i.vertexShader,l=i.fragmentShader,c="SHADOWMAP_TYPE_BASIC";r.shadowMapType===ma?c="SHADOWMAP_TYPE_PCF":r.shadowMapType===ga&&(c="SHADOWMAP_TYPE_PCF_SOFT");var h="ENVMAP_TYPE_CUBE",d="ENVMAP_MODE_REFLECTION",f="ENVMAP_BLENDING_MULTIPLY";if(r.envMap){switch(n.envMap.mapping){case co:case ho:h="ENVMAP_TYPE_CUBE";break;case go:case vo:h="ENVMAP_TYPE_CUBE_UV";break;case fo:case po:h="ENVMAP_TYPE_EQUIREC";break;case mo:h="ENVMAP_TYPE_SPHERE"}switch(n.envMap.mapping){case ho:case po:d="ENVMAP_MODE_REFRACTION"}switch(n.combine){case to:f="ENVMAP_BLENDING_MULTIPLY";break;case no:f="ENVMAP_BLENDING_MIX";break;case io:f="ENVMAP_BLENDING_ADD"}}var p,m,g=e.gammaFactor>0?e.gammaFactor:1,v=$e(o,r,e.extensions),y=et(s),_=a.createProgram();n.isRawShaderMaterial?(p=[y,"\n"].filter(nt).join("\n"),m=[v,y,"\n"].filter(nt).join("\n")):(p=["precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+i.name,y,r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+g,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+d:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&r.flatShading===!1?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(nt).join("\n"),m=[v,"precision "+r.precision+" float;","precision "+r.precision+" int;","#define SHADER_NAME "+i.name,y,r.alphaTest?"#define ALPHATEST "+r.alphaTest:"","#define GAMMA_FACTOR "+g,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+h:"",r.envMap?"#define "+d:"",r.envMap?"#define "+f:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexColors?"#define USE_COLOR":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"","#define NUM_CLIPPING_PLANES "+r.numClippingPlanes,"#define UNION_CLIPPING_PLANES "+(r.numClippingPlanes-r.numClipIntersection),r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+c:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&e.extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",r.envMap&&e.extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",r.toneMapping!==ro?"#define TONE_MAPPING":"",r.toneMapping!==ro?Bl.tonemapping_pars_fragment:"",r.toneMapping!==ro?Qe("toneMapping",r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.envMapEncoding||r.emissiveMapEncoding?Bl.encodings_pars_fragment:"",r.mapEncoding?Ze("mapTexelToLinear",r.mapEncoding):"",r.envMapEncoding?Ze("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?Ze("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.outputEncoding?Je("linearToOutputTexel",r.outputEncoding):"",r.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(nt).join("\n")),u=rt(u),u=it(u,r),l=rt(l),l=it(l,r),n.isShaderMaterial||(u=at(u),l=at(l));var x=p+u,b=m+l,w=Ye(a,a.VERTEX_SHADER,x),E=Ye(a,a.FRAGMENT_SHADER,b);a.attachShader(_,w),a.attachShader(_,E),void 0!==n.index0AttributeName?a.bindAttribLocation(_,0,n.index0AttributeName):r.morphTargets===!0&&a.bindAttribLocation(_,0,"position"),a.linkProgram(_);var S=a.getProgramInfoLog(_),M=a.getShaderInfoLog(w),T=a.getShaderInfoLog(E),A=!0,L=!0;a.getProgramParameter(_,a.LINK_STATUS)===!1?(A=!1,console.error("THREE.WebGLProgram: shader error: ",a.getError(),"gl.VALIDATE_STATUS",a.getProgramParameter(_,a.VALIDATE_STATUS),"gl.getProgramInfoLog",S,M,T)):""!==S?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",S):""!==M&&""!==T||(L=!1),L&&(this.diagnostics={runnable:A,material:n,programLog:S,vertexShader:{log:M,prefix:p},fragmentShader:{log:T,prefix:m}}),a.deleteShader(w),a.deleteShader(E);var R;this.getUniforms=function(){return void 0===R&&(R=new V(a,_,e)),R};var C;return this.getAttributes=function(){return void 0===C&&(C=tt(a,_)),C},this.destroy=function(){a.deleteProgram(_),this.program=void 0},Object.defineProperties(this,{uniforms:{get:function(){return console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms()."),this.getUniforms()}},attributes:{get:function(){return console.warn("THREE.WebGLProgram: .attributes is now .getAttributes()."),this.getAttributes()}}}),this.id=Hl++,this.code=t,this.usedTimes=1,this.program=_,this.vertexShader=w,this.fragmentShader=E,this}function st(e,t){function n(e){var n=e.skeleton,i=n.bones;if(t.floatVertexTextures)return 1024;var r=t.maxVertexUniforms,a=Math.floor((r-20)/4),o=Math.min(a,i.length);return o<i.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+i.length+" bones. This GPU supports "+o+"."),0):o}function i(e,t){var n;return e?e.isTexture?n=e.encoding:e.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),n=e.texture.encoding):n=ps,n===ps&&t&&(n=gs),n}var r=[],a={MeshDepthMaterial:"depth",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points"},o=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];this.getParameters=function(r,o,s,u,l,c){var h=a[r.type],d=c.isSkinnedMesh?n(c):0,f=e.getPrecision();null!==r.precision&&(f=t.getMaxPrecision(r.precision),f!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",f,"instead."));var p=e.getRenderTarget(),m={shaderID:h,precision:f,supportsVertexTextures:t.vertexTextures,outputEncoding:i(p?p.texture:null,e.gammaOutput),map:!!r.map,mapEncoding:i(r.map,e.gammaInput),envMap:!!r.envMap,envMapMode:r.envMap&&r.envMap.mapping,envMapEncoding:i(r.envMap,e.gammaInput),envMapCubeUV:!!r.envMap&&(r.envMap.mapping===go||r.envMap.mapping===vo),lightMap:!!r.lightMap,aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:i(r.emissiveMap,e.gammaInput),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,alphaMap:!!r.alphaMap,gradientMap:!!r.gradientMap,combine:r.combine,vertexColors:r.vertexColors,fog:!!s,useFog:r.fog,fogExp:s&&s.isFogExp2,flatShading:r.shading===xa,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:t.logarithmicDepthBuffer,skinning:r.skinning&&d>0,maxBones:d,useVertexTexture:t.floatVertexTextures,morphTargets:r.morphTargets,morphNormals:r.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numClippingPlanes:u,numClipIntersection:l,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.receiveShadow&&o.shadows.length>0,shadowMapType:e.shadowMap.type,toneMapping:e.toneMapping,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,alphaTest:r.alphaTest,doubleSided:r.side===_a,flipSided:r.side===ya,depthPacking:void 0!==r.depthPacking&&r.depthPacking};return m},this.getProgramCode=function(t,n){var i=[];if(n.shaderID?i.push(n.shaderID):(i.push(t.fragmentShader),i.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)i.push(r),i.push(t.defines[r]);for(var a=0;a<o.length;a++)i.push(n[o[a]]);return i.push(t.onBeforeCompile.toString()),i.push(e.gammaOutput),i.join()},this.acquireProgram=function(t,n,i,a){for(var o,s=0,u=r.length;s<u;s++){var l=r[s];if(l.code===a){o=l,++o.usedTimes;break}}return void 0===o&&(o=new ot(e,a,t,n,i),r.push(o)),o},this.releaseProgram=function(e){if(0===--e.usedTimes){var t=r.indexOf(e);r[t]=r[r.length-1],r.pop(),e.destroy()}},this.programs=r}function ut(e,t,n,i,r,a,o){function s(e,t){if(e.width>t||e.height>t){var n=(t/Math.max(e.width,e.height),document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),i=n.getContext("2d");return i.drawImage(e,0,0,e.width,e.height,0,0,n.width,n.height),console.warn("THREE.WebGLRenderer: image is too big ("+e.width+"x"+e.height+"). Resized to "+n.width+"x"+n.height,e),n}return e}function u(e){return Ss.isPowerOfTwo(e.width)&&Ss.isPowerOfTwo(e.height)}function l(e){if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement){var t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),n=t.getContext("2d");return n.drawImage(e,0,0,t.width,t.height),console.warn("THREE.WebGLRenderer: image is not power of two ("+e.width+"x"+e.height+"). Resized to "+t.width+"x"+t.height,e),t}return e}function c(e){return e.wrapS!==_o||e.wrapT!==_o||e.minFilter!==bo&&e.minFilter!==So}function h(e,t){return e.generateMipmaps&&t&&e.minFilter!==bo&&e.minFilter!==So}function d(t){return t===bo||t===wo||t===Eo?e.NEAREST:e.LINEAR}function f(e){var t=e.target;t.removeEventListener("dispose",f),m(t),o.textures--}function p(e){var t=e.target;t.removeEventListener("dispose",p),g(t),o.textures--}function m(t){var n=i.get(t);if(t.image&&n.__image__webglTextureCube)e.deleteTexture(n.__image__webglTextureCube);else{if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture)}i.remove(t)}function g(t){var n=i.get(t),r=i.get(t.texture);if(t){if(void 0!==r.__webglTexture&&e.deleteTexture(r.__webglTexture),t.depthTexture&&t.depthTexture.dispose(),t.isWebGLRenderTargetCube)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer);i.remove(t.texture),i.remove(t)}}function v(t,r){var a=i.get(t);if(t.version>0&&a.__version!==t.version){var o=t.image;if(void 0===o)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",t);else{if(o.complete!==!1)return void b(a,t,r);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",t)}}n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_2D,a.__webglTexture)}function y(t,l){var c=i.get(t);if(6===t.image.length)if(t.version>0&&c.__version!==t.version){c.__image__webglTextureCube||(t.addEventListener("dispose",f),c.__image__webglTextureCube=e.createTexture(),o.textures++),n.activeTexture(e.TEXTURE0+l),n.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t.flipY);for(var d=t&&t.isCompressedTexture,p=t.image[0]&&t.image[0].isDataTexture,m=[],g=0;g<6;g++)d||p?m[g]=p?t.image[g].image:t.image[g]:m[g]=s(t.image[g],r.maxCubemapSize);var v=m[0],y=u(v),_=a(t.format),b=a(t.type);x(e.TEXTURE_CUBE_MAP,t,y);for(var g=0;g<6;g++)if(d)for(var w,E=m[g].mipmaps,S=0,M=E.length;S<M;S++)w=E[S],t.format!==zo&&t.format!==jo?n.getCompressedTextureFormats().indexOf(_)>-1?n.compressedTexImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,S,_,w.width,w.height,0,w.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,S,_,w.width,w.height,0,_,b,w.data);else p?n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,_,m[g].width,m[g].height,0,_,b,m[g].data):n.texImage2D(e.TEXTURE_CUBE_MAP_POSITIVE_X+g,0,_,_,b,m[g]);h(t,y)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),c.__version=t.version,t.onUpdate&&t.onUpdate(t)}else n.activeTexture(e.TEXTURE0+l),n.bindTexture(e.TEXTURE_CUBE_MAP,c.__image__webglTextureCube)}function _(t,r){n.activeTexture(e.TEXTURE0+r),n.bindTexture(e.TEXTURE_CUBE_MAP,i.get(t).__webglTexture)}function x(n,o,s){var u;if(s?(e.texParameteri(n,e.TEXTURE_WRAP_S,a(o.wrapS)),e.texParameteri(n,e.TEXTURE_WRAP_T,a(o.wrapT)),e.texParameteri(n,e.TEXTURE_MAG_FILTER,a(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,a(o.minFilter))):(e.texParameteri(n,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(n,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),o.wrapS===_o&&o.wrapT===_o||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",o),e.texParameteri(n,e.TEXTURE_MAG_FILTER,d(o.magFilter)),e.texParameteri(n,e.TEXTURE_MIN_FILTER,d(o.minFilter)),o.minFilter!==bo&&o.minFilter!==So),u=t.get("EXT_texture_filter_anisotropic")){if(o.type===Oo&&null===t.get("OES_texture_float_linear"))return;if(o.type===ko&&null===t.get("OES_texture_half_float_linear"))return;(o.anisotropy>1||i.get(o).__currentAnisotropy)&&(e.texParameterf(n,u.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(o.anisotropy,r.getMaxAnisotropy())),i.get(o).__currentAnisotropy=o.anisotropy)}}function b(t,i,d){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",f),t.__webglTexture=e.createTexture(),o.textures++),n.activeTexture(e.TEXTURE0+d),n.bindTexture(e.TEXTURE_2D,t.__webglTexture),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,i.flipY),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i.premultiplyAlpha),e.pixelStorei(e.UNPACK_ALIGNMENT,i.unpackAlignment);var p=s(i.image,r.maxTextureSize);c(i)&&u(p)===!1&&(p=l(p));var m=u(p),g=a(i.format),v=a(i.type);x(e.TEXTURE_2D,i,m);var y,_=i.mipmaps;if(i.isDepthTexture){var b=e.DEPTH_COMPONENT;if(i.type===Oo){if(!L)throw new Error("Float Depth Texture only supported in WebGL2.0");b=e.DEPTH_COMPONENT32F}else L&&(b=e.DEPTH_COMPONENT16);i.format===Wo&&b===e.DEPTH_COMPONENT&&i.type!==Co&&i.type!==Io&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),i.type=Co,v=a(i.type)),i.format===qo&&(b=e.DEPTH_STENCIL,i.type!==Bo&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),i.type=Bo,v=a(i.type))),n.texImage2D(e.TEXTURE_2D,0,b,p.width,p.height,0,g,v,null)}else if(i.isDataTexture)if(_.length>0&&m){for(var w=0,E=_.length;w<E;w++)y=_[w],n.texImage2D(e.TEXTURE_2D,w,g,y.width,y.height,0,g,v,y.data);i.generateMipmaps=!1}else n.texImage2D(e.TEXTURE_2D,0,g,p.width,p.height,0,g,v,p.data);else if(i.isCompressedTexture)for(var w=0,E=_.length;w<E;w++)y=_[w],i.format!==zo&&i.format!==jo?n.getCompressedTextureFormats().indexOf(g)>-1?n.compressedTexImage2D(e.TEXTURE_2D,w,g,y.width,y.height,0,y.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(e.TEXTURE_2D,w,g,y.width,y.height,0,g,v,y.data);else if(_.length>0&&m){
for(var w=0,E=_.length;w<E;w++)y=_[w],n.texImage2D(e.TEXTURE_2D,w,g,g,v,y);i.generateMipmaps=!1}else n.texImage2D(e.TEXTURE_2D,0,g,g,v,p);h(i,m)&&e.generateMipmap(e.TEXTURE_2D),t.__version=i.version,i.onUpdate&&i.onUpdate(i)}function w(t,r,o,s){var u=a(r.texture.format),l=a(r.texture.type);n.texImage2D(s,0,u,r.width,r.height,0,u,l,null),e.bindFramebuffer(e.FRAMEBUFFER,t),e.framebufferTexture2D(e.FRAMEBUFFER,o,s,i.get(r.texture).__webglTexture,0),e.bindFramebuffer(e.FRAMEBUFFER,null)}function E(t,n){e.bindRenderbuffer(e.RENDERBUFFER,t),n.depthBuffer&&!n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)):n.depthBuffer&&n.stencilBuffer?(e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,n.width,n.height),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.RENDERBUFFER,t)):e.renderbufferStorage(e.RENDERBUFFER,e.RGBA4,n.width,n.height),e.bindRenderbuffer(e.RENDERBUFFER,null)}function S(t,n){var r=n&&n.isWebGLRenderTargetCube;if(r)throw new Error("Depth Texture with cube render targets is not supported!");if(e.bindFramebuffer(e.FRAMEBUFFER,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),v(n.depthTexture,0);var a=i.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===Wo)e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.TEXTURE_2D,a,0);else{if(n.depthTexture.format!==qo)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(e.FRAMEBUFFER,e.DEPTH_STENCIL_ATTACHMENT,e.TEXTURE_2D,a,0)}}function M(t){var n=i.get(t),r=t.isWebGLRenderTargetCube===!0;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");S(n.__webglFramebuffer,t)}else if(r){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),E(n.__webglDepthbuffer[a],t)}else e.bindFramebuffer(e.FRAMEBUFFER,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),E(n.__webglDepthbuffer,t);e.bindFramebuffer(e.FRAMEBUFFER,null)}function T(t){var r=i.get(t),a=i.get(t.texture);t.addEventListener("dispose",p),a.__webglTexture=e.createTexture(),o.textures++;var s=t.isWebGLRenderTargetCube===!0,l=u(t);if(s){r.__webglFramebuffer=[];for(var c=0;c<6;c++)r.__webglFramebuffer[c]=e.createFramebuffer()}else r.__webglFramebuffer=e.createFramebuffer();if(s){n.bindTexture(e.TEXTURE_CUBE_MAP,a.__webglTexture),x(e.TEXTURE_CUBE_MAP,t.texture,l);for(var c=0;c<6;c++)w(r.__webglFramebuffer[c],t,e.COLOR_ATTACHMENT0,e.TEXTURE_CUBE_MAP_POSITIVE_X+c);h(t.texture,l)&&e.generateMipmap(e.TEXTURE_CUBE_MAP),n.bindTexture(e.TEXTURE_CUBE_MAP,null)}else n.bindTexture(e.TEXTURE_2D,a.__webglTexture),x(e.TEXTURE_2D,t.texture,l),w(r.__webglFramebuffer,t,e.COLOR_ATTACHMENT0,e.TEXTURE_2D),h(t.texture,l)&&e.generateMipmap(e.TEXTURE_2D),n.bindTexture(e.TEXTURE_2D,null);t.depthBuffer&&M(t)}function A(t){var r=t.texture,a=u(t);if(h(r,a)){var o=t.isWebGLRenderTargetCube?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,s=i.get(r).__webglTexture;n.bindTexture(o,s),e.generateMipmap(o),n.bindTexture(o,null)}}var L="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext;this.setTexture2D=v,this.setTextureCube=y,this.setTextureCubeDynamic=_,this.setupRenderTarget=T,this.updateRenderTargetMipmap=A}function lt(){function e(e){var t=e.uuid,n=i[t];return void 0===n&&(n={},i[t]=n),n}function t(e){delete i[e.uuid]}function n(){i={}}var i={};return{get:e,remove:t,clear:n}}function ct(e,t,n){function r(){var t=!1,n=new i,r=null,a=new i;return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,i,r,o,s){s===!0&&(t*=o,i*=o,r*=o),n.set(t,i,r,o),a.equals(n)===!1&&(e.clearColor(t,i,r,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(0,0,0,1)}}}function a(){var t=!1,n=null,i=null,r=null;return{setTest:function(t){t?f(e.DEPTH_TEST):p(e.DEPTH_TEST)},setMask:function(i){n===i||t||(e.depthMask(i),n=i)},setFunc:function(t){if(i!==t){if(t)switch(t){case Xa:e.depthFunc(e.NEVER);break;case Ya:e.depthFunc(e.ALWAYS);break;case Ka:e.depthFunc(e.LESS);break;case Za:e.depthFunc(e.LEQUAL);break;case Ja:e.depthFunc(e.EQUAL);break;case Qa:e.depthFunc(e.GEQUAL);break;case $a:e.depthFunc(e.GREATER);break;case eo:e.depthFunc(e.NOTEQUAL);break;default:e.depthFunc(e.LEQUAL)}else e.depthFunc(e.LEQUAL);i=t}},setLocked:function(e){t=e},setClear:function(t){r!==t&&(e.clearDepth(t),r=t)},reset:function(){t=!1,n=null,i=null,r=null}}}function o(){var t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null;return{setTest:function(t){t?f(e.STENCIL_TEST):p(e.STENCIL_TEST)},setMask:function(i){n===i||t||(e.stencilMask(i),n=i)},setFunc:function(t,n,o){i===t&&r===n&&a===o||(e.stencilFunc(t,n,o),i=t,r=n,a=o)},setOp:function(t,n,i){o===t&&s===n&&u===i||(e.stencilOp(t,n,i),o=t,s=n,u=i)},setLocked:function(e){t=e},setClear:function(t){l!==t&&(e.clearStencil(t),l=t)},reset:function(){t=!1,n=null,i=null,r=null,a=null,o=null,s=null,u=null,l=null}}}function s(t,n,i){var r=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(t,e.TEXTURE_MAG_FILTER,e.NEAREST);for(var o=0;o<i;o++)e.texImage2D(n+o,0,e.RGBA,1,1,0,e.RGBA,e.UNSIGNED_BYTE,r);return a}function u(){P.setClear(0,0,0,1),I.setClear(1),O.setClear(0),f(e.DEPTH_TEST),I.setFunc(Za),y(!1),_(la),f(e.CULL_FACE),f(e.BLEND),g(Ta)}function l(){for(var e=0,t=D.length;e<t;e++)D[e]=0}function c(n){if(D[n]=1,0===N[n]&&(e.enableVertexAttribArray(n),N[n]=1),0!==U[n]){var i=t.get("ANGLE_instanced_arrays");i.vertexAttribDivisorANGLE(n,0),U[n]=0}}function h(n,i){if(D[n]=1,0===N[n]&&(e.enableVertexAttribArray(n),N[n]=1),U[n]!==i){var r=t.get("ANGLE_instanced_arrays");r.vertexAttribDivisorANGLE(n,i),U[n]=i}}function d(){for(var t=0,n=N.length;t!==n;++t)N[t]!==D[t]&&(e.disableVertexAttribArray(t),N[t]=0)}function f(t){B[t]!==!0&&(e.enable(t),B[t]=!0)}function p(t){B[t]!==!1&&(e.disable(t),B[t]=!1)}function m(){if(null===F&&(F=[],t.get("WEBGL_compressed_texture_pvrtc")||t.get("WEBGL_compressed_texture_s3tc")||t.get("WEBGL_compressed_texture_etc1")))for(var n=e.getParameter(e.COMPRESSED_TEXTURE_FORMATS),i=0;i<n.length;i++)F.push(n[i]);return F}function g(t,i,r,a,o,s,u,l){t!==Ma?f(e.BLEND):p(e.BLEND),t===Ca||t===j&&l===X||(t===Aa?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE,e.ONE,e.ONE)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE)):t===La?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.ZERO,e.ONE_MINUS_SRC_COLOR,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.ONE_MINUS_SRC_COLOR)):t===Ra?l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ZERO,e.SRC_COLOR,e.ZERO,e.SRC_ALPHA)):(e.blendEquation(e.FUNC_ADD),e.blendFunc(e.ZERO,e.SRC_COLOR)):l?(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.ONE,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)):(e.blendEquationSeparate(e.FUNC_ADD,e.FUNC_ADD),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA)),j=t,X=l),t===Ca?(o=o||i,s=s||r,u=u||a,i===z&&o===V||(e.blendEquationSeparate(n(i),n(o)),z=i,V=o),r===G&&a===H&&s===W&&u===q||(e.blendFuncSeparate(n(r),n(a),n(s),n(u)),G=r,H=a,W=s,q=u)):(z=null,G=null,H=null,V=null,W=null,q=null)}function v(t){t.side===_a?p(e.CULL_FACE):f(e.CULL_FACE),y(t.side===ya),t.transparent===!0?g(t.blending,t.blendEquation,t.blendSrc,t.blendDst,t.blendEquationAlpha,t.blendSrcAlpha,t.blendDstAlpha,t.premultipliedAlpha):g(Ma),I.setFunc(t.depthFunc),I.setTest(t.depthTest),I.setMask(t.depthWrite),P.setMask(t.colorWrite),b(t.polygonOffset,t.polygonOffsetFactor,t.polygonOffsetUnits)}function y(t){Y!==t&&(t?e.frontFace(e.CW):e.frontFace(e.CCW),Y=t)}function _(t){t!==ua?(f(e.CULL_FACE),t!==K&&(t===la?e.cullFace(e.BACK):t===ca?e.cullFace(e.FRONT):e.cullFace(e.FRONT_AND_BACK))):p(e.CULL_FACE),K=t}function x(t){t!==Z&&(ie&&e.lineWidth(t),Z=t)}function b(t,n,i){t?(f(e.POLYGON_OFFSET_FILL),J===n&&Q===i||(e.polygonOffset(n,i),J=n,Q=i)):p(e.POLYGON_OFFSET_FILL)}function w(){return ee}function E(t){ee=t,t?f(e.SCISSOR_TEST):p(e.SCISSOR_TEST)}function S(t){void 0===t&&(t=e.TEXTURE0+te-1),re!==t&&(e.activeTexture(t),re=t)}function M(t,n){null===re&&S();var i=ae[re];void 0===i&&(i={type:void 0,texture:void 0},ae[re]=i),i.type===t&&i.texture===n||(e.bindTexture(t,n||ue[t]),i.type=t,i.texture=n)}function T(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function A(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}}function L(t){oe.equals(t)===!1&&(e.scissor(t.x,t.y,t.z,t.w),oe.copy(t))}function R(t){se.equals(t)===!1&&(e.viewport(t.x,t.y,t.z,t.w),se.copy(t))}function C(){for(var t=0;t<N.length;t++)1===N[t]&&(e.disableVertexAttribArray(t),N[t]=0);B={},F=null,re=null,ae={},j=null,Y=null,K=null,P.reset(),I.reset(),O.reset()}var P=new r,I=new a,O=new o,k=e.getParameter(e.MAX_VERTEX_ATTRIBS),D=new Uint8Array(k),N=new Uint8Array(k),U=new Uint8Array(k),B={},F=null,j=null,z=null,G=null,H=null,V=null,W=null,q=null,X=!1,Y=null,K=null,Z=null,J=null,Q=null,ee=null,te=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS),ne=parseFloat(/^WebGL\ ([0-9])/.exec(e.getParameter(e.VERSION))[1]),ie=parseFloat(ne)>=1,re=null,ae={},oe=new i,se=new i,ue={};return ue[e.TEXTURE_2D]=s(e.TEXTURE_2D,e.TEXTURE_2D,1),ue[e.TEXTURE_CUBE_MAP]=s(e.TEXTURE_CUBE_MAP,e.TEXTURE_CUBE_MAP_POSITIVE_X,6),{buffers:{color:P,depth:I,stencil:O},init:u,initAttributes:l,enableAttribute:c,enableAttributeAndDivisor:h,disableUnusedAttributes:d,enable:f,disable:p,getCompressedTextureFormats:m,setBlending:g,setMaterial:v,setFlipSided:y,setCullFace:_,setLineWidth:x,setPolygonOffset:b,getScissorTest:w,setScissorTest:E,activeTexture:S,bindTexture:M,compressedTexImage2D:T,texImage2D:A,scissor:L,viewport:R,reset:C}}function ht(e,t,n){function i(){if(void 0!==a)return a;var n=t.get("EXT_texture_filter_anisotropic");return a=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0}function r(t){if("highp"===t){if(e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.HIGH_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.HIGH_FLOAT).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(e.VERTEX_SHADER,e.MEDIUM_FLOAT).precision>0&&e.getShaderPrecisionFormat(e.FRAGMENT_SHADER,e.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}var a,o=void 0!==n.precision?n.precision:"highp",s=r(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=n.logarithmicDepthBuffer===!0&&!!t.get("EXT_frag_depth"),l=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS),c=e.getParameter(e.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=e.getParameter(e.MAX_TEXTURE_SIZE),d=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),f=e.getParameter(e.MAX_VERTEX_ATTRIBS),p=e.getParameter(e.MAX_VERTEX_UNIFORM_VECTORS),m=e.getParameter(e.MAX_VARYING_VECTORS),g=e.getParameter(e.MAX_FRAGMENT_UNIFORM_VECTORS),v=c>0,y=!!t.get("OES_texture_float"),_=v&&y;return{getMaxAnisotropy:i,getMaxPrecision:r,precision:o,logarithmicDepthBuffer:u,maxTextures:l,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:d,maxAttributes:f,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:v,floatFragmentTextures:y,floatVertexTextures:_}}function dt(e){he.call(this),this.cameras=e||[]}function ft(e){function t(){if(r.isPresenting){var t=r.getEyeParameters("left"),i=t.renderWidth,a=t.renderHeight;p=e.getPixelRatio(),f=e.getSize(),e.setDrawingBufferSize(2*i,a,1)}else n.enabled&&e.setDrawingBufferSize(f.width,f.height,p)}var n=this,r=null,a=null;"VRFrameData"in window&&(a=new window.VRFrameData);var o=new u,s=new u,l=new u,c=new he;c.bounds=new i(0,0,.5,1),c.layers.enable(1);var h=new he;h.bounds=new i(.5,0,.5,1),h.layers.enable(2);var d=new dt([c,h]);d.layers.enable(1),d.layers.enable(2);var f,p;window.addEventListener("vrdisplaypresentchange",t,!1),this.enabled=!1,this.standing=!1,this.getDevice=function(){return r},this.setDevice=function(e){void 0!==e&&(r=e)},this.getCamera=function(e){if(null===r)return e;r.depthNear=e.near,r.depthFar=e.far,r.getFrameData(a);var t=a.pose;null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),null!==t.orientation&&e.quaternion.fromArray(t.orientation),e.updateMatrixWorld();var n=r.stageParameters;if(this.standing&&n&&(s.fromArray(n.sittingToStandingTransform),l.getInverse(s),e.matrixWorld.multiply(s),e.matrixWorldInverse.multiply(l)),r.isPresenting===!1)return e;d.matrixWorld.copy(e.matrixWorld),d.matrixWorldInverse.copy(e.matrixWorldInverse),c.matrixWorldInverse.fromArray(a.leftViewMatrix),h.matrixWorldInverse.fromArray(a.rightViewMatrix),this.standing&&n&&(c.matrixWorldInverse.multiply(l),h.matrixWorldInverse.multiply(l));var i=e.parent;null!==i&&(o.getInverse(i.matrixWorld),c.matrixWorldInverse.multiply(o),h.matrixWorldInverse.multiply(o)),c.matrixWorld.getInverse(c.matrixWorldInverse),h.matrixWorld.getInverse(h.matrixWorldInverse),c.projectionMatrix.fromArray(a.leftProjectionMatrix),h.projectionMatrix.fromArray(a.rightProjectionMatrix),d.projectionMatrix.copy(c.projectionMatrix);var u=r.getLayers();if(u.length){var f=u[0];null!==f.leftBounds&&4===f.leftBounds.length&&c.bounds.fromArray(f.leftBounds),null!==f.rightBounds&&4===f.rightBounds.length&&h.bounds.fromArray(f.rightBounds)}return d},this.getStandingMatrix=function(){return s},this.submitFrame=function(){r&&r.isPresenting&&r.submitFrame()}}function pt(e){var t={};return{get:function(n){if(void 0!==t[n])return t[n];var i;switch(n){case"WEBGL_depth_texture":i=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":i=e.getExtension("WEBGL_compressed_texture_etc1");break;default:i=e.getExtension(n)}return null===i&&console.warn("THREE.WebGLRenderer: "+n+" extension not supported."),t[n]=i,i}}}function mt(){function e(){l.value!==i&&(l.value=i,l.needsUpdate=r>0),n.numPlanes=r,n.numIntersection=0}function t(e,t,i,r){var a=null!==e?e.length:0,o=null;if(0!==a){if(o=l.value,r!==!0||null===o){var c=i+4*a,h=t.matrixWorldInverse;u.getNormalMatrix(h),(null===o||o.length<c)&&(o=new Float32Array(c));for(var d=0,f=i;d!==a;++d,f+=4)s.copy(e[d]).applyMatrix4(h,u),s.normal.toArray(o,f),o[f+3]=s.constant}l.value=o,l.needsUpdate=!0}return n.numPlanes=a,o}var n=this,i=null,r=0,a=!1,o=!1,s=new ne,u=new te,l={value:null,needsUpdate:!1};this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,n,o){var s=0!==e.length||n||0!==r||a;return a=n,i=t(e,o,0),r=e.length,s},this.beginShadows=function(){o=!0,t(null)},this.endShadows=function(){o=!1,e()},this.setState=function(n,s,u,c,h,d){if(!a||null===n||0===n.length||o&&!u)o?t(null):e();else{var f=o?0:r,p=4*f,m=h.clippingState||null;l.value=m,m=t(n,c,p,d);for(var g=0;g!==p;++g)m[g]=i[g];h.clippingState=m,this.numIntersection=s?this.numPlanes:0,this.numPlanes+=f}}}function gt(e){function t(){return null===te?ge:1}function n(){Be.init(),Be.scissor(ce.copy(ve).multiplyScalar(ge)),Be.viewport(de.copy(_e).multiplyScalar(ge))}function r(){ee=null,ue=null,se="",oe=-1,Be.reset()}function a(e){e.preventDefault(),r(),n(),Fe.clear(),Ke.clear()}function o(e){var t=e.target;t.removeEventListener("dispose",o),c(t)}function c(e){h(e),Fe.remove(e)}function h(e){var t=Fe.get(e).program;e.program=void 0,void 0!==t&&Ze.releaseProgram(t)}function d(e,t,n){e.render(function(e){Q.renderBufferImmediate(e,t,n)})}function f(e,t){return Math.abs(t[0])-Math.abs(e[0])}function p(e,t,n,i){if(n&&n.isInstancedBufferGeometry&&null===De.get("ANGLE_instanced_arrays"))return void console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");void 0===i&&(i=0),Be.initAttributes();var r=n.attributes,a=t.getAttributes(),o=e.defaultAttributeValues;for(var s in a){var u=a[s];if(u>=0){var l=r[s];if(void 0!==l){var c=l.normalized,h=l.itemSize,d=Xe.get(l),f=d.buffer,p=d.type,m=d.bytesPerElement;if(l.isInterleavedBufferAttribute){var g=l.data,v=g.stride,y=l.offset;g&&g.isInstancedInterleavedBuffer?(Be.enableAttributeAndDivisor(u,g.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=g.meshPerAttribute*g.count)):Be.enableAttribute(u),Ie.bindBuffer(Ie.ARRAY_BUFFER,f),Ie.vertexAttribPointer(u,h,p,c,v*m,(i*v+y)*m)}else l.isInstancedBufferAttribute?(Be.enableAttributeAndDivisor(u,l.meshPerAttribute),void 0===n.maxInstancedCount&&(n.maxInstancedCount=l.meshPerAttribute*l.count)):Be.enableAttribute(u),Ie.bindBuffer(Ie.ARRAY_BUFFER,f),Ie.vertexAttribPointer(u,h,p,c,0,i*h*m)}else if(void 0!==o){var _=o[s];if(void 0!==_)switch(_.length){case 2:Ie.vertexAttrib2fv(u,_);break;case 3:Ie.vertexAttrib3fv(u,_);break;case 4:Ie.vertexAttrib4fv(u,_);break;default:Ie.vertexAttrib1fv(u,_)}}}}Be.disableUnusedAttributes()}function m(e,t,n){if(e.visible){var i=e.layers.test(t.layers);if(i)if(e.isLight)W.push(e);else if(e.isSprite)e.frustumCulled&&!xe.intersectsSprite(e)||Z.push(e);else if(e.isLensFlare)J.push(e);else if(e.isImmediateRenderObject)n&&Me.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se),q.push(e,null,e.material,Me.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.update(),!e.frustumCulled||xe.intersectsObject(e))){n&&Me.setFromMatrixPosition(e.matrixWorld).applyMatrix4(Se);var r=Ke.update(e),a=e.material;if(Array.isArray(a))for(var o=r.groups,s=0,u=o.length;s<u;s++){var l=o[s],c=a[l.materialIndex];c&&c.visible&&q.push(e,r,c,Me.z,l)}else a.visible&&q.push(e,r,a,Me.z,null)}for(var h=e.children,s=0,u=h.length;s<u;s++)m(h[s],t,n)}}function g(e,t,n,i){for(var r=0,a=e.length;r<a;r++){var o=e[r],s=o.object,u=o.geometry,l=void 0===i?o.material:i,c=o.group;if(n.isArrayCamera){le=n;for(var h=n.cameras,d=0,f=h.length;d<f;d++){var p=h[d];if(s.layers.test(p.layers)){var m=p.bounds,g=m.x*pe,y=m.y*me,_=m.z*pe,x=m.w*me;Q.setViewport(g,y,_,x),Q.setScissor(g,y,_,x),Q.setScissorTest(!0),v(s,t,p,u,l,c)}}}else le=null,v(s,t,n,u,l,c)}}function v(e,t,n,i,r,a){if(e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.onBeforeRender(Q,t,n,i,r,a),e.isImmediateRenderObject){Be.setMaterial(r);var o=_(n,t.fog,r,e);se="",d(e,o,r)}else Q.renderBufferDirect(n,t.fog,i,r,e,a);e.onAfterRender(Q,t,n,i,r,a)}function y(e,t,n){var i=Fe.get(e),r=Ze.getParameters(e,Re,t,be.numPlanes,be.numIntersection,n),a=Ze.getProgramCode(e,r),s=i.program,u=!0;if(void 0===s)e.addEventListener("dispose",o);else if(s.code!==a)h(e);else{if(void 0!==r.shaderID)return;u=!1}if(u){if(r.shaderID){var l=Fl[r.shaderID];i.shader={name:e.type,uniforms:Ds.clone(l.uniforms),vertexShader:l.vertexShader,fragmentShader:l.fragmentShader}}else i.shader={name:e.type,uniforms:e.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader};e.onBeforeCompile(i.shader),s=Ze.acquireProgram(e,i.shader,r,a),i.program=s,e.program=s}var c=s.getAttributes();if(e.morphTargets){e.numSupportedMorphTargets=0;for(var d=0;d<Q.maxMorphTargets;d++)c["morphTarget"+d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;for(var d=0;d<Q.maxMorphNormals;d++)c["morphNormal"+d]>=0&&e.numSupportedMorphNormals++}var f=i.shader.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&e.clipping!==!0||(i.numClippingPlanes=be.numPlanes,i.numIntersection=be.numIntersection,f.clippingPlanes=be.uniform),i.fog=t,i.lightsHash=Re.hash,e.lights&&(f.ambientLightColor.value=Re.ambient,f.directionalLights.value=Re.directional,f.spotLights.value=Re.spot,f.rectAreaLights.value=Re.rectArea,f.pointLights.value=Re.point,f.hemisphereLights.value=Re.hemi,f.directionalShadowMap.value=Re.directionalShadowMap,f.directionalShadowMatrix.value=Re.directionalShadowMatrix,f.spotShadowMap.value=Re.spotShadowMap,f.spotShadowMatrix.value=Re.spotShadowMatrix,f.pointShadowMap.value=Re.pointShadowMap,f.pointShadowMatrix.value=Re.pointShadowMatrix);var p=i.program.getUniforms(),m=V.seqWithValue(p.seq,f);i.uniformsList=m}function _(e,t,n,i){fe=0;var r=Fe.get(n);if(we&&(Ee||e!==ue)){var a=e===ue&&n.id===oe;be.setState(n.clippingPlanes,n.clipIntersection,n.clipShadows,e,r,a)}n.needsUpdate===!1&&(void 0===r.program?n.needsUpdate=!0:n.fog&&r.fog!==t?n.needsUpdate=!0:n.lights&&r.lightsHash!==Re.hash?n.needsUpdate=!0:void 0===r.numClippingPlanes||r.numClippingPlanes===be.numPlanes&&r.numIntersection===be.numIntersection||(n.needsUpdate=!0)),n.needsUpdate&&(y(n,t,i),n.needsUpdate=!1);var o=!1,s=!1,u=!1,c=r.program,h=c.getUniforms(),d=r.shader.uniforms;if(c.id!==ee&&(Ie.useProgram(c.program),ee=c.id,o=!0,s=!0,u=!0),n.id!==oe&&(oe=n.id,s=!0),o||e!==ue){if(h.setValue(Ie,"projectionMatrix",e.projectionMatrix),Ne.logarithmicDepthBuffer&&h.setValue(Ie,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),ue!==(le||e)&&(ue=le||e,s=!0,u=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.envMap){var f=h.map.cameraPosition;void 0!==f&&f.setValue(Ie,Me.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.skinning)&&h.setValue(Ie,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){h.setOptional(Ie,i,"bindMatrix"),h.setOptional(Ie,i,"bindMatrixInverse");var p=i.skeleton;if(p){var m=p.bones;if(Ne.floatVertexTextures){if(void 0===p.boneTexture){var g=Math.sqrt(4*m.length);g=Ss.nextPowerOfTwo(Math.ceil(g)),g=Math.max(g,4);var v=new Float32Array(g*g*4);v.set(p.boneMatrices);var _=new l(v,g,g,zo,Oo);p.boneMatrices=v,p.boneTexture=_,p.boneTextureSize=g}h.setValue(Ie,"boneTexture",p.boneTexture),h.setValue(Ie,"boneTextureSize",p.boneTextureSize)}else h.setOptional(Ie,p,"boneMatrices")}}return s&&(h.setValue(Ie,"toneMappingExposure",Q.toneMappingExposure),h.setValue(Ie,"toneMappingWhitePoint",Q.toneMappingWhitePoint),n.lights&&P(d,u),t&&n.fog&&S(d,t),(n.isMeshBasicMaterial||n.isMeshLambertMaterial||n.isMeshPhongMaterial||n.isMeshStandardMaterial||n.isMeshNormalMaterial||n.isMeshDepthMaterial)&&x(d,n),n.isLineBasicMaterial?b(d,n):n.isLineDashedMaterial?(b(d,n),w(d,n)):n.isPointsMaterial?E(d,n):n.isMeshLambertMaterial?M(d,n):n.isMeshToonMaterial?A(d,n):n.isMeshPhongMaterial?T(d,n):n.isMeshPhysicalMaterial?R(d,n):n.isMeshStandardMaterial?L(d,n):n.isMeshDepthMaterial?n.displacementMap&&(d.displacementMap.value=n.displacementMap,d.displacementScale.value=n.displacementScale,d.displacementBias.value=n.displacementBias):n.isMeshNormalMaterial&&C(d,n),void 0!==d.ltcMat&&(d.ltcMat.value=ks.LTC_MAT_TEXTURE),void 0!==d.ltcMag&&(d.ltcMag.value=ks.LTC_MAG_TEXTURE),V.upload(Ie,r.uniformsList,d,Q)),h.setValue(Ie,"modelViewMatrix",i.modelViewMatrix),h.setValue(Ie,"normalMatrix",i.normalMatrix),h.setValue(Ie,"modelMatrix",i.matrixWorld),c}function x(e,t){e.opacity.value=t.opacity,e.diffuse.value=t.color,t.emissive&&e.emissive.value.copy(t.emissive).multiplyScalar(t.emissiveIntensity),e.map.value=t.map,e.specularMap.value=t.specularMap,e.alphaMap.value=t.alphaMap,t.lightMap&&(e.lightMap.value=t.lightMap,e.lightMapIntensity.value=t.lightMapIntensity),t.aoMap&&(e.aoMap.value=t.aoMap,e.aoMapIntensity.value=t.aoMapIntensity);var n;if(t.map?n=t.map:t.specularMap?n=t.specularMap:t.displacementMap?n=t.displacementMap:t.normalMap?n=t.normalMap:t.bumpMap?n=t.bumpMap:t.roughnessMap?n=t.roughnessMap:t.metalnessMap?n=t.metalnessMap:t.alphaMap?n=t.alphaMap:t.emissiveMap&&(n=t.emissiveMap),void 0!==n){n.isWebGLRenderTarget&&(n=n.texture);var i=n.offset,r=n.repeat;e.offsetRepeat.value.set(i.x,i.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap&&t.envMap.isCubeTexture?-1:1,e.reflectivity.value=t.reflectivity,e.refractionRatio.value=t.refractionRatio}function b(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function w(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function E(e,t){if(e.diffuse.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size*ge,e.scale.value=.5*me,e.map.value=t.map,null!==t.map){var n=t.map.offset,i=t.map.repeat;e.offsetRepeat.value.set(n.x,n.y,i.x,i.y)}}function S(e,t){e.fogColor.value=t.color,t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)}function M(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}function T(e,t){e.specular.value=t.specular,e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function A(e,t){T(e,t),t.gradientMap&&(e.gradientMap.value=t.gradientMap)}function L(e,t){e.roughness.value=t.roughness,e.metalness.value=t.metalness,t.roughnessMap&&(e.roughnessMap.value=t.roughnessMap),t.metalnessMap&&(e.metalnessMap.value=t.metalnessMap),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap),t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias),t.envMap&&(e.envMapIntensity.value=t.envMapIntensity)}function R(e,t){e.clearCoat.value=t.clearCoat,e.clearCoatRoughness.value=t.clearCoatRoughness,L(e,t)}function C(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale)),t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}function P(e,t){e.ambientLightColor.needsUpdate=t,e.directionalLights.needsUpdate=t,e.pointLights.needsUpdate=t,e.spotLights.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function I(e){for(var t=0,n=0,i=e.length;n<i;n++){var r=e[n];r.castShadow&&(Re.shadows[t]=r,t++)}Re.shadows.length=t}function O(e,t){var n,i,r,a,o,s,u,l,c=0,h=0,d=0,f=t.matrixWorldInverse,p=0,m=0,g=0,v=0,y=0;for(n=0,i=e.length;n<i;n++)if(r=e[n],o=r.color,s=r.intensity,u=r.distance,l=r.shadow&&r.shadow.map?r.shadow.map.texture:null,r.isAmbientLight)c+=o.r*s,h+=o.g*s,d+=o.b*s;else if(r.isDirectionalLight){var _=Je.get(r);_.color.copy(r.color).multiplyScalar(r.intensity),_.direction.setFromMatrixPosition(r.matrixWorld),Me.setFromMatrixPosition(r.target.matrixWorld),_.direction.sub(Me),_.direction.transformDirection(f),_.shadow=r.castShadow,r.castShadow&&(a=r.shadow,_.shadowBias=a.bias,_.shadowRadius=a.radius,_.shadowMapSize=a.mapSize),Re.directionalShadowMap[p]=l,Re.directionalShadowMatrix[p]=r.shadow.matrix,Re.directional[p]=_,p++}else if(r.isSpotLight){var _=Je.get(r);_.position.setFromMatrixPosition(r.matrixWorld),_.position.applyMatrix4(f),_.color.copy(o).multiplyScalar(s),_.distance=u,_.direction.setFromMatrixPosition(r.matrixWorld),Me.setFromMatrixPosition(r.target.matrixWorld),_.direction.sub(Me),_.direction.transformDirection(f),_.coneCos=Math.cos(r.angle),_.penumbraCos=Math.cos(r.angle*(1-r.penumbra)),_.decay=0===r.distance?0:r.decay,_.shadow=r.castShadow,r.castShadow&&(a=r.shadow,_.shadowBias=a.bias,_.shadowRadius=a.radius,_.shadowMapSize=a.mapSize),Re.spotShadowMap[g]=l,Re.spotShadowMatrix[g]=r.shadow.matrix,Re.spot[g]=_,g++}else if(r.isRectAreaLight){var _=Je.get(r);_.color.copy(o).multiplyScalar(s/(r.width*r.height)),_.position.setFromMatrixPosition(r.matrixWorld),_.position.applyMatrix4(f),Le.identity(),Te.copy(r.matrixWorld),Te.premultiply(f),Le.extractRotation(Te),_.halfWidth.set(.5*r.width,0,0),_.halfHeight.set(0,.5*r.height,0),_.halfWidth.applyMatrix4(Le),_.halfHeight.applyMatrix4(Le),Re.rectArea[v]=_,v++}else if(r.isPointLight){var _=Je.get(r);_.position.setFromMatrixPosition(r.matrixWorld),_.position.applyMatrix4(f),_.color.copy(r.color).multiplyScalar(r.intensity),_.distance=r.distance,_.decay=0===r.distance?0:r.decay,_.shadow=r.castShadow,r.castShadow&&(a=r.shadow,_.shadowBias=a.bias,_.shadowRadius=a.radius,_.shadowMapSize=a.mapSize),Re.pointShadowMap[m]=l,Re.pointShadowMatrix[m]=r.shadow.matrix,Re.point[m]=_,m++}else if(r.isHemisphereLight){var _=Je.get(r);_.direction.setFromMatrixPosition(r.matrixWorld),_.direction.transformDirection(f),_.direction.normalize(),_.skyColor.copy(r.color).multiplyScalar(s),_.groundColor.copy(r.groundColor).multiplyScalar(s),Re.hemi[y]=_,y++}Re.ambient[0]=c,Re.ambient[1]=h,Re.ambient[2]=d,Re.directional.length=p,Re.spot.length=g,Re.rectArea.length=v,Re.point.length=m,Re.hemi.length=y,Re.hash=p+","+m+","+g+","+v+","+y+","+Re.shadows.length}function k(){var e=fe;return e>=Ne.maxTextures&&console.warn("THREE.WebGLRenderer: Trying to use "+e+" texture units while this GPU supports only "+Ne.maxTextures),fe+=1,e}function D(e){var t;if(e===yo)return Ie.REPEAT;if(e===_o)return Ie.CLAMP_TO_EDGE;if(e===xo)return Ie.MIRRORED_REPEAT;if(e===bo)return Ie.NEAREST;if(e===wo)return Ie.NEAREST_MIPMAP_NEAREST;if(e===Eo)return Ie.NEAREST_MIPMAP_LINEAR;if(e===So)return Ie.LINEAR;if(e===Mo)return Ie.LINEAR_MIPMAP_NEAREST;if(e===To)return Ie.LINEAR_MIPMAP_LINEAR;if(e===Ao)return Ie.UNSIGNED_BYTE;if(e===Do)return Ie.UNSIGNED_SHORT_4_4_4_4;if(e===No)return Ie.UNSIGNED_SHORT_5_5_5_1;if(e===Uo)return Ie.UNSIGNED_SHORT_5_6_5;if(e===Lo)return Ie.BYTE;if(e===Ro)return Ie.SHORT;if(e===Co)return Ie.UNSIGNED_SHORT;if(e===Po)return Ie.INT;if(e===Io)return Ie.UNSIGNED_INT;if(e===Oo)return Ie.FLOAT;if(e===ko&&(t=De.get("OES_texture_half_float"),null!==t))return t.HALF_FLOAT_OES;if(e===Fo)return Ie.ALPHA;if(e===jo)return Ie.RGB;if(e===zo)return Ie.RGBA;if(e===Go)return Ie.LUMINANCE;if(e===Ho)return Ie.LUMINANCE_ALPHA;if(e===Wo)return Ie.DEPTH_COMPONENT;if(e===qo)return Ie.DEPTH_STENCIL;if(e===Pa)return Ie.FUNC_ADD;if(e===Ia)return Ie.FUNC_SUBTRACT;if(e===Oa)return Ie.FUNC_REVERSE_SUBTRACT;if(e===Na)return Ie.ZERO;if(e===Ua)return Ie.ONE;if(e===Ba)return Ie.SRC_COLOR;if(e===Fa)return Ie.ONE_MINUS_SRC_COLOR;if(e===ja)return Ie.SRC_ALPHA;if(e===za)return Ie.ONE_MINUS_SRC_ALPHA;if(e===Ga)return Ie.DST_ALPHA;if(e===Ha)return Ie.ONE_MINUS_DST_ALPHA;if(e===Va)return Ie.DST_COLOR;if(e===Wa)return Ie.ONE_MINUS_DST_COLOR;if(e===qa)return Ie.SRC_ALPHA_SATURATE;if((e===Xo||e===Yo||e===Ko||e===Zo)&&(t=De.get("WEBGL_compressed_texture_s3tc"),null!==t)){if(e===Xo)return t.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Yo)return t.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Ko)return t.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Zo)return t.COMPRESSED_RGBA_S3TC_DXT5_EXT}if((e===Jo||e===Qo||e===$o||e===es)&&(t=De.get("WEBGL_compressed_texture_pvrtc"),null!==t)){if(e===Jo)return t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Qo)return t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===$o)return t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===es)return t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===ts&&(t=De.get("WEBGL_compressed_texture_etc1"),
null!==t))return t.COMPRESSED_RGB_ETC1_WEBGL;if((e===ka||e===Da)&&(t=De.get("EXT_blend_minmax"),null!==t)){if(e===ka)return t.MIN_EXT;if(e===Da)return t.MAX_EXT}return e===Bo&&(t=De.get("WEBGL_depth_texture"),null!==t)?t.UNSIGNED_INT_24_8_WEBGL:0}console.log("THREE.WebGLRenderer",oa),e=e||{};var N=void 0!==e.canvas?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),U=void 0!==e.context?e.context:null,B=void 0!==e.alpha&&e.alpha,F=void 0===e.depth||e.depth,j=void 0===e.stencil||e.stencil,z=void 0!==e.antialias&&e.antialias,G=void 0===e.premultipliedAlpha||e.premultipliedAlpha,H=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,W=[],q=null,K=new Float32Array(8),Z=[],J=[];this.domElement=N,this.context=null,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyCorrectLights=!1,this.toneMapping=ao,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var Q=this,ee=null,te=null,ne=null,oe=-1,se="",ue=null,le=null,ce=new i,he=null,de=new i,fe=0,pe=N.width,me=N.height,ge=1,ve=new i(0,0,pe,me),ye=!1,_e=new i(0,0,pe,me),xe=new ie,be=new mt,we=!1,Ee=!1,Se=new u,Me=new s,Te=new u,Le=new u,Re={hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],shadows:[]},Ce={geometries:0,textures:0},Pe={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:Pe,memory:Ce,programs:null};var Ie;try{var Oe={alpha:B,depth:F,stencil:j,antialias:z,premultipliedAlpha:G,preserveDrawingBuffer:H};if(Ie=U||N.getContext("webgl",Oe)||N.getContext("experimental-webgl",Oe),null===Ie)throw null!==N.getContext("webgl")?"Error creating WebGL context with your selected attributes.":"Error creating WebGL context.";void 0===Ie.getShaderPrecisionFormat&&(Ie.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}),N.addEventListener("webglcontextlost",a,!1)}catch(ke){console.error("THREE.WebGLRenderer: "+ke)}var De=new pt(Ie);De.get("WEBGL_depth_texture"),De.get("OES_texture_float"),De.get("OES_texture_float_linear"),De.get("OES_texture_half_float"),De.get("OES_texture_half_float_linear"),De.get("OES_standard_derivatives"),De.get("ANGLE_instanced_arrays"),De.get("OES_element_index_uint")&&(Ae.MaxIndex=4294967296);var Ne=new ht(Ie,De,e),Be=new ct(Ie,De,D),Fe=new lt,je=new ut(Ie,De,Be,Fe,Ne,D,Ce),Xe=new ae(Ie),Ye=new Ve(Ie,Xe,Ce),Ke=new qe(Ie,Ye,Pe),Ze=new st(this,Ne),Je=new We,Qe=new ze,$e=new Ue(this,Be,Ke,G),et=new ft(this);this.info.programs=Ze.programs;var tt=new He(Ie,De,Pe),nt=new Ge(Ie,De,Pe);n(),this.context=Ie,this.capabilities=Ne,this.extensions=De,this.properties=Fe,this.renderLists=Qe,this.state=Be,this.vr=et;var it=new re(this,Re,Ke,Ne);this.shadowMap=it;var rt=new Y(this,Z),at=new X(this,J);this.getContext=function(){return Ie},this.getContextAttributes=function(){return Ie.getContextAttributes()},this.forceContextLoss=function(){var e=De.get("WEBGL_lose_context");e&&e.loseContext()},this.getMaxAnisotropy=function(){return Ne.getMaxAnisotropy()},this.getPrecision=function(){return Ne.precision},this.getPixelRatio=function(){return ge},this.setPixelRatio=function(e){void 0!==e&&(ge=e,this.setSize(pe,me,!1))},this.getSize=function(){return{width:pe,height:me}},this.setSize=function(e,t,n){et.getDevice();pe=e,me=t,N.width=e*ge,N.height=t*ge,n!==!1&&(N.style.width=e+"px",N.style.height=t+"px"),this.setViewport(0,0,e,t)},this.getDrawingBufferSize=function(){return{width:pe*ge,height:me*ge}},this.setDrawingBufferSize=function(e,t,n){pe=e,me=t,ge=n,N.width=e*n,N.height=t*n,this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,i){_e.set(e,me-t-i,n,i),Be.viewport(de.copy(_e).multiplyScalar(ge))},this.setScissor=function(e,t,n,i){ve.set(e,me-t-i,n,i),Be.scissor(ce.copy(ve).multiplyScalar(ge))},this.setScissorTest=function(e){Be.setScissorTest(ye=e)},this.getClearColor=$e.getClearColor,this.setClearColor=$e.setClearColor,this.getClearAlpha=$e.getClearAlpha,this.setClearAlpha=$e.setClearAlpha,this.clear=function(e,t,n){var i=0;(void 0===e||e)&&(i|=Ie.COLOR_BUFFER_BIT),(void 0===t||t)&&(i|=Ie.DEPTH_BUFFER_BIT),(void 0===n||n)&&(i|=Ie.STENCIL_BUFFER_BIT),Ie.clear(i)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.clearTarget=function(e,t,n,i){this.setRenderTarget(e),this.clear(t,n,i)},this.resetGLState=r,this.dispose=function(){N.removeEventListener("webglcontextlost",a,!1),Qe.dispose()},this.renderBufferImmediate=function(e,t,n){Be.initAttributes();var i=Fe.get(e);e.hasPositions&&!i.position&&(i.position=Ie.createBuffer()),e.hasNormals&&!i.normal&&(i.normal=Ie.createBuffer()),e.hasUvs&&!i.uv&&(i.uv=Ie.createBuffer()),e.hasColors&&!i.color&&(i.color=Ie.createBuffer());var r=t.getAttributes();if(e.hasPositions&&(Ie.bindBuffer(Ie.ARRAY_BUFFER,i.position),Ie.bufferData(Ie.ARRAY_BUFFER,e.positionArray,Ie.DYNAMIC_DRAW),Be.enableAttribute(r.position),Ie.vertexAttribPointer(r.position,3,Ie.FLOAT,!1,0,0)),e.hasNormals){if(Ie.bindBuffer(Ie.ARRAY_BUFFER,i.normal),!n.isMeshPhongMaterial&&!n.isMeshStandardMaterial&&!n.isMeshNormalMaterial&&n.shading===xa)for(var a=0,o=3*e.count;a<o;a+=9){var s=e.normalArray,u=(s[a+0]+s[a+3]+s[a+6])/3,l=(s[a+1]+s[a+4]+s[a+7])/3,c=(s[a+2]+s[a+5]+s[a+8])/3;s[a+0]=u,s[a+1]=l,s[a+2]=c,s[a+3]=u,s[a+4]=l,s[a+5]=c,s[a+6]=u,s[a+7]=l,s[a+8]=c}Ie.bufferData(Ie.ARRAY_BUFFER,e.normalArray,Ie.DYNAMIC_DRAW),Be.enableAttribute(r.normal),Ie.vertexAttribPointer(r.normal,3,Ie.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(Ie.bindBuffer(Ie.ARRAY_BUFFER,i.uv),Ie.bufferData(Ie.ARRAY_BUFFER,e.uvArray,Ie.DYNAMIC_DRAW),Be.enableAttribute(r.uv),Ie.vertexAttribPointer(Xe.uv,2,Ie.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==wa&&(Ie.bindBuffer(Ie.ARRAY_BUFFER,i.color),Ie.bufferData(Ie.ARRAY_BUFFER,e.colorArray,Ie.DYNAMIC_DRAW),Be.enableAttribute(r.color),Ie.vertexAttribPointer(r.color,3,Ie.FLOAT,!1,0,0)),Be.disableUnusedAttributes(),Ie.drawArrays(Ie.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,n,i,r,a,o){Be.setMaterial(r);var s=_(e,n,r,a),u=i.id+"_"+s.id+"_"+(r.wireframe===!0),l=!1;u!==se&&(se=u,l=!0);var c=a.morphTargetInfluences;if(void 0!==c){for(var h=[],d=0,m=c.length;d<m;d++){var g=c[d];h.push([g,d])}h.sort(f),h.length>8&&(h.length=8);for(var v=i.morphAttributes,d=0,m=h.length;d<m;d++){var g=h[d];if(K[d]=g[0],0!==g[0]){var y=g[1];r.morphTargets===!0&&v.position&&i.addAttribute("morphTarget"+d,v.position[y]),r.morphNormals===!0&&v.normal&&i.addAttribute("morphNormal"+d,v.normal[y])}else r.morphTargets===!0&&i.removeAttribute("morphTarget"+d),r.morphNormals===!0&&i.removeAttribute("morphNormal"+d)}for(var d=h.length,x=K.length;d<x;d++)K[d]=0;s.getUniforms().setValue(Ie,"morphTargetInfluences",K),l=!0}var y=i.index,b=i.attributes.position,w=1;r.wireframe===!0&&(y=Ye.getWireframeAttribute(i),w=2);var E,S=tt;null!==y&&(E=Xe.get(y),S=nt,S.setIndex(E)),l&&(p(r,s,i),null!==y&&Ie.bindBuffer(Ie.ELEMENT_ARRAY_BUFFER,E.buffer));var M=0;null!==y?M=y.count:void 0!==b&&(M=b.count);var T=i.drawRange.start*w,A=i.drawRange.count*w,L=null!==o?o.start*w:0,R=null!==o?o.count*w:1/0,C=Math.max(T,L),P=Math.min(M,T+A,L+R)-1,I=Math.max(0,P-C+1);if(0!==I){if(a.isMesh)if(r.wireframe===!0)Be.setLineWidth(r.wireframeLinewidth*t()),S.setMode(Ie.LINES);else switch(a.drawMode){case hs:S.setMode(Ie.TRIANGLES);break;case ds:S.setMode(Ie.TRIANGLE_STRIP);break;case fs:S.setMode(Ie.TRIANGLE_FAN)}else if(a.isLine){var O=r.linewidth;void 0===O&&(O=1),Be.setLineWidth(O*t()),a.isLineSegments?S.setMode(Ie.LINES):a.isLineLoop?S.setMode(Ie.LINE_LOOP):S.setMode(Ie.LINE_STRIP)}else a.isPoints&&S.setMode(Ie.POINTS);i&&i.isInstancedBufferGeometry?i.maxInstancedCount>0&&S.renderInstances(i,C,I):S.render(C,I)}},this.compile=function(e,t){W=[],e.traverse(function(e){e.isLight&&W.push(e)}),O(W,t),e.traverse(function(t){if(t.material)if(Array.isArray(t.material))for(var n=0;n<t.material.length;n++)y(t.material[n],e.fog,t);else y(t.material,e.fog,t)})},this.animate=function(e){function t(){e(),(et.getDevice()||window).requestAnimationFrame(t)}(et.getDevice()||window).requestAnimationFrame(t)},this.render=function(e,t,n,i){if(!t||!t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");se="",oe=-1,ue=null,e.autoUpdate===!0&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),et.enabled&&(t=et.getCamera(t)),Se.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),xe.setFromMatrix(Se),W.length=0,Z.length=0,J.length=0,Ee=this.localClippingEnabled,we=be.init(this.clippingPlanes,Ee,t),q=Qe.get(e,t),q.init(),m(e,t,Q.sortObjects),q.finish(),Q.sortObjects===!0&&q.sort(),we&&be.beginShadows(),I(W),it.render(e,t),O(W,t),we&&be.endShadows(),Pe.frame++,Pe.calls=0,Pe.vertices=0,Pe.faces=0,Pe.points=0,void 0===n&&(n=null),this.setRenderTarget(n),$e.render(e,t,i);var r=q.opaque,a=q.transparent;if(e.overrideMaterial){var o=e.overrideMaterial;r.length&&g(r,e,t,o),a.length&&g(a,e,t,o)}else r.length&&g(r,e,t),a.length&&g(a,e,t);rt.render(e,t),at.render(e,t,de),n&&je.updateRenderTargetMipmap(n),Be.buffers.depth.setTest(!0),Be.buffers.depth.setMask(!0),Be.buffers.color.setMask(!0),t.isArrayCamera&&Q.setScissorTest(!1),et.enabled&&et.submitFrame()},this.setFaceCulling=function(e,t){Be.setCullFace(e),Be.setFlipSided(t===da)},this.allocTextureUnit=k,this.setTexture2D=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTarget&&(e||(console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),je.setTexture2D(t,n)}}(),this.setTexture=function(){var e=!1;return function(t,n){e||(console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead."),e=!0),je.setTexture2D(t,n)}}(),this.setTextureCube=function(){var e=!1;return function(t,n){t&&t.isWebGLRenderTargetCube&&(e||(console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead."),e=!0),t=t.texture),t&&t.isCubeTexture||Array.isArray(t.image)&&6===t.image.length?je.setTextureCube(t,n):je.setTextureCubeDynamic(t,n)}}(),this.getRenderTarget=function(){return te},this.setRenderTarget=function(e){te=e,e&&void 0===Fe.get(e).__webglFramebuffer&&je.setupRenderTarget(e);var t,n=e&&e.isWebGLRenderTargetCube;if(e){var i=Fe.get(e);t=n?i.__webglFramebuffer[e.activeCubeFace]:i.__webglFramebuffer,ce.copy(e.scissor),he=e.scissorTest,de.copy(e.viewport)}else t=null,ce.copy(ve).multiplyScalar(ge),he=ye,de.copy(_e).multiplyScalar(ge);if(ne!==t&&(Ie.bindFramebuffer(Ie.FRAMEBUFFER,t),ne=t),Be.scissor(ce),Be.setScissorTest(he),Be.viewport(de),n){var r=Fe.get(e.texture);Ie.framebufferTexture2D(Ie.FRAMEBUFFER,Ie.COLOR_ATTACHMENT0,Ie.TEXTURE_CUBE_MAP_POSITIVE_X+e.activeCubeFace,r.__webglTexture,e.activeMipMapLevel)}},this.readRenderTargetPixels=function(e,t,n,i,r,a){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");var o=Fe.get(e).__webglFramebuffer;if(o){var s=!1;o!==ne&&(Ie.bindFramebuffer(Ie.FRAMEBUFFER,o),s=!0);try{var u=e.texture,l=u.format,c=u.type;if(l!==zo&&D(l)!==Ie.getParameter(Ie.IMPLEMENTATION_COLOR_READ_FORMAT))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(c===Ao||D(c)===Ie.getParameter(Ie.IMPLEMENTATION_COLOR_READ_TYPE)||c===Oo&&(De.get("OES_texture_float")||De.get("WEBGL_color_buffer_float"))||c===ko&&De.get("EXT_color_buffer_half_float")))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");Ie.checkFramebufferStatus(Ie.FRAMEBUFFER)===Ie.FRAMEBUFFER_COMPLETE?t>=0&&t<=e.width-i&&n>=0&&n<=e.height-r&&Ie.readPixels(t,n,i,r,D(l),D(c),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{s&&Ie.bindFramebuffer(Ie.FRAMEBUFFER,ne)}}}}function vt(e,t){this.name="",this.color=new W(e),this.density=void 0!==t?t:25e-5}function yt(e,t,n){this.name="",this.color=new W(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3}function _t(){ue.call(this),this.type="Scene",this.background=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0}function xt(e,t,n,i,r){ue.call(this),this.lensFlares=[],this.positionScreen=new s,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,i,r)}function bt(e){K.call(this),this.type="SpriteMaterial",this.color=new W(16777215),this.map=null,this.rotation=0,this.fog=!1,this.lights=!1,this.setValues(e)}function wt(e){ue.call(this),this.type="Sprite",this.material=void 0!==e?e:new bt}function Et(){ue.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}function St(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),void 0===t)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new u)}}function Mt(){ue.call(this),this.type="Bone"}function Tt(e,t){Ne.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new u,this.bindMatrixInverse=new u;var n=this.initBones(),i=new St(n);this.bind(i,this.matrixWorld),this.normalizeSkinWeights()}function At(e){K.call(this),this.type="LineBasicMaterial",this.color=new W(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.lights=!1,this.setValues(e)}function Lt(e,t,n){return 1===n?(console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead."),new Rt(e,t)):(ue.call(this),this.type="Line",this.geometry=void 0!==e?e:new Ae,void(this.material=void 0!==t?t:new At({color:16777215*Math.random()})))}function Rt(e,t){Lt.call(this,e,t),this.type="LineSegments"}function Ct(e,t){Lt.call(this,e,t),this.type="LineLoop"}function Pt(e){K.call(this),this.type="PointsMaterial",this.color=new W(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.lights=!1,this.setValues(e)}function It(e,t){ue.call(this),this.type="Points",this.geometry=void 0!==e?e:new Ae,this.material=void 0!==t?t:new Pt({color:16777215*Math.random()})}function Ot(){ue.call(this),this.type="Group"}function kt(e,t,i,r,a,o,s,u,l){function c(){requestAnimationFrame(c),e.readyState>=e.HAVE_CURRENT_DATA&&(h.needsUpdate=!0)}n.call(this,e,t,i,r,a,o,s,u,l),this.generateMipmaps=!1;var h=this;c()}function Dt(e,t,i,r,a,o,s,u,l,c,h,d){n.call(this,null,o,s,u,l,c,r,a,h,d),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Nt(e,t,i,r,a,o,s,u,l){n.call(this,e,t,i,r,a,o,s,u,l),this.needsUpdate=!0}function Ut(e,t,i,r,a,o,s,u,l,c){if(c=void 0!==c?c:Wo,c!==Wo&&c!==qo)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===Wo&&(i=Co),void 0===i&&c===qo&&(i=Bo),n.call(this,null,r,a,o,s,u,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==s?s:bo,this.minFilter=void 0!==u?u:bo,this.flipY=!1,this.generateMipmaps=!1}function Bt(e){Ae.call(this),this.type="WireframeGeometry";var t,n,i,r,a,o,u,l,c,h,d=[],f=[0,0],p={},m=["a","b","c"];if(e&&e.isGeometry){var g=e.faces;for(t=0,i=g.length;t<i;t++){var v=g[t];for(n=0;n<3;n++)u=v[m[n]],l=v[m[(n+1)%3]],f[0]=Math.min(u,l),f[1]=Math.max(u,l),c=f[0]+","+f[1],void 0===p[c]&&(p[c]={index1:f[0],index2:f[1]})}for(c in p)o=p[c],h=e.vertices[o.index1],d.push(h.x,h.y,h.z),h=e.vertices[o.index2],d.push(h.x,h.y,h.z)}else if(e&&e.isBufferGeometry){var y,_,x,b,w,E,S,M;if(h=new s,null!==e.index){for(y=e.attributes.position,_=e.index,x=e.groups,0===x.length&&(x=[{start:0,count:_.count,materialIndex:0}]),r=0,a=x.length;r<a;++r)for(b=x[r],w=b.start,E=b.count,t=w,i=w+E;t<i;t+=3)for(n=0;n<3;n++)u=_.getX(t+n),l=_.getX(t+(n+1)%3),f[0]=Math.min(u,l),f[1]=Math.max(u,l),c=f[0]+","+f[1],void 0===p[c]&&(p[c]={index1:f[0],index2:f[1]});for(c in p)o=p[c],h.fromBufferAttribute(y,o.index1),d.push(h.x,h.y,h.z),h.fromBufferAttribute(y,o.index2),d.push(h.x,h.y,h.z)}else for(y=e.attributes.position,t=0,i=y.count/3;t<i;t++)for(n=0;n<3;n++)S=3*t+n,h.fromBufferAttribute(y,S),d.push(h.x,h.y,h.z),M=3*t+(n+1)%3,h.fromBufferAttribute(y,M),d.push(h.x,h.y,h.z)}this.addAttribute("position",new Ee(d,3))}function Ft(e,t,n){pe.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n},this.fromBufferGeometry(new jt(e,t,n)),this.mergeVertices()}function jt(e,t,n){Ae.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:n};var i,r,a=[],o=[],u=[],l=[],c=1e-5,h=new s,d=new s,f=new s,p=new s,m=new s,g=t+1;for(i=0;i<=n;i++){var v=i/n;for(r=0;r<=t;r++){var y=r/t;d=e(y,v,d),o.push(d.x,d.y,d.z),y-c>=0?(f=e(y-c,v,f),p.subVectors(d,f)):(f=e(y+c,v,f),p.subVectors(f,d)),v-c>=0?(f=e(y,v-c,f),m.subVectors(d,f)):(f=e(y,v+c,f),m.subVectors(f,d)),h.crossVectors(p,m).normalize(),u.push(h.x,h.y,h.z),l.push(y,v)}}for(i=0;i<n;i++)for(r=0;r<t;r++){var _=i*g+r,x=i*g+r+1,b=(i+1)*g+r+1,w=(i+1)*g+r;a.push(_,x,w),a.push(x,b,w)}this.setIndex(a),this.addAttribute("position",new Ee(o,3)),this.addAttribute("normal",new Ee(u,3)),this.addAttribute("uv",new Ee(l,2))}function zt(e,t,n,i){pe.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i},this.fromBufferGeometry(new Gt(e,t,n,i)),this.mergeVertices()}function Gt(e,n,i,r){function a(e){for(var t=new s,i=new s,r=new s,a=0;a<n.length;a+=3)d(n[a+0],t),d(n[a+1],i),d(n[a+2],r),o(t,i,r,e)}function o(e,t,n,i){var r,a,o=Math.pow(2,i),s=[];for(r=0;r<=o;r++){s[r]=[];var u=e.clone().lerp(n,r/o),l=t.clone().lerp(n,r/o),c=o-r;for(a=0;a<=c;a++)0===a&&r===o?s[r][a]=u:s[r][a]=u.clone().lerp(l,a/c)}for(r=0;r<o;r++)for(a=0;a<2*(o-r)-1;a++){var d=Math.floor(a/2);a%2===0?(h(s[r][d+1]),h(s[r+1][d]),h(s[r][d])):(h(s[r][d+1]),h(s[r+1][d+1]),h(s[r+1][d]))}}function u(e){for(var t=new s,n=0;n<v.length;n+=3)t.x=v[n+0],t.y=v[n+1],t.z=v[n+2],t.normalize().multiplyScalar(e),v[n+0]=t.x,v[n+1]=t.y,v[n+2]=t.z}function l(){for(var e=new s,t=0;t<v.length;t+=3){e.x=v[t+0],e.y=v[t+1],e.z=v[t+2];var n=m(e)/2/Math.PI+.5,i=g(e)/Math.PI+.5;y.push(n,1-i)}f(),c()}function c(){for(var e=0;e<y.length;e+=6){var t=y[e+0],n=y[e+2],i=y[e+4],r=Math.max(t,n,i),a=Math.min(t,n,i);r>.9&&a<.1&&(t<.2&&(y[e+0]+=1),n<.2&&(y[e+2]+=1),i<.2&&(y[e+4]+=1))}}function h(e){v.push(e.x,e.y,e.z)}function d(t,n){var i=3*t;n.x=e[i+0],n.y=e[i+1],n.z=e[i+2]}function f(){for(var e=new s,n=new s,i=new s,r=new s,a=new t,o=new t,u=new t,l=0,c=0;l<v.length;l+=9,c+=6){e.set(v[l+0],v[l+1],v[l+2]),n.set(v[l+3],v[l+4],v[l+5]),i.set(v[l+6],v[l+7],v[l+8]),a.set(y[c+0],y[c+1]),o.set(y[c+2],y[c+3]),u.set(y[c+4],y[c+5]),r.copy(e).add(n).add(i).divideScalar(3);var h=m(r);p(a,c+0,e,h),p(o,c+2,n,h),p(u,c+4,i,h)}}function p(e,t,n,i){i<0&&1===e.x&&(y[t]=e.x-1),0===n.x&&0===n.z&&(y[t]=i/2/Math.PI+.5)}function m(e){return Math.atan2(e.z,-e.x)}function g(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}Ae.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:n,radius:i,detail:r},i=i||1,r=r||0;var v=[],y=[];a(r),u(i),l(),this.addAttribute("position",new Ee(v,3)),this.addAttribute("normal",new Ee(v.slice(),3)),this.addAttribute("uv",new Ee(y,2)),0===r?this.computeVertexNormals():this.normalizeNormals()}function Ht(e,t){pe.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Vt(e,t)),this.mergeVertices()}function Vt(e,t){var n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];Gt.call(this,n,i,e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Wt(e,t){pe.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new qt(e,t)),this.mergeVertices()}function qt(e,t){var n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];Gt.call(this,n,i,e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Xt(e,t){pe.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Yt(e,t)),this.mergeVertices()}function Yt(e,t){var n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],r=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];Gt.call(this,i,r,e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Kt(e,t){pe.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Zt(e,t)),this.mergeVertices()}function Zt(e,t){var n=(1+Math.sqrt(5))/2,i=1/n,r=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];Gt.call(this,r,a,e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Jt(e,t,n,i,r,a){pe.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:r},void 0!==a&&console.warn("THREE.TubeGeometry: taper has been removed.");var o=new Qt(e,t,n,i,r);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals,this.fromBufferGeometry(o),this.mergeVertices()}function Qt(e,n,i,r,a){function o(){for(d=0;d<n;d++)u(d);u(a===!1?n:0),c(),l()}function u(t){var a=e.getPointAt(t/n),o=h.normals[t],s=h.binormals[t];for(f=0;f<=r;f++){var u=f/r*Math.PI*2,l=Math.sin(u),c=-Math.cos(u);m.x=c*o.x+l*s.x,m.y=c*o.y+l*s.y,m.z=c*o.z+l*s.z,m.normalize(),y.push(m.x,m.y,m.z),p.x=a.x+i*m.x,p.y=a.y+i*m.y,p.z=a.z+i*m.z,v.push(p.x,p.y,p.z)}}function l(){for(f=1;f<=n;f++)for(d=1;d<=r;d++){var e=(r+1)*(f-1)+(d-1),t=(r+1)*f+(d-1),i=(r+1)*f+d,a=(r+1)*(f-1)+d;x.push(e,t,a),x.push(t,i,a)}}function c(){for(d=0;d<=n;d++)for(f=0;f<=r;f++)g.x=d/n,g.y=f/r,_.push(g.x,g.y)}Ae.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:n,radius:i,radialSegments:r,closed:a},n=n||64,i=i||1,r=r||8,a=a||!1;var h=e.computeFrenetFrames(n,a);this.tangents=h.tangents,this.normals=h.normals,this.binormals=h.binormals;var d,f,p=new s,m=new s,g=new t,v=[],y=[],_=[],x=[];o(),this.setIndex(x),this.addAttribute("position",new Ee(v,3)),this.addAttribute("normal",new Ee(y,3)),this.addAttribute("uv",new Ee(_,2))}function $t(e,t,n,i,r,a,o){pe.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},void 0!==o&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new en(e,t,n,i,r,a)),this.mergeVertices()}function en(e,t,n,i,r,a){function o(e,t,n,i,r){var a=Math.cos(e),o=Math.sin(e),s=n/t*e,u=Math.cos(s);r.x=i*(2+u)*.5*a,r.y=i*(2+u)*o*.5,r.z=i*Math.sin(s)*.5}Ae.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:r,q:a},e=e||100,t=t||40,n=Math.floor(n)||64,i=Math.floor(i)||8,r=r||2,a=a||3;var u,l,c=[],h=[],d=[],f=[],p=new s,m=new s,g=new s,v=new s,y=new s,_=new s,x=new s;for(u=0;u<=n;++u){var b=u/n*r*Math.PI*2;for(o(b,r,a,e,g),o(b+.01,r,a,e,v),_.subVectors(v,g),x.addVectors(v,g),y.crossVectors(_,x),x.crossVectors(y,_),y.normalize(),x.normalize(),l=0;l<=i;++l){var w=l/i*Math.PI*2,E=-t*Math.cos(w),S=t*Math.sin(w);p.x=g.x+(E*x.x+S*y.x),p.y=g.y+(E*x.y+S*y.y),p.z=g.z+(E*x.z+S*y.z),h.push(p.x,p.y,p.z),m.subVectors(p,g).normalize(),d.push(m.x,m.y,m.z),f.push(u/n),f.push(l/i)}}for(l=1;l<=n;l++)for(u=1;u<=i;u++){var M=(i+1)*(l-1)+(u-1),T=(i+1)*l+(u-1),A=(i+1)*l+u,L=(i+1)*(l-1)+u;c.push(M,T,L),c.push(T,A,L)}this.setIndex(c),this.addAttribute("position",new Ee(h,3)),this.addAttribute("normal",new Ee(d,3)),this.addAttribute("uv",new Ee(f,2))}function tn(e,t,n,i,r){pe.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},this.fromBufferGeometry(new nn(e,t,n,i,r)),this.mergeVertices()}function nn(e,t,n,i,r){Ae.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:r},e=e||100,t=t||40,n=Math.floor(n)||8,i=Math.floor(i)||6,r=r||2*Math.PI;var a,o,u=[],l=[],c=[],h=[],d=new s,f=new s,p=new s;for(a=0;a<=n;a++)for(o=0;o<=i;o++){var m=o/i*r,g=a/n*Math.PI*2;f.x=(e+t*Math.cos(g))*Math.cos(m),f.y=(e+t*Math.cos(g))*Math.sin(m),f.z=t*Math.sin(g),l.push(f.x,f.y,f.z),d.x=e*Math.cos(m),d.y=e*Math.sin(m),p.subVectors(f,d).normalize(),c.push(p.x,p.y,p.z),h.push(o/i),h.push(a/n)}for(a=1;a<=n;a++)for(o=1;o<=i;o++){var v=(i+1)*a+o-1,y=(i+1)*(a-1)+o-1,_=(i+1)*(a-1)+o,x=(i+1)*a+o;u.push(v,y,x),u.push(y,_,x)}this.setIndex(u),this.addAttribute("position",new Ee(l,3)),this.addAttribute("normal",new Ee(c,3)),this.addAttribute("uv",new Ee(h,2))}function rn(e,t){pe.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new an(e,t)),this.mergeVertices()}function an(e,t){"undefined"!=typeof e&&(Ae.call(this),this.type="ExtrudeBufferGeometry",e=Array.isArray(e)?e:[e],this.addShapeList(e,t),this.computeVertexNormals())}function on(e,t){pe.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new sn(e,t)),this.mergeVertices()}function sn(e,t){t=t||{};var n=t.font;if(!n||!n.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new pe;var i=n.generateShapes(e,t.size,t.curveSegments);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),an.call(this,i,t),this.type="TextBufferGeometry"}function un(e,t,n,i,r,a,o){pe.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},this.fromBufferGeometry(new ln(e,t,n,i,r,a,o)),this.mergeVertices()}function ln(e,t,n,i,r,a,o){Ae.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:r,thetaStart:a,thetaLength:o},e=e||50,t=Math.max(3,Math.floor(t)||8),n=Math.max(2,Math.floor(n)||6),i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI,a=void 0!==a?a:0,o=void 0!==o?o:Math.PI;var u,l,c=a+o,h=0,d=[],f=new s,p=new s,m=[],g=[],v=[],y=[];for(l=0;l<=n;l++){var _=[],x=l/n;for(u=0;u<=t;u++){var b=u/t;f.x=-e*Math.cos(i+b*r)*Math.sin(a+x*o),f.y=e*Math.cos(a+x*o),f.z=e*Math.sin(i+b*r)*Math.sin(a+x*o),g.push(f.x,f.y,f.z),p.set(f.x,f.y,f.z).normalize(),v.push(p.x,p.y,p.z),y.push(b,1-x),_.push(h++)}d.push(_)}for(l=0;l<n;l++)for(u=0;u<t;u++){var w=d[l][u+1],E=d[l][u],S=d[l+1][u],M=d[l+1][u+1];(0!==l||a>0)&&m.push(w,E,M),(l!==n-1||c<Math.PI)&&m.push(E,S,M)}this.setIndex(m),this.addAttribute("position",new Ee(g,3)),this.addAttribute("normal",new Ee(v,3)),this.addAttribute("uv",new Ee(y,2))}function cn(e,t,n,i,r,a){pe.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:r,thetaLength:a},this.fromBufferGeometry(new hn(e,t,n,i,r,a)),this.mergeVertices()}function hn(e,n,i,r,a,o){Ae.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:n,thetaSegments:i,phiSegments:r,thetaStart:a,thetaLength:o},e=e||20,n=n||50,a=void 0!==a?a:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,r=void 0!==r?Math.max(1,r):1;var u,l,c,h=[],d=[],f=[],p=[],m=e,g=(n-e)/r,v=new s,y=new t;for(l=0;l<=r;l++){for(c=0;c<=i;c++)u=a+c/i*o,v.x=m*Math.cos(u),v.y=m*Math.sin(u),d.push(v.x,v.y,v.z),f.push(0,0,1),y.x=(v.x/n+1)/2,y.y=(v.y/n+1)/2,p.push(y.x,y.y);m+=g}for(l=0;l<r;l++){var _=l*(i+1);for(c=0;c<i;c++){u=c+_;var x=u,b=u+i+1,w=u+i+2,E=u+1;h.push(x,b,E),h.push(b,w,E)}}this.setIndex(h),this.addAttribute("position",new Ee(d,3)),this.addAttribute("normal",new Ee(f,3)),this.addAttribute("uv",new Ee(p,2))}function dn(e,t,n,i){pe.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},this.fromBufferGeometry(new fn(e,t,n,i)),this.mergeVertices()}function fn(e,n,i,r){Ae.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:n,phiStart:i,phiLength:r},n=Math.floor(n)||12,i=i||0,r=r||2*Math.PI,r=Ss.clamp(r,0,2*Math.PI);var a,o,u,l=[],c=[],h=[],d=1/n,f=new s,p=new t;for(o=0;o<=n;o++){var m=i+o*d*r,g=Math.sin(m),v=Math.cos(m);for(u=0;u<=e.length-1;u++)f.x=e[u].x*g,f.y=e[u].y,f.z=e[u].x*v,c.push(f.x,f.y,f.z),p.x=o/n,p.y=u/(e.length-1),h.push(p.x,p.y)}for(o=0;o<n;o++)for(u=0;u<e.length-1;u++){a=u+o*e.length;var y=a,_=a+e.length,x=a+e.length+1,b=a+1;l.push(y,_,b),l.push(_,x,b)}if(this.setIndex(l),this.addAttribute("position",new Ee(c,3)),this.addAttribute("uv",new Ee(h,2)),this.computeVertexNormals(),r===2*Math.PI){var w=this.attributes.normal.array,E=new s,S=new s,M=new s;for(a=n*e.length*3,o=0,u=0;o<e.length;o++,u+=3)E.x=w[u+0],E.y=w[u+1],E.z=w[u+2],S.x=w[a+u+0],S.y=w[a+u+1],S.z=w[a+u+2],M.addVectors(E,S).normalize(),w[u+0]=w[a+u+0]=M.x,w[u+1]=w[a+u+1]=M.y,w[u+2]=w[a+u+2]=M.z}}function pn(e,t){pe.call(this),this.type="ShapeGeometry","object"==typeof t&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new mn(e,t)),this.mergeVertices()}function mn(e,t){function n(e){var n,s,l,c=r.length/3,h=e.extractPoints(t),d=h.shape,f=h.holes;if(Vl.isClockWise(d)===!1)for(d=d.reverse(),n=0,s=f.length;n<s;n++)l=f[n],Vl.isClockWise(l)===!0&&(f[n]=l.reverse());var p=Vl.triangulateShape(d,f);for(n=0,s=f.length;n<s;n++)l=f[n],d=d.concat(l);for(n=0,s=d.length;n<s;n++){var m=d[n];r.push(m.x,m.y,0),a.push(0,0,1),o.push(m.x,m.y)}for(n=0,s=p.length;n<s;n++){var g=p[n],v=g[0]+c,y=g[1]+c,_=g[2]+c;i.push(v,y,_),u+=3}}Ae.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var i=[],r=[],a=[],o=[],s=0,u=0;if(Array.isArray(e)===!1)n(e);else for(var l=0;l<e.length;l++)n(e[l]),this.addGroup(s,u,l),s+=u,u=0;this.setIndex(i),this.addAttribute("position",new Ee(r,3)),this.addAttribute("normal",new Ee(a,3)),this.addAttribute("uv",new Ee(o,2))}function gn(e,t){Ae.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=void 0!==t?t:1;var n,i,r,a,o=[],s=Math.cos(Ss.DEG2RAD*t),u=[0,0],l={},c=["a","b","c"];e.isBufferGeometry?(a=new pe,a.fromBufferGeometry(e)):a=e.clone(),a.mergeVertices(),a.computeFaceNormals();for(var h=a.vertices,d=a.faces,f=0,p=d.length;f<p;f++)for(var m=d[f],g=0;g<3;g++)n=m[c[g]],i=m[c[(g+1)%3]],u[0]=Math.min(n,i),u[1]=Math.max(n,i),r=u[0]+","+u[1],void 0===l[r]?l[r]={index1:u[0],index2:u[1],face1:f,face2:void 0}:l[r].face2=f;for(r in l){var v=l[r];if(void 0===v.face2||d[v.face1].normal.dot(d[v.face2].normal)<=s){var y=h[v.index1];o.push(y.x,y.y,y.z),y=h[v.index2],o.push(y.x,y.y,y.z)}}this.addAttribute("position",new Ee(o,3))}function vn(e,t,n,i,r,a,o,s){pe.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:r,openEnded:a,thetaStart:o,thetaLength:s},this.fromBufferGeometry(new yn(e,t,n,i,r,a,o,s)),this.mergeVertices()}function yn(e,n,i,r,a,o,u,l){function c(){var t,o,c=new s,h=new s,b=0,w=(n-e)/i;for(o=0;o<=a;o++){var E=[],S=o/a,M=S*(n-e)+e;
for(t=0;t<=r;t++){var T=t/r,A=T*l+u,L=Math.sin(A),R=Math.cos(A);h.x=M*L,h.y=-S*i+_,h.z=M*R,p.push(h.x,h.y,h.z),c.set(L,w,R).normalize(),m.push(c.x,c.y,c.z),g.push(T,1-S),E.push(v++)}y.push(E)}for(t=0;t<r;t++)for(o=0;o<a;o++){var C=y[o][t],P=y[o+1][t],I=y[o+1][t+1],O=y[o][t+1];f.push(C,P,O),f.push(P,I,O),b+=6}d.addGroup(x,b,0),x+=b}function h(i){var a,o,c,h=new t,y=new s,b=0,w=i===!0?e:n,E=i===!0?1:-1;for(o=v,a=1;a<=r;a++)p.push(0,_*E,0),m.push(0,E,0),g.push(.5,.5),v++;for(c=v,a=0;a<=r;a++){var S=a/r,M=S*l+u,T=Math.cos(M),A=Math.sin(M);y.x=w*A,y.y=_*E,y.z=w*T,p.push(y.x,y.y,y.z),m.push(0,E,0),h.x=.5*T+.5,h.y=.5*A*E+.5,g.push(h.x,h.y),v++}for(a=0;a<r;a++){var L=o+a,R=c+a;i===!0?f.push(R,R+1,L):f.push(R+1,R,L),b+=3}d.addGroup(x,b,i===!0?1:2),x+=b}Ae.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:n,height:i,radialSegments:r,heightSegments:a,openEnded:o,thetaStart:u,thetaLength:l};var d=this;e=void 0!==e?e:20,n=void 0!==n?n:20,i=void 0!==i?i:100,r=Math.floor(r)||8,a=Math.floor(a)||1,o=void 0!==o&&o,u=void 0!==u?u:0,l=void 0!==l?l:2*Math.PI;var f=[],p=[],m=[],g=[],v=0,y=[],_=i/2,x=0;c(),o===!1&&(e>0&&h(!0),n>0&&h(!1)),this.setIndex(f),this.addAttribute("position",new Ee(p,3)),this.addAttribute("normal",new Ee(m,3)),this.addAttribute("uv",new Ee(g,2))}function _n(e,t,n,i,r,a,o){vn.call(this,0,e,t,n,i,r,a,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function xn(e,t,n,i,r,a,o){yn.call(this,0,e,t,n,i,r,a,o),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:r,thetaStart:a,thetaLength:o}}function bn(e,t,n,i){pe.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},this.fromBufferGeometry(new wn(e,t,n,i)),this.mergeVertices()}function wn(e,n,i,r){Ae.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:n,thetaStart:i,thetaLength:r},e=e||50,n=void 0!==n?Math.max(3,n):8,i=void 0!==i?i:0,r=void 0!==r?r:2*Math.PI;var a,o,u=[],l=[],c=[],h=[],d=new s,f=new t;for(l.push(0,0,0),c.push(0,0,1),h.push(.5,.5),o=0,a=3;o<=n;o++,a+=3){var p=i+o/n*r;d.x=e*Math.cos(p),d.y=e*Math.sin(p),l.push(d.x,d.y,d.z),c.push(0,0,1),f.x=(l[a]/e+1)/2,f.y=(l[a+1]/e+1)/2,h.push(f.x,f.y)}for(a=1;a<=n;a++)u.push(a,a+1,0);this.setIndex(u),this.addAttribute("position",new Ee(l,3)),this.addAttribute("normal",new Ee(c,3)),this.addAttribute("uv",new Ee(h,2))}function En(e){Z.call(this,{uniforms:Ds.merge([ks.lights,{opacity:{value:1}}]),vertexShader:Bl.shadow_vert,fragmentShader:Bl.shadow_frag}),this.lights=!0,this.transparent=!0,Object.defineProperties(this,{opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(e){this.uniforms.opacity.value=e}}}),this.setValues(e)}function Sn(e){Z.call(this,e),this.type="RawShaderMaterial"}function Mn(e){K.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new W(16777215),this.roughness=.5,this.metalness=.5,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Tn(e){Mn.call(this),this.defines={PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearCoat=0,this.clearCoatRoughness=0,this.setValues(e)}function An(e){K.call(this),this.type="MeshPhongMaterial",this.color=new W(16777215),this.specular=new W(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=to,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Ln(e){An.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.gradientMap=null,this.setValues(e)}function Rn(e){K.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new t(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Cn(e){K.call(this),this.type="MeshLambertMaterial",this.color=new W(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new W(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=to,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Pn(e){K.call(this),this.type="LineDashedMaterial",this.color=new W(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.lights=!1,this.setValues(e)}function In(e,t,n){var i=this,r=!1,a=0,o=0;this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,r===!1&&void 0!==i.onStart&&i.onStart(e,a,o),r=!0},this.itemEnd=function(e){a++,void 0!==i.onProgress&&i.onProgress(e,a,o),a===o&&(r=!1,void 0!==i.onLoad&&i.onLoad())},this.itemError=function(e){void 0!==i.onError&&i.onError(e)}}function On(e){this.manager=void 0!==e?e:Yl}function kn(e){this.manager=void 0!==e?e:Yl,this._parser=null}function Dn(e){this.manager=void 0!==e?e:Yl,this._parser=null}function Nn(e){this.manager=void 0!==e?e:Yl}function Un(e){this.manager=void 0!==e?e:Yl}function Bn(e){this.manager=void 0!==e?e:Yl}function Fn(e,t){ue.call(this),this.type="Light",this.color=new W(e),this.intensity=void 0!==t?t:1,this.receiveShadow=void 0}function jn(e,t,n){Fn.call(this,e,n),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(ue.DefaultUp),this.updateMatrix(),this.groundColor=new W(t)}function zn(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new t(512,512),this.map=null,this.matrix=new u}function Gn(){zn.call(this,new he(50,1,.5,500))}function Hn(e,t,n,i,r,a){Fn.call(this,e,t),this.type="SpotLight",this.position.copy(ue.DefaultUp),this.updateMatrix(),this.target=new ue,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==i?i:Math.PI/3,this.penumbra=void 0!==r?r:0,this.decay=void 0!==a?a:1,this.shadow=new Gn}function Vn(e,t,n,i){Fn.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==i?i:1,this.shadow=new zn(new he(90,1,.5,500))}function Wn(){zn.call(this,new ce((-5),5,5,(-5),.5,500))}function qn(e,t){Fn.call(this,e,t),this.type="DirectionalLight",this.position.copy(ue.DefaultUp),this.updateMatrix(),this.target=new ue,this.shadow=new Wn}function Xn(e,t){Fn.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function Yn(e,t,n,i){Fn.call(this,e,t),this.type="RectAreaLight",this.position.set(0,1,0),this.updateMatrix(),this.width=void 0!==n?n:10,this.height=void 0!==i?i:10}function Kn(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==i?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function Zn(e,t,n,i){Kn.call(this,e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Jn(e,t,n,i){Kn.call(this,e,t,n,i)}function Qn(e,t,n,i){Kn.call(this,e,t,n,i)}function $n(e,t,n,i){if(void 0===e)throw new Error("track name is undefined");if(void 0===t||0===t.length)throw new Error("no keyframes in track named "+e);this.name=e,this.times=Kl.convertArray(t,this.TimeBufferType),this.values=Kl.convertArray(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation),this.validate(),this.optimize()}function ei(e,t,n,i){$n.call(this,e,t,n,i)}function ti(e,t,n,i){Kn.call(this,e,t,n,i)}function ni(e,t,n,i){$n.call(this,e,t,n,i)}function ii(e,t,n,i){$n.call(this,e,t,n,i)}function ri(e,t,n,i){$n.call(this,e,t,n,i)}function ai(e,t,n){$n.call(this,e,t,n)}function oi(e,t,n,i){$n.call(this,e,t,n,i)}function si(e,t,n,i){$n.apply(this,arguments)}function ui(e,t,n){this.name=e,this.tracks=n,this.duration=void 0!==t?t:-1,this.uuid=Ss.generateUUID(),this.duration<0&&this.resetDuration(),this.optimize()}function li(e){this.manager=void 0!==e?e:Yl,this.textures={}}function ci(e){this.manager=void 0!==e?e:Yl}function hi(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}}function di(e){"boolean"==typeof e&&(console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor."),e=void 0),this.manager=void 0!==e?e:Yl,this.withCredentials=!1}function fi(e){this.manager=void 0!==e?e:Yl,this.texturePath=""}function pi(e,t,n,i,r){var a=.5*(i-t),o=.5*(r-n),s=e*e,u=e*s;return(2*n-2*i+a+o)*u+(-3*n+3*i-2*a-o)*s+a*e+n}function mi(e,t){var n=1-e;return n*n*t}function gi(e,t){return 2*(1-e)*e*t}function vi(e,t){return e*e*t}function yi(e,t,n,i){return mi(e,t)+gi(e,n)+vi(e,i)}function _i(e,t){var n=1-e;return n*n*n*t}function xi(e,t){var n=1-e;return 3*n*n*e*t}function bi(e,t){return 3*(1-e)*e*e*t}function wi(e,t){return e*e*e*t}function Ei(e,t,n,i,r){return _i(e,t)+xi(e,n)+bi(e,i)+wi(e,r)}function Si(){this.arcLengthDivisions=200}function Mi(e,t){Si.call(this),this.v1=e,this.v2=t}function Ti(){Si.call(this),this.curves=[],this.autoClose=!1}function Ai(e,t,n,i,r,a,o,s){Si.call(this),this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=r,this.aEndAngle=a,this.aClockwise=o,this.aRotation=s||0}function Li(e){Si.call(this),this.points=void 0===e?[]:e}function Ri(e,t,n,i){Si.call(this),this.v0=e,this.v1=t,this.v2=n,this.v3=i}function Ci(e,t,n){Si.call(this),this.v0=e,this.v1=t,this.v2=n}function Pi(e){Ti.call(this),this.currentPoint=new t,e&&this.fromPoints(e)}function Ii(){Pi.apply(this,arguments),this.holes=[]}function Oi(){this.subPaths=[],this.currentPath=null}function ki(e){this.data=e}function Di(e){this.manager=void 0!==e?e:Yl}function Ni(e){this.manager=void 0!==e?e:Yl}function Ui(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new he,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new he,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1}function Bi(e,t,n){ue.call(this),this.type="CubeCamera";var i=90,r=1,o=new he(i,r,e,t);o.up.set(0,-1,0),o.lookAt(new s(1,0,0)),this.add(o);var u=new he(i,r,e,t);u.up.set(0,-1,0),u.lookAt(new s((-1),0,0)),this.add(u);var l=new he(i,r,e,t);l.up.set(0,0,1),l.lookAt(new s(0,1,0)),this.add(l);var c=new he(i,r,e,t);c.up.set(0,0,-1),c.lookAt(new s(0,(-1),0)),this.add(c);var h=new he(i,r,e,t);h.up.set(0,-1,0),h.lookAt(new s(0,0,1)),this.add(h);var d=new he(i,r,e,t);d.up.set(0,-1,0),d.lookAt(new s(0,0,(-1))),this.add(d);var f={format:jo,magFilter:So,minFilter:So};this.renderTarget=new a(n,n,f),this.renderTarget.texture.name="CubeCamera",this.updateCubeMap=function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,i=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,o,n),n.activeCubeFace=1,e.render(t,u,n),n.activeCubeFace=2,e.render(t,l,n),n.activeCubeFace=3,e.render(t,c,n),n.activeCubeFace=4,e.render(t,h,n),n.texture.generateMipmaps=i,n.activeCubeFace=5,e.render(t,d,n),e.setRenderTarget(null)}}function Fi(){ue.call(this),this.type="AudioListener",this.context=ic.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null}function ji(e){ue.call(this),this.type="Audio",this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.loop=!1,this.startTime=0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this.filters=[]}function zi(e){ji.call(this,e),this.panner=this.context.createPanner(),this.panner.connect(this.gain)}function Gi(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=void 0!==t?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function Hi(e,t,n){this.binding=e,this.valueSize=n;var i,r=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":r=Array,i=this._select;break;default:i=this._lerp}this.buffer=new r(4*n),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}function Vi(e,t,n){var i=n||Wi.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Wi(e,t,n){this.path=t,this.parsedPath=n||Wi.parseTrackName(t),this.node=Wi.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function qi(e){this.uuid=Ss.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,i=arguments.length;n!==i;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}function Xi(e,t,n){this._mixer=e,this._clip=t,this._localRoot=n||null;for(var i=t.tracks,r=i.length,a=new Array(r),o={endingStart:us,endingEnd:us},s=0;s!==r;++s){var u=i[s].createInterpolant(null);a[s]=u,u.settings=o}this._interpolantSettings=o,this._interpolants=a,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=is,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function Yi(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Ki(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function Zi(){Ae.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function Ji(e,t,n,i){this.uuid=Ss.generateUUID(),this.data=e,this.itemSize=t,this.offset=n,this.normalized=i===!0}function Qi(e,t){this.uuid=Ss.generateUUID(),this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.dynamic=!1,this.updateRange={offset:0,count:-1},this.onUploadCallback=function(){},this.version=0}function $i(e,t,n){Qi.call(this,e,t),this.meshPerAttribute=n||1}function er(e,t,n){me.call(this,e,t),this.meshPerAttribute=n||1}function tr(e,t,n,i){this.ray=new Oe(e,t),this.near=n||0,this.far=i||1/0,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function nr(e,t){return e.distance-t.distance}function ir(e,t,n,i){if(e.visible!==!1&&(e.raycast(t,n),i===!0))for(var r=e.children,a=0,o=r.length;a<o;a++)ir(r[a],t,n,!0)}function rr(e){this.autoStart=void 0===e||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}function ar(e,t,n){return this.radius=void 0!==e?e:1,this.phi=void 0!==t?t:0,this.theta=void 0!==n?n:0,this}function or(e,t,n){return this.radius=void 0!==e?e:1,this.theta=void 0!==t?t:0,this.y=void 0!==n?n:0,this}function sr(e,t){Ne.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length,i="__default",r=0,a=n-1,o=n/1;this.createAnimation(i,r,a,o),this.setAnimationWeight(i,1)}function ur(e){ue.call(this),this.material=e,this.render=function(e){}}function lr(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16711680,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=3*s.faces.length:s&&s.isBufferGeometry&&(o=s.attributes.normal.count);var u=new Ae,l=new Ee(2*o*3,3);u.addAttribute("position",l),Rt.call(this,u,new At({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function cr(e){ue.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;for(var t=new Ae,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,r=1,a=32;i<a;i++,r++){var o=i/a*Math.PI*2,s=r/a*Math.PI*2;n.push(Math.cos(o),Math.sin(o),1,Math.cos(s),Math.sin(s),1)}t.addAttribute("position",new Ee(n,3));var u=new At({fog:!1});this.cone=new Rt(t,u),this.add(this.cone),this.update()}function hr(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,hr(e.children[n]));return t}function dr(e){for(var t=hr(e),n=new Ae,i=[],r=[],a=new W(0,0,1),o=new W(0,1,0),s=0;s<t.length;s++){var u=t[s];u.parent&&u.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),r.push(a.r,a.g,a.b),r.push(o.r,o.g,o.b))}n.addAttribute("position",new Ee(i,3)),n.addAttribute("color",new Ee(r,3));var l=new At({vertexColors:Sa,depthTest:!1,depthWrite:!1,transparent:!0});Rt.call(this,n,l),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.onBeforeRender()}function fr(e,t){this.light=e,this.light.updateMatrixWorld();var n=new ln(t,4,2),i=new Ie({wireframe:!0,fog:!1});i.color.copy(this.light.color),Ne.call(this,n,i),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1}function pr(e){ue.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new At({color:e.color}),n=new Ae;n.addAttribute("position",new me(new Float32Array(15),3)),this.add(new Lt(n,t)),this.update()}function mr(e,t){ue.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;var n=new qt(t);n.rotateY(.5*Math.PI);var i=new Ie({vertexColors:Sa,wireframe:!0}),r=n.getAttribute("position"),a=new Float32Array(3*r.count);n.addAttribute("color",new me(a,3)),this.add(new Ne(n,i)),this.update()}function gr(e,t,n,i){e=e||10,t=t||10,n=new W(void 0!==n?n:4473924),i=new W(void 0!==i?i:8947848);for(var r=t/2,a=e/t,o=e/2,s=[],u=[],l=0,c=0,h=-o;l<=t;l++,h+=a){s.push(-o,0,h,o,0,h),s.push(h,0,-o,h,0,o);var d=l===r?n:i;d.toArray(u,c),c+=3,d.toArray(u,c),c+=3,d.toArray(u,c),c+=3,d.toArray(u,c),c+=3}var f=new Ae;f.addAttribute("position",new Ee(s,3)),f.addAttribute("color",new Ee(u,3));var p=new At({vertexColors:Sa});Rt.call(this,f,p)}function vr(e,t,n,i,r,a){e=e||10,t=t||16,n=n||8,i=i||64,r=new W(void 0!==r?r:4473924),a=new W(void 0!==a?a:8947848);var o,s,u,l,c,h,d,f=[],p=[];for(l=0;l<=t;l++)u=l/t*(2*Math.PI),o=Math.sin(u)*e,s=Math.cos(u)*e,f.push(0,0,0),f.push(o,0,s),d=1&l?r:a,p.push(d.r,d.g,d.b),p.push(d.r,d.g,d.b);for(l=0;l<=n;l++)for(d=1&l?r:a,h=e-e/n*l,c=0;c<i;c++)u=c/i*(2*Math.PI),o=Math.sin(u)*h,s=Math.cos(u)*h,f.push(o,0,s),p.push(d.r,d.g,d.b),u=(c+1)/i*(2*Math.PI),o=Math.sin(u)*h,s=Math.cos(u)*h,f.push(o,0,s),p.push(d.r,d.g,d.b);var m=new Ae;m.addAttribute("position",new Ee(f,3)),m.addAttribute("color",new Ee(p,3));var g=new At({vertexColors:Sa});Rt.call(this,m,g)}function yr(e,t,n,i){this.object=e,this.size=void 0!==t?t:1;var r=void 0!==n?n:16776960,a=void 0!==i?i:1,o=0,s=this.object.geometry;s&&s.isGeometry?o=s.faces.length:console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.");var u=new Ae,l=new Ee(2*o*3,3);u.addAttribute("position",l),Rt.call(this,u,new At({color:r,linewidth:a})),this.matrixAutoUpdate=!1,this.update()}function _r(e,t){ue.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,void 0===t&&(t=1);var n=new Ae;n.addAttribute("position",new Ee([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var i=new At({fog:!1});this.add(new Lt(n,i)),n=new Ae,n.addAttribute("position",new Ee([0,0,0,0,0,1],3)),this.add(new Lt(n,i)),this.update()}function xr(e){function t(e,t,i){n(e,i),n(t,i)}function n(e,t){a.push(0,0,0),o.push(t.r,t.g,t.b),void 0===s[e]&&(s[e]=[]),s[e].push(a.length/3-1)}var i=new Ae,r=new At({color:16777215,vertexColors:Ea}),a=[],o=[],s={},u=new W(16755200),l=new W(16711680),c=new W(43775),h=new W(16777215),d=new W(3355443);t("n1","n2",u),t("n2","n4",u),t("n4","n3",u),t("n3","n1",u),t("f1","f2",u),t("f2","f4",u),t("f4","f3",u),t("f3","f1",u),t("n1","f1",u),t("n2","f2",u),t("n3","f3",u),t("n4","f4",u),t("p","n1",l),t("p","n2",l),t("p","n3",l),t("p","n4",l),t("u1","u2",c),t("u2","u3",c),t("u3","u1",c),t("c","t",h),t("p","c",d),t("cn1","cn2",d),t("cn3","cn4",d),t("cf1","cf2",d),t("cf3","cf4",d),i.addAttribute("position",new Ee(a,3)),i.addAttribute("color",new Ee(o,3)),Rt.call(this,i,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()}function br(e,t){this.object=e,void 0===t&&(t=16776960);var n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),r=new Ae;r.setIndex(new me(n,1)),r.addAttribute("position",new me(i,3)),Rt.call(this,r,new At({color:t})),this.matrixAutoUpdate=!1,this.update()}function wr(e,t,n,i,r,a){ue.call(this),void 0===i&&(i=16776960),void 0===n&&(n=1),void 0===r&&(r=.2*n),void 0===a&&(a=.2*r),void 0===rc&&(rc=new Ae,rc.addAttribute("position",new Ee([0,0,0,0,1,0],3)),ac=new yn(0,.5,1,5,1),ac.translate(0,-.5,0)),this.position.copy(t),this.line=new Lt(rc,new At({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Ne(ac,new Ie({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,r,a)}function Er(e){e=e||1;var t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Ae;i.addAttribute("position",new Ee(t,3)),i.addAttribute("color",new Ee(n,3));var r=new At({vertexColors:Sa});Rt.call(this,i,r)}function Sr(){function e(e,a,o,s){t=e,n=o,i=-3*e+3*a-2*o-s,r=2*e-2*a+o+s}var t=0,n=0,i=0,r=0;return{initCatmullRom:function(t,n,i,r,a){e(n,i,a*(i-t),a*(r-n))},initNonuniformCatmullRom:function(t,n,i,r,a,o,s){var u=(n-t)/a-(i-t)/(a+o)+(i-n)/o,l=(i-n)/o-(r-n)/(o+s)+(r-i)/s;u*=o,l*=o,e(n,i,u,l)},calc:function(e){var a=e*e,o=a*e;return t+n*e+i*a+r*o}}}function Mr(e){Si.call(this),e.length<2&&console.warn("THREE.CatmullRomCurve3: Points array needs at least two entries."),this.points=e||[],this.closed=!1}function Tr(e,t,n,i){Si.call(this),this.v0=e,this.v1=t,this.v2=n,this.v3=i}function Ar(e,t,n){Si.call(this),this.v0=e,this.v1=t,this.v2=n}function Lr(e,t){Si.call(this),this.v1=e,this.v2=t}function Rr(e,t,n,i,r,a){Ai.call(this,e,t,n,n,i,r,a)}function Cr(e,t,n,i,r,a,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new de(e,t,n,r,a,o)}function Pr(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function Ir(e){return void 0===e&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function Or(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new It(e,t)}function kr(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new wt(e)}function Dr(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new It(e,t)}function Nr(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Pt(e)}function Ur(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Pt(e)}function Br(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Pt(e)}function Fr(e,t,n){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new s(e,t,n)}function jr(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead."),new me(e,t).setDynamic(!0)}function zr(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new ge(e,t)}function Gr(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new ve(e,t)}function Hr(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ye(e,t)}function Vr(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new _e(e,t)}function Wr(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new xe(e,t)}function qr(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new be(e,t)}function Xr(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new we(e,t)}function Yr(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Ee(e,t)}function Kr(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Se(e,t)}function Zr(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Mr.call(this,e),this.type="catmullrom",this.closed=!0}function Jr(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Mr.call(this,e),this.type="catmullrom"}function Qr(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Mr.call(this,e),this.type="catmullrom"}function $r(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new br(e,t)}function ea(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new Rt(new gn(e.geometry),new At({color:void 0!==t?t:16777215}))}function ta(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new Rt(new Bt(e.geometry),new At({color:void 0!==t?t:16777215}))}function na(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new On(e)}function ia(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Dn(e)}function ra(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js."),this.projectVector=function(e,t){console.warn("THREE.Projector: .projectVector() is now vector.project()."),e.project(t)},this.unprojectVector=function(e,t){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject()."),e.unproject(t)},this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}}function aa(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js"),this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),this.clear=function(){},this.render=function(){},this.setClearColor=function(){},this.setSize=function(){}}void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Number.isInteger&&(Number.isInteger=function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e}),void 0===Math.sign&&(Math.sign=function(e){return e<0?-1:e>0?1:+e}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&!function(){Object.assign=function(e){if(void 0===e||null===e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),n=1;n<arguments.length;n++){var i=arguments[n];if(void 0!==i&&null!==i)for(var r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t[r]=i[r])}return t}}(),Object.assign(e.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&n[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners,i=n[e];if(void 0!==i){var r=i.indexOf(t);r!==-1&&i.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners,n=t[e.type];if(void 0!==n){e.target=this;for(var i=n.slice(0),r=0,a=i.length;r<a;r++)i[r].call(this,e)}}}});var oa="86",sa={LEFT:0,MIDDLE:1,RIGHT:2},ua=0,la=1,ca=2,ha=3,da=0,fa=1,pa=0,ma=1,ga=2,va=0,ya=1,_a=2,xa=1,ba=2,wa=0,Ea=1,Sa=2,Ma=0,Ta=1,Aa=2,La=3,Ra=4,Ca=5,Pa=100,Ia=101,Oa=102,ka=103,Da=104,Na=200,Ua=201,Ba=202,Fa=203,ja=204,za=205,Ga=206,Ha=207,Va=208,Wa=209,qa=210,Xa=0,Ya=1,Ka=2,Za=3,Ja=4,Qa=5,$a=6,eo=7,to=0,no=1,io=2,ro=0,ao=1,oo=2,so=3,uo=4,lo=300,co=301,ho=302,fo=303,po=304,mo=305,go=306,vo=307,yo=1e3,_o=1001,xo=1002,bo=1003,wo=1004,Eo=1005,So=1006,Mo=1007,To=1008,Ao=1009,Lo=1010,Ro=1011,Co=1012,Po=1013,Io=1014,Oo=1015,ko=1016,Do=1017,No=1018,Uo=1019,Bo=1020,Fo=1021,jo=1022,zo=1023,Go=1024,Ho=1025,Vo=zo,Wo=1026,qo=1027,Xo=2001,Yo=2002,Ko=2003,Zo=2004,Jo=2100,Qo=2101,$o=2102,es=2103,ts=2151,ns=2200,is=2201,rs=2202,as=2300,os=2301,ss=2302,us=2400,ls=2401,cs=2402,hs=0,ds=1,fs=2,ps=3e3,ms=3001,gs=3007,vs=3002,ys=3003,_s=3004,xs=3005,bs=3006,ws=3200,Es=3201,Ss={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),n=new Array(36),i=0;return function(){for(var r=0;r<36;r++)8===r||13===r||18===r||23===r?n[r]="-":14===r?n[r]="4":(i<=2&&(i=33554432+16777216*Math.random()|0),e=15&i,i>>=4,n[r]=t[19===r?3&e|8:e]);return n.join("")}}(),clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,i,r){return i+(e-t)*(r-i)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*Ss.DEG2RAD},radToDeg:function(e){return e*Ss.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},nearestPowerOfTwo:function(e){return Math.pow(2,Math.round(Math.log(e)/Math.LN2))},nextPowerOfTwo:function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e++,e}};Object.defineProperties(t.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(t.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,
this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(){var e=new t,n=new t;return function(t,i){return e.set(t,t),n.set(i,i),this.clamp(e,n)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=this.x-e.x,a=this.y-e.y;return this.x=r*n-a*i+e.x,this.y=r*i+a*n+e.y,this}});var Ms=0;n.DEFAULT_IMAGE=void 0,n.DEFAULT_MAPPING=lo,Object.defineProperty(n.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(n.prototype,e.prototype,{constructor:n,isTexture:!0,clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){function t(e){var t;return void 0!==e.toDataURL?t=e:(t=document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),t.getContext("2d").drawImage(e,0,0,e.width,e.height)),t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}if(void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(void 0!==this.image){var i=this.image;void 0===i.uuid&&(i.uuid=Ss.generateUUID()),void 0===e.images[i.uuid]&&(e.images[i.uuid]={uuid:i.uuid,url:t(i)}),n.image=i.uuid}return e.textures[this.uuid]=n,n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping===lo){if(e.multiply(this.repeat),e.add(this.offset),e.x<0||e.x>1)switch(this.wrapS){case yo:e.x=e.x-Math.floor(e.x);break;case _o:e.x=e.x<0?0:1;break;case xo:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case yo:e.y=e.y-Math.floor(e.y);break;case _o:e.y=e.y<0?0:1;break;case xo:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}this.flipY&&(e.y=1-e.y)}}}),Object.assign(i.prototype,{isVector4:!0,set:function(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*r,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*r,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*r,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*r,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,i,r,a=.01,o=.1,s=e.elements,u=s[0],l=s[4],c=s[8],h=s[1],d=s[5],f=s[9],p=s[2],m=s[6],g=s[10];if(Math.abs(l-h)<a&&Math.abs(c-p)<a&&Math.abs(f-m)<a){if(Math.abs(l+h)<o&&Math.abs(c+p)<o&&Math.abs(f+m)<o&&Math.abs(u+d+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var v=(u+1)/2,y=(d+1)/2,_=(g+1)/2,x=(l+h)/4,b=(c+p)/4,w=(f+m)/4;return v>y&&v>_?v<a?(n=0,i=.707106781,r=.707106781):(n=Math.sqrt(v),i=x/n,r=b/n):y>_?y<a?(n=.707106781,i=0,r=.707106781):(i=Math.sqrt(y),n=x/i,r=w/i):_<a?(n=.707106781,i=.707106781,r=0):(r=Math.sqrt(_),n=b/r,i=w/r),this.set(n,i,r,t),this}var E=Math.sqrt((m-f)*(m-f)+(c-p)*(c-p)+(h-l)*(h-l));return Math.abs(E)<.001&&(E=1),this.x=(m-f)/E,this.y=(c-p)/E,this.z=(h-l)/E,this.w=Math.acos((u+d+g-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new i,t=new i),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Object.assign(r.prototype,e.prototype,{isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),a.prototype=Object.create(r.prototype),a.prototype.constructor=a,a.prototype.isWebGLRenderTargetCube=!0,Object.assign(o,{slerp:function(e,t,n,i){return n.copy(e).slerp(t,i)},slerpFlat:function(e,t,n,i,r,a,o){var s=n[i+0],u=n[i+1],l=n[i+2],c=n[i+3],h=r[a+0],d=r[a+1],f=r[a+2],p=r[a+3];if(c!==p||s!==h||u!==d||l!==f){var m=1-o,g=s*h+u*d+l*f+c*p,v=g>=0?1:-1,y=1-g*g;if(y>Number.EPSILON){var _=Math.sqrt(y),x=Math.atan2(_,g*v);m=Math.sin(m*x)/_,o=Math.sin(o*x)/_}var b=o*v;if(s=s*m+h*b,u=u*m+d*b,l=l*m+f*b,c=c*m+p*b,m===1-o){var w=1/Math.sqrt(s*s+u*u+l*l+c*c);s*=w,u*=w,l*=w,c*=w}}e[t]=s,e[t+1]=u,e[t+2]=l,e[t+3]=c}}),Object.defineProperties(o.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this.onChangeCallback()}}}),Object.assign(o.prototype,{set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this.onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,i=e._y,r=e._z,a=e.order,o=Math.cos,s=Math.sin,u=o(n/2),l=o(i/2),c=o(r/2),h=s(n/2),d=s(i/2),f=s(r/2);return"XYZ"===a?(this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f):"YXZ"===a?(this._x=h*l*c+u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f):"ZXY"===a?(this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c-h*d*f):"ZYX"===a?(this._x=h*l*c-u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c+h*d*f):"YZX"===a?(this._x=h*l*c+u*d*f,this._y=u*d*c+h*l*f,this._z=u*l*f-h*d*c,this._w=u*l*c-h*d*f):"XZY"===a&&(this._x=h*l*c-u*d*f,this._y=u*d*c-h*l*f,this._z=u*l*f+h*d*c,this._w=u*l*c+h*d*f),t!==!1&&this.onChangeCallback(),this},setFromAxisAngle:function(e,t){var n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this.onChangeCallback(),this},setFromRotationMatrix:function(e){var t,n=e.elements,i=n[0],r=n[4],a=n[8],o=n[1],s=n[5],u=n[9],l=n[2],c=n[6],h=n[10],d=i+s+h;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-u)*t,this._y=(a-l)*t,this._z=(o-r)*t):i>s&&i>h?(t=2*Math.sqrt(1+i-s-h),this._w=(c-u)/t,this._x=.25*t,this._y=(r+o)/t,this._z=(a+l)/t):s>h?(t=2*Math.sqrt(1+s-i-h),this._w=(a-l)/t,this._x=(r+o)/t,this._y=.25*t,this._z=(u+c)/t):(t=2*Math.sqrt(1+h-i-s),this._w=(o-r)/t,this._x=(a+l)/t,this._y=(u+c)/t,this._z=.25*t),this.onChangeCallback(),this},setFromUnitVectors:function(){var e,t=new s,n=1e-6;return function(i,r){return void 0===t&&(t=new s),e=i.dot(r)+1,e<n?(e=0,Math.abs(i.x)>Math.abs(i.z)?t.set(-i.y,i.x,0):t.set(0,-i.z,i.y)):t.crossVectors(i,r),this._x=t.x,this._y=t.y,this._z=t.z,this._w=e,this.normalize()}}(),inverse:function(){return this.conjugate().normalize()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this.onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this.onChangeCallback(),this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var n=e._x,i=e._y,r=e._z,a=e._w,o=t._x,s=t._y,u=t._z,l=t._w;return this._x=n*l+a*o+i*u-r*s,this._y=i*l+a*s+r*o-n*u,this._z=r*l+a*u+n*s-i*o,this._w=a*l-n*o-i*s-r*u,this.onChangeCallback(),this},slerp:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,i=this._y,r=this._z,a=this._w,o=a*e._w+n*e._x+i*e._y+r*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=i,this._z=r,this;var s=Math.sqrt(1-o*o);if(Math.abs(s)<.001)return this._w=.5*(a+this._w),this._x=.5*(n+this._x),this._y=.5*(i+this._y),this._z=.5*(r+this._z),this;var u=Math.atan2(s,o),l=Math.sin((1-t)*u)/s,c=Math.sin(t*u)/s;return this._w=a*l+this._w*c,this._x=n*l+this._x*c,this._y=i*l+this._y*c,this._z=r*l+this._z*c,this.onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return void 0===t&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(s.prototype,{isVector3:!0,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e=new o;return function(t){return t&&t.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(e.setFromEuler(t))}}(),applyAxisAngle:function(){var e=new o;return function(t,n){return this.applyQuaternion(e.setFromAxisAngle(t,n))}}(),applyMatrix3:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6]*i,this.y=r[1]*t+r[4]*n+r[7]*i,this.z=r[2]*t+r[5]*n+r[8]*i,this},applyMatrix4:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements,a=1/(r[3]*t+r[7]*n+r[11]*i+r[15]);return this.x=(r[0]*t+r[4]*n+r[8]*i+r[12])*a,this.y=(r[1]*t+r[5]*n+r[9]*i+r[13])*a,this.z=(r[2]*t+r[6]*n+r[10]*i+r[14])*a,this},applyQuaternion:function(e){var t=this.x,n=this.y,i=this.z,r=e.x,a=e.y,o=e.z,s=e.w,u=s*t+a*i-o*n,l=s*n+o*t-r*i,c=s*i+r*n-a*t,h=-r*t-a*n-o*i;return this.x=u*s+h*-r+l*-o-c*-a,this.y=l*s+h*-a+c*-r-u*-o,this.z=c*s+h*-o+u*-a-l*-r,this},project:function(){var e=new u;return function(t){return e.multiplyMatrices(t.projectionMatrix,e.getInverse(t.matrixWorld)),this.applyMatrix4(e)}}(),unproject:function(){var e=new u;return function(t){return e.multiplyMatrices(t.matrixWorld,e.getInverse(t.projectionMatrix)),this.applyMatrix4(e)}}(),transformDirection:function(e){var t=this.x,n=this.y,i=this.z,r=e.elements;return this.x=r[0]*t+r[4]*n+r[8]*i,this.y=r[1]*t+r[5]*n+r[9]*i,this.z=r[2]*t+r[6]*n+r[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(){var e=new s,t=new s;return function(n,i){return e.set(n,n,n),t.set(i,i,i),this.clamp(e,t)}}(),clampLength:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,n){return this.subVectors(t,e).multiplyScalar(n).add(e)},cross:function(e,t){if(void 0!==t)return console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,i=this.y,r=this.z;return this.x=i*e.z-r*e.y,this.y=r*e.x-n*e.z,this.z=n*e.y-i*e.x,this},crossVectors:function(e,t){var n=e.x,i=e.y,r=e.z,a=t.x,o=t.y,s=t.z;return this.x=i*s-r*o,this.y=r*a-n*s,this.z=n*o-i*a,this},projectOnVector:function(e){var t=e.dot(this)/e.lengthSq();return this.copy(e).multiplyScalar(t)},projectOnPlane:function(){var e=new s;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new s;return function(t){return this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){var t=this.dot(e)/Math.sqrt(this.lengthSq()*e.lengthSq());return Math.acos(Ss.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i},distanceToManhattan:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){var t=Math.sin(e.phi)*e.radius;return this.x=t*Math.sin(e.theta),this.y=Math.cos(e.phi)*e.radius,this.z=t*Math.cos(e.theta),this},setFromCylindrical:function(e){return this.x=e.radius*Math.sin(e.theta),this.y=e.y,this.z=e.radius*Math.cos(e.theta),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return void 0===t&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}}),Object.assign(u.prototype,{isMatrix4:!0,set:function(e,t,n,i,r,a,o,s,u,l,c,h,d,f,p,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=n,g[12]=i,g[1]=r,g[5]=a,g[9]=o,g[13]=s,g[2]=u,g[6]=l,g[10]=c,g[14]=h,g[3]=d,g[7]=f,g[11]=p,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return(new u).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this},copyPosition:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this},extractBasis:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this},extractRotation:function(){var e=new s;return function(t){var n=this.elements,i=t.elements,r=1/e.setFromMatrixColumn(t,0).length(),a=1/e.setFromMatrixColumn(t,1).length(),o=1/e.setFromMatrixColumn(t,2).length();return n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n[4]=i[4]*a,n[5]=i[5]*a,n[6]=i[6]*a,n[8]=i[8]*o,n[9]=i[9]*o,n[10]=i[10]*o,this}}(),makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,i=e.y,r=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(i),u=Math.sin(i),l=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var h=a*l,d=a*c,f=o*l,p=o*c;t[0]=s*l,t[4]=-s*c,t[8]=u,t[1]=d+f*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=f+d*u,t[10]=a*s}else if("YXZ"===e.order){var m=s*l,g=s*c,v=u*l,y=u*c;t[0]=m+y*o,t[4]=v*o-g,t[8]=a*u,t[1]=a*c,t[5]=a*l,t[9]=-o,t[2]=g*o-v,t[6]=y+m*o,t[10]=a*s}else if("ZXY"===e.order){var m=s*l,g=s*c,v=u*l,y=u*c;t[0]=m-y*o,t[4]=-a*c,t[8]=v+g*o,t[1]=g+v*o,t[5]=a*l,t[9]=y-m*o,t[2]=-a*u,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var h=a*l,d=a*c,f=o*l,p=o*c;t[0]=s*l,t[4]=f*u-d,t[8]=h*u+p,t[1]=s*c,t[5]=p*u+h,t[9]=d*u-f,t[2]=-u,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var _=a*s,x=a*u,b=o*s,w=o*u;t[0]=s*l,t[4]=w-_*c,t[8]=b*c+x,t[1]=c,t[5]=a*l,t[9]=-o*l,t[2]=-u*l,t[6]=x*c+b,t[10]=_-w*c}else if("XZY"===e.order){var _=a*s,x=a*u,b=o*s,w=o*u;t[0]=s*l,t[4]=-c,t[8]=u*l,t[1]=_*c+w,t[5]=a*l,t[9]=x*c-b,t[2]=b*c-x,t[6]=o*l,t[10]=w*c+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){var t=this.elements,n=e._x,i=e._y,r=e._z,a=e._w,o=n+n,s=i+i,u=r+r,l=n*o,c=n*s,h=n*u,d=i*s,f=i*u,p=r*u,m=a*o,g=a*s,v=a*u;return t[0]=1-(d+p),t[4]=c-v,t[8]=h+g,t[1]=c+v,t[5]=1-(l+p),t[9]=f-m,t[2]=h-g,t[6]=f+m,t[10]=1-(l+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new s,t=new s,n=new s;return function(i,r,a){var o=this.elements;return n.subVectors(i,r),0===n.lengthSq()&&(n.z=1),n.normalize(),e.crossVectors(a,n),0===e.lengthSq()&&(1===Math.abs(a.z)?n.x+=1e-4:n.z+=1e-4,n.normalize(),e.crossVectors(a,n)),e.normalize(),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[4],s=n[8],u=n[12],l=n[1],c=n[5],h=n[9],d=n[13],f=n[2],p=n[6],m=n[10],g=n[14],v=n[3],y=n[7],_=n[11],x=n[15],b=i[0],w=i[4],E=i[8],S=i[12],M=i[1],T=i[5],A=i[9],L=i[13],R=i[2],C=i[6],P=i[10],I=i[14],O=i[3],k=i[7],D=i[11],N=i[15];return r[0]=a*b+o*M+s*R+u*O,r[4]=a*w+o*T+s*C+u*k,r[8]=a*E+o*A+s*P+u*D,r[12]=a*S+o*L+s*I+u*N,r[1]=l*b+c*M+h*R+d*O,r[5]=l*w+c*T+h*C+d*k,r[9]=l*E+c*A+h*P+d*D,r[13]=l*S+c*L+h*I+d*N,r[2]=f*b+p*M+m*R+g*O,r[6]=f*w+p*T+m*C+g*k,r[10]=f*E+p*A+m*P+g*D,r[14]=f*S+p*L+m*I+g*N,r[3]=v*b+y*M+_*R+x*O,r[7]=v*w+y*T+_*C+x*k,r[11]=v*E+y*A+_*P+x*D,r[15]=v*S+y*L+_*I+x*N,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},applyToBufferAttribute:function(){var e=new s;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix4(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),determinant:function(){var e=this.elements,t=e[0],n=e[4],i=e[8],r=e[12],a=e[1],o=e[5],s=e[9],u=e[13],l=e[2],c=e[6],h=e[10],d=e[14],f=e[3],p=e[7],m=e[11],g=e[15];return f*(+r*s*c-i*u*c-r*o*h+n*u*h+i*o*d-n*s*d)+p*(+t*s*d-t*u*h+r*a*h-i*a*d+i*u*l-r*s*l)+m*(+t*u*c-t*o*d-r*a*c+n*a*d+r*o*l-n*u*l)+g*(-i*o*l-t*s*c+t*o*h+i*a*c-n*a*h+n*s*l)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,i=e.elements,r=i[0],a=i[1],o=i[2],s=i[3],u=i[4],l=i[5],c=i[6],h=i[7],d=i[8],f=i[9],p=i[10],m=i[11],g=i[12],v=i[13],y=i[14],_=i[15],x=f*y*h-v*p*h+v*c*m-l*y*m-f*c*_+l*p*_,b=g*p*h-d*y*h-g*c*m+u*y*m+d*c*_-u*p*_,w=d*v*h-g*f*h+g*l*m-u*v*m-d*l*_+u*f*_,E=g*f*c-d*v*c-g*l*p+u*v*p+d*l*y-u*f*y,S=r*x+a*b+o*w+s*E;if(0===S){var M="THREE.Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t===!0)throw new Error(M);return console.warn(M),this.identity()}var T=1/S;return n[0]=x*T,n[1]=(v*p*s-f*y*s-v*o*m+a*y*m+f*o*_-a*p*_)*T,n[2]=(l*y*s-v*c*s+v*o*h-a*y*h-l*o*_+a*c*_)*T,n[3]=(f*c*s-l*p*s-f*o*h+a*p*h+l*o*m-a*c*m)*T,n[4]=b*T,n[5]=(d*y*s-g*p*s+g*o*m-r*y*m-d*o*_+r*p*_)*T,n[6]=(g*c*s-u*y*s-g*o*h+r*y*h+u*o*_-r*c*_)*T,n[7]=(u*p*s-d*c*s+d*o*h-r*p*h-u*o*m+r*c*m)*T,n[8]=w*T,n[9]=(g*f*s-d*v*s-g*a*m+r*v*m+d*a*_-r*f*_)*T,n[10]=(u*v*s-g*l*s+g*a*h-r*v*h-u*a*_+r*l*_)*T,n[11]=(d*l*s-u*f*s-d*a*h+r*f*h+u*a*m-r*l*m)*T,n[12]=E*T,n[13]=(d*v*o-g*f*o+g*a*p-r*v*p-d*a*y+r*f*y)*T,n[14]=(g*l*o-u*v*o-g*a*c+r*v*c+u*a*y-r*l*y)*T,n[15]=(u*f*o-d*l*o+d*a*c-r*f*c-u*a*p+r*l*p)*T,this},scale:function(e){var t=this.elements,n=e.x,i=e.y,r=e.z;return t[0]*=n,t[4]*=i,t[8]*=r,t[1]*=n,t[5]*=i,t[9]*=r,t[2]*=n,t[6]*=i,t[10]*=r,t[3]*=n,t[7]*=i,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),n=Math.sin(e);
return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),i=Math.sin(t),r=1-n,a=e.x,o=e.y,s=e.z,u=r*a,l=r*o;return this.set(u*a+n,u*o-i*s,u*s+i*o,0,u*o+i*s,l*o+n,l*s-i*a,0,u*s-i*o,l*s+i*a,r*s*s+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},makeShear:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new s,t=new u;return function(n,i,r){var a=this.elements,o=e.set(a[0],a[1],a[2]).length(),s=e.set(a[4],a[5],a[6]).length(),u=e.set(a[8],a[9],a[10]).length(),l=this.determinant();l<0&&(o=-o),n.x=a[12],n.y=a[13],n.z=a[14],t.copy(this);var c=1/o,h=1/s,d=1/u;return t.elements[0]*=c,t.elements[1]*=c,t.elements[2]*=c,t.elements[4]*=h,t.elements[5]*=h,t.elements[6]*=h,t.elements[8]*=d,t.elements[9]*=d,t.elements[10]*=d,i.setFromRotationMatrix(t),r.x=o,r.y=s,r.z=u,this}}(),makePerspective:function(e,t,n,i,r,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*r/(t-e),u=2*r/(n-i),l=(t+e)/(t-e),c=(n+i)/(n-i),h=-(a+r)/(a-r),d=-2*a*r/(a-r);return o[0]=s,o[4]=0,o[8]=l,o[12]=0,o[1]=0,o[5]=u,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=d,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makeOrthographic:function(e,t,n,i,r,a){var o=this.elements,s=1/(t-e),u=1/(n-i),l=1/(a-r),c=(t+e)*s,h=(n+i)*u,d=(a+r)*l;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*l,o[14]=-d,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<16;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}),l.prototype=Object.create(n.prototype),l.prototype.constructor=l,l.prototype.isDataTexture=!0,c.prototype=Object.create(n.prototype),c.prototype.constructor=c,c.prototype.isCubeTexture=!0,Object.defineProperty(c.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Ts=new n,As=new c,Ls=[],Rs=[],Cs=new Float32Array(16),Ps=new Float32Array(9);z.prototype.setValue=function(e,t){for(var n=this.seq,i=0,r=n.length;i!==r;++i){var a=n[i];a.setValue(e,t[a.id])}};var Is=/([\w\d_]+)(\])?(\[|\.)?/g;V.prototype.setValue=function(e,t,n){var i=this.map[t];void 0!==i&&i.setValue(e,n,this.renderer)},V.prototype.setOptional=function(e,t,n){var i=t[n];void 0!==i&&this.setValue(e,n,i)},V.upload=function(e,t,n,i){for(var r=0,a=t.length;r!==a;++r){var o=t[r],s=n[o.id];s.needsUpdate!==!1&&o.setValue(e,s.value,i)}},V.seqWithValue=function(e,t){for(var n=[],i=0,r=e.length;i!==r;++i){var a=e[i];a.id in t&&n.push(a)}return n};var Os={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Object.assign(W.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(){function e(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}return function(t,n,i){if(t=Ss.euclideanModulo(t,1),n=Ss.clamp(n,0,1),i=Ss.clamp(i,0,1),0===n)this.r=this.g=this.b=i;else{var r=i<=.5?i*(1+n):i+n-i*n,a=2*i-r;this.r=e(a,r,t+1/3),this.g=e(a,r,t),this.b=e(a,r,t-1/3)}return this}}(),setStyle:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,r=n[1],a=n[2];switch(r){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(a)){var o=parseFloat(i[1])/360,s=parseInt(i[2],10)/100,u=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(o,s,u)}}}else if(n=/^\#([A-Fa-f0-9]+)$/.exec(e)){var l=n[1],c=l.length;if(3===c)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,this}if(e&&e.length>0){var l=Os[e];void 0!==l?this.setHex(l):console.warn("THREE.Color: Unknown color "+e)}return this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return void 0===t&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){void 0===t&&(t=2);var n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,n,i=e||{h:0,s:0,l:0},r=this.r,a=this.g,o=this.b,s=Math.max(r,a,o),u=Math.min(r,a,o),l=(u+s)/2;if(u===s)t=0,n=0;else{var c=s-u;switch(n=l<=.5?c/(s+u):c/(2-s-u),s){case r:t=(a-o)/c+(a<o?6:0);break;case a:t=(o-r)/c+2;break;case o:t=(r-a)/c+4}t/=6}return i.h=t,i.s=n,i.l=l,i},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var i=this.getHSL();return i.h+=e,i.s+=t,i.l+=n,this.setHSL(i.h,i.s,i.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return void 0===t&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}});var ks={common:{diffuse:{value:new W(15658734)},opacity:{value:1},map:{value:null},offsetRepeat:{value:new i(0,0,1,1)},specularMap:{value:null},alphaMap:{value:null},envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new t(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new W(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new W(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},offsetRepeat:{value:new i(0,0,1,1)}}},Ds={merge:function(e){for(var t={},n=0;n<e.length;n++){var i=this.clone(e[n]);for(var r in i)t[r]=i[r]}return t},clone:function(e){var t={};for(var n in e){t[n]={};for(var i in e[n]){var r=e[n][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture)?t[n][i]=r.clone():Array.isArray(r)?t[n][i]=r.slice():t[n][i]=r}}return t}},Ns="#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif\n",Us="#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif\n",Bs="#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif\n",Fs="#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif\n",js="#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",zs="\nvec3 transformed = vec3( position );\n",Gs="\nvec3 objectNormal = vec3( normal );\n",Hs="float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\tif( decayExponent > 0.0 ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\n#else\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n#endif\n\t}\n\treturn 1.0;\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE  = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\n\tfloat theta = acos( dot( N, V ) );\n\tvec2 uv = vec2(\n\t\tsqrt( saturate( roughness ) ),\n\t\tsaturate( theta / ( 0.5 * PI ) ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.86267 + (0.49788 + 0.01436 * y ) * y;\n\tfloat b = 3.45068 + (4.18814 + y) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = (x > 0.0) ? v : 0.5 * inversesqrt( 1.0 - x * x ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transpose( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tvec3 result = vec3( LTC_ClippedSphereFormFactor( vectorFormFactor ) );\n\treturn result;\n}\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\n\treturn specularColor * AB.x + AB.y;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n",Vs="#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif\n",Ws="#if NUM_CLIPPING_PLANES > 0\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; ++ i ) {\n\t\tvec4 plane = clippingPlanes[ i ];\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t\t\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; ++ i ) {\n\t\t\tvec4 plane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\tif ( clipped ) discard;\n\t\n\t#endif\n#endif\n",qs="#if NUM_CLIPPING_PLANES > 0\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\n\t\tvarying vec3 vViewPosition;\n\t#endif\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif\n",Xs="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvarying vec3 vViewPosition;\n#endif\n",Ys="#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n",Ks="#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",Zs="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif\n",Js="#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",Qs="#ifdef USE_COLOR\n\tvColor.xyz = color.xyz;\n#endif",$s="#define PI 3.14159265359\n#define PI2 6.28318530718\n#define PI_HALF 1.5707963267949\n#define RECIPROCAL_PI 0.31830988618\n#define RECIPROCAL_PI2 0.15915494\n#define LOG2 1.442695\n#define EPSILON 1e-6\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transpose( const in mat3 v ) {\n\tmat3 tmp;\n\ttmp[0] = vec3(v[0].x, v[1].x, v[2].x);\n\ttmp[1] = vec3(v[0].y, v[1].y, v[2].y);\n\ttmp[2] = vec3(v[0].z, v[1].z, v[2].z);\n\treturn tmp;\n}\n",eu="#ifdef ENVMAP_TYPE_CUBE_UV\n#define cubeUV_textureSize (1024.0)\nint getFaceFromDirection(vec3 direction) {\n\tvec3 absDirection = abs(direction);\n\tint face = -1;\n\tif( absDirection.x > absDirection.z ) {\n\t\tif(absDirection.x > absDirection.y )\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\telse {\n\t\tif(absDirection.z > absDirection.y )\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\n\t\telse\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\n\t}\n\treturn face;\n}\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\n\tfloat dxRoughness = dFdx(roughness);\n\tfloat dyRoughness = dFdy(roughness);\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\n\tfloat mipLevel = 0.5 * log2(d);\n\treturn vec2(floor(mipLevel), fract(mipLevel));\n}\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\n\tbool bRes = mipLevel == 0.0;\n\tscale =  bRes && (scale < a) ? a : scale;\n\tvec3 r;\n\tvec2 offset;\n\tint face = getFaceFromDirection(direction);\n\tfloat rcpPowScale = 1.0 / powScale;\n\tif( face == 0) {\n\t\tr = vec3(direction.x, -direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 1) {\n\t\tr = vec3(direction.y, direction.x, direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 2) {\n\t\tr = vec3(direction.z, direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\n\t}\n\telse if( face == 3) {\n\t\tr = vec3(direction.x, direction.z, direction.y);\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse if( face == 4) {\n\t\tr = vec3(direction.y, direction.x, -direction.z);\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\telse {\n\t\tr = vec3(direction.z, -direction.x, direction.y);\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\n\t}\n\tr = normalize(r);\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\n\tvec2 base = offset + vec2( texelOffset );\n\treturn base + s * ( scale - 2.0 * texelOffset );\n}\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\n\tfloat r1 = floor(roughnessVal);\n\tfloat r2 = r1 + 1.0;\n\tfloat t = fract(roughnessVal);\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\n\tfloat s = mipInfo.y;\n\tfloat level0 = mipInfo.x;\n\tfloat level1 = level0 + 1.0;\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\n\tvec4 result = mix(color10, color20, t);\n\treturn vec4(result.rgb, 1.0);\n}\n#endif\n",tu="vec3 transformedNormal = normalMatrix * objectNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n",nu="#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif\n",iu="#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\n#endif\n",ru="#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif\n",au="#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif\n",ou="  gl_FragColor = linearToOutputTexel( gl_FragColor );\n",su="\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM            = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\n\tD            = min( floor( D ) / 255.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value )  {\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract(Le);\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\n\treturn vec4( max(vRGB, 0.0), 1.0 );\n}\n",uu="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\tvec2 sampleUV;\n\t\tsampleUV.y = asin( flipNormal * reflectVec.y ) * RECIPROCAL_PI + 0.5;\n\t\tsampleUV.x = atan( flipNormal * reflectVec.z, flipNormal * reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\n\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\tvec3 reflectView = flipNormal * normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\tenvColor = envMapTexelToLinear( envColor );\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif\n",lu="#if defined( USE_ENVMAP ) || defined( PHYSICAL )\n\tuniform float reflectivity;\n\tuniform float envMapIntensity;\n#endif\n#ifdef USE_ENVMAP\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\n\t\tvarying vec3 vWorldPosition;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\tuniform float flipEnvMap;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif\n",cu="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif\n",hu="#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif\n",du="\n#ifdef USE_FOG\nfogDepth = -mvPosition.z;\n#endif",fu="#ifdef USE_FOG\n  varying float fogDepth;\n#endif\n",pu="#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif\n",mu="#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif\n",gu="#ifdef TOON\n\tuniform sampler2D gradientMap;\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\t\tfloat dotNL = dot( normal, lightDirection );\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t\t#ifdef USE_GRADIENTMAP\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\n\t\t#else\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t\t#endif\n\t}\n#endif\n",vu="#ifdef USE_LIGHTMAP\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n#endif\n",yu="#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",_u="vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\n#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n#endif\n",xu="uniform vec3 ambientLightColor;\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t\tint shadow;\n\t\tfloat shadowBias;\n\t\tfloat shadowRadius;\n\t\tvec2 shadowMapSize;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltcMat;\tuniform sampler2D ltcMag;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar - 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\n\t\t\tvec2 sampleUV;\n\t\t\tsampleUV.y = saturate( reflectVec.y * 0.5 + 0.5 );\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif\n",bu="BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;\n",wu="varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3\tdiffuseColor;\n\tvec3\tspecularColor;\n\tfloat\tspecularShininess;\n\tfloat\tspecularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifdef TOON\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#else\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\t\tvec3 irradiance = dotNL * directLight.color;\n\t#endif\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)\n",Eu="PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\n#ifdef STANDARD\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.clearCoat = saturate( clearCoat );\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\n#endif\n",Su="struct PhysicalMaterial {\n\tvec3\tdiffuseColor;\n\tfloat\tspecularRoughness;\n\tvec3\tspecularColor;\n\t#ifndef STANDARD\n\t\tfloat clearCoat;\n\t\tfloat clearCoatRoughness;\n\t#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tfloat norm = texture2D( ltcMag, uv ).a;\n\t\tvec4 t = texture2D( ltcMat, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3(   1,   0, t.y ),\n\t\t\tvec3(   0, t.z,   0 ),\n\t\t\tvec3( t.w,   0, t.x )\n\t\t);\n\t\treflectedLight.directSpecular += lightColor * material.specularColor * norm * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifndef STANDARD\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\t#ifndef STANDARD\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t#ifndef STANDARD\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\tfloat dotNL = dotNV;\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\n\t#else\n\t\tfloat clearCoatDHR = 0.0;\n\t#endif\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\n\t#ifndef STANDARD\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\n\t#endif\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}\n",Mu="\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = normalize( vViewPosition );\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#ifdef USE_SHADOWMAP\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\t#ifdef USE_LIGHTMAP\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\n\t#endif\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\n\t#ifndef STANDARD\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\n\t#else\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\n\t#endif\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\n#endif\n",Tu="#if defined(USE_LOGDEPTHBUF) && defined(USE_LOGDEPTHBUF_EXT)\n\tgl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n#endif",Au="#ifdef USE_LOGDEPTHBUF\n\tuniform float logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n#endif\n",Lu="#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t#endif\n\tuniform float logDepthBufFC;\n#endif",Ru="#ifdef USE_LOGDEPTHBUF\n\tgl_Position.z = log2(max( EPSILON, gl_Position.w + 1.0 )) * logDepthBufFC;\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t#else\n\t\tgl_Position.z = (gl_Position.z - 1.0) * gl_Position.w;\n\t#endif\n#endif\n",Cu="#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif\n",Pu="#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n",Iu="#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) * offsetRepeat.zw + offsetRepeat.xy );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n",Ou="#ifdef USE_MAP\n\tuniform vec4 offsetRepeat;\n\tuniform sampler2D map;\n#endif\n",ku="float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif\n",Du="#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",Nu="#ifdef USE_MORPHNORMALS\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\n#endif\n",Uu="#ifdef USE_MORPHTARGETS\n\t#ifndef USE_MORPHNORMALS\n\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",Bu="#ifdef USE_MORPHTARGETS\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n\t#endif\n#endif\n",Fu="#ifdef DOUBLE_SIDED\n\tfloat flipNormal = ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n#else\n\tfloat flipNormal = 1.0;\n#endif\n",ju="#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal ) * flipNormal;\n#endif\n#ifdef USE_NORMALMAP\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n",zu="#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\n\t\tvec3 N = normalize( surf_norm );\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t\tmapN.xy = normalScale * mapN.xy;\n\t\tmat3 tsn = mat3( S, T, N );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif\n",Gu="vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 1.0 - 2.0 * rgb.xyz;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}\n",Hu="#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif\n",Vu="vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n",Wu="#if defined( DITHERING )\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif\n",qu="#if defined( DITHERING )\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif\n",Xu="float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif\n",Yu="#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",Ku="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\n\t\tvec2 f = fract( uv * size + 0.5 );\n\t\tfloat a = mix( lb, lt, f.y );\n\t\tfloat b = mix( rb, rt, f.y );\n\t\tfloat c = mix( a, b, f.x );\n\t\treturn c;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tshadow = (\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\tfloat dp = ( length( lightToPosition ) - shadowBias ) / 1000.0;\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif\n",Zu="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\n\t#endif\n#endif\n",Ju="#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\n\t}\n\t#endif\n#endif\n",Qu="float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHTS > 0\n\tDirectionalLight directionalLight;\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_SPOT_LIGHTS > 0\n\tSpotLight spotLight;\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#if NUM_POINT_LIGHTS > 0\n\tPointLight pointLight;\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ] ) : 1.0;\n\t}\n\t#endif\n\t#endif\n\treturn shadow;\n}\n",$u="#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",el="#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif\n",tl="#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif\n",nl="#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n#endif\n",il="float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",rl="#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",al="#if defined( TONE_MAPPING )\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif\n",ol="#define saturate(a) clamp( a, 0.0, 1.0 )\nuniform float toneMappingExposure;\nuniform float toneMappingWhitePoint;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\nvec3 Uncharted2ToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\n",sl="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n#endif",ul="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvarying vec2 vUv;\n\tuniform vec4 offsetRepeat;\n#endif\n",ll="#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\n\tvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",cl="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",hl="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n#endif",dl="#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = uv2;\n#endif",fl="#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( PHYSICAL ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\n#endif\n",pl="uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n\tgl_FragColor.a *= opacity;\n}\n",ml="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",gl="#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\n\t#endif\n}\n",vl="#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n}\n",yl="uniform vec3 lightPos;\nvarying vec4 vWorldPosition;\n#include <common>\n#include <packing>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tgl_FragColor = packDepthToRGBA( length( vWorldPosition.xyz - lightPos.xyz ) / 1000.0 );\n}\n",_l="varying vec4 vWorldPosition;\n#include <common>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <skinbase_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition;\n}\n",xl="uniform sampler2D tEquirect;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldPosition );\n\tvec2 sampleUV;\n\tsampleUV.y = saturate( tFlip * direction.y * -0.5 + 0.5 );\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n}\n",bl="varying vec3 vWorldPosition;\n#include <common>\nvoid main() {\n\tvWorldPosition = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}\n",wl="uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",El="uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\tvLineDistance = scale * lineDistance;\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}\n",Sl="uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Ml="#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}\n",Tl="uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <normal_flip>\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Al="#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Ll="#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Rl="#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Cl="#define PHYSICAL\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifndef STANDARD\n\tuniform float clearCoat;\n\tuniform float clearCoatRoughness;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <lights_pars>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_template>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}\n",Pl="#define PHYSICAL\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Il="#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\nvoid main() {\n\t#include <logdepthbuf_fragment>\n\t#include <normal_flip>\n\t#include <normal_fragment>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}\n",Ol="#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}\n",kl="uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <premultiplied_alpha_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}\n",Dl="uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#ifdef USE_SIZEATTENUATION\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\n\t#else\n\t\tgl_PointSize = size;\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}\n",Nl="uniform float opacity;\n#include <common>\n#include <packing>\n#include <bsdfs>\n#include <lights_pars>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( 0.0, 0.0, 0.0, opacity * ( 1.0 - getShadowMask() ) );\n}\n",Ul="#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n}\n",Bl={
alphamap_fragment:Ns,alphamap_pars_fragment:Us,alphatest_fragment:Bs,aomap_fragment:Fs,aomap_pars_fragment:js,begin_vertex:zs,beginnormal_vertex:Gs,bsdfs:Hs,bumpmap_pars_fragment:Vs,clipping_planes_fragment:Ws,clipping_planes_pars_fragment:qs,clipping_planes_pars_vertex:Xs,clipping_planes_vertex:Ys,color_fragment:Ks,color_pars_fragment:Zs,color_pars_vertex:Js,color_vertex:Qs,common:$s,cube_uv_reflection_fragment:eu,defaultnormal_vertex:tu,displacementmap_pars_vertex:nu,displacementmap_vertex:iu,emissivemap_fragment:ru,emissivemap_pars_fragment:au,encodings_fragment:ou,encodings_pars_fragment:su,envmap_fragment:uu,envmap_pars_fragment:lu,envmap_pars_vertex:cu,envmap_vertex:hu,fog_vertex:du,fog_pars_vertex:fu,fog_fragment:pu,fog_pars_fragment:mu,gradientmap_pars_fragment:gu,lightmap_fragment:vu,lightmap_pars_fragment:yu,lights_lambert_vertex:_u,lights_pars:xu,lights_phong_fragment:bu,lights_phong_pars_fragment:wu,lights_physical_fragment:Eu,lights_physical_pars_fragment:Su,lights_template:Mu,logdepthbuf_fragment:Tu,logdepthbuf_pars_fragment:Au,logdepthbuf_pars_vertex:Lu,logdepthbuf_vertex:Ru,map_fragment:Cu,map_pars_fragment:Pu,map_particle_fragment:Iu,map_particle_pars_fragment:Ou,metalnessmap_fragment:ku,metalnessmap_pars_fragment:Du,morphnormal_vertex:Nu,morphtarget_pars_vertex:Uu,morphtarget_vertex:Bu,normal_flip:Fu,normal_fragment:ju,normalmap_pars_fragment:zu,packing:Gu,premultiplied_alpha_fragment:Hu,project_vertex:Vu,dithering_fragment:Wu,dithering_pars_fragment:qu,roughnessmap_fragment:Xu,roughnessmap_pars_fragment:Yu,shadowmap_pars_fragment:Ku,shadowmap_pars_vertex:Zu,shadowmap_vertex:Ju,shadowmask_pars_fragment:Qu,skinbase_vertex:$u,skinning_pars_vertex:el,skinning_vertex:tl,skinnormal_vertex:nl,specularmap_fragment:il,specularmap_pars_fragment:rl,tonemapping_fragment:al,tonemapping_pars_fragment:ol,uv_pars_fragment:sl,uv_pars_vertex:ul,uv_vertex:ll,uv2_pars_fragment:cl,uv2_pars_vertex:hl,uv2_vertex:dl,worldpos_vertex:fl,cube_frag:pl,cube_vert:ml,depth_frag:gl,depth_vert:vl,distanceRGBA_frag:yl,distanceRGBA_vert:_l,equirect_frag:xl,equirect_vert:bl,linedashed_frag:wl,linedashed_vert:El,meshbasic_frag:Sl,meshbasic_vert:Ml,meshlambert_frag:Tl,meshlambert_vert:Al,meshphong_frag:Ll,meshphong_vert:Rl,meshphysical_frag:Cl,meshphysical_vert:Pl,normal_frag:Il,normal_vert:Ol,points_frag:kl,points_vert:Dl,shadow_frag:Nl,shadow_vert:Ul},Fl={basic:{uniforms:Ds.merge([ks.common,ks.aomap,ks.lightmap,ks.fog]),vertexShader:Bl.meshbasic_vert,fragmentShader:Bl.meshbasic_frag},lambert:{uniforms:Ds.merge([ks.common,ks.aomap,ks.lightmap,ks.emissivemap,ks.fog,ks.lights,{emissive:{value:new W(0)}}]),vertexShader:Bl.meshlambert_vert,fragmentShader:Bl.meshlambert_frag},phong:{uniforms:Ds.merge([ks.common,ks.aomap,ks.lightmap,ks.emissivemap,ks.bumpmap,ks.normalmap,ks.displacementmap,ks.gradientmap,ks.fog,ks.lights,{emissive:{value:new W(0)},specular:{value:new W(1118481)},shininess:{value:30}}]),vertexShader:Bl.meshphong_vert,fragmentShader:Bl.meshphong_frag},standard:{uniforms:Ds.merge([ks.common,ks.aomap,ks.lightmap,ks.emissivemap,ks.bumpmap,ks.normalmap,ks.displacementmap,ks.roughnessmap,ks.metalnessmap,ks.fog,ks.lights,{emissive:{value:new W(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Bl.meshphysical_vert,fragmentShader:Bl.meshphysical_frag},points:{uniforms:Ds.merge([ks.points,ks.fog]),vertexShader:Bl.points_vert,fragmentShader:Bl.points_frag},dashed:{uniforms:Ds.merge([ks.common,ks.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Bl.linedashed_vert,fragmentShader:Bl.linedashed_frag},depth:{uniforms:Ds.merge([ks.common,ks.displacementmap]),vertexShader:Bl.depth_vert,fragmentShader:Bl.depth_frag},normal:{uniforms:Ds.merge([ks.common,ks.bumpmap,ks.normalmap,ks.displacementmap,{opacity:{value:1}}]),vertexShader:Bl.normal_vert,fragmentShader:Bl.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Bl.cube_vert,fragmentShader:Bl.cube_frag},equirect:{uniforms:{tEquirect:{value:null},tFlip:{value:-1}},vertexShader:Bl.equirect_vert,fragmentShader:Bl.equirect_frag},distanceRGBA:{uniforms:{lightPos:{value:new s}},vertexShader:Bl.distanceRGBA_vert,fragmentShader:Bl.distanceRGBA_frag}};Fl.physical={uniforms:Ds.merge([Fl.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:Bl.meshphysical_vert,fragmentShader:Bl.meshphysical_frag},Object.assign(q.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new t;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=+(1/0),this.max.x=this.max.y=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){var n=e||new t;return this.isEmpty()?n.set(0,0):n.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var n=e||new t;return this.isEmpty()?n.set(0,0):n.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,n){var i=n||new t;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,n){var i=n||new t;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new t;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var jl=0;Object.assign(K.prototype,e.prototype,{isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n){var i=this[t];void 0!==i?i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):"overdraw"===t?this[t]=Number(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){function t(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}var n=void 0===e;n&&(e={textures:{},images:{}});var i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearCoat&&(i.clearCoat=this.clearCoat),void 0!==this.clearCoatRoughness&&(i.clearCoatRoughness=this.clearCoatRoughness),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,i.reflectivity=this.reflectivity),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(i.size=this.size),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==Ta&&(i.blending=this.blending),this.shading!==ba&&(i.shading=this.shading),this.side!==va&&(i.side=this.side),this.vertexColors!==wa&&(i.vertexColors=this.vertexColors),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),i.skinning=this.skinning,i.morphTargets=this.morphTargets,i.dithering=this.dithering,n){var r=t(e.textures),a=t(e.images);r.length>0&&(i.textures=r),a.length>0&&(i.images=a)}return i},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.lights=e.lights,this.blending=e.blending,this.side=e.side,this.shading=e.shading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.overdraw=e.overdraw,this.visible=e.visible,this.clipShadows=e.clipShadows,this.clipIntersection=e.clipIntersection;var t=e.clippingPlanes,n=null;if(null!==t){var i=t.length;n=new Array(i);for(var r=0;r!==i;++r)n[r]=t[r].clone()}return this.clippingPlanes=n,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Z.prototype=Object.create(K.prototype),Z.prototype.constructor=Z,Z.prototype.isShaderMaterial=!0,Z.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ds.clone(e.uniforms),this.defines=e.defines,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Z.prototype.toJSON=function(e){var t=K.prototype.toJSON.call(this,e);return t.uniforms=this.uniforms,t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t},J.prototype=Object.create(K.prototype),J.prototype.constructor=J,J.prototype.isMeshDepthMaterial=!0,J.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Object.assign(Q.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=+(1/0),n=+(1/0),i=+(1/0),r=-(1/0),a=-(1/0),o=-(1/0),s=0,u=e.length;s<u;s+=3){var l=e[s],c=e[s+1],h=e[s+2];l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromBufferAttribute:function(e){for(var t=+(1/0),n=+(1/0),i=+(1/0),r=-(1/0),a=-(1/0),o=-(1/0),s=0,u=e.count;s<u;s++){var l=e.getX(s),c=e.getY(s),h=e.getZ(s);l<t&&(t=l),c<n&&(n=c),h<i&&(i=h),l>r&&(r=l),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,i),this.max.set(r,a,o),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(){var e=new s;return function(t,n){var i=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(i),this.max.copy(t).add(i),this}}(),setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=+(1/0),this.max.x=this.max.y=this.max.z=-(1/0),this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){var t=e||new s;return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){var t=e||new s;return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(){var e=new s;return function(t){var n=this;return t.updateMatrixWorld(!0),t.traverse(function(t){var i,r,a=t.geometry;if(void 0!==a)if(a.isGeometry){var o=a.vertices;for(i=0,r=o.length;i<r;i++)e.copy(o[i]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}else if(a.isBufferGeometry){var s=a.attributes.position;if(void 0!==s)for(i=0,r=s.count;i<r;i++)e.fromBufferAttribute(s,i).applyMatrix4(t.matrixWorld),n.expandByPoint(e)}}),this}}(),containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){var n=t||new s;return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(){var e=new s;return function(t){return this.clampPoint(t.center,e),e.distanceToSquared(t.center)<=t.radius*t.radius}}(),intersectsPlane:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=e.constant&&n>=e.constant},clampPoint:function(e,t){var n=t||new s;return n.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new s;return function(t){var n=e.copy(t).clamp(this.min,this.max);return n.sub(t).length()}}(),getBoundingSphere:function(){var e=new s;return function(t){var n=t||new ee;return this.getCenter(n.center),n.radius=.5*this.getSize(e).length(),n}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new s,new s,new s,new s,new s,new s,new s,new s];return function(t){return this.isEmpty()?this:(e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(e),this)}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}),Object.assign(ee.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new Q;return function(t,n){var i=this.center;void 0!==n?i.copy(n):e.setFromPoints(t).getCenter(i);for(var r=0,a=0,o=t.length;a<o;a++)r=Math.max(r,i.distanceToSquared(t[a]));return this.radius=Math.sqrt(r),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(this.center.dot(e.normal)-e.constant)<=this.radius},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),i=t||new s;return i.copy(e),n>this.radius*this.radius&&(i.sub(this.center).normalize(),i.multiplyScalar(this.radius).add(this.center)),i},getBoundingBox:function(e){var t=e||new Q;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}),Object.assign(te.prototype,{isMatrix3:!0,set:function(e,t,n,i,r,a,o,s,u){var l=this.elements;return l[0]=e,l[1]=i,l[2]=o,l[3]=t,l[4]=r,l[5]=s,l[6]=n,l[7]=a,l[8]=u,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},applyToBufferAttribute:function(){var e=new s;return function(t){for(var n=0,i=t.count;n<i;n++)e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.applyMatrix3(this),t.setXYZ(n,e.x,e.y,e.z);return t}}(),multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var n=e.elements,i=t.elements,r=this.elements,a=n[0],o=n[3],s=n[6],u=n[1],l=n[4],c=n[7],h=n[2],d=n[5],f=n[8],p=i[0],m=i[3],g=i[6],v=i[1],y=i[4],_=i[7],x=i[2],b=i[5],w=i[8];return r[0]=a*p+o*v+s*x,r[3]=a*m+o*y+s*b,r[6]=a*g+o*_+s*w,r[1]=u*p+l*v+c*x,r[4]=u*m+l*y+c*b,r[7]=u*g+l*_+c*w,r[2]=h*p+d*v+f*x,r[5]=h*m+d*y+f*b,r[8]=h*g+d*_+f*w,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8];return t*a*l-t*o*u-n*r*l+n*o*s+i*r*u-i*a*s},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3.getInverse no longer takes a Matrix4 argument.");var n=e.elements,i=this.elements,r=n[0],a=n[1],o=n[2],s=n[3],u=n[4],l=n[5],c=n[6],h=n[7],d=n[8],f=d*u-l*h,p=l*c-d*s,m=h*s-u*c,g=r*f+a*p+o*m;if(0===g){var v="THREE.Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t===!0)throw new Error(v);return console.warn(v),this.identity()}var y=1/g;return i[0]=f*y,i[1]=(o*h-d*a)*y,i[2]=(l*a-o*u)*y,i[3]=p*y,i[4]=(d*r-o*c)*y,i[5]=(o*s-l*r)*y,i[6]=m*y,i[7]=(a*c-h*r)*y,i[8]=(u*r-a*s)*y,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},equals:function(e){for(var t=this.elements,n=e.elements,i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0},fromArray:function(e,t){void 0===t&&(t=0);for(var n=0;n<9;n++)this.elements[n]=e[n+t];return this},toArray:function(e,t){void 0===e&&(e=[]),void 0===t&&(t=0);var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}),Object.assign(ne.prototype,{set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new s,t=new s;return function(n,i,r){var a=e.subVectors(r,i).cross(t.subVectors(n,i)).normalize();return this.setFromNormalAndCoplanarPoint(a,n),this}}(),clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e),i=t||new s;return i.copy(this.normal).multiplyScalar(n)},intersectLine:function(){var e=new s;return function(t,n){var i=n||new s,r=t.delta(e),a=this.normal.dot(r);if(0!==a){var o=-(t.start.dot(this.normal)+this.constant)/a;if(!(o<0||o>1))return i.copy(r).multiplyScalar(o).add(t.start)}else if(0===this.distanceToPoint(t.start))return i.copy(t.start)}}(),intersectsLine:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){var t=e||new s;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new s,t=new te;return function(n,i){var r=this.coplanarPoint(e).applyMatrix4(n),a=i||t.getNormalMatrix(n),o=this.normal.applyMatrix3(a).normalize();return this.constant=-r.dot(o),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}),Object.assign(ie.prototype,{set:function(e,t,n,i,r,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(i),o[4].copy(r),o[5].copy(a),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements,i=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],c=n[7],h=n[8],d=n[9],f=n[10],p=n[11],m=n[12],g=n[13],v=n[14],y=n[15];return t[0].setComponents(o-i,c-s,p-h,y-m).normalize(),t[1].setComponents(o+i,c+s,p+h,y+m).normalize(),t[2].setComponents(o+r,c+u,p+d,y+g).normalize(),t[3].setComponents(o-r,c-u,p-d,y-g).normalize(),t[4].setComponents(o-a,c-l,p-f,y-v).normalize(),t[5].setComponents(o+a,c+l,p+f,y+v).normalize(),this},intersectsObject:function(){var e=new ee;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere).applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSprite:function(){var e=new ee;return function(t){return e.center.set(0,0,0),e.radius=.7071067811865476,e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,n=e.center,i=-e.radius,r=0;r<6;r++){var a=t[r].distanceToPoint(n);if(a<i)return!1}return!0},intersectsBox:function(){var e=new s,t=new s;return function(n){for(var i=this.planes,r=0;r<6;r++){var a=i[r];e.x=a.normal.x>0?n.min.x:n.max.x,t.x=a.normal.x>0?n.max.x:n.min.x,e.y=a.normal.y>0?n.min.y:n.max.y,t.y=a.normal.y>0?n.max.y:n.min.y,e.z=a.normal.z>0?n.min.z:n.max.z,t.z=a.normal.z>0?n.max.z:n.min.z;var o=a.distanceToPoint(e),s=a.distanceToPoint(t);if(o<0&&s<0)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}),oe.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],oe.DefaultOrder="XYZ",Object.defineProperties(oe.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this.onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this.onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this.onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this.onChangeCallback()}}}),Object.assign(oe.prototype,{isEuler:!0,set:function(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._order=i||this._order,this.onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this.onChangeCallback(),this},setFromRotationMatrix:function(e,t,n){var i=Ss.clamp,r=e.elements,a=r[0],o=r[4],s=r[8],u=r[1],l=r[5],c=r[9],h=r[2],d=r[6],f=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(s,-1,1)),Math.abs(s)<.99999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(d,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(c,-1,1)),Math.abs(c)<.99999?(this._y=Math.atan2(s,f),this._z=Math.atan2(u,l)):(this._y=Math.atan2(-h,a),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(d,-1,1)),Math.abs(d)<.99999?(this._y=Math.atan2(-h,f),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(u,a))):"ZYX"===t?(this._y=Math.asin(-i(h,-1,1)),Math.abs(h)<.99999?(this._x=Math.atan2(d,f),this._z=Math.atan2(u,a)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(u,-1,1)),Math.abs(u)<.99999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,f))):"XZY"===t?(this._z=Math.asin(-i(o,-1,1)),Math.abs(o)<.99999?(this._x=Math.atan2(d,l),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,f),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,n!==!1&&this.onChangeCallback(),this},setFromQuaternion:function(){var e=new u;return function(t,n,i){return e.makeRotationFromQuaternion(t),this.setFromRotationMatrix(e,n,i)}}(),setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(){var e=new o;return function(t){return e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this.onChangeCallback(),this},toArray:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new s(this._x,this._y,this._z)},onChange:function(e){return this.onChangeCallback=e,this},onChangeCallback:function(){}}),Object.assign(se.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},test:function(e){return 0!==(this.mask&e.mask)}});var zl=0;ue.DefaultUp=new s(0,1,0),ue.DefaultMatrixAutoUpdate=!0,Object.assign(ue.prototype,e.prototype,{isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new o;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new s(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new s(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new s(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new s;return function(t,n){return e.copy(t).applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translateX:function(){var e=new s(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new s(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new s(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new u;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new u;return function(t){this.isCamera?e.lookAt(this.position,t,this.up):e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return n!==-1&&(e.parent=null,e.dispatchEvent({type:"removed"}),this.children.splice(n,1)),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,i=this.children.length;n<i;n++){var r=this.children[n],a=r.getObjectByProperty(e,t);if(void 0!==a)return a}},getWorldPosition:function(e){var t=e||new s;return this.updateMatrixWorld(!0),t.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var e=new s,t=new s;return function(n){var i=n||new o;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,i,t),i}}(),getWorldRotation:function(){var e=new o;return function(t){var n=t||new oe;return this.getWorldQuaternion(e),n.setFromQuaternion(e,this.rotation.order,!1)}}(),getWorldScale:function(){var e=new s,t=new o;return function(n){
var i=n||new s;return this.updateMatrixWorld(!0),this.matrixWorld.decompose(e,t,i),i}}(),getWorldDirection:function(){var e=new o;return function(t){var n=t||new s;return this.getWorldQuaternion(e),n.set(0,0,1).applyQuaternion(e)}}(),raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)},toJSON:function(e){function t(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}function n(e){var t=[];for(var n in e){var i=e[n];delete i.metadata,t.push(i)}return t}var i=void 0===e||""===e,r={};i&&(e={geometries:{},materials:{},textures:{},images:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var a={};if(a.uuid=this.uuid,a.type=this.type,""!==this.name&&(a.name=this.name),"{}"!==JSON.stringify(this.userData)&&(a.userData=this.userData),this.castShadow===!0&&(a.castShadow=!0),this.receiveShadow===!0&&(a.receiveShadow=!0),this.visible===!1&&(a.visible=!1),a.matrix=this.matrix.toArray(),void 0!==this.geometry&&(a.geometry=t(e.geometries,this.geometry)),void 0!==this.material)if(Array.isArray(this.material)){for(var o=[],s=0,u=this.material.length;s<u;s++)o.push(t(e.materials,this.material[s]));a.material=o}else a.material=t(e.materials,this.material);if(this.children.length>0){a.children=[];for(var s=0;s<this.children.length;s++)a.children.push(this.children[s].toJSON(e).object)}if(i){var l=n(e.geometries),c=n(e.materials),h=n(e.textures),d=n(e.images);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),h.length>0&&(r.textures=h),d.length>0&&(r.images=d)}return r.object=a,r},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e,t){if(void 0===t&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var n=0;n<e.children.length;n++){var i=e.children[n];this.add(i.clone())}return this}}),le.prototype=Object.assign(Object.create(ue.prototype),{constructor:le,isCamera:!0,copy:function(e,t){return ue.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this},getWorldDirection:function(){var e=new o;return function(t){var n=t||new s;return this.getWorldQuaternion(e),n.set(0,0,-1).applyQuaternion(e)}}(),updateMatrixWorld:function(e){ue.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return(new this.constructor).copy(this)}}),ce.prototype=Object.assign(Object.create(le.prototype),{constructor:ce,isOrthographicCamera:!0,copy:function(e,t){return le.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,i,r,a){this.view={fullWidth:e,fullHeight:t,offsetX:n,offsetY:i,width:r,height:a},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2,r=n-e,a=n+e,o=i+t,s=i-t;if(null!==this.view){var u=this.zoom/(this.view.width/this.view.fullWidth),l=this.zoom/(this.view.height/this.view.fullHeight),c=(this.right-this.left)/this.view.width,h=(this.top-this.bottom)/this.view.height;r+=c*(this.view.offsetX/u),a=r+c*(this.view.width/u),o-=h*(this.view.offsetY/l),s=o-h*(this.view.height/l)}this.projectionMatrix.makeOrthographic(r,a,o,s,this.near,this.far)},toJSON:function(e){var t=ue.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),he.prototype=Object.assign(Object.create(le.prototype),{constructor:he,isPerspectiveCamera:!0,copy:function(e,t){return le.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*Ss.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*Ss.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*Ss.RAD2DEG*Math.atan(Math.tan(.5*Ss.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,i,r,a){this.aspect=e/t,this.view={fullWidth:e,fullHeight:t,offsetX:n,offsetY:i,width:r,height:a},this.updateProjectionMatrix()},clearViewOffset:function(){this.view=null,this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*Ss.DEG2RAD*this.fov)/this.zoom,n=2*t,i=this.aspect*n,r=-.5*i,a=this.view;if(null!==a){var o=a.fullWidth,s=a.fullHeight;r+=a.offsetX*i/o,t-=a.offsetY*n/s,i*=a.width/o,n*=a.height/s}var u=this.filmOffset;0!==u&&(r+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(r,r+i,t,t-n,e,this.far)},toJSON:function(e){var t=ue.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),Object.assign(de.prototype,{clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var t=0,n=e.vertexColors.length;t<n;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Gl=0;Object.assign(pe.prototype,e.prototype,{isGeometry:!0,applyMatrix:function(e){for(var t=(new te).getNormalMatrix(e),n=0,i=this.vertices.length;n<i;n++){var r=this.vertices[n];r.applyMatrix4(e)}for(var n=0,i=this.faces.length;n<i;n++){var a=this.faces[n];a.normal.applyMatrix3(t).normalize();for(var o=0,s=a.vertexNormals.length;o<s;o++)a.vertexNormals[o].applyMatrix3(t).normalize()}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(){var e=new u;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new u;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new u;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new u;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new u;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ue;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),fromBufferGeometry:function(e){function n(e,t,n,r){var a=void 0!==u?[d[e].clone(),d[t].clone(),d[n].clone()]:[],o=void 0!==l?[i.colors[e].clone(),i.colors[t].clone(),i.colors[n].clone()]:[],s=new de(e,t,n,a,o,r);i.faces.push(s),void 0!==c&&i.faceVertexUvs[0].push([f[e].clone(),f[t].clone(),f[n].clone()]),void 0!==h&&i.faceVertexUvs[1].push([p[e].clone(),p[t].clone(),p[n].clone()])}var i=this,r=null!==e.index?e.index.array:void 0,a=e.attributes,o=a.position.array,u=void 0!==a.normal?a.normal.array:void 0,l=void 0!==a.color?a.color.array:void 0,c=void 0!==a.uv?a.uv.array:void 0,h=void 0!==a.uv2?a.uv2.array:void 0;void 0!==h&&(this.faceVertexUvs[1]=[]);for(var d=[],f=[],p=[],m=0,g=0;m<o.length;m+=3,g+=2)i.vertices.push(new s(o[m],o[m+1],o[m+2])),void 0!==u&&d.push(new s(u[m],u[m+1],u[m+2])),void 0!==l&&i.colors.push(new W(l[m],l[m+1],l[m+2])),void 0!==c&&f.push(new t(c[g],c[g+1])),void 0!==h&&p.push(new t(h[g],h[g+1]));var v=e.groups;if(v.length>0)for(var m=0;m<v.length;m++)for(var y=v[m],_=y.start,x=y.count,g=_,b=_+x;g<b;g+=3)void 0!==r?n(r[g],r[g+1],r[g+2],y.materialIndex):n(g,g+1,g+2,y.materialIndex);else if(void 0!==r)for(var m=0;m<r.length;m+=3)n(r[m],r[m+1],r[m+2]);else for(var m=0;m<o.length/3;m+=3)n(m,m+1,m+2);return this.computeFaceNormals(),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,n=0===t?1:1/t,i=new u;return i.set(n,0,0,-n*e.x,0,n,0,-n*e.y,0,0,n,-n*e.z,0,0,0,1),this.applyMatrix(i),this},computeFaceNormals:function(){for(var e=new s,t=new s,n=0,i=this.faces.length;n<i;n++){var r=this.faces[n],a=this.vertices[r.a],o=this.vertices[r.b],u=this.vertices[r.c];e.subVectors(u,o),t.subVectors(a,o),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){void 0===e&&(e=!0);var t,n,i,r,a,o;for(o=new Array(this.vertices.length),t=0,n=this.vertices.length;t<n;t++)o[t]=new s;if(e){var u,l,c,h=new s,d=new s;for(i=0,r=this.faces.length;i<r;i++)a=this.faces[i],u=this.vertices[a.a],l=this.vertices[a.b],c=this.vertices[a.c],h.subVectors(c,l),d.subVectors(u,l),h.cross(d),o[a.a].add(h),o[a.b].add(h),o[a.c].add(h)}else for(this.computeFaceNormals(),i=0,r=this.faces.length;i<r;i++)a=this.faces[i],o[a.a].add(a.normal),o[a.b].add(a.normal),o[a.c].add(a.normal);for(t=0,n=this.vertices.length;t<n;t++)o[t].normalize();for(i=0,r=this.faces.length;i<r;i++){a=this.faces[i];var f=a.vertexNormals;3===f.length?(f[0].copy(o[a.a]),f[1].copy(o[a.b]),f[2].copy(o[a.c])):(f[0]=o[a.a].clone(),f[1]=o[a.b].clone(),f[2]=o[a.c].clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,n;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){n=this.faces[e];var i=n.vertexNormals;3===i.length?(i[0].copy(n.normal),i[1].copy(n.normal),i[2].copy(n.normal)):(i[0]=n.normal.clone(),i[1]=n.normal.clone(),i[2]=n.normal.clone())}this.faces.length>0&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,n,i,r;for(n=0,i=this.faces.length;n<i;n++)for(r=this.faces[n],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;e<t;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var a=new pe;for(a.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var o,u,l=this.morphNormals[e].faceNormals,c=this.morphNormals[e].vertexNormals;for(n=0,i=this.faces.length;n<i;n++)o=new s,u={a:new s,b:new s,c:new s},l.push(o),c.push(u)}var h=this.morphNormals[e];a.vertices=this.morphTargets[e].vertices,a.computeFaceNormals(),a.computeVertexNormals();var o,u;for(n=0,i=this.faces.length;n<i;n++)r=this.faces[n],o=h.faceNormals[n],u=h.vertexNormals[n],o.copy(r.normal),u.a.copy(r.vertexNormals[0]),u.b.copy(r.vertexNormals[1]),u.c.copy(r.vertexNormals[2])}for(n=0,i=this.faces.length;n<i;n++)r=this.faces[n],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,i=t.length;n<i;n++)n>0&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Q),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new ee),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,n){if(!e||!e.isGeometry)return void console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e);var i,r=this.vertices.length,a=this.vertices,o=e.vertices,s=this.faces,u=e.faces,l=this.faceVertexUvs[0],c=e.faceVertexUvs[0],h=this.colors,d=e.colors;void 0===n&&(n=0),void 0!==t&&(i=(new te).getNormalMatrix(t));for(var f=0,p=o.length;f<p;f++){var m=o[f],g=m.clone();void 0!==t&&g.applyMatrix4(t),a.push(g)}for(var f=0,p=d.length;f<p;f++)h.push(d[f].clone());for(f=0,p=u.length;f<p;f++){var v,y,_,x=u[f],b=x.vertexNormals,w=x.vertexColors;v=new de(x.a+r,x.b+r,x.c+r),v.normal.copy(x.normal),void 0!==i&&v.normal.applyMatrix3(i).normalize();for(var E=0,S=b.length;E<S;E++)y=b[E].clone(),void 0!==i&&y.applyMatrix3(i).normalize(),v.vertexNormals.push(y);v.color.copy(x.color);for(var E=0,S=w.length;E<S;E++)_=w[E],v.vertexColors.push(_.clone());v.materialIndex=x.materialIndex+n,s.push(v)}for(f=0,p=c.length;f<p;f++){var M=c[f],T=[];if(void 0!==M){for(var E=0,S=M.length;E<S;E++)T.push(M[E].clone());l.push(T)}}},mergeMesh:function(e){return e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),void this.merge(e.geometry,e.matrix)):void console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,n,i,r,a,o,s,u={},l=[],c=[],h=4,d=Math.pow(10,h);for(n=0,i=this.vertices.length;n<i;n++)e=this.vertices[n],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===u[t]?(u[t]=n,l.push(this.vertices[n]),c[n]=l.length-1):c[n]=c[u[t]];var f=[];for(n=0,i=this.faces.length;n<i;n++){r=this.faces[n],r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],a=[r.a,r.b,r.c];for(var p=0;p<3;p++)if(a[p]===a[(p+1)%3]){f.push(n);break}}for(n=f.length-1;n>=0;n--){var m=f[n];for(this.faces.splice(m,1),o=0,s=this.faceVertexUvs.length;o<s;o++)this.faceVertexUvs[o].splice(m,1)}var g=this.vertices.length-l.length;return this.vertices=l,g},sortFacesByMaterialIndex:function(){function e(e,t){return e.materialIndex-t.materialIndex}for(var t=this.faces,n=t.length,i=0;i<n;i++)t[i]._id=i;t.sort(e);var r,a,o=this.faceVertexUvs[0],s=this.faceVertexUvs[1];o&&o.length===n&&(r=[]),s&&s.length===n&&(a=[]);for(var i=0;i<n;i++){var u=t[i]._id;r&&r.push(o[u]),a&&a.push(s[u])}r&&(this.faceVertexUvs[0]=r),a&&(this.faceVertexUvs[1]=a)},toJSON:function(){function e(e,t,n){return n?e|1<<t:e&~(1<<t)}function t(e){var t=e.x.toString()+e.y.toString()+e.z.toString();return void 0!==d[t]?d[t]:(d[t]=h.length/3,h.push(e.x,e.y,e.z),d[t])}function n(e){var t=e.r.toString()+e.g.toString()+e.b.toString();return void 0!==p[t]?p[t]:(p[t]=f.length,f.push(e.getHex()),p[t])}function i(e){var t=e.x.toString()+e.y.toString();return void 0!==g[t]?g[t]:(g[t]=m.length/2,m.push(e.x,e.y),g[t])}var r={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),void 0!==this.parameters){var a=this.parameters;for(var o in a)void 0!==a[o]&&(r[o]=a[o]);return r}for(var s=[],u=0;u<this.vertices.length;u++){var l=this.vertices[u];s.push(l.x,l.y,l.z)}for(var c=[],h=[],d={},f=[],p={},m=[],g={},u=0;u<this.faces.length;u++){var v=this.faces[u],y=!0,_=!1,x=void 0!==this.faceVertexUvs[0][u],b=v.normal.length()>0,w=v.vertexNormals.length>0,E=1!==v.color.r||1!==v.color.g||1!==v.color.b,S=v.vertexColors.length>0,M=0;if(M=e(M,0,0),M=e(M,1,y),M=e(M,2,_),M=e(M,3,x),M=e(M,4,b),M=e(M,5,w),M=e(M,6,E),M=e(M,7,S),c.push(M),c.push(v.a,v.b,v.c),c.push(v.materialIndex),x){var T=this.faceVertexUvs[0][u];c.push(i(T[0]),i(T[1]),i(T[2]))}if(b&&c.push(t(v.normal)),w){var A=v.vertexNormals;c.push(t(A[0]),t(A[1]),t(A[2]))}if(E&&c.push(n(v.color)),S){var L=v.vertexColors;c.push(n(L[0]),n(L[1]),n(L[2]))}}return r.data={},r.data.vertices=s,r.data.normals=h,f.length>0&&(r.data.colors=f),m.length>0&&(r.data.uvs=[m]),r.data.faces=c,r},clone:function(){return(new pe).copy(this)},copy:function(e){var t,n,i,r,a,o;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var s=e.vertices;for(t=0,n=s.length;t<n;t++)this.vertices.push(s[t].clone());var u=e.colors;for(t=0,n=u.length;t<n;t++)this.colors.push(u[t].clone());var l=e.faces;for(t=0,n=l.length;t<n;t++)this.faces.push(l[t].clone());for(t=0,n=e.faceVertexUvs.length;t<n;t++){var c=e.faceVertexUvs[t];for(void 0===this.faceVertexUvs[t]&&(this.faceVertexUvs[t]=[]),i=0,r=c.length;i<r;i++){var h=c[i],d=[];for(a=0,o=h.length;a<o;a++){var f=h[a];d.push(f.clone())}this.faceVertexUvs[t].push(d)}}var p=e.morphTargets;for(t=0,n=p.length;t<n;t++){var m={};if(m.name=p[t].name,void 0!==p[t].vertices)for(m.vertices=[],i=0,r=p[t].vertices.length;i<r;i++)m.vertices.push(p[t].vertices[i].clone());if(void 0!==p[t].normals)for(m.normals=[],i=0,r=p[t].normals.length;i<r;i++)m.normals.push(p[t].normals[i].clone());this.morphTargets.push(m)}var g=e.morphNormals;for(t=0,n=g.length;t<n;t++){var v={};if(void 0!==g[t].vertexNormals)for(v.vertexNormals=[],i=0,r=g[t].vertexNormals.length;i<r;i++){var y=g[t].vertexNormals[i],_={};_.a=y.a.clone(),_.b=y.b.clone(),_.c=y.c.clone(),v.vertexNormals.push(_)}if(void 0!==g[t].faceNormals)for(v.faceNormals=[],i=0,r=g[t].faceNormals.length;i<r;i++)v.faceNormals.push(g[t].faceNormals[i].clone());this.morphNormals.push(v)}var x=e.skinWeights;for(t=0,n=x.length;t<n;t++)this.skinWeights.push(x[t].clone());var b=e.skinIndices;for(t=0,n=b.length;t<n;t++)this.skinIndices.push(b[t].clone());var w=e.lineDistances;for(t=0,n=w.length;t<n;t++)this.lineDistances.push(w[t]);var E=e.boundingBox;null!==E&&(this.boundingBox=E.clone());var S=e.boundingSphere;return null!==S&&(this.boundingSphere=S.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(me.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(me.prototype,{isBufferAttribute:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.itemSize:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var i=0,r=this.itemSize;i<r;i++)this.array[e+i]=t.array[n+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),a=new W),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyIndicesArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];t[n++]=a.a,t[n++]=a.b,t[n++]=a.c}return this},copyVector2sArray:function(e){for(var n=this.array,i=0,r=0,a=e.length;r<a;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),o=new t),n[i++]=o.x,n[i++]=o.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,i=0,r=e.length;i<r;i++){var a=e[i];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),a=new s),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var o=e[r];void 0===o&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),o=new i),t[n++]=o.x,t[n++]=o.y,t[n++]=o.z,t[n++]=o.w}return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=r,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)}}),ge.prototype=Object.create(me.prototype),ge.prototype.constructor=ge,ve.prototype=Object.create(me.prototype),ve.prototype.constructor=ve,ye.prototype=Object.create(me.prototype),ye.prototype.constructor=ye,_e.prototype=Object.create(me.prototype),_e.prototype.constructor=_e,xe.prototype=Object.create(me.prototype),xe.prototype.constructor=xe,be.prototype=Object.create(me.prototype),be.prototype.constructor=be,we.prototype=Object.create(me.prototype),we.prototype.constructor=we,Ee.prototype=Object.create(me.prototype),Ee.prototype.constructor=Ee,Se.prototype=Object.create(me.prototype),Se.prototype.constructor=Se,Object.assign(Me.prototype,{computeGroups:function(e){for(var t,n=[],i=void 0,r=e.faces,a=0;a<r.length;a++){var o=r[a];o.materialIndex!==i&&(i=o.materialIndex,void 0!==t&&(t.count=3*a-t.start,n.push(t)),t={start:3*a,materialIndex:i})}void 0!==t&&(t.count=3*a-t.start,n.push(t)),this.groups=n},fromGeometry:function(e){var n,i=e.faces,r=e.vertices,a=e.faceVertexUvs,o=a[0]&&a[0].length>0,s=a[1]&&a[1].length>0,u=e.morphTargets,l=u.length;if(l>0){n=[];for(var c=0;c<l;c++)n[c]=[];this.morphTargets.position=n}var h,d=e.morphNormals,f=d.length;if(f>0){h=[];for(var c=0;c<f;c++)h[c]=[];this.morphTargets.normal=h}for(var p=e.skinIndices,m=e.skinWeights,g=p.length===r.length,v=m.length===r.length,c=0;c<i.length;c++){var y=i[c];this.vertices.push(r[y.a],r[y.b],r[y.c]);var _=y.vertexNormals;if(3===_.length)this.normals.push(_[0],_[1],_[2]);else{var x=y.normal;this.normals.push(x,x,x)}var b=y.vertexColors;if(3===b.length)this.colors.push(b[0],b[1],b[2]);else{var w=y.color;this.colors.push(w,w,w)}if(o===!0){var E=a[0][c];void 0!==E?this.uvs.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",c),this.uvs.push(new t,new t,new t))}if(s===!0){var E=a[1][c];void 0!==E?this.uvs2.push(E[0],E[1],E[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",c),this.uvs2.push(new t,new t,new t))}for(var S=0;S<l;S++){var M=u[S].vertices;n[S].push(M[y.a],M[y.b],M[y.c])}for(var S=0;S<f;S++){var T=d[S].vertexNormals[c];h[S].push(T.a,T.b,T.c)}g&&this.skinIndices.push(p[y.a],p[y.b],p[y.c]),v&&this.skinWeights.push(m[y.a],m[y.b],m[y.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this}}),Ae.MaxIndex=65535,Object.assign(Ae.prototype,e.prototype,{isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(Te(e)>65535?we:xe)(e,1):this.index=e},addAttribute:function(e,t){return t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),void this.setIndex(t)):(this.attributes[e]=t,this):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),void this.addAttribute(e,new me(arguments[1],arguments[2])))},getAttribute:function(e){return this.attributes[e]},removeAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:void 0!==n?n:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.applyToBufferAttribute(t),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var i=(new te).getNormalMatrix(e);i.applyToBufferAttribute(n),n.needsUpdate=!0}return null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(){var e=new u;return function(t){return e.makeRotationX(t),this.applyMatrix(e),this}}(),rotateY:function(){var e=new u;return function(t){return e.makeRotationY(t),this.applyMatrix(e),this}}(),rotateZ:function(){var e=new u;return function(t){return e.makeRotationZ(t),this.applyMatrix(e),this}}(),translate:function(){var e=new u;return function(t,n,i){return e.makeTranslation(t,n,i),this.applyMatrix(e),this}}(),scale:function(){var e=new u;return function(t,n,i){return e.makeScale(t,n,i),this.applyMatrix(e),this}}(),lookAt:function(){var e=new ue;return function(t){e.lookAt(t),e.updateMatrix(),this.applyMatrix(e.matrix)}}(),center:function(){this.computeBoundingBox();var e=this.boundingBox.getCenter().negate();return this.translate(e.x,e.y,e.z),e},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var n=new Ee(3*t.vertices.length,3),i=new Ee(3*t.colors.length,3);if(this.addAttribute("position",n.copyVector3sArray(t.vertices)),this.addAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var r=new Ee(t.lineDistances.length,1);this.addAttribute("lineDistance",r.copyArray(t.lineDistances))}null!==t.boundingSphere&&(this.boundingSphere=t.boundingSphere.clone()),null!==t.boundingBox&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},updateFromObject:function(e){var t=e.geometry;if(e.isMesh){var n=t.__directGeometry;if(t.elementsNeedUpdate===!0&&(n=void 0,t.elementsNeedUpdate=!1),void 0===n)return this.fromGeometry(t);n.verticesNeedUpdate=t.verticesNeedUpdate,n.normalsNeedUpdate=t.normalsNeedUpdate,n.colorsNeedUpdate=t.colorsNeedUpdate,n.uvsNeedUpdate=t.uvsNeedUpdate,n.groupsNeedUpdate=t.groupsNeedUpdate,t.verticesNeedUpdate=!1,t.normalsNeedUpdate=!1,t.colorsNeedUpdate=!1,t.uvsNeedUpdate=!1,t.groupsNeedUpdate=!1,t=n}var i;return t.verticesNeedUpdate===!0&&(i=this.attributes.position,void 0!==i&&(i.copyVector3sArray(t.vertices),i.needsUpdate=!0),t.verticesNeedUpdate=!1),t.normalsNeedUpdate===!0&&(i=this.attributes.normal,void 0!==i&&(i.copyVector3sArray(t.normals),i.needsUpdate=!0),t.normalsNeedUpdate=!1),t.colorsNeedUpdate===!0&&(i=this.attributes.color,void 0!==i&&(i.copyColorsArray(t.colors),i.needsUpdate=!0),t.colorsNeedUpdate=!1),t.uvsNeedUpdate&&(i=this.attributes.uv,void 0!==i&&(i.copyVector2sArray(t.uvs),i.needsUpdate=!0),t.uvsNeedUpdate=!1),t.lineDistancesNeedUpdate&&(i=this.attributes.lineDistance,void 0!==i&&(i.copyArray(t.lineDistances),i.needsUpdate=!0),t.lineDistancesNeedUpdate=!1),t.groupsNeedUpdate&&(t.computeGroups(e.geometry),this.groups=t.groups,t.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=(new Me).fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.addAttribute("position",new me(t,3).copyVector3sArray(e.vertices)),e.normals.length>0){var n=new Float32Array(3*e.normals.length);this.addAttribute("normal",new me(n,3).copyVector3sArray(e.normals))}if(e.colors.length>0){var i=new Float32Array(3*e.colors.length);this.addAttribute("color",new me(i,3).copyColorsArray(e.colors))}if(e.uvs.length>0){var r=new Float32Array(2*e.uvs.length);this.addAttribute("uv",new me(r,2).copyVector2sArray(e.uvs))}if(e.uvs2.length>0){var a=new Float32Array(2*e.uvs2.length);this.addAttribute("uv2",new me(a,2).copyVector2sArray(e.uvs2))}if(e.indices.length>0){var o=Te(e.indices)>65535?Uint32Array:Uint16Array,s=new o(3*e.indices.length);this.setIndex(new me(s,1).copyIndicesArray(e.indices))}this.groups=e.groups;for(var u in e.morphTargets){for(var l=[],c=e.morphTargets[u],h=0,d=c.length;h<d;h++){var f=c[h],p=new Ee(3*f.length,3);l.push(p.copyVector3sArray(f))}this.morphAttributes[u]=l}if(e.skinIndices.length>0){var m=new Ee(4*e.skinIndices.length,4);this.addAttribute("skinIndex",m.copyVector4sArray(e.skinIndices))}if(e.skinWeights.length>0){var g=new Ee(4*e.skinWeights.length,4);this.addAttribute("skinWeight",g.copyVector4sArray(e.skinWeights))}return null!==e.boundingSphere&&(this.boundingSphere=e.boundingSphere.clone()),null!==e.boundingBox&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Q);var e=this.attributes.position;void 0!==e?this.boundingBox.setFromBufferAttribute(e):this.boundingBox.makeEmpty(),(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){var e=new Q,t=new s;return function(){null===this.boundingSphere&&(this.boundingSphere=new ee);var n=this.attributes.position;if(n){var i=this.boundingSphere.center;e.setFromBufferAttribute(n),e.getCenter(i);for(var r=0,a=0,o=n.count;a<o;a++)t.x=n.getX(a),t.y=n.getY(a),t.z=n.getZ(a),r=Math.max(r,i.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}}(),computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes,n=this.groups;if(t.position){var i=t.position.array;if(void 0===t.normal)this.addAttribute("normal",new me(new Float32Array(i.length),3));else for(var r=t.normal.array,a=0,o=r.length;a<o;a++)r[a]=0;var u,l,c,h=t.normal.array,d=new s,f=new s,p=new s,m=new s,g=new s;if(e){var v=e.array;0===n.length&&this.addGroup(0,v.length);for(var y=0,_=n.length;y<_;++y)for(var x=n[y],b=x.start,w=x.count,a=b,o=b+w;a<o;a+=3)u=3*v[a+0],l=3*v[a+1],c=3*v[a+2],d.fromArray(i,u),f.fromArray(i,l),p.fromArray(i,c),m.subVectors(p,f),g.subVectors(d,f),m.cross(g),h[u]+=m.x,h[u+1]+=m.y,h[u+2]+=m.z,h[l]+=m.x,h[l+1]+=m.y,h[l+2]+=m.z,h[c]+=m.x,h[c+1]+=m.y,h[c+2]+=m.z}else for(var a=0,o=i.length;a<o;a+=9)d.fromArray(i,a),
f.fromArray(i,a+3),p.fromArray(i,a+6),m.subVectors(p,f),g.subVectors(d,f),m.cross(g),h[a]=m.x,h[a+1]=m.y,h[a+2]=m.z,h[a+3]=m.x,h[a+4]=m.y,h[a+5]=m.z,h[a+6]=m.x,h[a+7]=m.y,h[a+8]=m.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0);var n=this.attributes;for(var i in n)if(void 0!==e.attributes[i])for(var r=n[i],a=r.array,o=e.attributes[i],s=o.array,u=o.itemSize,l=0,c=u*t;l<s.length;l++,c++)a[c]=s[l];return this},normalizeNormals:function(){for(var e,t,n,i,r=this.attributes.normal,a=0,o=r.count;a<o;a++)e=r.getX(a),t=r.getY(a),n=r.getZ(a),i=1/Math.sqrt(e*e+t*t+n*n),r.setXYZ(a,e*i,t*i,n*i)},toNonIndexed:function(){if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var e=new Ae,t=this.index.array,n=this.attributes;for(var i in n){for(var r=n[i],a=r.array,o=r.itemSize,s=new a.constructor(t.length*o),u=0,l=0,c=0,h=t.length;c<h;c++){u=t[c]*o;for(var d=0;d<o;d++)s[l++]=a[u++]}e.addAttribute(i,new me(s,o))}return e},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var i=this.index;if(null!==i){var r=Array.prototype.slice.call(i.array);e.data.index={type:i.array.constructor.name,array:r}}var a=this.attributes;for(var n in a){var o=a[n],r=Array.prototype.slice.call(o.array);e.data.attributes[n]={itemSize:o.itemSize,type:o.array.constructor.name,array:r,normalized:o.normalized}}var s=this.groups;s.length>0&&(e.data.groups=JSON.parse(JSON.stringify(s)));var u=this.boundingSphere;return null!==u&&(e.data.boundingSphere={center:u.center.toArray(),radius:u.radius}),e},clone:function(){return(new Ae).copy(this)},copy:function(e){var t,n,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var r=e.index;null!==r&&this.setIndex(r.clone());var a=e.attributes;for(t in a){var o=a[t];this.addAttribute(t,o.clone())}var s=e.morphAttributes;for(t in s){var u=[],l=s[t];for(n=0,i=l.length;n<i;n++)u.push(l[n].clone());this.morphAttributes[t]=u}var c=e.groups;for(n=0,i=c.length;n<i;n++){var h=c[n];this.addGroup(h.start,h.count,h.materialIndex)}var d=e.boundingBox;null!==d&&(this.boundingBox=d.clone());var f=e.boundingSphere;return null!==f&&(this.boundingSphere=f.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Le.prototype=Object.create(pe.prototype),Le.prototype.constructor=Le,Re.prototype=Object.create(Ae.prototype),Re.prototype.constructor=Re,Ce.prototype=Object.create(pe.prototype),Ce.prototype.constructor=Ce,Pe.prototype=Object.create(Ae.prototype),Pe.prototype.constructor=Pe,Ie.prototype=Object.create(K.prototype),Ie.prototype.constructor=Ie,Ie.prototype.isMeshBasicMaterial=!0,Ie.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this},Object.assign(Oe.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var n=t||new s;return n.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(){var e=new s;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new s;n.subVectors(e,this.origin);var i=n.dot(this.direction);return i<0?n.copy(this.origin):n.copy(this.direction).multiplyScalar(i).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(){var e=new s;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceToSquared(t))}}(),distanceSqToSegment:function(){var e=new s,t=new s,n=new s;return function(i,r,a,o){e.copy(i).add(r).multiplyScalar(.5),t.copy(r).sub(i).normalize(),n.copy(this.origin).sub(e);var s,u,l,c,h=.5*i.distanceTo(r),d=-this.direction.dot(t),f=n.dot(this.direction),p=-n.dot(t),m=n.lengthSq(),g=Math.abs(1-d*d);if(g>0)if(s=d*p-f,u=d*f-p,c=h*g,s>=0)if(u>=-c)if(u<=c){var v=1/g;s*=v,u*=v,l=s*(s+d*u+2*f)+u*(d*s+u+2*p)+m}else u=h,s=Math.max(0,-(d*u+f)),l=-s*s+u*(u+2*p)+m;else u=-h,s=Math.max(0,-(d*u+f)),l=-s*s+u*(u+2*p)+m;else u<=-c?(s=Math.max(0,-(-d*h+f)),u=s>0?-h:Math.min(Math.max(-h,-p),h),l=-s*s+u*(u+2*p)+m):u<=c?(s=0,u=Math.min(Math.max(-h,-p),h),l=u*(u+2*p)+m):(s=Math.max(0,-(d*h+f)),u=s>0?h:Math.min(Math.max(-h,-p),h),l=-s*s+u*(u+2*p)+m);else u=d>0?-h:h,s=Math.max(0,-(d*u+f)),l=-s*s+u*(u+2*p)+m;return a&&a.copy(this.direction).multiplyScalar(s).add(this.origin),o&&o.copy(t).multiplyScalar(u).add(e),l}}(),intersectSphere:function(){var e=new s;return function(t,n){e.subVectors(t.center,this.origin);var i=e.dot(this.direction),r=e.dot(e)-i*i,a=t.radius*t.radius;if(r>a)return null;var o=Math.sqrt(a-r),s=i-o,u=i+o;return s<0&&u<0?null:s<0?this.at(u,n):this.at(s,n)}}(),intersectsSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var n=e.normal.dot(this.direction);return n*t<0},intersectBox:function(e,t){var n,i,r,a,o,s,u=1/this.direction.x,l=1/this.direction.y,c=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,i=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,i=(e.min.x-h.x)*u),l>=0?(r=(e.min.y-h.y)*l,a=(e.max.y-h.y)*l):(r=(e.max.y-h.y)*l,a=(e.min.y-h.y)*l),n>a||r>i?null:((r>n||n!==n)&&(n=r),(a<i||i!==i)&&(i=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>i?null:((o>n||n!==n)&&(n=o),(s<i||i!==i)&&(i=s),i<0?null:this.at(n>=0?n:i,t)))},intersectsBox:function(){var e=new s;return function(t){return null!==this.intersectBox(t,e)}}(),intersectTriangle:function(){var e=new s,t=new s,n=new s,i=new s;return function(r,a,o,s,u){t.subVectors(a,r),n.subVectors(o,r),i.crossVectors(t,n);var l,c=this.direction.dot(i);if(c>0){if(s)return null;l=1}else{if(!(c<0))return null;l=-1,c=-c}e.subVectors(this.origin,r);var h=l*this.direction.dot(n.crossVectors(e,n));if(h<0)return null;var d=l*this.direction.dot(t.cross(e));if(d<0)return null;if(h+d>c)return null;var f=-l*e.dot(i);return f<0?null:this.at(f/c,u)}}(),applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}),Object.assign(ke.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){var t=e||new s;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new s;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new s;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new s,t=new s;return function(n,i){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),a=t.dot(e),o=a/r;return i&&(o=Ss.clamp(o,0,1)),o}}(),closestPointToPoint:function(e,t,n){var i=this.closestPointToPointParameter(e,t),r=n||new s;return this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),Object.assign(De,{normal:function(){var e=new s;return function(t,n,i,r){var a=r||new s;a.subVectors(i,n),e.subVectors(t,n),a.cross(e);var o=a.lengthSq();return o>0?a.multiplyScalar(1/Math.sqrt(o)):a.set(0,0,0)}}(),barycoordFromPoint:function(){var e=new s,t=new s,n=new s;return function(i,r,a,o,u){e.subVectors(o,r),t.subVectors(a,r),n.subVectors(i,r);var l=e.dot(e),c=e.dot(t),h=e.dot(n),d=t.dot(t),f=t.dot(n),p=l*d-c*c,m=u||new s;if(0===p)return m.set(-2,-1,-1);var g=1/p,v=(d*h-c*f)*g,y=(l*f-c*h)*g;return m.set(1-v-y,y,v)}}(),containsPoint:function(){var e=new s;return function(t,n,i,r){var a=De.barycoordFromPoint(t,n,i,r,e);return a.x>=0&&a.y>=0&&a.x+a.y<=1}}()}),Object.assign(De.prototype,{set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new s,t=new s;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new s;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return De.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new ne;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return De.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return De.containsPoint(e,this.a,this.b,this.c)},closestPointToPoint:function(){var e=new ne,t=[new ke,new ke,new ke],n=new s,i=new s;return function(r,a){var o=a||new s,u=1/0;if(e.setFromCoplanarPoints(this.a,this.b,this.c),e.projectPoint(r,n),this.containsPoint(n)===!0)o.copy(n);else{t[0].set(this.a,this.b),t[1].set(this.b,this.c),t[2].set(this.c,this.a);for(var l=0;l<t.length;l++){t[l].closestPointToPoint(n,!0,i);var c=n.distanceToSquared(i);c<u&&(u=c,o.copy(i))}}return o}}(),equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}),Ne.prototype=Object.assign(Object.create(ue.prototype),{constructor:Ne,isMesh:!0,setDrawMode:function(e){this.drawMode=e},copy:function(e){return ue.prototype.copy.call(this,e),this.drawMode=e.drawMode,this},updateMorphTargets:function(){var e,t,n,i=this.geometry;if(i.isBufferGeometry){var r=i.morphAttributes,a=Object.keys(r);if(a.length>0){var o=r[a[0]];if(void 0!==o)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=o.length;e<t;e++)n=o[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}}else{var s=i.morphTargets;if(void 0!==s&&s.length>0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=s.length;e<t;e++)n=s[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[n]=e}},raycast:function(){function e(e,t,n,i,r,a,o){return De.barycoordFromPoint(e,t,n,i,y),r.multiplyScalar(y.x),a.multiplyScalar(y.y),o.multiplyScalar(y.z),r.add(a).add(o),r.clone()}function n(e,t,n,i,r,a,o){var s,u=e.material;if(s=u.side===ya?n.intersectTriangle(a,r,i,!0,o):n.intersectTriangle(i,r,a,u.side!==_a,o),null===s)return null;x.copy(o),x.applyMatrix4(e.matrixWorld);var l=t.ray.origin.distanceTo(x);return l<t.near||l>t.far?null:{distance:l,point:x.clone(),object:e}}function i(t,i,r,a,o,s,u,d){l.fromBufferAttribute(a,s),c.fromBufferAttribute(a,u),h.fromBufferAttribute(a,d);var f=n(t,i,r,l,c,h,_);return f&&(o&&(m.fromBufferAttribute(o,s),g.fromBufferAttribute(o,u),v.fromBufferAttribute(o,d),f.uv=e(_,l,c,h,m,g,v)),f.face=new de(s,u,d,De.normal(l,c,h)),f.faceIndex=s),f}var r=new u,a=new Oe,o=new ee,l=new s,c=new s,h=new s,d=new s,f=new s,p=new s,m=new t,g=new t,v=new t,y=new s,_=new s,x=new s;return function(t,s){var u=this.geometry,y=this.material,x=this.matrixWorld;if(void 0!==y&&(null===u.boundingSphere&&u.computeBoundingSphere(),o.copy(u.boundingSphere),o.applyMatrix4(x),t.ray.intersectsSphere(o)!==!1&&(r.getInverse(x),a.copy(t.ray).applyMatrix4(r),null===u.boundingBox||a.intersectsBox(u.boundingBox)!==!1))){var b;if(u.isBufferGeometry){var w,E,S,M,T,A=u.index,L=u.attributes.position,R=u.attributes.uv;if(null!==A)for(M=0,T=A.count;M<T;M+=3)w=A.getX(M),E=A.getX(M+1),S=A.getX(M+2),b=i(this,t,a,L,R,w,E,S),b&&(b.faceIndex=Math.floor(M/3),s.push(b));else for(M=0,T=L.count;M<T;M+=3)w=M,E=M+1,S=M+2,b=i(this,t,a,L,R,w,E,S),b&&(b.index=w,s.push(b))}else if(u.isGeometry){var C,P,I,O,k=Array.isArray(y),D=u.vertices,N=u.faces,U=u.faceVertexUvs[0];U.length>0&&(O=U);for(var B=0,F=N.length;B<F;B++){var j=N[B],z=k?y[j.materialIndex]:y;if(void 0!==z){if(C=D[j.a],P=D[j.b],I=D[j.c],z.morphTargets===!0){var G=u.morphTargets,H=this.morphTargetInfluences;l.set(0,0,0),c.set(0,0,0),h.set(0,0,0);for(var V=0,W=G.length;V<W;V++){var q=H[V];if(0!==q){var X=G[V].vertices;l.addScaledVector(d.subVectors(X[j.a],C),q),c.addScaledVector(f.subVectors(X[j.b],P),q),h.addScaledVector(p.subVectors(X[j.c],I),q)}}l.add(C),c.add(P),h.add(I),C=l,P=c,I=h}if(b=n(this,t,a,C,P,I,_)){if(O&&O[B]){var Y=O[B];m.copy(Y[0]),g.copy(Y[1]),v.copy(Y[2]),b.uv=e(_,C,P,I,m,g,v)}b.face=j,b.faceIndex=B,s.push(b)}}}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Hl=0;dt.prototype=Object.assign(Object.create(he.prototype),{constructor:dt,isArrayCamera:!0}),vt.prototype.isFogExp2=!0,vt.prototype.clone=function(){return new vt(this.color.getHex(),this.density)},vt.prototype.toJSON=function(e){return{type:"FogExp2",color:this.color.getHex(),density:this.density}},yt.prototype.isFog=!0,yt.prototype.clone=function(){return new yt(this.color.getHex(),this.near,this.far)},yt.prototype.toJSON=function(e){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}},_t.prototype=Object.assign(Object.create(ue.prototype),{constructor:_t,copy:function(e,t){return ue.prototype.copy.call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=ue.prototype.toJSON.call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}),xt.prototype=Object.assign(Object.create(ue.prototype),{constructor:xt,isLensFlare:!0,copy:function(e){ue.prototype.copy.call(this,e),this.positionScreen.copy(e.positionScreen),this.customUpdateCallback=e.customUpdateCallback;for(var t=0,n=e.lensFlares.length;t<n;t++)this.lensFlares.push(e.lensFlares[t]);return this},add:function(e,t,n,i,r,a){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===a&&(a=1),void 0===r&&(r=new W(16777215)),void 0===i&&(i=Ta),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:0,opacity:a,color:r,blending:i})},updateLensFlares:function(){var e,t,n=this.lensFlares.length,i=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;e<n;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+i*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=t.x*Math.PI*.25,t.rotation+=.25*(t.wantedRotation-t.rotation)}}),bt.prototype=Object.create(K.prototype),bt.prototype.constructor=bt,bt.prototype.isSpriteMaterial=!0,bt.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.rotation=e.rotation,this},wt.prototype=Object.assign(Object.create(ue.prototype),{constructor:wt,isSprite:!0,raycast:function(){var e=new s,t=new s,n=new s;return function(i,r){t.setFromMatrixPosition(this.matrixWorld),i.ray.closestPointToPoint(t,e),n.setFromMatrixScale(this.matrixWorld);var a=n.x*n.y/4;if(!(t.distanceToSquared(e)>a)){var o=i.ray.origin.distanceTo(e);o<i.near||o>i.far||r.push({distance:o,point:e.clone(),face:null,object:this})}}}(),clone:function(){return new this.constructor(this.material).copy(this)}}),Et.prototype=Object.assign(Object.create(ue.prototype),{constructor:Et,copy:function(e){ue.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,i=t.length;n<i;n++){var r=t[n];this.addLevel(r.object.clone(),r.distance)}return this},addLevel:function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=this.levels,i=0;i<n.length&&!(t<n[i].distance);i++);n.splice(i,0,{distance:t,object:e}),this.add(e)},getObjectForDistance:function(e){for(var t=this.levels,n=1,i=t.length;n<i&&!(e<t[n].distance);n++);return t[n-1].object},raycast:function(){var e=new s;return function(t,n){e.setFromMatrixPosition(this.matrixWorld);var i=t.ray.origin.distanceTo(e);this.getObjectForDistance(i).raycast(t,n)}}(),update:function(){var e=new s,t=new s;return function(n){var i=this.levels;if(i.length>1){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var r=e.distanceTo(t);i[0].object.visible=!0;for(var a=1,o=i.length;a<o&&r>=i[a].distance;a++)i[a-1].object.visible=!1,i[a].object.visible=!0;for(;a<o;a++)i[a].object.visible=!1}}}(),toJSON:function(e){var t=ue.prototype.toJSON.call(this,e);t.object.levels=[];for(var n=this.levels,i=0,r=n.length;i<r;i++){var a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}}),Object.assign(St.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var n=new u;this.bones[e]&&n.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(n)}},pose:function(){var e,t,n;for(t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,n=this.bones.length;t<n;t++)e=this.bones[t],e&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){var e=new u,t=new u;return function(){for(var n=this.bones,i=this.boneInverses,r=this.boneMatrices,a=this.boneTexture,o=0,s=n.length;o<s;o++){var u=n[o]?n[o].matrixWorld:t;e.multiplyMatrices(u,i[o]),e.toArray(r,16*o)}void 0!==a&&(a.needsUpdate=!0)}}(),clone:function(){return new St(this.bones,this.boneInverses)}}),Mt.prototype=Object.assign(Object.create(ue.prototype),{constructor:Mt,isBone:!0}),Tt.prototype=Object.assign(Object.create(Ne.prototype),{constructor:Tt,isSkinnedMesh:!0,initBones:function(){var e,t,n,i,r=[];if(this.geometry&&void 0!==this.geometry.bones){for(n=0,i=this.geometry.bones.length;n<i;n++)t=this.geometry.bones[n],e=new Mt,r.push(e),e.name=t.name,e.position.fromArray(t.pos),e.quaternion.fromArray(t.rotq),void 0!==t.scl&&e.scale.fromArray(t.scl);for(n=0,i=this.geometry.bones.length;n<i;n++)t=this.geometry.bones[n],t.parent!==-1&&null!==t.parent&&void 0!==r[t.parent]?r[t.parent].add(r[n]):this.add(r[n])}return this.updateMatrixWorld(!0),r},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){var e,t;if(this.geometry&&this.geometry.isGeometry)for(t=0;t<this.geometry.skinWeights.length;t++){var n=this.geometry.skinWeights[t];e=1/n.lengthManhattan(),e!==1/0?n.multiplyScalar(e):n.set(1,0,0,0)}else if(this.geometry&&this.geometry.isBufferGeometry){var r=new i,a=this.geometry.attributes.skinWeight;for(t=0;t<a.count;t++)r.x=a.getX(t),r.y=a.getY(t),r.z=a.getZ(t),r.w=a.getW(t),e=1/r.lengthManhattan(),e!==1/0?r.multiplyScalar(e):r.set(1,0,0,0),a.setXYZW(t,r.x,r.y,r.z,r.w)}},updateMatrixWorld:function(e){Ne.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.getInverse(this.matrixWorld):"detached"===this.bindMode?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),At.prototype=Object.create(K.prototype),At.prototype.constructor=At,At.prototype.isLineBasicMaterial=!0,At.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this},Lt.prototype=Object.assign(Object.create(ue.prototype),{constructor:Lt,isLine:!0,raycast:function(){var e=new u,t=new Oe,n=new ee;return function(i,r){var a=i.linePrecision,o=a*a,u=this.geometry,l=this.matrixWorld;if(null===u.boundingSphere&&u.computeBoundingSphere(),n.copy(u.boundingSphere),n.applyMatrix4(l),i.ray.intersectsSphere(n)!==!1){e.getInverse(l),t.copy(i.ray).applyMatrix4(e);var c=new s,h=new s,d=new s,f=new s,p=this&&this.isLineSegments?2:1;if(u.isBufferGeometry){var m=u.index,g=u.attributes,v=g.position.array;if(null!==m)for(var y=m.array,_=0,x=y.length-1;_<x;_+=p){var b=y[_],w=y[_+1];c.fromArray(v,3*b),h.fromArray(v,3*w);var E=t.distanceSqToSegment(c,h,f,d);if(!(E>o)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}else for(var _=0,x=v.length/3-1;_<x;_+=p){c.fromArray(v,3*_),h.fromArray(v,3*_+3);var E=t.distanceSqToSegment(c,h,f,d);if(!(E>o)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}else if(u.isGeometry)for(var M=u.vertices,T=M.length,_=0;_<T-1;_+=p){var E=t.distanceSqToSegment(M[_],M[_+1],f,d);if(!(E>o)){f.applyMatrix4(this.matrixWorld);var S=i.ray.origin.distanceTo(f);S<i.near||S>i.far||r.push({distance:S,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Rt.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Rt,isLineSegments:!0}),Ct.prototype=Object.assign(Object.create(Lt.prototype),{constructor:Ct,isLineLoop:!0}),Pt.prototype=Object.create(K.prototype),Pt.prototype.constructor=Pt,Pt.prototype.isPointsMaterial=!0,Pt.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this},It.prototype=Object.assign(Object.create(ue.prototype),{constructor:It,isPoints:!0,raycast:function(){var e=new u,t=new Oe,n=new ee;return function(i,r){function a(e,n){var a=t.distanceSqToPoint(e);if(a<d){var s=t.closestPointToPoint(e);s.applyMatrix4(l);var u=i.ray.origin.distanceTo(s);if(u<i.near||u>i.far)return;r.push({distance:u,distanceToRay:Math.sqrt(a),point:s.clone(),index:n,face:null,object:o})}}var o=this,u=this.geometry,l=this.matrixWorld,c=i.params.Points.threshold;if(null===u.boundingSphere&&u.computeBoundingSphere(),n.copy(u.boundingSphere),n.applyMatrix4(l),n.radius+=c,i.ray.intersectsSphere(n)!==!1){e.getInverse(l),t.copy(i.ray).applyMatrix4(e);var h=c/((this.scale.x+this.scale.y+this.scale.z)/3),d=h*h,f=new s;if(u.isBufferGeometry){var p=u.index,m=u.attributes,g=m.position.array;if(null!==p)for(var v=p.array,y=0,_=v.length;y<_;y++){var x=v[y];f.fromArray(g,3*x),a(f,x)}else for(var y=0,b=g.length/3;y<b;y++)f.fromArray(g,3*y),a(f,y)}else for(var w=u.vertices,y=0,b=w.length;y<b;y++)a(w[y],y)}}}(),clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Ot.prototype=Object.assign(Object.create(ue.prototype),{constructor:Ot}),kt.prototype=Object.create(n.prototype),kt.prototype.constructor=kt,Dt.prototype=Object.create(n.prototype),Dt.prototype.constructor=Dt,Dt.prototype.isCompressedTexture=!0,Nt.prototype=Object.create(n.prototype),Nt.prototype.constructor=Nt,Ut.prototype=Object.create(n.prototype),Ut.prototype.constructor=Ut,Ut.prototype.isDepthTexture=!0,Bt.prototype=Object.create(Ae.prototype),Bt.prototype.constructor=Bt,Ft.prototype=Object.create(pe.prototype),Ft.prototype.constructor=Ft,jt.prototype=Object.create(Ae.prototype),jt.prototype.constructor=jt,zt.prototype=Object.create(pe.prototype),zt.prototype.constructor=zt,Gt.prototype=Object.create(Ae.prototype),Gt.prototype.constructor=Gt,Ht.prototype=Object.create(pe.prototype),Ht.prototype.constructor=Ht,Vt.prototype=Object.create(Gt.prototype),Vt.prototype.constructor=Vt,Wt.prototype=Object.create(pe.prototype),Wt.prototype.constructor=Wt,qt.prototype=Object.create(Gt.prototype),qt.prototype.constructor=qt,Xt.prototype=Object.create(pe.prototype),Xt.prototype.constructor=Xt,Yt.prototype=Object.create(Gt.prototype),Yt.prototype.constructor=Yt,Kt.prototype=Object.create(pe.prototype),Kt.prototype.constructor=Kt,Zt.prototype=Object.create(Gt.prototype),Zt.prototype.constructor=Zt,Jt.prototype=Object.create(pe.prototype),Jt.prototype.constructor=Jt,Qt.prototype=Object.create(Ae.prototype),Qt.prototype.constructor=Qt,$t.prototype=Object.create(pe.prototype),$t.prototype.constructor=$t,en.prototype=Object.create(Ae.prototype),en.prototype.constructor=en,tn.prototype=Object.create(pe.prototype),tn.prototype.constructor=tn,nn.prototype=Object.create(Ae.prototype),nn.prototype.constructor=nn;var Vl={area:function(e){for(var t=e.length,n=0,i=t-1,r=0;r<t;i=r++)n+=e[i].x*e[r].y-e[r].x*e[i].y;return.5*n},triangulate:function(){function e(e,t,n,i,r,a){var o,s,u,l,c,h,d,f,p;if(s=e[a[t]].x,u=e[a[t]].y,l=e[a[n]].x,c=e[a[n]].y,h=e[a[i]].x,d=e[a[i]].y,(l-s)*(d-u)-(c-u)*(h-s)<=0)return!1;var m,g,v,y,_,x,b,w,E,S,M,T,A,L,R;for(m=h-l,g=d-c,v=s-h,y=u-d,_=l-s,x=c-u,o=0;o<r;o++)if(f=e[a[o]].x,p=e[a[o]].y,!(f===s&&p===u||f===l&&p===c||f===h&&p===d)&&(b=f-s,w=p-u,E=f-l,S=p-c,M=f-h,T=p-d,R=m*S-g*E,A=_*w-x*b,L=v*T-y*M,R>=-Number.EPSILON&&L>=-Number.EPSILON&&A>=-Number.EPSILON))return!1;return!0}return function(t,n){var i=t.length;if(i<3)return null;var r,a,o,s=[],u=[],l=[];if(Vl.area(t)>0)for(a=0;a<i;a++)u[a]=a;else for(a=0;a<i;a++)u[a]=i-1-a;var c=i,h=2*c;for(a=c-1;c>2;){if(h--<=0)return console.warn("THREE.ShapeUtils: Unable to triangulate polygon! in triangulate()"),n?l:s;if(r=a,c<=r&&(r=0),a=r+1,c<=a&&(a=0),o=a+1,c<=o&&(o=0),e(t,r,a,o,c,u)){var d,f,p,m,g;for(d=u[r],f=u[a],p=u[o],s.push([t[d],t[f],t[p]]),l.push([u[r],u[a],u[o]]),m=a,g=a+1;g<c;m++,g++)u[m]=u[g];c--,h=2*c}}return n?l:s}}(),triangulateShape:function(e,t){function n(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function i(e,t,n){return e.x!==t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,n,r,a){var o=t.x-e.x,s=t.y-e.y,u=r.x-n.x,l=r.y-n.y,c=e.x-n.x,h=e.y-n.y,d=s*u-o*l,f=s*c-o*h;if(Math.abs(d)>Number.EPSILON){var p;if(d>0){if(f<0||f>d)return[];if(p=l*c-u*h,p<0||p>d)return[]}else{if(f>0||f<d)return[];if(p=l*c-u*h,p>0||p<d)return[]}if(0===p)return!a||0!==f&&f!==d?[e]:[];if(p===d)return!a||0!==f&&f!==d?[t]:[];if(0===f)return[n];if(f===d)return[r];var m=p/d;return[{x:e.x+m*o,y:e.y+m*s}]}if(0!==f||l*c!==u*h)return[];var g=0===o&&0===s,v=0===u&&0===l;if(g&&v)return e.x!==n.x||e.y!==n.y?[]:[e];if(g)return i(n,r,e)?[e]:[];if(v)return i(e,t,n)?[n]:[];var y,_,x,b,w,E,S,M;return 0!==o?(e.x<t.x?(y=e,x=e.x,_=t,b=t.x):(y=t,x=t.x,_=e,b=e.x),n.x<r.x?(w=n,S=n.x,E=r,M=r.x):(w=r,S=r.x,E=n,M=n.x)):(e.y<t.y?(y=e,x=e.y,_=t,b=t.y):(y=t,x=t.y,_=e,b=e.y),n.y<r.y?(w=n,S=n.y,E=r,M=r.y):(w=r,S=r.y,E=n,M=n.y)),x<=S?b<S?[]:b===S?a?[]:[w]:b<=M?[w,_]:[w,E]:x>M?[]:x===M?a?[]:[y]:b<=M?[y,_]:[y,E]}function a(e,t,n,i){var r=t.x-e.x,a=t.y-e.y,o=n.x-e.x,s=n.y-e.y,u=i.x-e.x,l=i.y-e.y,c=r*s-a*o,h=r*l-a*u;if(Math.abs(c)>Number.EPSILON){var d=u*s-l*o;return c>0?h>=0&&d>=0:h>=0||d>=0}return h>0}function o(e,t){function n(e,t){var n=y.length-1,i=e-1;i<0&&(i=n);var r=e+1;r>n&&(r=0);var o=a(y[e],y[i],y[r],s[t]);if(!o)return!1;var u=s.length-1,l=t-1;l<0&&(l=u);var c=t+1;return c>u&&(c=0),o=a(s[t],s[l],s[c],y[e]),!!o}function i(e,t){var n,i,a;for(n=0;n<y.length;n++)if(i=n+1,i%=y.length,a=r(e,t,y[n],y[i],!0),a.length>0)return!0;return!1}function o(e,n){var i,a,o,s,u;for(i=0;i<_.length;i++)for(a=t[_[i]],o=0;o<a.length;o++)if(s=o+1,s%=a.length,u=r(e,n,a[o],a[s],!0),u.length>0)return!0;return!1}for(var s,u,l,c,h,d,f,p,m,g,v,y=e.concat(),_=[],x=[],b=0,w=t.length;b<w;b++)_.push(b);for(var E=0,S=2*_.length;_.length>0;){if(S--,S<0){console.log("Infinite Loop! Holes left:"+_.length+", Probably Hole outside Shape!");break}for(l=E;l<y.length;l++){c=y[l],u=-1;for(var b=0;b<_.length;b++)if(d=_[b],f=c.x+":"+c.y+":"+d,void 0===x[f]){s=t[d];for(var M=0;M<s.length;M++)if(h=s[M],n(l,M)&&!i(c,h)&&!o(c,h)){u=M,_.splice(b,1),p=y.slice(0,l+1),m=y.slice(l),g=s.slice(u),v=s.slice(0,u+1),y=p.concat(g).concat(v).concat(m),E=l;break}if(u>=0)break;x[f]=!0}if(u>=0)break}}return y}n(e),t.forEach(n);for(var s,u,l,c,h,d,f={},p=e.concat(),m=0,g=t.length;m<g;m++)Array.prototype.push.apply(p,t[m]);for(s=0,u=p.length;s<u;s++)h=p[s].x+":"+p[s].y,void 0!==f[h]&&console.warn("THREE.ShapeUtils: Duplicate point",h,s),f[h]=s;var v=o(e,t),y=Vl.triangulate(v,!1);for(s=0,u=y.length;s<u;s++)for(c=y[s],l=0;l<3;l++)h=c[l].x+":"+c[l].y,d=f[h],void 0!==d&&(c[l]=d);return y.concat()},isClockWise:function(e){return Vl.area(e)<0}};rn.prototype=Object.create(pe.prototype),rn.prototype.constructor=rn,an.prototype=Object.create(Ae.prototype),an.prototype.constructor=an,an.prototype.getArrays=function(){var e=this.getAttribute("position"),t=e?Array.prototype.slice.call(e.array):[],n=this.getAttribute("uv"),i=n?Array.prototype.slice.call(n.array):[],r=this.index,a=r?Array.prototype.slice.call(r.array):[];return{position:t,uv:i,index:a}},an.prototype.addShapeList=function(e,t){var n=e.length;t.arrays=this.getArrays();for(var i=0;i<n;i++){var r=e[i];this.addShape(r,t)}this.setIndex(t.arrays.index),this.addAttribute("position",new Ee(t.arrays.position,3)),this.addAttribute("uv",new Ee(t.arrays.uv,2))},an.prototype.addShape=function(e,n){function i(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}function r(e,n,i){var r,a,o,s=e.x-n.x,u=e.y-n.y,l=i.x-e.x,c=i.y-e.y,h=s*s+u*u,d=s*c-u*l;if(Math.abs(d)>Number.EPSILON){var f=Math.sqrt(h),p=Math.sqrt(l*l+c*c),m=n.x-u/f,g=n.y+s/f,v=i.x-c/p,y=i.y+l/p,_=((v-m)*c-(y-g)*l)/(s*c-u*l);r=m+s*_-e.x,a=g+u*_-e.y;var x=r*r+a*a;if(x<=2)return new t(r,a);o=Math.sqrt(x/2)}else{var b=!1;s>Number.EPSILON?l>Number.EPSILON&&(b=!0):s<-Number.EPSILON?l<-Number.EPSILON&&(b=!0):Math.sign(u)===Math.sign(c)&&(b=!0),b?(r=-u,a=s,o=Math.sqrt(h)):(r=s,a=u,o=Math.sqrt(h/2))}return new t(r/o,a/o)}function a(){var e=x.length/3;if(L){var t=0,i=Z*t;for(ee=0;ee<J;ee++)K=G[ee],c(K[2]+i,K[1]+i,K[0]+i);for(t=C+2*A,i=Z*t,ee=0;ee<J;ee++)K=G[ee],c(K[0]+i,K[1]+i,K[2]+i)}else{for(ee=0;ee<J;ee++)K=G[ee],c(K[2],K[1],K[0]);for(ee=0;ee<J;ee++)K=G[ee],c(K[0]+Z*C,K[1]+Z*C,K[2]+Z*C)}U.addGroup(e,x.length/3-e,void 0!==n.material?n.material:0)}function o(){var e=x.length/3,t=0;for(u(H,t),t+=H.length,D=0,N=j.length;D<N;D++)k=j[D],u(k,t),t+=k.length;U.addGroup(e,x.length/3-e,void 0!==n.extrudeMaterial?n.extrudeMaterial:1)}function u(e,t){var n,i;for(ee=e.length;--ee>=0;){n=ee,i=ee-1,i<0&&(i=e.length-1);
var r=0,a=C+2*A;for(r=0;r<a;r++){var o=Z*r,s=Z*(r+1),u=t+n+o,l=t+i+o,c=t+i+s,d=t+n+s;h(u,l,c,d,e,r,a,n,i)}}}function l(e,t,n){E.push(e),E.push(t),E.push(n)}function c(e,t,n){d(e),d(t),d(n);var i=x.length/3,r=O.generateTopUV(U,x,i-3,i-2,i-1);f(r[0]),f(r[1]),f(r[2])}function h(e,t,n,i,r,a,o,s,u){d(e),d(t),d(i),d(t),d(n),d(i);var l=x.length/3,c=O.generateSideWallUV(U,x,l-6,l-3,l-2,l-1);f(c[0]),f(c[1]),f(c[3]),f(c[1]),f(c[2]),f(c[3])}function d(e){b.push(x.length/3),x.push(E[3*e+0]),x.push(E[3*e+1]),x.push(E[3*e+2])}function f(e){w.push(e.x),w.push(e.y)}var p,m,g,v,y,_=n.arrays?n.arrays:this.getArrays(),x=_.position,b=_.index,w=_.uv,E=[],S=void 0!==n.amount?n.amount:100,M=void 0!==n.bevelThickness?n.bevelThickness:6,T=void 0!==n.bevelSize?n.bevelSize:M-2,A=void 0!==n.bevelSegments?n.bevelSegments:3,L=void 0===n.bevelEnabled||n.bevelEnabled,R=void 0!==n.curveSegments?n.curveSegments:12,C=void 0!==n.steps?n.steps:1,P=n.extrudePath,I=!1,O=void 0!==n.UVGenerator?n.UVGenerator:rn.WorldUVGenerator;P&&(p=P.getSpacedPoints(C),I=!0,L=!1,m=void 0!==n.frames?n.frames:P.computeFrenetFrames(C,!1),g=new s,v=new s,y=new s),L||(A=0,M=0,T=0);var k,D,N,U=this,B=e.extractPoints(R),F=B.shape,j=B.holes,z=!Vl.isClockWise(F);if(z)for(F=F.reverse(),D=0,N=j.length;D<N;D++)k=j[D],Vl.isClockWise(k)&&(j[D]=k.reverse());var G=Vl.triangulateShape(F,j),H=F;for(D=0,N=j.length;D<N;D++)k=j[D],F=F.concat(k);for(var V,W,q,X,Y,K,Z=F.length,J=G.length,Q=[],ee=0,te=H.length,ne=te-1,ie=ee+1;ee<te;ee++,ne++,ie++)ne===te&&(ne=0),ie===te&&(ie=0),Q[ee]=r(H[ee],H[ne],H[ie]);var re,ae=[],oe=Q.concat();for(D=0,N=j.length;D<N;D++){for(k=j[D],re=[],ee=0,te=k.length,ne=te-1,ie=ee+1;ee<te;ee++,ne++,ie++)ne===te&&(ne=0),ie===te&&(ie=0),re[ee]=r(k[ee],k[ne],k[ie]);ae.push(re),oe=oe.concat(re)}for(V=0;V<A;V++){for(q=V/A,X=M*Math.cos(q*Math.PI/2),W=T*Math.sin(q*Math.PI/2),ee=0,te=H.length;ee<te;ee++)Y=i(H[ee],Q[ee],W),l(Y.x,Y.y,-X);for(D=0,N=j.length;D<N;D++)for(k=j[D],re=ae[D],ee=0,te=k.length;ee<te;ee++)Y=i(k[ee],re[ee],W),l(Y.x,Y.y,-X)}for(W=T,ee=0;ee<Z;ee++)Y=L?i(F[ee],oe[ee],W):F[ee],I?(v.copy(m.normals[0]).multiplyScalar(Y.x),g.copy(m.binormals[0]).multiplyScalar(Y.y),y.copy(p[0]).add(v).add(g),l(y.x,y.y,y.z)):l(Y.x,Y.y,0);var se;for(se=1;se<=C;se++)for(ee=0;ee<Z;ee++)Y=L?i(F[ee],oe[ee],W):F[ee],I?(v.copy(m.normals[se]).multiplyScalar(Y.x),g.copy(m.binormals[se]).multiplyScalar(Y.y),y.copy(p[se]).add(v).add(g),l(y.x,y.y,y.z)):l(Y.x,Y.y,S/C*se);for(V=A-1;V>=0;V--){for(q=V/A,X=M*Math.cos(q*Math.PI/2),W=T*Math.sin(q*Math.PI/2),ee=0,te=H.length;ee<te;ee++)Y=i(H[ee],Q[ee],W),l(Y.x,Y.y,S+X);for(D=0,N=j.length;D<N;D++)for(k=j[D],re=ae[D],ee=0,te=k.length;ee<te;ee++)Y=i(k[ee],re[ee],W),I?l(Y.x,Y.y+p[C-1].y,p[C-1].x+X):l(Y.x,Y.y,S+X)}a(),o(),n.arrays||(this.setIndex(b),this.addAttribute("position",new Ee(x,3)),this.addAttribute("uv",new Ee(n.arrays.uv,2)))},rn.WorldUVGenerator={generateTopUV:function(e,n,i,r,a){var o=n[3*i],s=n[3*i+1],u=n[3*r],l=n[3*r+1],c=n[3*a],h=n[3*a+1];return[new t(o,s),new t(u,l),new t(c,h)]},generateSideWallUV:function(e,n,i,r,a,o){var s=n[3*i],u=n[3*i+1],l=n[3*i+2],c=n[3*r],h=n[3*r+1],d=n[3*r+2],f=n[3*a],p=n[3*a+1],m=n[3*a+2],g=n[3*o],v=n[3*o+1],y=n[3*o+2];return Math.abs(u-h)<.01?[new t(s,1-l),new t(c,1-d),new t(f,1-m),new t(g,1-y)]:[new t(u,1-l),new t(h,1-d),new t(p,1-m),new t(v,1-y)]}},on.prototype=Object.create(pe.prototype),on.prototype.constructor=on,sn.prototype=Object.create(an.prototype),sn.prototype.constructor=sn,un.prototype=Object.create(pe.prototype),un.prototype.constructor=un,ln.prototype=Object.create(Ae.prototype),ln.prototype.constructor=ln,cn.prototype=Object.create(pe.prototype),cn.prototype.constructor=cn,hn.prototype=Object.create(Ae.prototype),hn.prototype.constructor=hn,dn.prototype=Object.create(pe.prototype),dn.prototype.constructor=dn,fn.prototype=Object.create(Ae.prototype),fn.prototype.constructor=fn,pn.prototype=Object.create(pe.prototype),pn.prototype.constructor=pn,mn.prototype=Object.create(Ae.prototype),mn.prototype.constructor=mn,gn.prototype=Object.create(Ae.prototype),gn.prototype.constructor=gn,vn.prototype=Object.create(pe.prototype),vn.prototype.constructor=vn,yn.prototype=Object.create(Ae.prototype),yn.prototype.constructor=yn,_n.prototype=Object.create(vn.prototype),_n.prototype.constructor=_n,xn.prototype=Object.create(yn.prototype),xn.prototype.constructor=xn,bn.prototype=Object.create(pe.prototype),bn.prototype.constructor=bn,wn.prototype=Object.create(Ae.prototype),wn.prototype.constructor=wn;var Wl=Object.freeze({WireframeGeometry:Bt,ParametricGeometry:Ft,ParametricBufferGeometry:jt,TetrahedronGeometry:Ht,TetrahedronBufferGeometry:Vt,OctahedronGeometry:Wt,OctahedronBufferGeometry:qt,IcosahedronGeometry:Xt,IcosahedronBufferGeometry:Yt,DodecahedronGeometry:Kt,DodecahedronBufferGeometry:Zt,PolyhedronGeometry:zt,PolyhedronBufferGeometry:Gt,TubeGeometry:Jt,TubeBufferGeometry:Qt,TorusKnotGeometry:$t,TorusKnotBufferGeometry:en,TorusGeometry:tn,TorusBufferGeometry:nn,TextGeometry:on,TextBufferGeometry:sn,SphereGeometry:un,SphereBufferGeometry:ln,RingGeometry:cn,RingBufferGeometry:hn,PlaneGeometry:Ce,PlaneBufferGeometry:Pe,LatheGeometry:dn,LatheBufferGeometry:fn,ShapeGeometry:pn,ShapeBufferGeometry:mn,ExtrudeGeometry:rn,ExtrudeBufferGeometry:an,EdgesGeometry:gn,ConeGeometry:_n,ConeBufferGeometry:xn,CylinderGeometry:vn,CylinderBufferGeometry:yn,CircleGeometry:bn,CircleBufferGeometry:wn,BoxGeometry:Le,BoxBufferGeometry:Re});En.prototype=Object.create(Z.prototype),En.prototype.constructor=En,En.prototype.isShadowMaterial=!0,Sn.prototype=Object.create(Z.prototype),Sn.prototype.constructor=Sn,Sn.prototype.isRawShaderMaterial=!0,Mn.prototype=Object.create(K.prototype),Mn.prototype.constructor=Mn,Mn.prototype.isMeshStandardMaterial=!0,Mn.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Tn.prototype=Object.create(Mn.prototype),Tn.prototype.constructor=Tn,Tn.prototype.isMeshPhysicalMaterial=!0,Tn.prototype.copy=function(e){return Mn.prototype.copy.call(this,e),this.defines={PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearCoat=e.clearCoat,this.clearCoatRoughness=e.clearCoatRoughness,this},An.prototype=Object.create(K.prototype),An.prototype.constructor=An,An.prototype.isMeshPhongMaterial=!0,An.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Ln.prototype=Object.create(An.prototype),Ln.prototype.constructor=Ln,Ln.prototype.isMeshToonMaterial=!0,Ln.prototype.copy=function(e){return An.prototype.copy.call(this,e),this.gradientMap=e.gradientMap,this},Rn.prototype=Object.create(K.prototype),Rn.prototype.constructor=Rn,Rn.prototype.isMeshNormalMaterial=!0,Rn.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Cn.prototype=Object.create(K.prototype),Cn.prototype.constructor=Cn,Cn.prototype.isMeshLambertMaterial=!0,Cn.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},Pn.prototype=Object.create(K.prototype),Pn.prototype.constructor=Pn,Pn.prototype.isLineDashedMaterial=!0,Pn.prototype.copy=function(e){return K.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var ql=Object.freeze({ShadowMaterial:En,SpriteMaterial:bt,RawShaderMaterial:Sn,ShaderMaterial:Z,PointsMaterial:Pt,MeshPhysicalMaterial:Tn,MeshStandardMaterial:Mn,MeshPhongMaterial:An,MeshToonMaterial:Ln,MeshNormalMaterial:Rn,MeshLambertMaterial:Cn,MeshDepthMaterial:J,MeshBasicMaterial:Ie,LineDashedMaterial:Pn,LineBasicMaterial:At,Material:K}),Xl={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},Yl=new In;Object.assign(On.prototype,{load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=this,a=Xl.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o=/^data:(.*?)(;base64)?,(.*)$/,s=e.match(o);if(s){var u=s[1],l=!!s[2],c=s[3];c=window.decodeURIComponent(c),l&&(c=window.atob(c));try{var h,d=(this.responseType||"").toLowerCase();switch(d){case"arraybuffer":case"blob":h=new ArrayBuffer(c.length);for(var f=new Uint8Array(h),p=0;p<c.length;p++)f[p]=c.charCodeAt(p);"blob"===d&&(h=new Blob([h],{type:u}));break;case"document":var m=new DOMParser;h=m.parseFromString(c,u);break;case"json":h=JSON.parse(c);break;default:h=c}window.setTimeout(function(){t&&t(h),r.manager.itemEnd(e)},0)}catch(g){window.setTimeout(function(){i&&i(g),r.manager.itemEnd(e),r.manager.itemError(e)},0)}}else{var v=new XMLHttpRequest;v.open("GET",e,!0),v.addEventListener("load",function(n){var a=n.target.response;Xl.add(e,a),200===this.status?(t&&t(a),r.manager.itemEnd(e)):0===this.status?(console.warn("THREE.FileLoader: HTTP Status 0 received."),t&&t(a),r.manager.itemEnd(e)):(i&&i(n),r.manager.itemEnd(e),r.manager.itemError(e))},!1),void 0!==n&&v.addEventListener("progress",function(e){n(e)},!1),v.addEventListener("error",function(t){i&&i(t),r.manager.itemEnd(e),r.manager.itemError(e)},!1),void 0!==this.responseType&&(v.responseType=this.responseType),void 0!==this.withCredentials&&(v.withCredentials=this.withCredentials),v.overrideMimeType&&v.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain");for(var y in this.requestHeader)v.setRequestHeader(y,this.requestHeader[y]);v.send(null)}return r.manager.itemStart(e),v},setPath:function(e){return this.path=e,this},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),Object.assign(kn.prototype,{load:function(e,t,n,i){function r(r){u.load(e[r],function(e){var n=a._parser(e,!0);o[r]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},l+=1,6===l&&(1===n.mipmapCount&&(s.minFilter=So),s.format=n.format,s.needsUpdate=!0,t&&t(s))},n,i)}var a=this,o=[],s=new Dt;s.image=o;var u=new On(this.manager);if(u.setPath(this.path),u.setResponseType("arraybuffer"),Array.isArray(e))for(var l=0,c=0,h=e.length;c<h;++c)r(c);else u.load(e,function(e){var n=a._parser(e,!0);if(n.isCubemap)for(var i=n.mipmaps.length/n.mipmapCount,r=0;r<i;r++){o[r]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)o[r].mipmaps.push(n.mipmaps[r*n.mipmapCount+u]),o[r].format=n.format,o[r].width=n.width,o[r].height=n.height}else s.image.width=n.width,s.image.height=n.height,s.mipmaps=n.mipmaps;1===n.mipmapCount&&(s.minFilter=So),s.format=n.format,s.needsUpdate=!0,t&&t(s)},n,i);return s},setPath:function(e){return this.path=e,this}}),Object.assign(Dn.prototype,{load:function(e,t,n,i){var r=this,a=new l,o=new On(this.manager);return o.setResponseType("arraybuffer"),o.load(e,function(e){var n=r._parser(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:_o,a.wrapT=void 0!==n.wrapT?n.wrapT:_o,a.magFilter=void 0!==n.magFilter?n.magFilter:So,a.minFilter=void 0!==n.minFilter?n.minFilter:To,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps),1===n.mipmapCount&&(a.minFilter=So),a.needsUpdate=!0,t&&t(a,n))},n,i),a}}),Object.assign(Nn.prototype,{load:function(e,t,n,i){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e);var r=this,a=Xl.get(e);if(void 0!==a)return r.manager.itemStart(e),setTimeout(function(){t&&t(a),r.manager.itemEnd(e)},0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");return o.addEventListener("load",function(){Xl.add(e,this),t&&t(this),r.manager.itemEnd(e)},!1),o.addEventListener("error",function(t){i&&i(t),r.manager.itemEnd(e),r.manager.itemError(e)},!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),r.manager.itemStart(e),o.src=e,o.crossOrigin="*",o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Un.prototype,{load:function(e,t,n,i){function r(n){o.load(e[n],function(e){a.images[n]=e,s++,6===s&&(a.needsUpdate=!0,t&&t(a))},void 0,i)}var a=new c,o=new Nn(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);for(var s=0,u=0;u<e.length;++u)r(u);return a},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Object.assign(Bn.prototype,{load:function(e,t,i,r){var a=new Nn(this.manager);a.setCrossOrigin("*"),a.setPath(this.path);var o=new n;return o.image=a.load(e,function(){var n=e.search(/\.(jpg|jpeg)$/)>0||0===e.search(/^data\:image\/jpeg/);o.format=n?jo:zo,o.needsUpdate=!0,void 0!==t&&t(o)},i,r),o},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this}}),Fn.prototype=Object.assign(Object.create(ue.prototype),{constructor:Fn,isLight:!0,copy:function(e){return ue.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=ue.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),jn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:jn,isHemisphereLight:!0,copy:function(e){return Fn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(zn.prototype,{copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),Gn.prototype=Object.assign(Object.create(zn.prototype),{constructor:Gn,isSpotLightShadow:!0,update:function(e){var t=this.camera,n=2*Ss.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,r=e.distance||t.far;n===t.fov&&i===t.aspect&&r===t.far||(t.fov=n,t.aspect=i,t.far=r,t.updateProjectionMatrix())}}),Hn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Hn,isSpotLight:!0,copy:function(e){return Fn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Vn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Vn,isPointLight:!0,copy:function(e){return Fn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),Wn.prototype=Object.assign(Object.create(zn.prototype),{constructor:Wn}),qn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:qn,isDirectionalLight:!0,copy:function(e){return Fn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),Xn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Xn,isAmbientLight:!0}),Yn.prototype=Object.assign(Object.create(Fn.prototype),{constructor:Yn,isRectAreaLight:!0,copy:function(e){return Fn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Fn.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var Kl={arraySlice:function(e,t,n){return Kl.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){function t(t,n){return e[t]-e[n]}for(var n=e.length,i=new Array(n),r=0;r!==n;++r)i[r]=r;return i.sort(t),i},sortedArray:function(e,t,n){for(var i=e.length,r=new e.constructor(i),a=0,o=0;o!==i;++a)for(var s=n[a]*t,u=0;u!==t;++u)r[o++]=e[s+u];return r},flattenJSON:function(e,t,n,i){for(var r=1,a=e[0];void 0!==a&&void 0===a[i];)a=e[r++];if(void 0!==a){var o=a[i];if(void 0!==o)if(Array.isArray(o)){do o=a[i],void 0!==o&&(t.push(a.time),n.push.apply(n,o)),a=e[r++];while(void 0!==a)}else if(void 0!==o.toArray){do o=a[i],void 0!==o&&(t.push(a.time),o.toArray(n,n.length)),a=e[r++];while(void 0!==a)}else do o=a[i],void 0!==o&&(t.push(a.time),n.push(o)),a=e[r++];while(void 0!==a)}}};Object.assign(Kn.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,i=t[n],r=t[n-1];e:{t:{var a;n:{i:if(!(e<i)){for(var o=n+2;;){if(void 0===i){if(e<r)break i;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,r)}if(n===o)break;if(r=i,i=t[++n],e<i)break t}a=t.length;break n}{if(e>=r)break e;var s=t[1];e<s&&(n=2,r=s);for(var o=n-2;;){if(void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(n===o)break;if(i=r,r=t[--n-1],e>=r)break t}a=n,n=0}}for(;n<a;){var u=n+a>>>1;e<t[u]?a=u:n=u+1}if(i=t[n],r=t[n-1],void 0===r)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(void 0===i)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,r,e)}this._cachedIndex=n,this.intervalChanged_(n,r,i)}return this.interpolate_(n,r,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,r=e*i,a=0;a!==i;++a)t[a]=n[r+a];return t},interpolate_:function(e,t,n,i){throw new Error("call to abstract method")},intervalChanged_:function(e,t,n){}}),Object.assign(Kn.prototype,{beforeStart_:Kn.prototype.copySampleValue_,afterEnd_:Kn.prototype.copySampleValue_}),Zn.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Zn,DefaultSettings_:{endingStart:us,endingEnd:us},intervalChanged_:function(e,t,n){var i=this.parameterPositions,r=e-2,a=e+1,o=i[r],s=i[a];if(void 0===o)switch(this.getSettings_().endingStart){case ls:r=e,o=2*t-n;break;case cs:r=i.length-2,o=t+i[r]-i[r+1];break;default:r=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case ls:a=e,s=2*n-t;break;case cs:a=1,s=n+i[1]-i[0];break;default:a=e-1,s=t}var u=.5*(n-t),l=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=r*l,this._offsetNext=a*l},interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,d=this._weightNext,f=(n-t)/(i-t),p=f*f,m=p*f,g=-h*m+2*h*p-h*f,v=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*f+1,y=(-1-d)*m+(1.5+d)*p+.5*f,_=d*m-d*p,x=0;x!==o;++x)r[x]=g*a[l+x]+v*a[u+x]+y*a[s+x]+_*a[c+x];return r}}),Jn.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Jn,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,l=(n-t)/(i-t),c=1-l,h=0;h!==o;++h)r[h]=a[u+h]*c+a[s+h]*l;return r}}),Qn.prototype=Object.assign(Object.create(Kn.prototype),{constructor:Qn,interpolate_:function(e,t,n,i){return this.copySampleValue_(e-1)}});var Zl;Zl={TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:os,InterpolantFactoryMethodDiscrete:function(e){return new Qn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Jn(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new Zn(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case as:t=this.InterpolantFactoryMethodDiscrete;break;case os:t=this.InterpolantFactoryMethodLinear;break;case ss:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return void console.warn("THREE.KeyframeTrackPrototype:",n)}this.createInterpolant=t},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return as;case this.InterpolantFactoryMethodLinear:return os;case this.InterpolantFactoryMethodSmooth:return ss}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,i=t.length;n!==i;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,i=n.length,r=0,a=i-1;r!==i&&n[r]<e;)++r;for(;a!==-1&&n[a]>t;)--a;if(++a,0!==r||a!==i){r>=a&&(a=Math.max(a,1),r=a-1);var o=this.getValueSize();this.times=Kl.arraySlice(n,r,a),this.values=Kl.arraySlice(this.values,r*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrackPrototype: Invalid value size in track.",this),e=!1);var n=this.times,i=this.values,r=n.length;0===r&&(console.error("THREE.KeyframeTrackPrototype: Track is empty.",this),e=!1);for(var a=null,o=0;o!==r;o++){var s=n[o];if("number"==typeof s&&isNaN(s)){console.error("THREE.KeyframeTrackPrototype: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrackPrototype: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==i&&Kl.isTypedArray(i))for(var o=0,u=i.length;o!==u;++o){var l=i[o];if(isNaN(l)){console.error("THREE.KeyframeTrackPrototype: Value is not a valid number.",this,o,l),e=!1;break}}return e},optimize:function(){for(var e=this.times,t=this.values,n=this.getValueSize(),i=this.getInterpolation()===ss,r=1,a=e.length-1,o=1;o<a;++o){var s=!1,u=e[o],l=e[o+1];if(u!==l&&(1!==o||u!==u[0]))if(i)s=!0;else for(var c=o*n,h=c-n,d=c+n,f=0;f!==n;++f){var p=t[c+f];if(p!==t[h+f]||p!==t[d+f]){s=!0;break}}if(s){if(o!==r){e[r]=e[o];for(var m=o*n,g=r*n,f=0;f!==n;++f)t[g+f]=t[m+f]}++r}}if(a>0){e[r]=e[a];for(var m=a*n,g=r*n,f=0;f!==n;++f)t[g+f]=t[m+f];++r}return r!==e.length&&(this.times=Kl.arraySlice(e,0,r),this.values=Kl.arraySlice(t,0,r*n)),this}},ei.prototype=Object.assign(Object.create(Zl),{constructor:ei,ValueTypeName:"vector"}),ti.prototype=Object.assign(Object.create(Kn.prototype),{constructor:ti,interpolate_:function(e,t,n,i){for(var r=this.resultBuffer,a=this.sampleValues,s=this.valueSize,u=e*s,l=(n-t)/(i-t),c=u+s;u!==c;u+=4)o.slerpFlat(r,0,a,u-s,a,u,l);return r}}),ni.prototype=Object.assign(Object.create(Zl),{constructor:ni,ValueTypeName:"quaternion",DefaultInterpolation:os,InterpolantFactoryMethodLinear:function(e){return new ti(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),ii.prototype=Object.assign(Object.create(Zl),{constructor:ii,ValueTypeName:"number"}),ri.prototype=Object.assign(Object.create(Zl),{constructor:ri,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:as,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ai.prototype=Object.assign(Object.create(Zl),{constructor:ai,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:as,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),oi.prototype=Object.assign(Object.create(Zl),{constructor:oi,ValueTypeName:"color"}),si.prototype=Zl,Zl.constructor=si,Object.assign(si,{parse:function(e){if(void 0===e.type)throw new Error("track type undefined, can not parse");var t=si._getTrackTypeForValueTypeName(e.type);if(void 0===e.times){var n=[],i=[];Kl.flattenJSON(e.keys,n,i,"value"),e.times=n,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)},toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:Kl.convertArray(e.times,Array),values:Kl.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t},_getTrackTypeForValueTypeName:function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ii;case"vector":case"vector2":case"vector3":case"vector4":return ei;case"color":return oi;case"quaternion":return ni;case"bool":case"boolean":return ai;case"string":return ri}throw new Error("Unsupported typeName: "+e)}}),Object.assign(ui,{parse:function(e){for(var t=[],n=e.tracks,i=1/(e.fps||1),r=0,a=n.length;r!==a;++r)t.push(si.parse(n[r]).scale(i));return new ui(e.name,e.duration,t)},toJSON:function(e){for(var t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t},r=0,a=n.length;r!==a;++r)t.push(si.toJSON(n[r]));return i},CreateFromMorphTargetSequence:function(e,t,n,i){for(var r=t.length,a=[],o=0;o<r;o++){var s=[],u=[];s.push((o+r-1)%r,o,(o+1)%r),u.push(0,1,0);var l=Kl.getKeyframeOrder(s);s=Kl.sortedArray(s,1,l),u=Kl.sortedArray(u,1,l),i||0!==s[0]||(s.push(r),u.push(u[0])),a.push(new ii(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new ui(e,(-1),a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var i=e;n=i.geometry&&i.geometry.animations||i.animations}for(var r=0;r<n.length;r++)if(n[r].name===t)return n[r];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var i={},r=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],u=s.name.match(r);if(u&&u.length>1){var l=u[1],c=i[l];c||(i[l]=c=[]),c.push(s)}}var h=[];for(var l in i)h.push(ui.CreateFromMorphTargetSequence(l,i[l],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,i,r){if(0!==n.length){var a=[],o=[];Kl.flattenJSON(n,a,o,i),0!==a.length&&r.push(new e(t,a,o))}},i=[],r=e.name||"default",a=e.length||-1,o=e.fps||30,s=e.hierarchy||[],u=0;u<s.length;u++){var l=s[u].keys;if(l&&0!==l.length)if(l[0].morphTargets){for(var c={},h=0;h<l.length;h++)if(l[h].morphTargets)for(var d=0;d<l[h].morphTargets.length;d++)c[l[h].morphTargets[d]]=-1;for(var f in c){for(var p=[],m=[],d=0;d!==l[h].morphTargets.length;++d){var g=l[h];p.push(g.time),m.push(g.morphTarget===f?1:0)}i.push(new ii(".morphTargetInfluence["+f+"]",p,m))}a=c.length*(o||1)}else{var v=".bones["+t[u].name+"]";n(ei,v+".position",l,"pos",i),n(ni,v+".quaternion",l,"rot",i),n(ei,v+".scale",l,"scl",i)}}if(0===i.length)return null;var y=new ui(r,a,i);return y}}),Object.assign(ui.prototype,{resetDuration:function(){for(var e=this.tracks,t=0,n=0,i=e.length;n!==i;++n){var r=this.tracks[n];t=Math.max(t,r.times[r.times.length-1])}this.duration=t},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}}),Object.assign(li.prototype,{load:function(e,t,n,i){var r=this,a=new On(r.manager);a.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},setTextures:function(e){this.textures=e},parse:function(e){function n(e){return void 0===i[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),i[e]}var i=this.textures,r=new ql[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearCoat&&(r.clearCoat=e.clearCoat),void 0!==e.clearCoatRoughness&&(r.clearCoatRoughness=e.clearCoatRoughness),void 0!==e.uniforms&&(r.uniforms=e.uniforms),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.vertexColors&&(r.vertexColors=e.vertexColors),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.shading&&(r.shading=e.shading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),
void 0!==e.map&&(r.map=n(e.map)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap),r.transparent=!0),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalScale){var a=e.normalScale;Array.isArray(a)===!1&&(a=[a,a]),r.normalScale=(new t).fromArray(a)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),r}}),Object.assign(ci.prototype,{load:function(e,t,n,i){var r=this,a=new On(r.manager);a.load(e,function(e){t(r.parse(JSON.parse(e)))},n,i)},parse:function(e){var t=new Ae,n=e.data.index;if(void 0!==n){var i=new Jl[n.type](n.array);t.setIndex(new me(i,1))}var r=e.data.attributes;for(var a in r){var o=r[a],i=new Jl[o.type](o.array);t.addAttribute(a,new me(i,o.itemSize,o.normalized))}var u=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==u)for(var l=0,c=u.length;l!==c;++l){var h=u[l];t.addGroup(h.start,h.count,h.materialIndex)}var d=e.data.boundingSphere;if(void 0!==d){var f=new s;void 0!==d.center&&f.fromArray(d.center),t.boundingSphere=new ee(f,d.radius)}return t}});var Jl={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!=typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};hi.Handlers={handlers:[],add:function(e,t){this.handlers.push(e,t)},get:function(e){for(var t=this.handlers,n=0,i=t.length;n<i;n+=2){var r=t[n],a=t[n+1];if(r.test(e))return a}return null}},Object.assign(hi.prototype,{crossOrigin:"*",extractUrlBase:function(e){var t=e.split("/");return 1===t.length?"./":(t.pop(),t.join("/")+"/")},initMaterials:function(e,t,n){for(var i=[],r=0;r<e.length;++r)i[r]=this.createMaterial(e[r],t,n);return i},createMaterial:function(){var e={NoBlending:Ma,NormalBlending:Ta,AdditiveBlending:Aa,SubtractiveBlending:La,MultiplyBlending:Ra,CustomBlending:Ca},t=new W,n=new Bn,i=new li;return function(r,a,o){function s(e,t,i,r,s){var l,c=a+e,h=hi.Handlers.get(c);null!==h?l=h.load(c):(n.setCrossOrigin(o),l=n.load(c)),void 0!==t&&(l.repeat.fromArray(t),1!==t[0]&&(l.wrapS=yo),1!==t[1]&&(l.wrapT=yo)),void 0!==i&&l.offset.fromArray(i),void 0!==r&&("repeat"===r[0]&&(l.wrapS=yo),"mirror"===r[0]&&(l.wrapS=xo),"repeat"===r[1]&&(l.wrapT=yo),"mirror"===r[1]&&(l.wrapT=xo)),void 0!==s&&(l.anisotropy=s);var d=Ss.generateUUID();return u[d]=l,d}var u={},l={uuid:Ss.generateUUID(),type:"MeshLambertMaterial"};for(var c in r){var h=r[c];switch(c){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":l.name=h;break;case"blending":l.blending=e[h];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",c,"is no longer supported.");break;case"colorDiffuse":l.color=t.fromArray(h).getHex();break;case"colorSpecular":l.specular=t.fromArray(h).getHex();break;case"colorEmissive":l.emissive=t.fromArray(h).getHex();break;case"specularCoef":l.shininess=h;break;case"shading":"basic"===h.toLowerCase()&&(l.type="MeshBasicMaterial"),"phong"===h.toLowerCase()&&(l.type="MeshPhongMaterial"),"standard"===h.toLowerCase()&&(l.type="MeshStandardMaterial");break;case"mapDiffuse":l.map=s(h,r.mapDiffuseRepeat,r.mapDiffuseOffset,r.mapDiffuseWrap,r.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":l.emissiveMap=s(h,r.mapEmissiveRepeat,r.mapEmissiveOffset,r.mapEmissiveWrap,r.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":l.lightMap=s(h,r.mapLightRepeat,r.mapLightOffset,r.mapLightWrap,r.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":l.aoMap=s(h,r.mapAORepeat,r.mapAOOffset,r.mapAOWrap,r.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":l.bumpMap=s(h,r.mapBumpRepeat,r.mapBumpOffset,r.mapBumpWrap,r.mapBumpAnisotropy);break;case"mapBumpScale":l.bumpScale=h;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":l.normalMap=s(h,r.mapNormalRepeat,r.mapNormalOffset,r.mapNormalWrap,r.mapNormalAnisotropy);break;case"mapNormalFactor":l.normalScale=[h,h];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":l.specularMap=s(h,r.mapSpecularRepeat,r.mapSpecularOffset,r.mapSpecularWrap,r.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":l.metalnessMap=s(h,r.mapMetalnessRepeat,r.mapMetalnessOffset,r.mapMetalnessWrap,r.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":l.roughnessMap=s(h,r.mapRoughnessRepeat,r.mapRoughnessOffset,r.mapRoughnessWrap,r.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":l.alphaMap=s(h,r.mapAlphaRepeat,r.mapAlphaOffset,r.mapAlphaWrap,r.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":l.side=ya;break;case"doubleSided":l.side=_a;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity"),l.opacity=h;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":l[c]=h;break;case"vertexColors":h===!0&&(l.vertexColors=Sa),"face"===h&&(l.vertexColors=Ea);break;default:console.error("THREE.Loader.createMaterial: Unsupported",c,h)}}return"MeshBasicMaterial"===l.type&&delete l.emissive,"MeshPhongMaterial"!==l.type&&delete l.specular,l.opacity<1&&(l.transparent=!0),i.setTextures(u),i.parse(l)}}()}),Object.assign(di.prototype,{load:function(e,t,n,i){var r=this,a=this.texturePath&&"string"==typeof this.texturePath?this.texturePath:hi.prototype.extractUrlBase(e),o=new On(this.manager);o.setWithCredentials(this.withCredentials),o.load(e,function(n){var i=JSON.parse(n),o=i.metadata;if(void 0!==o){var s=o.type;if(void 0!==s){if("object"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.ObjectLoader instead.");if("scene"===s.toLowerCase())return void console.error("THREE.JSONLoader: "+e+" should be loaded with THREE.SceneLoader instead.")}}var u=r.parse(i,a);t(u.geometry,u.materials)},n,i)},setTexturePath:function(e){this.texturePath=e},parse:function(){function e(e,n){function i(e,t){return e&1<<t}var r,a,o,u,l,c,h,d,f,p,m,g,v,y,_,x,b,w,E,S,M,T,A,L,R,C,P,I=e.faces,O=e.vertices,k=e.normals,D=e.colors,N=e.scale,U=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&U++;for(r=0;r<U;r++)n.faceVertexUvs[r]=[]}for(u=0,l=O.length;u<l;)w=new s,w.x=O[u++]*N,w.y=O[u++]*N,w.z=O[u++]*N,n.vertices.push(w);for(u=0,l=I.length;u<l;)if(p=I[u++],m=i(p,0),g=i(p,1),v=i(p,3),y=i(p,4),_=i(p,5),x=i(p,6),b=i(p,7),m){if(S=new de,S.a=I[u],S.b=I[u+1],S.c=I[u+3],M=new de,M.a=I[u+1],M.b=I[u+2],M.c=I[u+3],u+=4,g&&(f=I[u++],S.materialIndex=f,M.materialIndex=f),o=n.faces.length,v)for(r=0;r<U;r++)for(L=e.uvs[r],n.faceVertexUvs[r][o]=[],n.faceVertexUvs[r][o+1]=[],a=0;a<4;a++)d=I[u++],C=L[2*d],P=L[2*d+1],R=new t(C,P),2!==a&&n.faceVertexUvs[r][o].push(R),0!==a&&n.faceVertexUvs[r][o+1].push(R);if(y&&(h=3*I[u++],S.normal.set(k[h++],k[h++],k[h]),M.normal.copy(S.normal)),_)for(r=0;r<4;r++)h=3*I[u++],A=new s(k[h++],k[h++],k[h]),2!==r&&S.vertexNormals.push(A),0!==r&&M.vertexNormals.push(A);if(x&&(c=I[u++],T=D[c],S.color.setHex(T),M.color.setHex(T)),b)for(r=0;r<4;r++)c=I[u++],T=D[c],2!==r&&S.vertexColors.push(new W(T)),0!==r&&M.vertexColors.push(new W(T));n.faces.push(S),n.faces.push(M)}else{if(E=new de,E.a=I[u++],E.b=I[u++],E.c=I[u++],g&&(f=I[u++],E.materialIndex=f),o=n.faces.length,v)for(r=0;r<U;r++)for(L=e.uvs[r],n.faceVertexUvs[r][o]=[],a=0;a<3;a++)d=I[u++],C=L[2*d],P=L[2*d+1],R=new t(C,P),n.faceVertexUvs[r][o].push(R);if(y&&(h=3*I[u++],E.normal.set(k[h++],k[h++],k[h])),_)for(r=0;r<3;r++)h=3*I[u++],A=new s(k[h++],k[h++],k[h]),E.vertexNormals.push(A);if(x&&(c=I[u++],E.color.setHex(D[c])),b)for(r=0;r<3;r++)c=I[u++],E.vertexColors.push(new W(D[c]));n.faces.push(E)}}function n(e,t){var n=void 0!==e.influencesPerVertex?e.influencesPerVertex:2;if(e.skinWeights)for(var r=0,a=e.skinWeights.length;r<a;r+=n){var o=e.skinWeights[r],s=n>1?e.skinWeights[r+1]:0,u=n>2?e.skinWeights[r+2]:0,l=n>3?e.skinWeights[r+3]:0;t.skinWeights.push(new i(o,s,u,l))}if(e.skinIndices)for(var r=0,a=e.skinIndices.length;r<a;r+=n){var c=e.skinIndices[r],h=n>1?e.skinIndices[r+1]:0,d=n>2?e.skinIndices[r+2]:0,f=n>3?e.skinIndices[r+3]:0;t.skinIndices.push(new i(c,h,d,f))}t.bones=e.bones,t.bones&&t.bones.length>0&&(t.skinWeights.length!==t.skinIndices.length||t.skinIndices.length!==t.vertices.length)&&console.warn("When skinning, number of vertices ("+t.vertices.length+"), skinIndices ("+t.skinIndices.length+"), and skinWeights ("+t.skinWeights.length+") should match.")}function r(e,t){var n=e.scale;if(void 0!==e.morphTargets)for(var i=0,r=e.morphTargets.length;i<r;i++){t.morphTargets[i]={},t.morphTargets[i].name=e.morphTargets[i].name,t.morphTargets[i].vertices=[];for(var a=t.morphTargets[i].vertices,o=e.morphTargets[i].vertices,u=0,l=o.length;u<l;u+=3){var c=new s;c.x=o[u]*n,c.y=o[u+1]*n,c.z=o[u+2]*n,a.push(c)}}if(void 0!==e.morphColors&&e.morphColors.length>0){console.warn('THREE.JSONLoader: "morphColors" no longer supported. Using them as face colors.');for(var h=t.faces,d=e.morphColors[0].colors,i=0,r=h.length;i<r;i++)h[i].color.fromArray(d,3*i)}}function a(e,t){var n=[],i=[];void 0!==e.animation&&i.push(e.animation),void 0!==e.animations&&(e.animations.length?i=i.concat(e.animations):i.push(e.animations));for(var r=0;r<i.length;r++){var a=ui.parseAnimation(i[r],t.bones);a&&n.push(a)}if(t.morphTargets){var o=ui.CreateClipsFromMorphTargetSequences(t.morphTargets,10);n=n.concat(o)}n.length>0&&(t.animations=n)}return function(t,i){void 0!==t.data&&(t=t.data),void 0!==t.scale?t.scale=1/t.scale:t.scale=1;var o=new pe;if(e(t,o),n(t,o),r(t,o),a(t,o),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===t.materials||0===t.materials.length)return{geometry:o};var s=hi.prototype.initMaterials(t.materials,i,this.crossOrigin);return{geometry:o,materials:s}}}()}),Object.assign(fi.prototype,{load:function(e,t,n,i){""===this.texturePath&&(this.texturePath=e.substring(0,e.lastIndexOf("/")+1));var r=this,a=new On(r.manager);a.load(e,function(n){var a=null;try{a=JSON.parse(n)}catch(o){return void 0!==i&&i(o),void console.error("THREE:ObjectLoader: Can't parse "+e+".",o.message)}var s=a.metadata;return void 0===s||void 0===s.type||"geometry"===s.type.toLowerCase()?void console.error("THREE.ObjectLoader: Can't load "+e+". Use THREE.JSONLoader instead."):void r.parse(a,t)},n,i)},setTexturePath:function(e){this.texturePath=e},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e,t){var n=this.parseGeometries(e.geometries),i=this.parseImages(e.images,function(){void 0!==t&&t(o)}),r=this.parseTextures(e.textures,i),a=this.parseMaterials(e.materials,r),o=this.parseObject(e.object,n,a);return e.animations&&(o.animations=this.parseAnimations(e.animations)),void 0!==e.images&&0!==e.images.length||void 0!==t&&t(o),o},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new di,i=new ci,r=0,a=e.length;r<a;r++){var o,s=e[r];switch(s.type){case"PlaneGeometry":case"PlaneBufferGeometry":o=new Wl[s.type](s.width,s.height,s.widthSegments,s.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":o=new Wl[s.type](s.width,s.height,s.depth,s.widthSegments,s.heightSegments,s.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":o=new Wl[s.type](s.radius,s.segments,s.thetaStart,s.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":o=new Wl[s.type](s.radiusTop,s.radiusBottom,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":o=new Wl[s.type](s.radius,s.height,s.radialSegments,s.heightSegments,s.openEnded,s.thetaStart,s.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":o=new Wl[s.type](s.radius,s.widthSegments,s.heightSegments,s.phiStart,s.phiLength,s.thetaStart,s.thetaLength);break;case"DodecahedronGeometry":case"IcosahedronGeometry":case"OctahedronGeometry":case"TetrahedronGeometry":o=new Wl[s.type](s.radius,s.detail);break;case"RingGeometry":case"RingBufferGeometry":o=new Wl[s.type](s.innerRadius,s.outerRadius,s.thetaSegments,s.phiSegments,s.thetaStart,s.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":o=new Wl[s.type](s.radius,s.tube,s.radialSegments,s.tubularSegments,s.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":o=new Wl[s.type](s.radius,s.tube,s.tubularSegments,s.radialSegments,s.p,s.q);break;case"LatheGeometry":case"LatheBufferGeometry":o=new Wl[s.type](s.points,s.segments,s.phiStart,s.phiLength);break;case"BufferGeometry":o=i.parse(s);break;case"Geometry":o=n.parse(s,this.texturePath).geometry;break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+s.type+'"');continue}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),t[s.uuid]=o}return t},parseMaterials:function(e,t){var n={};if(void 0!==e){var i=new li;i.setTextures(t);for(var r=0,a=e.length;r<a;r++){var o=e[r];if("MultiMaterial"===o.type){for(var s=[],u=0;u<o.materials.length;u++)s.push(i.parse(o.materials[u]));n[o.uuid]=s}else n[o.uuid]=i.parse(o)}}return n},parseAnimations:function(e){for(var t=[],n=0;n<e.length;n++){var i=ui.parse(e[n]);t.push(i)}return t},parseImages:function(e,t){function n(e){return i.manager.itemStart(e),o.load(e,function(){i.manager.itemEnd(e)},void 0,function(){i.manager.itemEnd(e),i.manager.itemError(e)})}var i=this,r={};if(void 0!==e&&e.length>0){var a=new In(t),o=new Nn(a);o.setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;s<u;s++){var l=e[s],c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l.url)?l.url:i.texturePath+l.url;r[l.uuid]=n(c)}}return r},parseTextures:function(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var a=0,o=e.length;a<o;a++){var s=e[a];void 0===s.image&&console.warn('THREE.ObjectLoader: No "image" specified for',s.uuid),void 0===t[s.image]&&console.warn("THREE.ObjectLoader: Undefined image",s.image);var u=new n(t[s.image]);u.needsUpdate=!0,u.uuid=s.uuid,void 0!==s.name&&(u.name=s.name),void 0!==s.mapping&&(u.mapping=i(s.mapping,Ql)),void 0!==s.offset&&u.offset.fromArray(s.offset),void 0!==s.repeat&&u.repeat.fromArray(s.repeat),void 0!==s.wrap&&(u.wrapS=i(s.wrap[0],$l),u.wrapT=i(s.wrap[1],$l)),void 0!==s.minFilter&&(u.minFilter=i(s.minFilter,ec)),void 0!==s.magFilter&&(u.magFilter=i(s.magFilter,ec)),void 0!==s.anisotropy&&(u.anisotropy=s.anisotropy),void 0!==s.flipY&&(u.flipY=s.flipY),r[s.uuid]=u}return r},parseObject:function(){var e=new u;return function(t,n,i){function r(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),n[e]}function a(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];void 0===i[a]&&console.warn("THREE.ObjectLoader: Undefined material",a),t.push(i[a])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}var o;switch(t.type){case"Scene":o=new _t,void 0!==t.background&&Number.isInteger(t.background)&&(o.background=new W(t.background)),void 0!==t.fog&&("Fog"===t.fog.type?o.fog=new yt(t.fog.color,t.fog.near,t.fog.far):"FogExp2"===t.fog.type&&(o.fog=new vt(t.fog.color,t.fog.density)));break;case"PerspectiveCamera":o=new he(t.fov,t.aspect,t.near,t.far),void 0!==t.focus&&(o.focus=t.focus),void 0!==t.zoom&&(o.zoom=t.zoom),void 0!==t.filmGauge&&(o.filmGauge=t.filmGauge),void 0!==t.filmOffset&&(o.filmOffset=t.filmOffset),void 0!==t.view&&(o.view=Object.assign({},t.view));break;case"OrthographicCamera":o=new ce(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":o=new Xn(t.color,t.intensity);break;case"DirectionalLight":o=new qn(t.color,t.intensity);break;case"PointLight":o=new Vn(t.color,t.intensity,t.distance,t.decay);break;case"RectAreaLight":o=new Yn(t.color,t.intensity,t.width,t.height);break;case"SpotLight":o=new Hn(t.color,t.intensity,t.distance,t.angle,t.penumbra,t.decay);break;case"HemisphereLight":o=new jn(t.color,t.groundColor,t.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var s=r(t.geometry),u=a(t.material);o=s.bones&&s.bones.length>0?new Tt(s,u):new Ne(s,u);break;case"LOD":o=new Et;break;case"Line":o=new Lt(r(t.geometry),a(t.material),t.mode);break;case"LineLoop":o=new Ct(r(t.geometry),a(t.material));break;case"LineSegments":o=new Rt(r(t.geometry),a(t.material));break;case"PointCloud":case"Points":o=new It(r(t.geometry),a(t.material));break;case"Sprite":o=new wt(a(t.material));break;case"Group":o=new Ot;break;default:o=new ue}if(o.uuid=t.uuid,void 0!==t.name&&(o.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(o.position,o.quaternion,o.scale)):(void 0!==t.position&&o.position.fromArray(t.position),void 0!==t.rotation&&o.rotation.fromArray(t.rotation),void 0!==t.quaternion&&o.quaternion.fromArray(t.quaternion),void 0!==t.scale&&o.scale.fromArray(t.scale)),void 0!==t.castShadow&&(o.castShadow=t.castShadow),void 0!==t.receiveShadow&&(o.receiveShadow=t.receiveShadow),t.shadow&&(void 0!==t.shadow.bias&&(o.shadow.bias=t.shadow.bias),void 0!==t.shadow.radius&&(o.shadow.radius=t.shadow.radius),void 0!==t.shadow.mapSize&&o.shadow.mapSize.fromArray(t.shadow.mapSize),void 0!==t.shadow.camera&&(o.shadow.camera=this.parseObject(t.shadow.camera))),void 0!==t.visible&&(o.visible=t.visible),void 0!==t.userData&&(o.userData=t.userData),void 0!==t.children)for(var l in t.children)o.add(this.parseObject(t.children[l],n,i));if("LOD"===t.type)for(var c=t.levels,h=0;h<c.length;h++){var d=c[h],l=o.getObjectByProperty("uuid",d.object);void 0!==l&&o.addLevel(l,d.distance)}return o}}()});var Ql={UVMapping:lo,CubeReflectionMapping:co,CubeRefractionMapping:ho,EquirectangularReflectionMapping:fo,EquirectangularRefractionMapping:po,SphericalReflectionMapping:mo,CubeUVReflectionMapping:go,CubeUVRefractionMapping:vo},$l={RepeatWrapping:yo,ClampToEdgeWrapping:_o,MirroredRepeatWrapping:xo},ec={NearestFilter:bo,NearestMipMapNearestFilter:wo,NearestMipMapLinearFilter:Eo,LinearFilter:So,LinearMipMapNearestFilter:Mo,LinearMipMapLinearFilter:To};Object.assign(Si.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},getPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(e){void 0===e&&(e=5);for(var t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n,i=[],r=this.getPoint(0),a=0;for(i.push(0),n=1;n<=e;n++)t=this.getPoint(n/e),a+=t.distanceTo(r),i.push(a),r=t;return this.cacheArcLengths=i,i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,i=this.getLengths(),r=0,a=i.length;n=t?t:e*i[a-1];for(var o,s=0,u=a-1;s<=u;)if(r=Math.floor(s+(u-s)/2),o=i[r]-n,o<0)s=r+1;else{if(!(o>0)){u=r;break}u=r-1}if(r=u,i[r]===n)return r/(a-1);var l=i[r],c=i[r+1],h=c-l,d=(n-l)/h,f=(r+d)/(a-1);return f},getTangent:function(e){var t=1e-4,n=e-t,i=e+t;n<0&&(n=0),i>1&&(i=1);var r=this.getPoint(n),a=this.getPoint(i),o=a.clone().sub(r);return o.normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var n,i,r,a=new s,o=[],l=[],c=[],h=new s,d=new u;for(n=0;n<=e;n++)i=n/e,o[n]=this.getTangentAt(i),o[n].normalize();l[0]=new s,c[0]=new s;var f=Number.MAX_VALUE,p=Math.abs(o[0].x),m=Math.abs(o[0].y),g=Math.abs(o[0].z);for(p<=f&&(f=p,a.set(1,0,0)),m<=f&&(f=m,a.set(0,1,0)),g<=f&&a.set(0,0,1),h.crossVectors(o[0],a).normalize(),l[0].crossVectors(o[0],h),c[0].crossVectors(o[0],l[0]),n=1;n<=e;n++)l[n]=l[n-1].clone(),c[n]=c[n-1].clone(),h.crossVectors(o[n-1],o[n]),h.length()>Number.EPSILON&&(h.normalize(),r=Math.acos(Ss.clamp(o[n-1].dot(o[n]),-1,1)),l[n].applyMatrix4(d.makeRotationAxis(h,r))),c[n].crossVectors(o[n],l[n]);if(t===!0)for(r=Math.acos(Ss.clamp(l[0].dot(l[e]),-1,1)),r/=e,o[0].dot(h.crossVectors(l[0],l[e]))>0&&(r=-r),n=1;n<=e;n++)l[n].applyMatrix4(d.makeRotationAxis(o[n],r*n)),c[n].crossVectors(o[n],l[n]);return{tangents:o,normals:l,binormals:c}}}),Mi.prototype=Object.create(Si.prototype),Mi.prototype.constructor=Mi,Mi.prototype.isLineCurve=!0,Mi.prototype.getPoint=function(e){if(1===e)return this.v2.clone();var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},Mi.prototype.getPointAt=function(e){return this.getPoint(e)},Mi.prototype.getTangent=function(e){var t=this.v2.clone().sub(this.v1);return t.normalize()},Ti.prototype=Object.assign(Object.create(Si.prototype),{constructor:Ti,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Mi(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),i=0;i<n.length;){if(n[i]>=t){var r=n[i]-t,a=this.curves[i],o=a.getLength(),s=0===o?0:1-r/o;return a.getPointAt(s)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(e){void 0===e&&(e=40);for(var t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,n=[],i=0,r=this.curves;i<r.length;i++)for(var a=r[i],o=a&&a.isEllipseCurve?2*e:a&&a.isLineCurve?1:a&&a.isSplineCurve?e*a.points.length:e,s=a.getPoints(o),u=0;u<s.length;u++){var l=s[u];t&&t.equals(l)||(n.push(l),t=l)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},createPointsGeometry:function(e){var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){for(var t=new pe,n=0,i=e.length;n<i;n++){var r=e[n];t.vertices.push(new s(r.x,r.y,r.z||0))}return t}}),Ai.prototype=Object.create(Si.prototype),Ai.prototype.constructor=Ai,Ai.prototype.isEllipseCurve=!0,Ai.prototype.getPoint=function(e){for(var n=2*Math.PI,i=this.aEndAngle-this.aStartAngle,r=Math.abs(i)<Number.EPSILON;i<0;)i+=n;for(;i>n;)i-=n;i<Number.EPSILON&&(i=r?0:n),this.aClockwise!==!0||r||(i===n?i=-n:i-=n);var a=this.aStartAngle+e*i,o=this.aX+this.xRadius*Math.cos(a),s=this.aY+this.yRadius*Math.sin(a);if(0!==this.aRotation){var u=Math.cos(this.aRotation),l=Math.sin(this.aRotation),c=o-this.aX,h=s-this.aY;o=c*u-h*l+this.aX,s=c*l+h*u+this.aY}return new t(o,s)},Li.prototype=Object.create(Si.prototype),Li.prototype.constructor=Li,Li.prototype.isSplineCurve=!0,Li.prototype.getPoint=function(e){var n=this.points,i=(n.length-1)*e,r=Math.floor(i),a=i-r,o=n[0===r?r:r-1],s=n[r],u=n[r>n.length-2?n.length-1:r+1],l=n[r>n.length-3?n.length-1:r+2];return new t(pi(a,o.x,s.x,u.x,l.x),pi(a,o.y,s.y,u.y,l.y))},Ri.prototype=Object.create(Si.prototype),Ri.prototype.constructor=Ri,Ri.prototype.getPoint=function(e){var n=this.v0,i=this.v1,r=this.v2,a=this.v3;return new t(Ei(e,n.x,i.x,r.x,a.x),Ei(e,n.y,i.y,r.y,a.y))},Ci.prototype=Object.create(Si.prototype),Ci.prototype.constructor=Ci,Ci.prototype.getPoint=function(e){var n=this.v0,i=this.v1,r=this.v2;return new t(yi(e,n.x,i.x,r.x),yi(e,n.y,i.y,r.y))};var tc=Object.assign(Object.create(Ti.prototype),{fromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},moveTo:function(e,t){this.currentPoint.set(e,t)},lineTo:function(e,n){var i=new Mi(this.currentPoint.clone(),new t(e,n));this.curves.push(i),this.currentPoint.set(e,n)},quadraticCurveTo:function(e,n,i,r){var a=new Ci(this.currentPoint.clone(),new t(e,n),new t(i,r));this.curves.push(a),this.currentPoint.set(i,r)},bezierCurveTo:function(e,n,i,r,a,o){var s=new Ri(this.currentPoint.clone(),new t(e,n),new t(i,r),new t(a,o));this.curves.push(s),this.currentPoint.set(a,o)},splineThru:function(e){var t=[this.currentPoint.clone()].concat(e),n=new Li(t);this.curves.push(n),this.currentPoint.copy(e[e.length-1])},arc:function(e,t,n,i,r,a){var o=this.currentPoint.x,s=this.currentPoint.y;this.absarc(e+o,t+s,n,i,r,a)},absarc:function(e,t,n,i,r,a){this.absellipse(e,t,n,n,i,r,a)},ellipse:function(e,t,n,i,r,a,o,s){var u=this.currentPoint.x,l=this.currentPoint.y;this.absellipse(e+u,t+l,n,i,r,a,o,s)},absellipse:function(e,t,n,i,r,a,o,s){var u=new Ai(e,t,n,i,r,a,o,s);if(this.curves.length>0){var l=u.getPoint(0);l.equals(this.currentPoint)||this.lineTo(l.x,l.y)}this.curves.push(u);var c=u.getPoint(1);this.currentPoint.copy(c)}});Pi.prototype=tc,tc.constructor=Pi,Ii.prototype=Object.assign(Object.create(tc),{constructor:Ii,getPointsHoles:function(e){for(var t=[],n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t},extractAllPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},extractPoints:function(e){return this.extractAllPoints(e)}}),Object.assign(Oi.prototype,{moveTo:function(e,t){this.currentPath=new Pi,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t)},lineTo:function(e,t){this.currentPath.lineTo(e,t)},quadraticCurveTo:function(e,t,n,i){this.currentPath.quadraticCurveTo(e,t,n,i)},bezierCurveTo:function(e,t,n,i,r,a){this.currentPath.bezierCurveTo(e,t,n,i,r,a)},splineThru:function(e){this.currentPath.splineThru(e)},toShapes:function(e,t){function n(e){for(var t=[],n=0,i=e.length;n<i;n++){var r=e[n],a=new Ii;a.curves=r.curves,t.push(a)}return t}function i(e,t){for(var n=t.length,i=!1,r=n-1,a=0;a<n;r=a++){var o=t[r],s=t[a],u=s.x-o.x,l=s.y-o.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(o=t[a],u=-u,s=t[r],l=-l),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=l*(e.x-o.x)-u*(e.y-o.y);if(0===c)return!0;if(c<0)continue;i=!i}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return i}var r=Vl.isClockWise,a=this.subPaths;if(0===a.length)return[];if(t===!0)return n(a);var o,s,u,l=[];if(1===a.length)return s=a[0],u=new Ii,u.curves=s.curves,l.push(u),l;var c=!r(a[0].getPoints());c=e?!c:c;var h,d=[],f=[],p=[],m=0;f[m]=void 0,p[m]=[];for(var g=0,v=a.length;g<v;g++)s=a[g],h=s.getPoints(),o=r(h),o=e?!o:o,o?(!c&&f[m]&&m++,f[m]={s:new Ii,p:h},f[m].s.curves=s.curves,c&&m++,p[m]=[]):p[m].push({h:s,p:h[0]});if(!f[0])return n(a);if(f.length>1){for(var y=!1,_=[],x=0,b=f.length;x<b;x++)d[x]=[];for(var x=0,b=f.length;x<b;x++)for(var w=p[x],E=0;E<w.length;E++){for(var S=w[E],M=!0,T=0;T<f.length;T++)i(S.p,f[T].p)&&(x!==T&&_.push({froms:x,tos:T,hole:E}),M?(M=!1,d[T].push(S)):y=!0);M&&d[x].push(S)}_.length>0&&(y||(p=d))}for(var A,g=0,L=f.length;g<L;g++){u=f[g].s,l.push(u),A=p[g];for(var R=0,C=A.length;R<C;R++)u.holes.push(A[R].h)}return l}}),Object.assign(ki.prototype,{isFont:!0,generateShapes:function(e,t,n){function i(e){for(var n=String(e).split(""),i=t/a.resolution,o=(a.boundingBox.yMax-a.boundingBox.yMin+a.underlineThickness)*i,s=0,u=0,l=[],c=0;c<n.length;c++){var h=n[c];if("\n"===h)s=0,u-=o;else{var d=r(h,i,s,u);s+=d.offsetX,l.push(d.path)}}return l}function r(e,t,i,r){var o=a.glyphs[e]||a.glyphs["?"];if(o){var s,u,l,c,h,d,f,p,m,g,v,y=new Oi,_=[];if(o.o)for(var x=o._cachedOutline||(o._cachedOutline=o.o.split(" ")),b=0,w=x.length;b<w;){var E=x[b++];switch(E){case"m":s=x[b++]*t+i,u=x[b++]*t+r,y.moveTo(s,u);break;case"l":s=x[b++]*t+i,u=x[b++]*t+r,y.lineTo(s,u);break;case"q":if(l=x[b++]*t+i,c=x[b++]*t+r,f=x[b++]*t+i,p=x[b++]*t+r,y.quadraticCurveTo(f,p,l,c),v=_[_.length-1]){h=v.x,d=v.y;for(var S=1;S<=n;S++){var M=S/n;yi(M,h,f,l),yi(M,d,p,c)}}break;case"b":if(l=x[b++]*t+i,c=x[b++]*t+r,f=x[b++]*t+i,p=x[b++]*t+r,m=x[b++]*t+i,g=x[b++]*t+r,y.bezierCurveTo(f,p,m,g,l,c),v=_[_.length-1]){h=v.x,d=v.y;for(var S=1;S<=n;S++){var M=S/n;Ei(M,h,f,m,l),Ei(M,d,p,g,c)}}}}return{offsetX:o.ha*t,path:y}}}void 0===t&&(t=100),void 0===n&&(n=4);for(var a=this.data,o=i(e),s=[],u=0,l=o.length;u<l;u++)Array.prototype.push.apply(s,o[u].toShapes());return s}}),Object.assign(Di.prototype,{load:function(e,t,n,i){var r=this,a=new On(this.manager);a.load(e,function(e){var n;try{n=JSON.parse(e)}catch(i){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var a=r.parse(n);t&&t(a)},n,i)},parse:function(e){return new ki(e)}});var nc,ic={getContext:function(){return void 0===nc&&(nc=new(window.AudioContext||window.webkitAudioContext)),nc},setContext:function(e){nc=e}};Object.assign(Ni.prototype,{load:function(e,t,n,i){var r=new On(this.manager);r.setResponseType("arraybuffer"),r.load(e,function(e){var n=ic.getContext();n.decodeAudioData(e,function(e){t(e)})},n,i)}}),Object.assign(Ui.prototype,{update:function(){var e,t,n,i,r,a,o,s,l=new u,c=new u;return function(u){var h=e!==this||t!==u.focus||n!==u.fov||i!==u.aspect*this.aspect||r!==u.near||a!==u.far||o!==u.zoom||s!==this.eyeSep;if(h){e=this,t=u.focus,n=u.fov,i=u.aspect*this.aspect,r=u.near,a=u.far,o=u.zoom;var d=u.projectionMatrix.clone();s=this.eyeSep/2;var f,p,m=s*r/t,g=r*Math.tan(Ss.DEG2RAD*n*.5)/o;c.elements[12]=-s,l.elements[12]=s,f=-g*i+m,p=g*i+m,d.elements[0]=2*r/(p-f),d.elements[8]=(p+f)/(p-f),this.cameraL.projectionMatrix.copy(d),f=-g*i-m,p=g*i-m,d.elements[0]=2*r/(p-f),d.elements[8]=(p+f)/(p-f),this.cameraR.projectionMatrix.copy(d)}this.cameraL.matrixWorld.copy(u.matrixWorld).multiply(c),this.cameraR.matrixWorld.copy(u.matrixWorld).multiply(l)}}()}),Bi.prototype=Object.create(ue.prototype),Bi.prototype.constructor=Bi,Fi.prototype=Object.assign(Object.create(ue.prototype),{constructor:Fi,getInput:function(){return this.gain},removeFilter:function(){null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null)},getFilter:function(){return this.filter},setFilter:function(e){null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),
this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination)},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){this.gain.gain.value=e},updateMatrixWorld:function(){var e=new s,t=new o,n=new s,i=new s;return function(r){ue.prototype.updateMatrixWorld.call(this,r);var a=this.context.listener,o=this.up;this.matrixWorld.decompose(e,t,n),i.set(0,0,-1).applyQuaternion(t),a.positionX?(a.positionX.setValueAtTime(e.x,this.context.currentTime),a.positionY.setValueAtTime(e.y,this.context.currentTime),a.positionZ.setValueAtTime(e.z,this.context.currentTime),a.forwardX.setValueAtTime(i.x,this.context.currentTime),a.forwardY.setValueAtTime(i.y,this.context.currentTime),a.forwardZ.setValueAtTime(i.z,this.context.currentTime),a.upX.setValueAtTime(o.x,this.context.currentTime),a.upY.setValueAtTime(o.y,this.context.currentTime),a.upZ.setValueAtTime(o.z,this.context.currentTime)):(a.setPosition(e.x,e.y,e.z),a.setOrientation(i.x,i.y,i.z,o.x,o.y,o.z))}}()}),ji.prototype=Object.assign(Object.create(ue.prototype),{constructor:ji,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(){if(this.isPlaying===!0)return void console.warn("THREE.Audio: Audio is already playing.");if(this.hasPlaybackControl===!1)return void console.warn("THREE.Audio: this Audio has no playback control.");var e=this.context.createBufferSource();return e.buffer=this.buffer,e.loop=this.loop,e.onended=this.onEnded.bind(this),e.playbackRate.setValueAtTime(this.playbackRate,this.startTime),e.start(0,this.startTime),this.isPlaying=!0,this.source=e,this.connect()},pause:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=this.context.currentTime,this.isPlaying=!1,this)},stop:function(){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.source.stop(),this.startTime=0,this.isPlaying=!1,this)},connect:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e||(e=[]),this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime),this)},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){return this.hasPlaybackControl===!1?void console.warn("THREE.Audio: this Audio has no playback control."):(this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this)},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.value=e,this}}),zi.prototype=Object.assign(Object.create(ji.prototype),{constructor:zi,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){this.panner.refDistance=e},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){this.panner.rolloffFactor=e},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){this.panner.distanceModel=e},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){this.panner.maxDistance=e},updateMatrixWorld:function(){var e=new s;return function(t){ue.prototype.updateMatrixWorld.call(this,t),e.setFromMatrixPosition(this.matrixWorld),this.panner.setPosition(e.x,e.y,e.z)}}()}),Object.assign(Gi.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}),Object.assign(Hi.prototype,{accumulate:function(e,t){var n=this.buffer,i=this.valueSize,r=e*i+i,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==i;++o)n[r+o]=n[o];a=t}else{a+=t;var s=t/a;this._mixBufferRegion(n,r,0,s,i)}this.cumulativeWeight=a},apply:function(e){var t=this.valueSize,n=this.buffer,i=e*t+t,r=this.cumulativeWeight,a=this.binding;if(this.cumulativeWeight=0,r<1){var o=3*t;this._mixBufferRegion(n,i,o,1-r,t)}for(var s=t,u=t+t;s!==u;++s)if(n[s]!==n[s+t]){a.setValue(n,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,i=3*n;e.getValue(t,i);for(var r=n,a=i;r!==a;++r)t[r]=t[i+r%n];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,n,i,r){if(i>=.5)for(var a=0;a!==r;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,i){o.slerpFlat(e,t,e,t,e,n,i)},_lerp:function(e,t,n,i,r){for(var a=1-i,o=0;o!==r;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*i}}}),Object.assign(Vi.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,i=this._bindings[n];void 0!==i&&i.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,i=this._targetGroup.nCachedObjects_,r=n.length;i!==r;++i)n[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Wi,{Composite:Vi,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Wi.Composite(e,t,n):new Wi(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(/[^\w-]/g,"")},parseTrackName:function(){var e=/((?:[\w-]+[\/:])*)/,t=/([\w-\.]+)?/,n=/(?:\.([\w-]+)(?:\[(.+)\])?)?/,i=/\.([\w-]+)(?:\[(.+)\])?/,r=new RegExp("^"+e.source+t.source+n.source+i.source+"$"),a=["material","materials","bones"];return function(e){var t=r.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==i&&i!==-1){var o=n.nodeName.substring(i+1);a.indexOf(o)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=o)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}}(),findNode:function(e,t){if(!t||""===t||"root"===t||"."===t||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=function(e){for(var n=0;n<e.bones.length;n++){var i=e.bones[n];if(i.name===t)return i}return null},i=n(e.skeleton);if(i)return i}if(e.children){var r=function(e){for(var n=0;n<e.length;n++){var i=e[n];if(i.name===t||i.uuid===t)return i;var a=r(i.children);if(a)return a}return null},a=r(e.children);if(a)return a}return null}}),Object.assign(Wi.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)e[t++]=n[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.node[this.propertyName]=e[t]},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.node[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++]},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,i=0,r=n.length;i!==r;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,i=t.propertyName,r=t.propertyIndex;if(e||(e=Wi.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[i];if(void 0===s){var u=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e)}var l=this.Versioning.None;void 0!==e.needsUpdate?(l=this.Versioning.NeedsUpdate,this.targetObject=e):void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate,this.targetObject=e);var c=this.BindingType.Direct;if(void 0!==r){if("morphTargetInfluences"===i){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(var o=0;o<this.node.geometry.morphAttributes.position.length;o++)if(e.geometry.morphAttributes.position[o].name===r){r=o;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(var o=0;o<this.node.geometry.morphTargets.length;o++)if(e.geometry.morphTargets[o].name===r){r=o;break}}}c=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=r}else void 0!==s.fromArray&&void 0!==s.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(c=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Wi.prototype,{_getValue_unbound:Wi.prototype.getValue,_setValue_unbound:Wi.prototype.setValue}),Object.assign(qi.prototype,{isAnimationObjectGroup:!0,add:function(e){for(var t=this._objects,n=t.length,i=this.nCachedObjects_,r=this._indicesByUUID,a=this._paths,o=this._parsedPaths,s=this._bindings,u=s.length,l=0,c=arguments.length;l!==c;++l){var h=arguments[l],d=h.uuid,f=r[d],p=void 0;if(void 0===f){f=n++,r[d]=f,t.push(h);for(var m=0,g=u;m!==g;++m)s[m].push(new Wi(h,a[m],o[m]))}else if(f<i){p=t[f];var v=--i,y=t[v];r[y.uuid]=f,t[f]=y,r[d]=v,t[v]=h;for(var m=0,g=u;m!==g;++m){var _=s[m],x=_[v],b=_[f];_[f]=x,void 0===b&&(b=new Wi(h,a[m],o[m])),_[v]=b}}else t[f]!==p&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=i},remove:function(e){for(var t=this._objects,n=this.nCachedObjects_,i=this._indicesByUUID,r=this._bindings,a=r.length,o=0,s=arguments.length;o!==s;++o){var u=arguments[o],l=u.uuid,c=i[l];if(void 0!==c&&c>=n){var h=n++,d=t[h];i[d.uuid]=c,t[c]=d,i[l]=h,t[h]=u;for(var f=0,p=a;f!==p;++f){var m=r[f],g=m[h],v=m[c];m[c]=g,m[h]=v}}}this.nCachedObjects_=n},uncache:function(e){for(var t=this._objects,n=t.length,i=this.nCachedObjects_,r=this._indicesByUUID,a=this._bindings,o=a.length,s=0,u=arguments.length;s!==u;++s){var l=arguments[s],c=l.uuid,h=r[c];if(void 0!==h)if(delete r[c],h<i){var d=--i,f=t[d],p=--n,m=t[p];r[f.uuid]=h,t[h]=f,r[m.uuid]=d,t[d]=m,t.pop();for(var g=0,v=o;g!==v;++g){var y=a[g],_=y[d],x=y[p];y[h]=_,y[d]=x,y.pop()}}else{var p=--n,m=t[p];r[m.uuid]=h,t[h]=m,t.pop();for(var g=0,v=o;g!==v;++g){var y=a[g];y[h]=y[p],y.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,i=n[e],r=this._bindings;if(void 0!==i)return r[i];var a=this._paths,o=this._parsedPaths,s=this._objects,u=s.length,l=this.nCachedObjects_,c=new Array(u);i=r.length,n[e]=i,a.push(e),o.push(t),r.push(c);for(var h=l,d=s.length;h!==d;++h){var f=s[h];c[h]=new Wi(f,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var i=this._paths,r=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o],u=e[o];t[u]=n,a[n]=s,a.pop(),r[n]=r[o],r.pop(),i[n]=i[o],i.pop()}}}),Object.assign(Xi.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var i=this._clip.duration,r=e._clip.duration,a=r/i,o=i/r;e.warp(1,a,t),this.warp(o,1,t)}return this},crossFadeTo:function(e,t,n){return e.crossFadeFrom(this,t,n)},stopFading:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,n){var i=this._mixer,r=i.time,a=this._timeScaleInterpolant,o=this.timeScale;null===a&&(a=i._lendControlInterpolant(),this._timeScaleInterpolant=a);var s=a.parameterPositions,u=a.sampleValues;return s[0]=r,s[1]=r+n,u[0]=e/o,u[1]=t/o,this},stopWarping:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,n,i){if(!this.enabled)return void this._updateWeight(e);var r=this._startTime;if(null!==r){var a=(e-r)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0)for(var u=this._interpolants,l=this._propertyBindings,c=0,h=u.length;c!==h;++c)u[c].evaluate(o),l[c].accumulate(i,s)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),0===i&&(this.enabled=!1))}}return this._effectiveWeight=t,t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n){var i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t},_updateTime:function(e){var t=this.time+e;if(0===e)return t;var n=this._clip.duration,i=this.loop,r=this._loopCount;if(i===ns){r===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(t>=n)t=n;else{if(!(t<0))break e;t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{var a=i===rs;if(r===-1&&(e>=0?(r=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),t>=n||t<0){var o=Math.floor(t/n);t-=n*o,r+=Math.abs(o);var s=this.repetitions-r;if(s<0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=e>0?n:0,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(0===s){var u=e<0;this._setEndings(u,!u,a)}else this._setEndings(!1,!1,a);this._loopCount=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}if(a&&1===(1&r))return this.time=t,n-t}return this.time=t,t},_setEndings:function(e,t,n){var i=this._interpolantSettings;n?(i.endingStart=ls,i.endingEnd=ls):(e?i.endingStart=this.zeroSlopeAtStart?ls:us:i.endingStart=cs,t?i.endingEnd=this.zeroSlopeAtEnd?ls:us:i.endingEnd=cs)},_scheduleFading:function(e,t,n){var i=this._mixer,r=i.time,a=this._weightInterpolant;null===a&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=r,s[0]=t,o[1]=r+e,s[1]=n,this}}),Object.assign(Yi.prototype,e.prototype,{_bindAction:function(e,t){var n=e._localRoot||this._root,i=e._clip.tracks,r=i.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,l=u[s];void 0===l&&(l={},u[s]=l);for(var c=0;c!==r;++c){var h=i[c],d=h.name,f=l[d];if(void 0!==f)a[c]=f;else{if(f=a[c],void 0!==f){null===f._cacheIndex&&(++f.referenceCount,this._addInactiveBinding(f,s,d));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;f=new Hi(Wi.create(n,d,p),h.ValueTypeName,h.getValueSize()),++f.referenceCount,this._addInactiveBinding(f,s,d),a[c]=f}o[c].resultBuffer=f.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,i=this._actionsByClip[n];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,n,t)}for(var r=e._propertyBindings,a=0,o=r.length;a!==o;++a){var s=r[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.useCount&&(r.restoreOriginalState(),this._takeBackBinding(r))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var i=this._actions,r=this._actionsByClip,a=r[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,r[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;var r=e._clip.uuid,a=this._actionsByClip,o=a[r],s=o.knownActions,u=s[s.length-1],l=e._byClipCacheIndex;u._byClipCacheIndex=l,s[l]=u,s.pop(),e._byClipCacheIndex=null;var c=o.actionByRoot,h=(e._localRoot||this._root).uuid;delete c[h],0===s.length&&delete a[r],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,i=t.length;n!==i;++n){var r=t[n];0===--r.referenceCount&&this._removeInactiveBinding(r)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_addInactiveBinding:function(e,t,n){var i=this._bindingsByRootAndName,r=i[t],a=this._bindings;void 0===r&&(r={},i[t]=r),r[n]=e,e._cacheIndex=a.length,a.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,i=n.rootNode.uuid,r=n.path,a=this._bindingsByRootAndName,o=a[i],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[r];e:{for(var l in o)break e;delete a[i]}},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,r=t[i];e._cacheIndex=i,t[i]=e,r._cacheIndex=n,t[n]=r},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&(n=new Jn(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),n.__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,r=t[i];e.__cacheIndex=i,t[i]=e,r.__cacheIndex=n,t[n]=r},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?ui.findByName(n,e):e,a=null!==r?r.uuid:e,o=this._actionsByClip[a],s=null;if(void 0!==o){var u=o.actionByRoot[i];if(void 0!==u)return u;s=o.knownActions[0],null===r&&(r=s._clip)}if(null===r)return null;var l=new Xi(this,r,t);return this._bindAction(l,s),this._addInactiveAction(l,a,i),l},existingAction:function(e,t){var n=t||this._root,i=n.uuid,r="string"==typeof e?ui.findByName(n,e):e,a=r?r.uuid:e,o=this._actionsByClip[a];return void 0!==o?o.actionByRoot[i]||null:null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,n=this._bindings,i=this._nActiveBindings;this._nActiveActions=0,this._nActiveBindings=0;for(var r=0;r!==t;++r)e[r].reset();for(var r=0;r!==i;++r)n[r].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,i=this.time+=e,r=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){var s=t[o];s._update(i,e,r,a)}for(var u=this._bindings,l=this._nActiveBindings,o=0;o!==l;++o)u[o].apply(a);return this},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,i=this._actionsByClip,r=i[n];if(void 0!==r){for(var a=r.knownActions,o=0,s=a.length;o!==s;++o){var u=a[o];this._deactivateAction(u);var l=u._cacheIndex,c=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,c._cacheIndex=l,t[l]=c,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var i in n){var r=n[i].actionByRoot,a=r[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var o=this._bindingsByRootAndName,s=o[t];if(void 0!==s)for(var u in s){var l=s[u];l.restoreOriginalState(),this._removeInactiveBinding(l)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}),Ki.prototype.clone=function(){return new Ki(void 0===this.value.clone?this.value:this.value.clone())},Zi.prototype=Object.assign(Object.create(Ae.prototype),{constructor:Zi,isInstancedBufferGeometry:!0,addGroup:function(e,t,n){this.groups.push({start:e,count:t,materialIndex:n})},copy:function(e){var t=e.index;null!==t&&this.setIndex(t.clone());var n=e.attributes;for(var i in n){var r=n[i];this.addAttribute(i,r.clone())}for(var a=e.groups,o=0,s=a.length;o<s;o++){var u=a[o];this.addGroup(u.start,u.count,u.materialIndex)}return this}}),Object.defineProperties(Ji.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(Ji.prototype,{isInterleavedBufferAttribute:!0,setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this},setXYZW:function(e,t,n,i,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=r,this}}),Object.defineProperty(Qi.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(Qi.prototype,{isInterleavedBuffer:!0,setArray:function(e){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.count=void 0!==e?e.length/this.stride:0,this.array=e},setDynamic:function(e){return this.dynamic=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.dynamic=e.dynamic,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var i=0,r=this.stride;i<r;i++)this.array[e+i]=t.array[n+i];return this},set:function(e,t){return void 0===t&&(t=0),this.array.set(e,t),this},clone:function(){return(new this.constructor).copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}}),$i.prototype=Object.assign(Object.create(Qi.prototype),{constructor:$i,isInstancedInterleavedBuffer:!0,copy:function(e){return Qi.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),er.prototype=Object.assign(Object.create(me.prototype),{constructor:er,isInstancedBufferAttribute:!0,copy:function(e){return me.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(tr.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize()):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld)):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t){var n=[];return ir(e,this,n,t),n.sort(nr),n},intersectObjects:function(e,t){var n=[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),n;for(var i=0,r=e.length;i<r;i++)ir(e[i],this,n,t);return n.sort(nr),n}}),Object.assign(rr.prototype,{start:function(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=("undefined"==typeof performance?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}),Object.assign(ar.prototype,{set:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this},setFromVector3:function(e){return this.radius=e.length(),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e.x,e.z),this.phi=Math.acos(Ss.clamp(e.y/this.radius,-1,1))),this}}),Object.assign(or.prototype,{set:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.radius=Math.sqrt(e.x*e.x+e.z*e.z),this.theta=Math.atan2(e.x,e.z),this.y=e.y,this}}),sr.prototype=Object.create(Ne.prototype),sr.prototype.constructor=sr,sr.prototype.createAnimation=function(e,t,n,i){var r={start:t,end:n,length:n-t+1,fps:i,duration:(n-t)/i,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},sr.prototype.autoCreateAnimations=function(e){for(var t,n=/([a-z]+)_?(\d+)/i,i={},r=this.geometry,a=0,o=r.morphTargets.length;a<o;a++){var s=r.morphTargets[a],u=s.name.match(n);if(u&&u.length>1){var l=u[1];i[l]||(i[l]={start:1/0,end:-(1/0)});var c=i[l];a<c.start&&(c.start=a),a>c.end&&(c.end=a),t||(t=l)}}for(var l in i){var c=i[l];this.createAnimation(l,c.start,c.end,e)}this.firstAnimation=t},sr.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},sr.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},sr.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},sr.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},sr.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},sr.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];
n&&(n.time=t)},sr.prototype.getAnimationTime=function(e){var t=0,n=this.animationsMap[e];return n&&(t=n.time),t},sr.prototype.getAnimationDuration=function(e){var t=-1,n=this.animationsMap[e];return n&&(t=n.duration),t},sr.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("THREE.MorphBlendMesh: animation["+e+"] undefined in .playAnimation()")},sr.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},sr.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var i=this.animationsList[t];if(i.active){var r=i.duration/i.length;i.time+=i.direction*e,i.mirroredLoop?(i.time>i.duration||i.time<0)&&(i.direction*=-1,i.time>i.duration&&(i.time=i.duration,i.directionBackwards=!0),i.time<0&&(i.time=0,i.directionBackwards=!1)):(i.time=i.time%i.duration,i.time<0&&(i.time+=i.duration));var a=i.start+Ss.clamp(Math.floor(i.time/r),0,i.length-1),o=i.weight;a!==i.currentFrame&&(this.morphTargetInfluences[i.lastFrame]=0,this.morphTargetInfluences[i.currentFrame]=1*o,this.morphTargetInfluences[a]=0,i.lastFrame=i.currentFrame,i.currentFrame=a);var s=i.time%r/r;i.directionBackwards&&(s=1-s),i.currentFrame!==i.lastFrame?(this.morphTargetInfluences[i.currentFrame]=s*o,this.morphTargetInfluences[i.lastFrame]=(1-s)*o):this.morphTargetInfluences[i.currentFrame]=o}}},ur.prototype=Object.create(ue.prototype),ur.prototype.constructor=ur,ur.prototype.isImmediateRenderObject=!0,lr.prototype=Object.create(Rt.prototype),lr.prototype.constructor=lr,lr.prototype.update=function(){var e=new s,t=new s,n=new te;return function(){var i=["a","b","c"];this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);var r=this.object.matrixWorld,a=this.geometry.attributes.position,o=this.object.geometry;if(o&&o.isGeometry)for(var s=o.vertices,u=o.faces,l=0,c=0,h=u.length;c<h;c++)for(var d=u[c],f=0,p=d.vertexNormals.length;f<p;f++){var m=s[d[i[f]]],g=d.vertexNormals[f];e.copy(m).applyMatrix4(r),t.copy(g).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(l,e.x,e.y,e.z),l+=1,a.setXYZ(l,t.x,t.y,t.z),l+=1}else if(o&&o.isBufferGeometry)for(var v=o.attributes.position,y=o.attributes.normal,l=0,f=0,p=v.count;f<p;f++)e.set(v.getX(f),v.getY(f),v.getZ(f)).applyMatrix4(r),t.set(y.getX(f),y.getY(f),y.getZ(f)),t.applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),a.setXYZ(l,e.x,e.y,e.z),l+=1,a.setXYZ(l,t.x,t.y,t.z),l+=1;a.needsUpdate=!0}}(),cr.prototype=Object.create(ue.prototype),cr.prototype.constructor=cr,cr.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},cr.prototype.update=function(){var e=new s,t=new s;return function(){this.light.updateMatrixWorld();var n=this.light.distance?this.light.distance:1e3,i=n*Math.tan(this.light.angle);this.cone.scale.set(i,i,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color)}}(),dr.prototype=Object.create(Rt.prototype),dr.prototype.constructor=dr,dr.prototype.onBeforeRender=function(){var e=new s,t=new u,n=new u;return function(){var i=this.bones,r=this.geometry,a=r.getAttribute("position");n.getInverse(this.root.matrixWorld);for(var o=0,s=0;o<i.length;o++){var u=i[o];u.parent&&u.parent.isBone&&(t.multiplyMatrices(n,u.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(s,e.x,e.y,e.z),t.multiplyMatrices(n,u.parent.matrixWorld),e.setFromMatrixPosition(t),a.setXYZ(s+1,e.x,e.y,e.z),s+=2)}r.getAttribute("position").needsUpdate=!0}}(),fr.prototype=Object.create(Ne.prototype),fr.prototype.constructor=fr,fr.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},fr.prototype.update=function(){this.material.color.copy(this.light.color)},pr.prototype=Object.create(ue.prototype),pr.prototype.constructor=pr,pr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},pr.prototype.update=function(){var e=this.children[0];e.material.color.copy(this.light.color);var t=.5*this.light.width,n=.5*this.light.height,i=e.geometry.attributes.position,r=i.array;r[0]=t,r[1]=-n,r[2]=0,r[3]=t,r[4]=n,r[5]=0,r[6]=-t,r[7]=n,r[8]=0,r[9]=-t,r[10]=-n,r[11]=0,r[12]=t,r[13]=-n,r[14]=0,i.needsUpdate=!0},mr.prototype=Object.create(ue.prototype),mr.prototype.constructor=mr,mr.prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},mr.prototype.update=function(){var e=new s,t=new W,n=new W;return function(){var i=this.children[0],r=i.geometry.getAttribute("color");t.copy(this.light.color),n.copy(this.light.groundColor);for(var a=0,o=r.count;a<o;a++){var s=a<o/2?t:n;r.setXYZ(a,s.r,s.g,s.b)}i.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),r.needsUpdate=!0}}(),gr.prototype=Object.create(Rt.prototype),gr.prototype.constructor=gr,vr.prototype=Object.create(Rt.prototype),vr.prototype.constructor=vr,yr.prototype=Object.create(Rt.prototype),yr.prototype.constructor=yr,yr.prototype.update=function(){var e=new s,t=new s,n=new te;return function(){this.object.updateMatrixWorld(!0),n.getNormalMatrix(this.object.matrixWorld);for(var i=this.object.matrixWorld,r=this.geometry.attributes.position,a=this.object.geometry,o=a.vertices,s=a.faces,u=0,l=0,c=s.length;l<c;l++){var h=s[l],d=h.normal;e.copy(o[h.a]).add(o[h.b]).add(o[h.c]).divideScalar(3).applyMatrix4(i),t.copy(d).applyMatrix3(n).normalize().multiplyScalar(this.size).add(e),r.setXYZ(u,e.x,e.y,e.z),u+=1,r.setXYZ(u,t.x,t.y,t.z),u+=1}r.needsUpdate=!0}}(),_r.prototype=Object.create(ue.prototype),_r.prototype.constructor=_r,_r.prototype.dispose=function(){var e=this.children[0],t=this.children[1];e.geometry.dispose(),e.material.dispose(),t.geometry.dispose(),t.material.dispose()},_r.prototype.update=function(){var e=new s,t=new s,n=new s;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e);var i=this.children[0],r=this.children[1];i.lookAt(n),i.material.color.copy(this.light.color),r.lookAt(n),r.scale.z=n.length()}}(),xr.prototype=Object.create(Rt.prototype),xr.prototype.constructor=xr,xr.prototype.update=function(){function e(e,a,o,s){i.set(a,o,s).unproject(r);var u=n[e];if(void 0!==u)for(var l=t.getAttribute("position"),c=0,h=u.length;c<h;c++)l.setXYZ(u[c],i.x,i.y,i.z)}var t,n,i=new s,r=new le;return function(){t=this.geometry,n=this.pointMap;var i=1,a=1;r.projectionMatrix.copy(this.camera.projectionMatrix),e("c",0,0,-1),e("t",0,0,1),e("n1",-i,-a,-1),e("n2",i,-a,-1),e("n3",-i,a,-1),e("n4",i,a,-1),e("f1",-i,-a,1),e("f2",i,-a,1),e("f3",-i,a,1),e("f4",i,a,1),e("u1",.7*i,1.1*a,-1),e("u2",.7*-i,1.1*a,-1),e("u3",0,2*a,-1),e("cf1",-i,0,1),e("cf2",i,0,1),e("cf3",0,-a,1),e("cf4",0,a,1),e("cn1",-i,0,-1),e("cn2",i,0,-1),e("cn3",0,-a,-1),e("cn4",0,a,-1),t.getAttribute("position").needsUpdate=!0}}(),br.prototype=Object.create(Rt.prototype),br.prototype.constructor=br,br.prototype.update=function(){var e=new Q;return function(t){if(void 0!==t&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&e.setFromObject(this.object),!e.isEmpty()){var n=e.min,i=e.max,r=this.geometry.attributes.position,a=r.array;a[0]=i.x,a[1]=i.y,a[2]=i.z,a[3]=n.x,a[4]=i.y,a[5]=i.z,a[6]=n.x,a[7]=n.y,a[8]=i.z,a[9]=i.x,a[10]=n.y,a[11]=i.z,a[12]=i.x,a[13]=i.y,a[14]=n.z,a[15]=n.x,a[16]=i.y,a[17]=n.z,a[18]=n.x,a[19]=n.y,a[20]=n.z,a[21]=i.x,a[22]=n.y,a[23]=n.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}}(),br.prototype.setFromObject=function(e){return this.object=e,this.update(),this};var rc,ac;wr.prototype=Object.create(ue.prototype),wr.prototype.constructor=wr,wr.prototype.setDirection=function(){var e,t=new s;return function(n){n.y>.99999?this.quaternion.set(0,0,0,1):n.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(n.z,0,-n.x).normalize(),e=Math.acos(n.y),this.quaternion.setFromAxisAngle(t,e))}}(),wr.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,Math.max(0,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},wr.prototype.setColor=function(e){this.line.material.color.copy(e),this.cone.material.color.copy(e)},Er.prototype=Object.create(Rt.prototype),Er.prototype.constructor=Er;var oc=new s,sc=new Sr,uc=new Sr,lc=new Sr;Mr.prototype=Object.create(Si.prototype),Mr.prototype.constructor=Mr,Mr.prototype.getPoint=function(e){var t=this.points,n=t.length,i=(n-(this.closed?0:1))*e,r=Math.floor(i),a=i-r;this.closed?r+=r>0?0:(Math.floor(Math.abs(r)/t.length)+1)*t.length:0===a&&r===n-1&&(r=n-2,a=1);var o,u,l,c;if(this.closed||r>0?o=t[(r-1)%n]:(oc.subVectors(t[0],t[1]).add(t[0]),o=oc),u=t[r%n],l=t[(r+1)%n],this.closed||r+2<n?c=t[(r+2)%n]:(oc.subVectors(t[n-1],t[n-2]).add(t[n-1]),c=oc),void 0===this.type||"centripetal"===this.type||"chordal"===this.type){var h="chordal"===this.type?.5:.25,d=Math.pow(o.distanceToSquared(u),h),f=Math.pow(u.distanceToSquared(l),h),p=Math.pow(l.distanceToSquared(c),h);f<1e-4&&(f=1),d<1e-4&&(d=f),p<1e-4&&(p=f),sc.initNonuniformCatmullRom(o.x,u.x,l.x,c.x,d,f,p),uc.initNonuniformCatmullRom(o.y,u.y,l.y,c.y,d,f,p),lc.initNonuniformCatmullRom(o.z,u.z,l.z,c.z,d,f,p)}else if("catmullrom"===this.type){var m=void 0!==this.tension?this.tension:.5;sc.initCatmullRom(o.x,u.x,l.x,c.x,m),uc.initCatmullRom(o.y,u.y,l.y,c.y,m),lc.initCatmullRom(o.z,u.z,l.z,c.z,m)}return new s(sc.calc(a),uc.calc(a),lc.calc(a))},Tr.prototype=Object.create(Si.prototype),Tr.prototype.constructor=Tr,Tr.prototype.getPoint=function(e){var t=this.v0,n=this.v1,i=this.v2,r=this.v3;return new s(Ei(e,t.x,n.x,i.x,r.x),Ei(e,t.y,n.y,i.y,r.y),Ei(e,t.z,n.z,i.z,r.z))},Ar.prototype=Object.create(Si.prototype),Ar.prototype.constructor=Ar,Ar.prototype.getPoint=function(e){var t=this.v0,n=this.v1,i=this.v2;return new s(yi(e,t.x,n.x,i.x),yi(e,t.y,n.y,i.y),yi(e,t.z,n.z,i.z))},Lr.prototype=Object.create(Si.prototype),Lr.prototype.constructor=Lr,Lr.prototype.getPoint=function(e){if(1===e)return this.v2.clone();var t=new s;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t},Rr.prototype=Object.create(Ai.prototype),Rr.prototype.constructor=Rr;var cc={createMultiMaterialObject:function(e,t){for(var n=new Ot,i=0,r=t.length;i<r;i++)n.add(new Ne(e,t[i]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){e.applyMatrix((new u).getInverse(n.matrixWorld)),t.remove(e),n.add(e)}},hc=0,dc=1;Si.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Si.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Zr.prototype=Object.create(Mr.prototype),Jr.prototype=Object.create(Mr.prototype),Qr.prototype=Object.create(Mr.prototype),Object.assign(Qr.prototype,{initFromArray:function(e){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(e){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(e){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),gr.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},dr.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(q.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Q.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),ke.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Ss.random16=function(){return console.warn("THREE.Math.random16() has been deprecated. Use Math.random() instead."),Math.random()},Object.assign(te.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(e){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function(e,t,n){return console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(e,t,n){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(u.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){var e;return function(){return void 0===e&&(e=new s),console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),e.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(e){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function(e,t,n){return console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead."),this.applyToBufferAttribute(e)},applyToVector3Array:function(e,t,n){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,i,r,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,n,r,a)}}),ne.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},o.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(Oe.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Ii.prototype,{extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new rn(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new pn(this,e)}}),Object.assign(t.prototype,{fromAttribute:function(e,t,n){return console.error("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)}}),Object.assign(s.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.error("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)}}),Object.assign(i.prototype,{fromAttribute:function(e,t,n){return console.error("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)}}),pe.prototype.computeTangents=function(){console.warn("THREE.Geometry: .computeTangents() has been removed.")},Object.assign(ue.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)}}),Object.defineProperties(ue.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.defineProperties(Et.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(St.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Object.defineProperty(Si.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),he.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Fn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(me.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}}}),Object.assign(Ae.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}}),Object.defineProperties(Ae.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Ki.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(K.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new W}}}),Object.defineProperties(An.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Z.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(gt.prototype,{getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")}}),Object.defineProperties(gt.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){return this.shadowMap.cullFace},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapCullFace is now .shadowMap.cullFace."),this.shadowMap.cullFace=e}}}),Object.defineProperties(re.prototype,{cullFace:{get:function(){return this.renderReverseSided?ca:la},set:function(e){var t=e!==la;console.warn("WebGLRenderer: .shadowMap.cullFace is deprecated. Set .shadowMap.renderReverseSided to "+t+"."),this.renderReverseSided=t}}}),Object.defineProperties(r.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),ji.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this,n=new Ni;return n.load(e,function(e){t.setBuffer(e)}),this},Gi.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()};var fc={merge:function(e,t,n){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var i;t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,n)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},pc={crossOrigin:"*",loadTexture:function(e,t,n,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var r=new Bn;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),a},loadTextureCube:function(e,t,n,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var r=new Un;r.setCrossOrigin(this.crossOrigin);var a=r.load(e,n,void 0,i);return t&&(a.mapping=t),
a},loadCompressedTexture:function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};exports.WebGLRenderTargetCube=a,exports.WebGLRenderTarget=r,exports.WebGLRenderer=gt,exports.ShaderLib=Fl,exports.UniformsLib=ks,exports.UniformsUtils=Ds,exports.ShaderChunk=Bl,exports.FogExp2=vt,exports.Fog=yt,exports.Scene=_t,exports.LensFlare=xt,exports.Sprite=wt,exports.LOD=Et,exports.SkinnedMesh=Tt,exports.Skeleton=St,exports.Bone=Mt,exports.Mesh=Ne,exports.LineSegments=Rt,exports.LineLoop=Ct,exports.Line=Lt,exports.Points=It,exports.Group=Ot,exports.VideoTexture=kt,exports.DataTexture=l,exports.CompressedTexture=Dt,exports.CubeTexture=c,exports.CanvasTexture=Nt,exports.DepthTexture=Ut,exports.Texture=n,exports.CompressedTextureLoader=kn,exports.DataTextureLoader=Dn,exports.CubeTextureLoader=Un,exports.TextureLoader=Bn,exports.ObjectLoader=fi,exports.MaterialLoader=li,exports.BufferGeometryLoader=ci,exports.DefaultLoadingManager=Yl,exports.LoadingManager=In,exports.JSONLoader=di,exports.ImageLoader=Nn,exports.FontLoader=Di,exports.FileLoader=On,exports.Loader=hi,exports.Cache=Xl,exports.AudioLoader=Ni,exports.SpotLightShadow=Gn,exports.SpotLight=Hn,exports.PointLight=Vn,exports.RectAreaLight=Yn,exports.HemisphereLight=jn,exports.DirectionalLightShadow=Wn,exports.DirectionalLight=qn,exports.AmbientLight=Xn,exports.LightShadow=zn,exports.Light=Fn,exports.StereoCamera=Ui,exports.PerspectiveCamera=he,exports.OrthographicCamera=ce,exports.CubeCamera=Bi,exports.ArrayCamera=dt,exports.Camera=le,exports.AudioListener=Fi,exports.PositionalAudio=zi,exports.AudioContext=ic,exports.AudioAnalyser=Gi,exports.Audio=ji,exports.VectorKeyframeTrack=ei,exports.StringKeyframeTrack=ri,exports.QuaternionKeyframeTrack=ni,exports.NumberKeyframeTrack=ii,exports.ColorKeyframeTrack=oi,exports.BooleanKeyframeTrack=ai,exports.PropertyMixer=Hi,exports.PropertyBinding=Wi,exports.KeyframeTrack=si,exports.AnimationUtils=Kl,exports.AnimationObjectGroup=qi,exports.AnimationMixer=Yi,exports.AnimationClip=ui,exports.Uniform=Ki,exports.InstancedBufferGeometry=Zi,exports.BufferGeometry=Ae,exports.GeometryIdCount=fe,exports.Geometry=pe,exports.InterleavedBufferAttribute=Ji,exports.InstancedInterleavedBuffer=$i,exports.InterleavedBuffer=Qi,exports.InstancedBufferAttribute=er,exports.Face3=de,exports.Object3D=ue,exports.Raycaster=tr,exports.Layers=se,exports.EventDispatcher=e,exports.Clock=rr,exports.QuaternionLinearInterpolant=ti,exports.LinearInterpolant=Jn,exports.DiscreteInterpolant=Qn,exports.CubicInterpolant=Zn,exports.Interpolant=Kn,exports.Triangle=De,exports.Math=Ss,exports.Spherical=ar,exports.Cylindrical=or,exports.Plane=ne,exports.Frustum=ie,exports.Sphere=ee,exports.Ray=Oe,exports.Matrix4=u,exports.Matrix3=te,exports.Box3=Q,exports.Box2=q,exports.Line3=ke,exports.Euler=oe,exports.Vector4=i,exports.Vector3=s,exports.Vector2=t,exports.Quaternion=o,exports.Color=W,exports.MorphBlendMesh=sr,exports.ImmediateRenderObject=ur,exports.VertexNormalsHelper=lr,exports.SpotLightHelper=cr,exports.SkeletonHelper=dr,exports.PointLightHelper=fr,exports.RectAreaLightHelper=pr,exports.HemisphereLightHelper=mr,exports.GridHelper=gr,exports.PolarGridHelper=vr,exports.FaceNormalsHelper=yr,exports.DirectionalLightHelper=_r,exports.CameraHelper=xr,exports.BoxHelper=br,exports.ArrowHelper=wr,exports.AxisHelper=Er,exports.CatmullRomCurve3=Mr,exports.CubicBezierCurve3=Tr,exports.QuadraticBezierCurve3=Ar,exports.LineCurve3=Lr,exports.ArcCurve=Rr,exports.EllipseCurve=Ai,exports.SplineCurve=Li,exports.CubicBezierCurve=Ri,exports.QuadraticBezierCurve=Ci,exports.LineCurve=Mi,exports.Shape=Ii,exports.Path=Pi,exports.ShapePath=Oi,exports.Font=ki,exports.CurvePath=Ti,exports.Curve=Si,exports.ShapeUtils=Vl,exports.SceneUtils=cc,exports.WireframeGeometry=Bt,exports.ParametricGeometry=Ft,exports.ParametricBufferGeometry=jt,exports.TetrahedronGeometry=Ht,exports.TetrahedronBufferGeometry=Vt,exports.OctahedronGeometry=Wt,exports.OctahedronBufferGeometry=qt,exports.IcosahedronGeometry=Xt,exports.IcosahedronBufferGeometry=Yt,exports.DodecahedronGeometry=Kt,exports.DodecahedronBufferGeometry=Zt,exports.PolyhedronGeometry=zt,exports.PolyhedronBufferGeometry=Gt,exports.TubeGeometry=Jt,exports.TubeBufferGeometry=Qt,exports.TorusKnotGeometry=$t,exports.TorusKnotBufferGeometry=en,exports.TorusGeometry=tn,exports.TorusBufferGeometry=nn,exports.TextGeometry=on,exports.TextBufferGeometry=sn,exports.SphereGeometry=un,exports.SphereBufferGeometry=ln,exports.RingGeometry=cn,exports.RingBufferGeometry=hn,exports.PlaneGeometry=Ce,exports.PlaneBufferGeometry=Pe,exports.LatheGeometry=dn,exports.LatheBufferGeometry=fn,exports.ShapeGeometry=pn,exports.ShapeBufferGeometry=mn,exports.ExtrudeGeometry=rn,exports.ExtrudeBufferGeometry=an,exports.EdgesGeometry=gn,exports.ConeGeometry=_n,exports.ConeBufferGeometry=xn,exports.CylinderGeometry=vn,exports.CylinderBufferGeometry=yn,exports.CircleGeometry=bn,exports.CircleBufferGeometry=wn,exports.BoxGeometry=Le,exports.BoxBufferGeometry=Re,exports.ShadowMaterial=En,exports.SpriteMaterial=bt,exports.RawShaderMaterial=Sn,exports.ShaderMaterial=Z,exports.PointsMaterial=Pt,exports.MeshPhysicalMaterial=Tn,exports.MeshStandardMaterial=Mn,exports.MeshPhongMaterial=An,exports.MeshToonMaterial=Ln,exports.MeshNormalMaterial=Rn,exports.MeshLambertMaterial=Cn,exports.MeshDepthMaterial=J,exports.MeshBasicMaterial=Ie,exports.LineDashedMaterial=Pn,exports.LineBasicMaterial=At,exports.Material=K,exports.Float64BufferAttribute=Se,exports.Float32BufferAttribute=Ee,exports.Uint32BufferAttribute=we,exports.Int32BufferAttribute=be,exports.Uint16BufferAttribute=xe,exports.Int16BufferAttribute=_e,exports.Uint8ClampedBufferAttribute=ye,exports.Uint8BufferAttribute=ve,exports.Int8BufferAttribute=ge,exports.BufferAttribute=me,exports.REVISION=oa,exports.MOUSE=sa,exports.CullFaceNone=ua,exports.CullFaceBack=la,exports.CullFaceFront=ca,exports.CullFaceFrontBack=ha,exports.FrontFaceDirectionCW=da,exports.FrontFaceDirectionCCW=fa,exports.BasicShadowMap=pa,exports.PCFShadowMap=ma,exports.PCFSoftShadowMap=ga,exports.FrontSide=va,exports.BackSide=ya,exports.DoubleSide=_a,exports.FlatShading=xa,exports.SmoothShading=ba,exports.NoColors=wa,exports.FaceColors=Ea,exports.VertexColors=Sa,exports.NoBlending=Ma,exports.NormalBlending=Ta,exports.AdditiveBlending=Aa,exports.SubtractiveBlending=La,exports.MultiplyBlending=Ra,exports.CustomBlending=Ca,exports.AddEquation=Pa,exports.SubtractEquation=Ia,exports.ReverseSubtractEquation=Oa,exports.MinEquation=ka,exports.MaxEquation=Da,exports.ZeroFactor=Na,exports.OneFactor=Ua,exports.SrcColorFactor=Ba,exports.OneMinusSrcColorFactor=Fa,exports.SrcAlphaFactor=ja,exports.OneMinusSrcAlphaFactor=za,exports.DstAlphaFactor=Ga,exports.OneMinusDstAlphaFactor=Ha,exports.DstColorFactor=Va,exports.OneMinusDstColorFactor=Wa,exports.SrcAlphaSaturateFactor=qa,exports.NeverDepth=Xa,exports.AlwaysDepth=Ya,exports.LessDepth=Ka,exports.LessEqualDepth=Za,exports.EqualDepth=Ja,exports.GreaterEqualDepth=Qa,exports.GreaterDepth=$a,exports.NotEqualDepth=eo,exports.MultiplyOperation=to,exports.MixOperation=no,exports.AddOperation=io,exports.NoToneMapping=ro,exports.LinearToneMapping=ao,exports.ReinhardToneMapping=oo,exports.Uncharted2ToneMapping=so,exports.CineonToneMapping=uo,exports.UVMapping=lo,exports.CubeReflectionMapping=co,exports.CubeRefractionMapping=ho,exports.EquirectangularReflectionMapping=fo,exports.EquirectangularRefractionMapping=po,exports.SphericalReflectionMapping=mo,exports.CubeUVReflectionMapping=go,exports.CubeUVRefractionMapping=vo,exports.RepeatWrapping=yo,exports.ClampToEdgeWrapping=_o,exports.MirroredRepeatWrapping=xo,exports.NearestFilter=bo,exports.NearestMipMapNearestFilter=wo,exports.NearestMipMapLinearFilter=Eo,exports.LinearFilter=So,exports.LinearMipMapNearestFilter=Mo,exports.LinearMipMapLinearFilter=To,exports.UnsignedByteType=Ao,exports.ByteType=Lo,exports.ShortType=Ro,exports.UnsignedShortType=Co,exports.IntType=Po,exports.UnsignedIntType=Io,exports.FloatType=Oo,exports.HalfFloatType=ko,exports.UnsignedShort4444Type=Do,exports.UnsignedShort5551Type=No,exports.UnsignedShort565Type=Uo,exports.UnsignedInt248Type=Bo,exports.AlphaFormat=Fo,exports.RGBFormat=jo,exports.RGBAFormat=zo,exports.LuminanceFormat=Go,exports.LuminanceAlphaFormat=Ho,exports.RGBEFormat=Vo,exports.DepthFormat=Wo,exports.DepthStencilFormat=qo,exports.RGB_S3TC_DXT1_Format=Xo,exports.RGBA_S3TC_DXT1_Format=Yo,exports.RGBA_S3TC_DXT3_Format=Ko,exports.RGBA_S3TC_DXT5_Format=Zo,exports.RGB_PVRTC_4BPPV1_Format=Jo,exports.RGB_PVRTC_2BPPV1_Format=Qo,exports.RGBA_PVRTC_4BPPV1_Format=$o,exports.RGBA_PVRTC_2BPPV1_Format=es,exports.RGB_ETC1_Format=ts,exports.LoopOnce=ns,exports.LoopRepeat=is,exports.LoopPingPong=rs,exports.InterpolateDiscrete=as,exports.InterpolateLinear=os,exports.InterpolateSmooth=ss,exports.ZeroCurvatureEnding=us,exports.ZeroSlopeEnding=ls,exports.WrapAroundEnding=cs,exports.TrianglesDrawMode=hs,exports.TriangleStripDrawMode=ds,exports.TriangleFanDrawMode=fs,exports.LinearEncoding=ps,exports.sRGBEncoding=ms,exports.GammaEncoding=gs,exports.RGBEEncoding=vs,exports.LogLuvEncoding=ys,exports.RGBM7Encoding=_s,exports.RGBM16Encoding=xs,exports.RGBDEncoding=bs,exports.BasicDepthPacking=ws,exports.RGBADepthPacking=Es,exports.CubeGeometry=Le,exports.Face4=Cr,exports.LineStrip=hc,exports.LinePieces=dc,exports.MeshFaceMaterial=Pr,exports.MultiMaterial=Ir,exports.PointCloud=Or,exports.Particle=kr,exports.ParticleSystem=Dr,exports.PointCloudMaterial=Nr,exports.ParticleBasicMaterial=Ur,exports.ParticleSystemMaterial=Br,exports.Vertex=Fr,exports.DynamicBufferAttribute=jr,exports.Int8Attribute=zr,exports.Uint8Attribute=Gr,exports.Uint8ClampedAttribute=Hr,exports.Int16Attribute=Vr,exports.Uint16Attribute=Wr,exports.Int32Attribute=qr,exports.Uint32Attribute=Xr,exports.Float32Attribute=Yr,exports.Float64Attribute=Kr,exports.ClosedSplineCurve3=Zr,exports.SplineCurve3=Jr,exports.Spline=Qr,exports.BoundingBoxHelper=$r,exports.EdgesHelper=ea,exports.WireframeHelper=ta,exports.XHRLoader=na,exports.BinaryTextureLoader=ia,exports.GeometryUtils=fc,exports.ImageUtils=pc,exports.Projector=ra,exports.CanvasRenderer=aa,Object.defineProperty(exports,"__esModule",{value:!0})}),THREE.OBJLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager,this.materials=null,this.regexp={vertex_pattern:/^v\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,normal_pattern:/^vn\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,uv_pattern:/^vt\s+([\d|\.|\+|\-|e|E]+)\s+([\d|\.|\+|\-|e|E]+)/,face_vertex:/^f\s+(-?\d+)\s+(-?\d+)\s+(-?\d+)(?:\s+(-?\d+))?/,face_vertex_uv:/^f\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+))?/,face_vertex_uv_normal:/^f\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)\s+(-?\d+)\/(-?\d+)\/(-?\d+)(?:\s+(-?\d+)\/(-?\d+)\/(-?\d+))?/,face_vertex_normal:/^f\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)\s+(-?\d+)\/\/(-?\d+)(?:\s+(-?\d+)\/\/(-?\d+))?/,object_pattern:/^[og]\s*(.+)?/,smoothing_pattern:/^s\s+(\d+|on|off)/,material_library_pattern:/^mtllib /,material_use_pattern:/^usemtl /}},THREE.OBJLoader.prototype={constructor:THREE.OBJLoader,load:function(e,t,n,i){var r=this,a=new THREE.FileLoader(r.manager);a.setPath(this.path),a.load(e,function(e){t(r.parse(e))},n,i)},setPath:function(e){this.path=e},setMaterials:function(e){this.materials=e},_createParserState:function(){var e={objects:[],object:{},vertices:[],normals:[],uvs:[],materialLibraries:[],startObject:function(e,t){if(this.object&&this.object.fromDeclaration===!1)return this.object.name=e,void(this.object.fromDeclaration=t!==!1);var n=this.object&&"function"==typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0),this.object={name:e||"",fromDeclaration:t!==!1,geometry:{vertices:[],normals:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(e,t){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var i={index:this.materials.length,name:e||"",mtllib:Array.isArray(t)&&t.length>0?t[t.length-1]:"",smooth:void 0!==n?n.smooth:this.smooth,groupStart:void 0!==n?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(e){var t={index:"number"==typeof e?e:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return t.clone=this.clone.bind(t),t}};return this.materials.push(i),i},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(e){var t=this.currentMaterial();if(t&&t.groupEnd===-1&&(t.groupEnd=this.geometry.vertices.length/3,t.groupCount=t.groupEnd-t.groupStart,t.inherited=!1),e&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return e&&0===this.materials.length&&this.materials.push({name:"",smooth:this.smooth}),t}},n&&n.name&&"function"==typeof n.clone){var i=n.clone(0);i.inherited=!0,this.object.materials.push(i)}this.objects.push(this.object)},finalize:function(){this.object&&"function"==typeof this.object._finalize&&this.object._finalize(!0)},parseVertexIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseNormalIndex:function(e,t){var n=parseInt(e,10);return 3*(n>=0?n-1:n+t/3)},parseUVIndex:function(e,t){var n=parseInt(e,10);return 2*(n>=0?n-1:n+t/2)},addVertex:function(e,t,n){var i=this.vertices,r=this.object.geometry.vertices;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addVertexLine:function(e){var t=this.vertices,n=this.object.geometry.vertices;n.push(t[e+0]),n.push(t[e+1]),n.push(t[e+2])},addNormal:function(e,t,n){var i=this.normals,r=this.object.geometry.normals;r.push(i[e+0]),r.push(i[e+1]),r.push(i[e+2]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[t+2]),r.push(i[n+0]),r.push(i[n+1]),r.push(i[n+2])},addUV:function(e,t,n){var i=this.uvs,r=this.object.geometry.uvs;r.push(i[e+0]),r.push(i[e+1]),r.push(i[t+0]),r.push(i[t+1]),r.push(i[n+0]),r.push(i[n+1])},addUVLine:function(e){var t=this.uvs,n=this.object.geometry.uvs;n.push(t[e+0]),n.push(t[e+1])},addFace:function(e,t,n,i,r,a,o,s,u,l,c,h){var d,f=this.vertices.length,p=this.parseVertexIndex(e,f),m=this.parseVertexIndex(t,f),g=this.parseVertexIndex(n,f);if(void 0===i?this.addVertex(p,m,g):(d=this.parseVertexIndex(i,f),this.addVertex(p,m,d),this.addVertex(m,g,d)),void 0!==r){var v=this.uvs.length;p=this.parseUVIndex(r,v),m=this.parseUVIndex(a,v),g=this.parseUVIndex(o,v),void 0===i?this.addUV(p,m,g):(d=this.parseUVIndex(s,v),this.addUV(p,m,d),this.addUV(m,g,d))}if(void 0!==u){var y=this.normals.length;p=this.parseNormalIndex(u,y),m=u===l?p:this.parseNormalIndex(l,y),g=u===c?p:this.parseNormalIndex(c,y),void 0===i?this.addNormal(p,m,g):(d=this.parseNormalIndex(h,y),this.addNormal(p,m,d),this.addNormal(m,g,d))}},addLineGeometry:function(e,t){this.object.geometry.type="Line";for(var n=this.vertices.length,i=this.uvs.length,r=0,a=e.length;r<a;r++)this.addVertexLine(this.parseVertexIndex(e[r],n));for(var o=0,a=t.length;o<a;o++)this.addUVLine(this.parseUVIndex(t[o],i))}};return e.startObject("",!1),e},parse:function(e){console.time("OBJLoader");var t=this._createParserState();e.indexOf("\r\n")!==-1&&(e=e.replace(/\r\n/g,"\n")),e.indexOf("\\\n")!==-1&&(e=e.replace(/\\\n/g,""));for(var n=e.split("\n"),i="",r="",a="",o=0,s=[],u="function"==typeof"".trimLeft,l=0,c=n.length;l<c;l++)if(i=n[l],i=u?i.trimLeft():i.trim(),o=i.length,0!==o&&(r=i.charAt(0),"#"!==r))if("v"===r)if(a=i.charAt(1)," "===a&&null!==(s=this.regexp.vertex_pattern.exec(i)))t.vertices.push(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else if("n"===a&&null!==(s=this.regexp.normal_pattern.exec(i)))t.normals.push(parseFloat(s[1]),parseFloat(s[2]),parseFloat(s[3]));else{if("t"!==a||null===(s=this.regexp.uv_pattern.exec(i)))throw new Error("Unexpected vertex/normal/uv line: '"+i+"'");t.uvs.push(parseFloat(s[1]),parseFloat(s[2]))}else if("f"===r)if(null!==(s=this.regexp.face_vertex_uv_normal.exec(i)))t.addFace(s[1],s[4],s[7],s[10],s[2],s[5],s[8],s[11],s[3],s[6],s[9],s[12]);else if(null!==(s=this.regexp.face_vertex_uv.exec(i)))t.addFace(s[1],s[3],s[5],s[7],s[2],s[4],s[6],s[8]);else if(null!==(s=this.regexp.face_vertex_normal.exec(i)))t.addFace(s[1],s[3],s[5],s[7],void 0,void 0,void 0,void 0,s[2],s[4],s[6],s[8]);else{if(null===(s=this.regexp.face_vertex.exec(i)))throw new Error("Unexpected face line: '"+i+"'");t.addFace(s[1],s[2],s[3],s[4])}else if("l"===r){var h=i.substring(1).trim().split(" "),d=[],f=[];if(i.indexOf("/")===-1)d=h;else for(var p=0,m=h.length;p<m;p++){var g=h[p].split("/");""!==g[0]&&d.push(g[0]),""!==g[1]&&f.push(g[1])}t.addLineGeometry(d,f)}else if(null!==(s=this.regexp.object_pattern.exec(i))){var v=(" "+s[0].substr(1).trim()).substr(1);t.startObject(v)}else if(this.regexp.material_use_pattern.test(i))t.object.startMaterial(i.substring(7).trim(),t.materialLibraries);else if(this.regexp.material_library_pattern.test(i))t.materialLibraries.push(i.substring(7).trim());else{if(null===(s=this.regexp.smoothing_pattern.exec(i))){if("\0"===i)continue;throw new Error("Unexpected line: '"+i+"'")}var y=s[1].trim().toLowerCase();t.object.smooth="1"===y||"on"===y;var _=t.object.currentMaterial();_&&(_.smooth=t.object.smooth)}t.finalize();var x=new THREE.Group;x.materialLibraries=[].concat(t.materialLibraries);for(var l=0,c=t.objects.length;l<c;l++){var b=t.objects[l],w=b.geometry,E=b.materials,S="Line"===w.type;if(0!==w.vertices.length){var M=new THREE.BufferGeometry;M.addAttribute("position",new THREE.BufferAttribute(new Float32Array(w.vertices),3)),w.normals.length>0?M.addAttribute("normal",new THREE.BufferAttribute(new Float32Array(w.normals),3)):M.computeVertexNormals(),w.uvs.length>0&&M.addAttribute("uv",new THREE.BufferAttribute(new Float32Array(w.uvs),2));for(var T=[],A=0,L=E.length;A<L;A++){var R=E[A],_=void 0;if(null!==this.materials&&(_=this.materials.create(R.name),S&&_&&!(_ instanceof THREE.LineBasicMaterial))){var C=new THREE.LineBasicMaterial;C.copy(_),_=C}_||(_=S?new THREE.LineBasicMaterial:new THREE.MeshPhongMaterial,_.name=R.name),_.shading=R.smooth?THREE.SmoothShading:THREE.FlatShading,T.push(_)}var P;if(T.length>1){for(var A=0,L=E.length;A<L;A++){var R=E[A];M.addGroup(R.groupStart,R.groupCount,A)}var I=new THREE.MultiMaterial(T);P=S?new THREE.LineSegments(M,I):new THREE.Mesh(M,I)}else P=S?new THREE.LineSegments(M,T[0]):new THREE.Mesh(M,T[0]);P.name=b.name,x.add(P)}}return console.timeEnd("OBJLoader"),x}},THREE.VRControls=function(e,t){function n(e){r=e,e.length>0?i=e[0]:t&&t("VR input not available.")}var i,r,a=this,o=new THREE.Matrix4,s=null;"VRFrameData"in window&&(s=new VRFrameData),navigator.getVRDisplays&&navigator.getVRDisplays().then(n)["catch"](function(){console.warn("THREE.VRControls: Unable to get VR Displays")}),this.scale=1,this.standing=!1,this.userHeight=0,this.getVRDisplay=function(){return i},this.setVRDisplay=function(e){i=e},this.getVRDisplays=function(){return console.warn("THREE.VRControls: getVRDisplays() is being deprecated."),r},this.getStandingMatrix=function(){return o},this.update=function(){if(i){var t;i.getFrameData?(i.getFrameData(s),t=s.pose):i.getPose&&(t=i.getPose()),null!==t.orientation&&e.quaternion.fromArray(t.orientation),null!==t.position?e.position.fromArray(t.position):e.position.set(0,0,0),this.standing&&(i.stageParameters?(e.updateMatrix(),o.fromArray(i.stageParameters.sittingToStandingTransform),e.applyMatrix(o)):e.position.setY(e.position.y+this.userHeight)),e.position.multiplyScalar(a.scale)}},this.dispose=function(){i=null}};